
/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.54.1/HERE_NOTICE
 */

(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var m,aa=[];function ba(a){return function(){return aa[a].apply(this,arguments)}}function ca(a,b){return aa[a]=b}function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ea(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:da(a)}}function fa(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}
function ia(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ja=ia(this),ka="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function la(a,b){if(b)a:{var c=ja;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ka(c,a,{configurable:!0,writable:!0,value:b})}}
la("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.Fx=f;ka(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.Fx};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
la("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ja[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ka(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ma(da(this))}})}return a});function ma(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function na(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}la("Array.prototype.keys",function(a){return a?a:function(){return na(this,function(b){return b})}});
la("Array.prototype.find",function(a){return a?a:function(b,c){a:{var d=this;d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var g=d[f];if(b.call(c,g,f,d)){b=g;break a}}b=void 0}return b}});var oa;if("function"==typeof Object.setPrototypeOf)oa=Object.setPrototypeOf;else{var pa;a:{var qa={a:!0},ra={};try{ra.__proto__=qa;pa=ra.a;break a}catch(a){}pa=!1}oa=pa?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var sa=oa;
la("Object.setPrototypeOf",function(a){return a||sa});la("Array.prototype.entries",function(a){return a?a:function(){return na(this,function(b,c){return[b,c]})}});
la("Promise",function(a){function b(g){this.o=0;this.lf=void 0;this.Rh=[];this.Qu=!1;var h=this.Wo();try{g(h.resolve,h.reject)}catch(k){h.reject(k)}}function c(){this.De=null}function d(g){return g instanceof b?g:new b(function(h){h(g)})}if(a)return a;c.prototype.bt=function(g){if(null==this.De){this.De=[];var h=this;this.ct(function(){h.Ry()})}this.De.push(g)};var e=ja.setTimeout;c.prototype.ct=function(g){e(g,0)};c.prototype.Ry=function(){for(;this.De&&this.De.length;){var g=this.De;this.De=[];
for(var h=0;h<g.length;++h){var k=g[h];g[h]=null;try{k()}catch(l){this.dy(l)}}}this.De=null};c.prototype.dy=function(g){this.ct(function(){throw g;})};b.prototype.Wo=function(){function g(l){return function(n){k||(k=!0,l.call(h,n))}}var h=this,k=!1;return{resolve:g(this.EC),reject:g(this.ur)}};b.prototype.EC=function(g){if(g===this)this.ur(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.VC(g);else{a:switch(typeof g){case "object":var h=null!=g;break a;case "function":h=
!0;break a;default:h=!1}h?this.DC(g):this.Xt(g)}};b.prototype.DC=function(g){var h=void 0;try{h=g.then}catch(k){this.ur(k);return}"function"==typeof h?this.WC(h,g):this.Xt(g)};b.prototype.ur=function(g){this.Tw(2,g)};b.prototype.Xt=function(g){this.Tw(1,g)};b.prototype.Tw=function(g,h){if(0!=this.o)throw Error("Cannot settle("+g+", "+h+"): Promise already settled in state"+this.o);this.o=g;this.lf=h;2===this.o&&this.IC();this.Ty()};b.prototype.IC=function(){var g=this;e(function(){if(g.CB()){var h=
ja.console;"undefined"!==typeof h&&h.error(g.lf)}},1)};b.prototype.CB=function(){if(this.Qu)return!1;var g=ja.CustomEvent,h=ja.Event,k=ja.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):"function"===typeof h?g=new h("unhandledrejection",{cancelable:!0}):(g=ja.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.lf;return k(g)};b.prototype.Ty=function(){if(null!=this.Rh){for(var g=
0;g<this.Rh.length;++g)f.bt(this.Rh[g]);this.Rh=null}};var f=new c;b.prototype.VC=function(g){var h=this.Wo();g.zl(h.resolve,h.reject)};b.prototype.WC=function(g,h){var k=this.Wo();try{g.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};b.prototype.then=function(g,h){function k(q,r){return"function"==typeof q?function(v){try{l(q(v))}catch(w){n(w)}}:r}var l,n,p=new b(function(q,r){l=q;n=r});this.zl(k(g,l),k(h,n));return p};b.prototype.catch=function(g){return this.then(void 0,g)};b.prototype.zl=function(g,
h){function k(){switch(l.o){case 1:g(l.lf);break;case 2:h(l.lf);break;default:throw Error("Unexpected state: "+l.o);}}var l=this;null==this.Rh?f.bt(k):this.Rh.push(k);this.Qu=!0};b.resolve=d;b.reject=function(g){return new b(function(h,k){k(g)})};b.race=function(g){return new b(function(h,k){for(var l=ea(g),n=l.next();!n.done;n=l.next())d(n.value).zl(h,k)})};b.all=function(g){var h=ea(g),k=h.next();return k.done?d([]):new b(function(l,n){function p(v){return function(w){q[v]=w;r--;0==r&&l(q)}}var q=
[],r=0;do q.push(void 0),r++,d(k.value).zl(p(q.length-1),n),k=h.next();while(!k.done)})};return b});la("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push([d,b[d]]);return c}});la("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push(b[d]);return c}});la("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}});
la("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}});
la("String.prototype.includes",function(a){return a?a:function(b,c){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==(this+"").indexOf(b,c||0)}});
la("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});function ua(a){return a?a:Array.prototype.fill}la("Int8Array.prototype.fill",ua);la("Uint8Array.prototype.fill",ua);la("Uint8ClampedArray.prototype.fill",ua);la("Int16Array.prototype.fill",ua);la("Uint16Array.prototype.fill",ua);la("Int32Array.prototype.fill",ua);
la("Uint32Array.prototype.fill",ua);la("Float32Array.prototype.fill",ua);la("Float64Array.prototype.fill",ua);var va="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};la("Object.assign",function(a){return a||va});la("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});la("globalThis",function(a){return a||ja});
var wa=this||self;function xa(a,b,c,d){a=a.split(".");d=d||wa;a[0]in d||"undefined"==typeof d.execScript||d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ya(b)&&ya(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function za(){}function Aa(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}
function Ba(a){var b=Aa(a);return"array"==b||"object"==b&&"number"==typeof a.length}function ya(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function Ca(a){return Object.prototype.hasOwnProperty.call(a,Da)&&a[Da]||(a[Da]=++Ea)}var Da="closure_uid_"+(1E9*Math.random()>>>0),Ea=0;function Fa(a,b,c){return a.call.apply(a.bind,arguments)}
function Ha(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function Ia(a,b,c){Ia=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Fa:Ha;return Ia.apply(null,arguments)}
function Ja(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){xa(a,b,!0,void 0)}function u(a,b){function c(){}c.prototype=b.prototype;a.g=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.KD=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};var Ka,La,Ma;function Na(){}t("H.util.ICharStream",Na);Na.prototype.next=function(){};Na.prototype.ui=function(){};Na.prototype.ih=function(){};Na.prototype.fb=function(){};function Oa(a){this.Eu=String(a);this.bw=0;this.Ac=[];this.Rf=!1}t("H.util.CharStream",Oa);Oa.prototype.next=function(){var a=this.Eu.charCodeAt(this.bw++);a=isNaN(a)?-1:a;this.Rf&&this.Ac.push(a);return a};Oa.prototype.ui=function(){this.Rf=!0;this.Ac=[]};Oa.prototype.ih=function(){var a=this.Ac.slice();this.Rf=!1;this.Ac=[];return a};Oa.prototype.fb=function(){var a=this.Eu.charCodeAt(this.bw+0);return isNaN(a)?-1:a};function Pa(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function Qa(a){for(var b in a)return!1;return!0}function Ra(a){var b={},c;for(c in a)b[c]=a[c];return b}var Sa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ta(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Sa.length;f++)c=Sa[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var x=this;function Ua(a,b){if(Error.captureStackTrace)Error.captureStackTrace(this,Ua);else{var c=Error().stack;c&&(this.stack=c)}a&&(this.message=String(a));b&&(this.MD=b)}u(Ua,Error);Ua.prototype.name="CustomError";var Va=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function Wa(){return Object.create(z,void 0)}var A=Ia,Xa=String,Ya=x.Object.freeze||function(a){return a};function Za(a){for(var b=Object.keys(a),c=b.length,d;c--;)d=a[b[c]],ya(d)&&Za(d);return Ya(a)}function $a(a){var b=Aa(a);if("object"==b||"array"==b){if(ab(a.clone))return a.clone();b="array"==b?[]:{};for(var c in a)a.hasOwnProperty(c)&&(b[c]=$a(a[c]));return b}return a}var B=[].pop(),z=/x/.exec(""),cb="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function C(a,b,c,d,e){if(!(b=a instanceof b)&&c)throw new D(c,d,db(e)?e:a);return b}function eb(a,b){if(!0===(C(a,b)&&a.constructor===b))throw new TypeError("Illegal constructor "+fb(b));}function ab(a){return"function"==Aa(a)}function gb(a,b,c,d,e){if(!(b=hb(a)===b)&&c)throw new D(c,d,db(e)?e:a);return b}function ib(a,b,c,d){return gb(a,"Array",b,c,d)}t("H.lang.isArray",ib);function db(a){return a!==B}function jb(a){return"string"===typeof a}t("H.lang.isString",jb);
var kb=parseInt,lb=parseFloat,E=isNaN;function ob(a){return a===+a}t("H.lang.isNumber",ob);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function pb(a){return!E(+a)}function hb(a){var b=Object[cb[0]][cb[6]].call(a).match(/^\[object (\w+)\]$/);return b?b[1]:typeof a}var qb=[];function rb(a){0>qb.indexOf(a)&&qb.push(a)}rb(qb);
function fb(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:x.H},c="",d=qb.slice());sb(b,!0,function(h,k){try{if(g=h[k],k=tb(h,g),!(ya(g)&&g.window===g&&g.self===g||ya(g)&&0<g.nodeType&&ab(g.cloneNode))&&ya(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=fb(a,g,c+"."+k,d)))return!0}}catch(l){}});f&&(e=e?e.substr(1).replace("."+cb[0]+".","#"):"~"+(ab(a)?ub(a)+"()":hb(a)));return e}
function tb(a,b){var c=[];sb(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(vb)[0]}function vb(a,b){return b.length-a.length}var wb=Object[cb[0]][cb[2]];function sb(a,b,c){var d;if(a){for(e in a)if((!b||wb.call(a,e))&&c(a,e,!0))return;for(d=cb.length;d--;){var e=cb[d];if((!b||wb.call(a,e))&&c(a,e,!1))break}}}function ub(a){return(a=/^\s*function ([^\( ]+)/.exec(a))?a[1]:"anonymous"}function xb(a,b,c){c[b]="#"+b}var yb=!!x.__karma__;function zb(){throw Error("unimplemented method");}
function D(a,b,c){var d=arguments.length,e;b=b!==B?+b:b;b!==B&&((e=/^.*?\(([^\)]+)/.exec((""+a).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?(e=e[1].replace(/\s+/g,""),e=Xa(e).split(","!==B?",":" ")):e=[],e.forEach(xb),e=e[b]||"#"+b);var f=a?fb(a):"";d=2<d?Xa(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,D.prototype);return d}u(D,Error);t("H.lang.InvalidArgumentError",D);D.prototype.name="InvalidArgumentError";
function Ab(a,b){var c=[];a&&c.push(fb(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,Ab.prototype);return c}u(Ab,Error);t("H.lang.IllegalOperationError",Ab);Ab.prototype.name="IllegalOperationError";var Bb=Math,Cb=Bb.min,Db=Bb.max,Eb=Bb.round,Fb=Bb.floor,Gb=Bb.ceil,Hb=Bb.abs,Ib=Bb.log,Jb=Bb.sqrt,Kb=Bb.pow,Lb=Bb.exp,Mb=Bb.sin,Nb=Bb.asin,Ob=Bb.cos,Pb=Bb.tan,Qb=Bb.atan,Rb=Bb.atan2,Sb=Bb.LN2,Tb=Bb.PI,Ub=Tb/2,Vb=Tb/4,Wb=2*Tb,Xb=3*Tb,Yb=Tb/180,Zb=180/Tb,$b=1/0,ac=Kb(-2,53),bc=bc||function(a){return Ib(a)/Sb};function cc(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}function dc(a,b,c){b-=c=c||0;a-=c;return a-Fb(a/b)*b+c}t("H.math.normalize",dc);function ec(a,b,c){return(a-=0)>c?c:a<b?b:a}
t("H.math.clamp",ec);function fc(a,b,c,d){(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var gc={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",gc);
function hc(a,b,c,d,e,f){var g=c.length,h=g,k=c[0],l=0,n=0,p=0;d=d/2||0;var q=f||2;f=q*(e?0:1)+1;for(var r=q-2;1!=l&&h>f;){h-=r;var v=c[--h];q=c[--h];var w=c[h?h-r-1:(g+(h-r-1))%g];var y=c[h?h-r-2:(g+(h-r-2))%g];if(q>=a-d&&q<=a+d&&v>=b-d&&v<=b+d||y>=a-d&&y<=a+d&&w>=b-d&&w<=b+d)l=1;else if(!l&&q===a)y===a&&(v<b&&w>b||v>b&&w<b)||(k<=a&&y>a||k>=a&&y<a)&&(v>=b?++n:++p),l=fc(b,v,w,d)&&Jb(Kb((a-y)*(v-w)-(b-w)*(q-y),2)/(Kb(q-y,2)+Kb(v-w,2)))<=d?2:0;else if(!l&&fc(a,q,y,d)){if(q<a&&y>a||q>a&&y<a)k=v+(a-q)/
(y-q)*(w-v),n+=k>b,p+=k<b;l=fc(b,v,w,d)&&Jb(Kb((a-y)*(v-w)-(b-w)*(q-y),2)/(Kb(q-y,2)+Kb(v-w,2)))<=d?2:0}k=q}!l&&e&&0!==p&&0!==n%2&&(l=3);return l}function ic(a,b){return hc(a.x,a.y,b,0,!0)!==gc.NONE}t("H.math.isPointInsidePolygon",ic);function jc(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&db(a[0].x);b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t("H.math.flatten",jc);function kc(a,b,c){var d=ec(+a,-90,90);if(b&&E(d))throw new D(b,c,a);return d}function lc(a,b,c){var d=+a;if(-180>d||180<d)d=cc(d+180,360)-180;if(b&&E(d))throw new D(b,c,a);return d}function mc(a,b,c){var d;if(a!==B&&E(d=+a)&&b)throw new D(b,c,a);return d}function nc(a,b){return 0>a!==0>b&&180<Hb(b-a)}t("H.geo.isDBC",nc);function oc(){eb(this,oc)}t("H.geo.AbstractGeometry",oc);oc.prototype.getBoundingBox=oc.prototype.C;oc.prototype.equals=oc.prototype.ea;oc.prototype.ac="";oc.prototype.Ec="";oc.prototype.toString=function(){return this.sf([this.ac.toUpperCase()," "]).join("")};oc.prototype.toString=oc.prototype.toString;oc.prototype.ue=function(){return{type:this.Ec,coordinates:this.rf()}};oc.prototype.toGeoJSON=oc.prototype.ue;oc.prototype.R=function(){return{type:this.ac,coordinates:this.Od(),boundingBox:this.C().R()}};
oc.prototype.forWorkerMessage=oc.prototype.R;function pc(a,b,c){this.lat=kc(a,pc,0);this.lng=lc(b,pc,1);c!==B&&(this.alt=mc(c,pc,2))}u(pc,oc);t("H.geo.Point",pc);pc.prototype.ea=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};pc.prototype.equals=pc.prototype.ea;pc.prototype.lb=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Yb;var c=a.lat*Yb;a=1.274200158E7*Nb(Cb(1,Jb(Kb(Mb((b-c)/2),2)+Ob(b)*Ob(c)*Kb(Mb((this.lng*Yb-a.lng*Yb)/2),2))))}return a};
pc.prototype.distance=pc.prototype.lb;
pc.prototype.ho=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*Yb;a=Yb*this.lat;var e=Mb(a);c=Mb(d);var f=Ob(d);d=Yb*this.lng;var g=Ob(a);a=Nb(g*Ob(b)*c+e*f);b=Rb(Mb(b)*g*c,f-e*Mb(a));b=(d+b+Tb)%(2*Tb)-Tb;b*=Zb;e=new pc(a*Zb,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*Wb*Ob(this.lat*Yb))*(270===a?-360:360),new pc(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=Yb,e=this.lat*Yb,c=this.lng*Yb,d=e+b*Ob(a),f=d-e,g=Ib(Pb(d/2+Vb)/Pb(e/2+Vb)),g=E(f/
g)?Ob(e):f/g,a=b*Mb(a)/g,Hb(d)>Ub&&(d=0<d?Tb-d:-(Tb+d)),d=new pc(d*Zb,((c+a+Xb+(Hb(e+f)>Ub?Tb:0))%Wb-Tb)*Zb);return d||this};pc.prototype.walk=pc.prototype.ho;pc.prototype.C=function(){return new F(this.lat,this.lng,this.lat,this.lng)};pc.prototype.getBoundingBox=pc.prototype.C;function qc(a,b,c){var d=ya(a)&&!(E(a.lat=kc(a.lat))||E(a.lng=lc(a.lng))||a.alt!==B&&E(a.alt=mc(a.alt)));if(!d&&b)throw new D(b,c,a);return d}pc.validate=qc;
function sc(a){if(!a)throw new D(sc,0,a);return new pc(a.lat,a.lng,a.alt)}pc.fromIPoint=sc;m=pc.prototype;m.ac="Point";m.sf=function(a){a.push("(",this.lng," ",this.lat,")");return a};m.Ec="Point";m.rf=function(){return[this.lng,this.lat,this.alt||0]};m.Od=function(){return[this.lat,this.lng,this.alt||0]};function tc(a,b,c,d,e,f){eb(this,tc);this.Lh=a||10;this.sj=null;this.Ui=d||0;this.Vi=e||0;this.qk=b||1;this.rk=c||1;this.zx=!!f;this.flush()}function uc(a){var b=a.sj;if(a.zx&&!b){var c=a.head;if(c.entries||c[0]||c[1]||c[2]||c[3])b=[c],b=vc([b,b,b,b],[c[6],c[7],c[4],c[5]]),a.sj=b}return b}
function vc(a,b){var c,d,e,f,g=0;for(c=3;0<=c;c--){var h=c+4;var k=0<c%3;var l=[];var n=b[c];var p=a[c];for(d=p.length;d--;){var q=p[d];if(e=q.entries)for(f=e.length;f--;){var r=e[f].Hf(c);if(k?r>n:r<n)n=r}for(f=4;f--;)(e=q[f])&&(k?e[h]>n:e[h]<n)&&l.push(e)}g+=l.length;b[c]=n;a[c]=l}g&&(b=vc(a,b));return b}function wc(a,b,c){var d,e;if(a.zx&&(d=a.sj))for(e=3;0<=e;e--){var f=b.Hf(e);if(e%3?f>=d[e]:f<=d[e])if(c)d[e]=f;else{a.sj=null;break}}}m=tc.prototype;
m.remove=function(a){var b,c,d,e=!1;a&&(b=a.node)&&b.cl===this&&(c=b.entries)&&0<=(d=c.indexOf(a))&&(c.splice(d,1),this.Bl(b),wc(this,a,!1),e=!0);return e};m.flush=function(){var a=new xc(B,NaN,this.Ui-this.qk,this.Vi-this.rk,this.Ui+this.qk,this.Vi+this.rk);a.cl=this;this.head=this.root=a;this.sj=null};m.gd=function(a){var b=this.head,c;if(a){var d=a;if(d!==b)for(b=d;d=d.parent;)if(d.entries||1<d.ib)b=d}else for(;!b.entries&&2>(c=b.ib);)if(c)b=d;else break;this.head=b};
m.pb=function(a,b,c,d,e,f){var g=[],h=this.head,k=this.root;a<=h[5]&&b<=h[6]&&(e?c>=h[7]:c>h[7])&&(f?d>=h[4]:d>h[4])&&yc(this,h,g,a,b,c,d,f||d>=k[6],e||c>=k[5]);return g};
function yc(a,b,c,d,e,f,g,h,k){var l=b.entries,n=b[7],p=b[4],q=b[5],r=b[6],v=b[8],w=b[9],y;if(l){var I=l.length;if(e>p||d>n||g<r||f<q)for(;I--;){n=l[I];p=n.Hf(3);q=n.Hf(0);r=n.Hf(1);var G=n.Hf(2);G>=e&&r>=d&&(q<g||h&&q==g)&&(p<f||k&&p==f)&&c.push(n)}else for(;I--;)c.push(l[I])}if(f>v||k&&f==v)e<w&&(y=b[1])&&yc(a,y,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(y=b[3])&&yc(a,y,c,d,e,f,g,h,k);d<v&&(e<w&&(y=b[0])&&yc(a,y,c,d,e,f,g,h,k),(g>w||h&&g==w)&&(y=b[2])&&yc(a,y,c,d,e,f,g,h,k))}m.ve=ba(1);var zc=0;
function xc(a,b,c,d,e,f){this.xo=b;a&&(this.parent=a,this.cl=a.cl,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}m=xc.prototype;m.ib=0;m.oh=function(a){return this[a]||(++this.ib,this[a]=new xc(this,a))};m.removeChild=function(a){var b=a.xo;this[b]===a&&(delete this[b],delete a.parent,--this.ib)};m.ve=ba(0);m.Lg=function(a){(this.entries||(this.entries=[])).push(a);a.node=this};
function Ac(a,b,c,d,e){var f=a[5],g=a[6];return a[7]<=b&&a[4]<=c&&(f>d||f===d&&f===a.cl.root[5])&&(g>e||g===e&&g===a.cl.root[6])};function Bc(a,b,c,d,e,f){Bc.g.constructor.apply(this,arguments)}u(Bc,tc);Bc.prototype.Bl=function(a){for(var b,c,d=this.head;a;){if(!(b=a.entries)||!b.length)if(b&&delete a.entries,!a.ib&&(c=a.parent)){c.removeChild(a);d===a&&(d=c);a=c;continue}break}this.head!==d&&(this.head=d,this.gd())};function Cc(a,b,c,d,e){if(Ac(a.root,b,c,d,e))return a.Ub(a.root,b,c,d,e,a.Lh);throw Error("Coordinates out of bounds");}
Bc.prototype.Hu=function(a,b,c,d){if(a>c){var e=a;a=c;c=e}b>d&&(e=b,b=d,d=e);return Cc(this,a,b,c,d)};Bc.prototype.Wd=function(a,b){return Cc(this,a,b,a,b)};Bc.prototype.Ub=function(a,b,c,d,e,f){var g=a[8],h=a[9],k=0,l=0;f&&(d<g||(k=+(b>=g)))&&(e<h||(l=+(c>=h)))?b=this.Ub(a.oh(k|l<<1),b,c,d,e,f-1):(a.Lg(b=new Dc(b,c,d,e)),wc(this,b,!0),this.gd(a));return b};function Dc(a,b,c,d){this.id=zc++;this[0]=b;this[1]=c;this[2]=d;this[3]=a}Dc.prototype.Hf=function(a){return this[a]};function F(a,b,c,d){Ec(this,kc(a,F,0),lc(b,F,1),kc(c,F,2),lc(d,F,3))}u(F,oc);t("H.geo.Rect",F);F.prototype.ac="Polygon";F.prototype.sf=function(a){var b=this.ga,c=this.X,d=this.ha,e=this.da;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};F.prototype.ea=function(a){var b=this===a;!b&&C(a,F)&&(b=this.ga===a.ga&&this.X===a.X&&this.ha===a.ha&&this.da===a.da);return b};F.prototype.equals=F.prototype.ea;
F.prototype.clone=function(){return new F(this.ga,this.X,this.ha,this.da)};F.prototype.clone=F.prototype.clone;function Ec(a,b,c,d,e){a.X=c;a.da=e;b<d&&(c=b,b=d,d=c);a.ga=b;a.ha=d;a.al=a.Ni=a.xf=null;return a}F.prototype.Kc=function(){this.al||(this.al=new pc(this.ga,this.X));return this.al};F.prototype.getTopLeft=F.prototype.Kc;F.prototype.Gc=function(){this.Ni||(this.Ni=new pc(this.ha,this.da));return this.Ni};F.prototype.getBottomRight=F.prototype.Gc;F.prototype.xA=function(){return this.ga};
F.prototype.getTop=F.prototype.xA;F.prototype.jz=function(){return this.ha};F.prototype.getBottom=F.prototype.jz;F.prototype.Sz=function(){return this.X};F.prototype.getLeft=F.prototype.Sz;F.prototype.nA=function(){return this.da};F.prototype.getRight=F.prototype.nA;F.prototype.wb=function(){this.xf||(this.xf=new pc(this.ha+(this.ga-this.ha)/2,Fc(this.X,this.nc())));return this.xf};F.prototype.getCenter=F.prototype.wb;F.prototype.nc=function(){return Gc(this.X,this.da)};F.prototype.getWidth=F.prototype.nc;
F.prototype.th=function(){return this.ga-this.ha};F.prototype.getHeight=F.prototype.th;F.prototype.oc=function(){return this.X>this.da};F.prototype.isCDB=F.prototype.oc;F.prototype.Bm=function(){return!this.nc()&&!this.th()};F.prototype.isEmpty=F.prototype.Bm;F.prototype.C=function(){return new F(this.ga,this.X,this.ha,this.da)};F.prototype.getBoundingBox=F.prototype.C;
F.prototype.Hl=function(a,b,c){var d=this.wb();c||(a=kc(a,this.Hl,0),b=lc(b,this.Hl,1));b=this.Ze(a,b,c);a=b.wb();return a.lat===d.lat&&a.lng===d.lng&&this.th()===b.th()&&this.nc()===b.nc()};F.prototype.containsLatLng=F.prototype.Hl;F.prototype.zf=function(a,b){b||qc(a,this.zf,0);return this.Hl(a.lat,a.lng,b)};F.prototype.containsPoint=F.prototype.zf;
F.prototype.Qo=function(a,b){var c=this.wb();if(!b&&!C(a,F))throw new D(this.Qo,0,a);b=this.wd(a,b);a=b.wb();return a.lat===c.lat&&a.lng===c.lng&&this.th()===b.th()&&this.nc()===b.nc()};F.prototype.containsRect=F.prototype.Qo;F.prototype.Ze=function(a,b,c,d){if(!c){if(E(a=kc(a)))throw new D(this.Ze,0,a);if(E(b=lc(b)))throw new D(this.Ze,1,b);}return Hc(this.ga,this.X,this.ha,this.da,a,b,a,b,d)};F.prototype.mergeLatLng=F.prototype.Ze;
F.prototype.rv=function(a,b,c){b||qc(a,this.rv,0);return this.Ze(a.lat,a.lng,b,c)};F.prototype.mergePoint=F.prototype.rv;F.prototype.wd=function(a,b,c){if(!b&&!C(a,F))throw new D(this.wd,0,a);return Hc(this.ga,this.X,this.ha,this.da,a.ga,a.X,a.ha,a.da,c)};F.prototype.mergeRect=F.prototype.wd;F.prototype.$d=function(a,b,c,d,e,f){e||(a=kc(a,this.$d,0),b=lc(b,this.$d,1),c=kc(c,this.$d,2),d=lc(d,this.$d,3));return Hc(this.ga,this.X,this.ha,this.da,a,b,c,d,f)};F.prototype.mergeTopLeftBottomRight=F.prototype.$d;
F.prototype.Pf=function(a,b){var c=this.X<=this.da,d=a.X<=a.da,e=this.X<a.da,f=a.X<this.da;if(!b&&!C(a,F))throw new D(this.Pf,0,a);return this.ha<=a.ga&&a.ha<=this.ga&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};F.prototype.intersects=F.prototype.Pf;function Gc(a,b){a=b-a;return a+(0>a?360:0)}function Fc(a,b){a+=b/2;return a-(180<a?360:0)}
function Hc(a,b,c,d,e,f,g,h,k){c=Cb(c,g);a=Db(a,e);e=Gc(b,d);var l=Fc(b,e);g=Gc(f,h);var n=Fc(f,g)-l;n+=0>n-1E-6?360:0;if(180>n-1E-6){l=b;var p=h}else n=360-n,l=f,p=d;n=n+e/2+g/2;360<=n+5E-7?(l=-180,p=180):n-5E-7<e?(l=b,p=d):n-5E-7<g&&(l=f,p=h);return k?Ec(k,a,l,c,p):new F(a,l,c,p)}F.merge=Hc;function Ic(a,b,c){c||(qc(a,Ic,0),qc(b,Ic,1));return new F(a.lat,a.lng,b.lat,b.lng)}F.fromPoints=Ic;
function Jc(a,b){var c=1,d=a.length,e=null;if(!Ba(a))throw new D(Jc,0,a);if(0<d){var f=a[0];for(e=Ic(f,f,b);c<d;c++)f=a[c],e.Ze(f.lat,f.lng,b,e)}return e}F.coverPoints=Jc;function Kc(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new D(Kc,0,a);if(0<d)for(e=new F(a[0],a[1],a[0],a[1]);c<d;c+=3)e.Ze(a[c],a[c+1],b,e);return e}F.coverLatLngAlts=Kc;
function Lc(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new D(Lc,0,a);if(0<d)for(e=new F(a[0].ga,a[0].X,a[0].ha,a[0].da);c<d;c++)e.wd(a[c],b,e);return e}F.coverRects=Lc;
F.prototype.Aw=function(a,b){var c=this.X,d=this.ga,e=this.da,f=this.ha,g=this.wb().lng;qc(a,this.Aw,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?Ec(b,d,a,f,e):new F(d,a,f,e)};F.prototype.resizeToCenter=F.prototype.Aw;F.prototype.Ec="Polygon";
F.prototype.rf=function(){return[[this.X,this.ga,0],[this.da,this.ga,0],[this.da,this.ha,0],[this.X,this.ha,0],[this.X,this.ga,0]]};F.prototype.R=function(){return this.Od()};F.prototype.Od=function(){return[this.ga,this.X,this.ha,this.da]};function Mc(a){this.we=new Bc(+a||10,180,90,0,0,!0);this.Al=[];this.fq=!1;this.wf=this.Hg=this.I=null}t("H.geo.QuadTree",Mc);m=Mc.prototype;m.jc=0;m.oc=function(){return this.fq};
m.C=function(){var a,b;if(!this.I){var c=[];!this.Hg&&(a=uc(this.we))&&(this.Hg=new F(-a[0],a[3],-a[2],a[1]));(b=this.Hg)&&c.push(b);var d,e,f;if(!this.wf&&(f=(e=this.Al).length)){a=90;var g=360;var h=-90;for(d=0;f--;){var k=e[f];a=Cb(a,k[0]);g=Cb(g,k[3]);h=Db(h,k[2]);d=Db(d,k[1])}this.wf=new F(-a,g,-h,d-360)}(b=this.wf)&&c.push(b);if(b=c[0])c[1]&&(b=b.wd(c[1],!0)),this.I=b}return this.I};
m.Ub=function(a,b,c,d,e){e?(e=new Dc(d,-a,b+360,-c),this.Al.push(e),this.fq=!0,this.wf&&this.wf.$d(a,b,c,d,!0,this.wf)):(e=Cc(this.we,b,-a,d,-c),this.Hg&&this.Hg.$d(a,b,c,d,!0,this.Hg));++this.jc;this.I=null;return e};m.Wd=function(a){var b=a.lng;a=a.lat;return this.Ub(a,b,a,b,!1)};m.Fu=function(a){var b=a.Kc(),c=a.Gc();return(a=a.oc())?this.Ub(b.lat,c.lng,c.lat,b.lng,a):this.Ub(b.lat,b.lng,c.lat,c.lng,a)};Mc.prototype.insertBoundingBox=Mc.prototype.Fu;
Mc.prototype.Hu=function(a,b,c,d){if(b<d)var e=b;else e=d,d=b;a<c?b=c:(b=a,a=c);return this.Ub(b,e,a,d,180<d-e)};Mc.prototype.remove=function(a){var b;if(a.node){var c=this.we.remove(a);this.Hg=null}else if(a=(b=this.Al).indexOf(a),c=0<=a)b.splice(a,1),this.fq=0<b.length,this.wf=null;c&&(--this.jc,this.I=null);return c};Mc.prototype.remove=Mc.prototype.remove;
function Nc(a,b,c,d,e,f,g){a=a.Al;var h=a.length,k=[],l;if(h){var n=c+360;for(l=e+360;h--;){var p=a[h];Oc(p,b,c,d,e,f,g)?k.push(p):Oc(p,b,n,d,l,f,g)&&k.push(p)}}return k}function Oc(a,b,c,d,e,f,g){var h=a[3],k=a[0],l=a[1];a=a[2];return(f?k<=d:k<d)&&(g?h<=e:h<e)&&a>=b&&l>=c}function Pc(a,b){var c,d,e;if(c=b.length){var f=a.length;for(d={};f--;)d[a[f].id]=1;for(;c--;)(e=b[c]).id in d||a.push(e)}}
Mc.prototype.ym=function(a,b,c){var d=this.we,e=a.Kc(),f=a.Gc(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;!b&&g===h||!c&&e===f?a=[]:a.oc()?(a=d.pb(-180,g,f,h,c,b),Pc(a,d.pb(e,g,180,h,!1,b)),Pc(a,Nc(this,g,f,h,e+360,b,c))):(a=d.pb(e,g,f,h,c,b),Pc(a,Nc(this,g,e,h,f,b,c)));return a};Mc.prototype.intersectBoundingBox=Mc.prototype.ym;var Qc=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Rc="undefined"!==typeof BigInt?BigInt:Number;
function Sc(a){var b=Rc(0),c=Rc(0),d=[];a.split("").forEach(function(e){e=Rc(Qc[e.charCodeAt(0)-45]);b|=(e&Rc(31))<<c;(e&Rc(32))===Rc(0)?(d.push(b),b=Rc(0),c=Rc(0)):c+=Rc(5)});if(0<c)throw Error("Invalid encoding");return d}function Tc(a){a&Rc(1)&&(a=~a);a>>=Rc(1);return+a.toString()}
function Uc(a){var b=void 0===a.precision?5:a.precision,c=void 0===a.Xk?0:a.Xk,d=void 0===a.Yk?0:a.Yk;a=a.fr;var e=Math.pow(10,b),f=Math.pow(10,d);if(0>b||15<b)throw Error("precision out of range. Should be between 0 and 15");if(0>d||15<d)throw Error("thirdDimPrecision out of range. Should be between 0 and 15");if(0>c||7<c||4===c||5===c)throw Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");b=Vc(1)+Vc(d<<7|c<<4|b);var g=[],h=Rc(0),k=Rc(0),l=Rc(0);a.forEach(function(n){var p=Rc(Math.round(n[0]*
e));g.push(Wc(p-h));h=p;p=Rc(Math.round(n[1]*e));g.push(Wc(p-k));k=p;c&&(n=Rc(Math.round(n[2]*f)),g.push(Wc(n-l)),l=n)});return[].concat(b instanceof Array?b:fa(ea(b)),g instanceof Array?g:fa(ea(g))).join("")}function Vc(a){var b="";for(a=Rc(a);31<a;)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a&Rc(31)|Rc(32)],a>>=Rc(5);return b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a]}function Wc(a){a=Rc(a);var b=0>a;a<<=Rc(1);b&&(a=~a);return Vc(a)}
function Xc(a){return Uc({fr:a.polyline,precision:a.precision,Xk:a.thirdDim,Yk:a.thirdDimPrecision})}t("H.util.flexiblePolyline.encode",Xc);
function Yc(a){a=Sc(a);if(1!==+a[0].toString())throw Error("Invalid format version");var b=+a[1].toString();b={precision:b&15,Xk:b>>4&7,Yk:b>>7&15};for(var c=Math.pow(10,b.precision),d=Math.pow(10,b.Yk),e=b.Xk,f=0,g=0,h=0,k=[],l=2;l<a.length;){var n=Tc(a[l+1])/c;f+=Tc(a[l])/c;g+=n;e?(h+=Tc(a[l+2])/d,k.push([f,g,h]),l+=3):(k.push([f,g]),l+=2)}if(l!==a.length)throw Error("Invalid encoding. Premature ending reached");a=Object.assign({},b,{fr:k});return{polyline:a.fr,precision:a.precision,thirdDim:a.Xk,
thirdDimPrecision:a.Yk}}t("H.util.flexiblePolyline.decode",Yc);function Zc(a,b){this.eB=100;this.yy=a;this.ug=b;this.Um=0;this.sm=null}Zc.prototype.get=function(){if(0<this.Um){this.Um--;var a=this.sm;this.sm=a.next;a.next=null}else a=this.yy();return a};Zc.prototype.put=function(a){this.ug(a);this.Um<this.eB&&(this.Um++,a.next=this.sm,this.sm=a)};function $c(a){wa.setTimeout(function(){throw a;},0)};function ad(a,b){return-1!=a.indexOf(b)};var bd;a:{var cd=wa.navigator;if(cd){var dd=cd.userAgent;if(dd){bd=dd;break a}}bd=""};function ed(a){ed[" "](a);return a}ed[" "]=za;var fd=ad(bd,"Gecko")&&!(ad(bd.toLowerCase(),"webkit")&&!ad(bd,"Edge"))&&!(ad(bd,"Trident")||ad(bd,"MSIE"))&&!ad(bd,"Edge"),gd=ad(bd.toLowerCase(),"webkit")&&!ad(bd,"Edge");function hd(){var a=document;var b="IFRAME";"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var id;
function jd(){var a=wa.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!ad(bd,"Presto")&&(a=function(){var e=hd();e.style.display="none";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=Ia(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener("message",e,
!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!ad(bd,"Trident")&&!ad(bd,"MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.ht;c.ht=null;e()}};return function(e){d.next={ht:e};d=d.next;b.port2.postMessage(0)}}return function(e){wa.setTimeout(e,0)}};function kd(){this.io=this.Ci=null}kd.prototype.add=function(a,b){var c=ld.get();c.set(a,b);this.io?this.io.next=c:this.Ci=c;this.io=c};kd.prototype.remove=function(){var a=null;this.Ci&&(a=this.Ci,this.Ci=this.Ci.next,this.Ci||(this.io=null),a.next=null);return a};var ld=new Zc(function(){return new md},function(a){return a.reset()});function md(){this.next=this.scope=this.op=null}md.prototype.set=function(a,b){this.op=a;this.scope=b;this.next=null};
md.prototype.reset=function(){this.next=this.scope=this.op=null};function nd(a,b){od||qd();rd||(od(),rd=!0);sd.add(a,b)}var od;function qd(){if(wa.Promise&&wa.Promise.resolve){var a=wa.Promise.resolve(void 0);od=function(){a.then(td)}}else od=function(){var b=td;"function"!==typeof wa.setImmediate||wa.Window&&wa.Window.prototype&&!ad(bd,"Edge")&&wa.Window.prototype.setImmediate==wa.setImmediate?(id||(id=jd()),id(b)):wa.setImmediate(b)}}var rd=!1,sd=new kd;function td(){for(var a;a=sd.remove();){try{a.op.call(a.scope)}catch(b){$c(b)}ld.put(a)}rd=!1};function ud(a){this.o=vd;this.lf=void 0;this.Ug=this.Ge=this.ig=null;this.mm=this.jp=!1;if(a!=za)try{var b=this;a.call(void 0,function(c){wd(b,xd,c)},function(c){wd(b,yd,c)})}catch(c){wd(this,yd,c)}}var vd=0,xd=2,yd=3;function Ad(){this.next=this.context=this.Qh=this.ck=this.yf=null;this.sl=!1}Ad.prototype.reset=function(){this.context=this.Qh=this.ck=this.yf=null;this.sl=!1};var Bd=new Zc(function(){return new Ad},function(a){a.reset()});
function Cd(a,b,c){var d=Bd.get();d.ck=a;d.Qh=b;d.context=c;return d}function Dd(a){if(a instanceof ud)return a;var b=new ud(za);wd(b,xd,a);return b}function Ed(a){return new ud(function(b,c){c(a)})}function Fd(){var a,b,c=new ud(function(d,e){a=d;b=e});return new Gd(c,a,b)}ud.prototype.then=function(a,b,c){return Hd(this,"function"===typeof a?a:null,"function"===typeof b?b:null,c)};ud.prototype.$goog_Thenable=!0;
ud.prototype.cancel=function(a){if(this.o==vd){var b=new Id(a);nd(function(){Jd(this,b)},this)}};function Jd(a,b){if(a.o==vd)if(a.ig){var c=a.ig;if(c.Ge){for(var d=0,e=null,f=null,g=c.Ge;g&&(g.sl||(d++,g.yf==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.o==vd&&1==d?Jd(c,b):(f?(d=f,d.next==c.Ug&&(c.Ug=d),d.next=d.next.next):Kd(c),Ld(c,e,yd,b)))}a.ig=null}else wd(a,yd,b)}function Md(a,b){a.Ge||a.o!=xd&&a.o!=yd||Nd(a);a.Ug?a.Ug.next=b:a.Ge=b;a.Ug=b}
function Hd(a,b,c,d){var e=Cd(null,null,null);e.yf=new ud(function(f,g){e.ck=b?function(h){try{var k=b.call(d,h);f(k)}catch(l){g(l)}}:f;e.Qh=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Id?g(h):f(k)}catch(l){g(l)}}:g});e.yf.ig=a;Md(a,e);return e.yf}ud.prototype.uD=function(a){this.o=vd;wd(this,xd,a)};ud.prototype.vD=function(a){this.o=vd;wd(this,yd,a)};
function wd(a,b,c){if(a.o==vd){a===c&&(b=yd,c=new TypeError("Promise cannot resolve to itself"));a.o=1;a:{var d=c,e=a.uD,f=a.vD;if(d instanceof ud){Md(d,Cd(e||za,f||null,a));var g=!0}else{if(d)try{var h=!!d.$goog_Thenable}catch(l){h=!1}else h=!1;if(h)d.then(e,f,a),g=!0;else{if(ya(d))try{var k=d.then;if("function"===typeof k){Od(d,k,e,f,a);g=!0;break a}}catch(l){f.call(a,l);g=!0;break a}g=!1}}}g||(a.lf=c,a.o=b,a.ig=null,Nd(a),b!=yd||c instanceof Id||Pd(a,c))}}
function Od(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Nd(a){a.jp||(a.jp=!0,nd(a.Sy,a))}function Kd(a){var b=null;a.Ge&&(b=a.Ge,a.Ge=b.next,b.next=null);a.Ge||(a.Ug=null);return b}ud.prototype.Sy=function(){for(var a;a=Kd(this);)Ld(this,a,this.o,this.lf);this.jp=!1};
function Ld(a,b,c,d){if(c==yd&&b.Qh&&!b.sl)for(;a&&a.mm;a=a.ig)a.mm=!1;if(b.yf)b.yf.ig=null,Qd(b,c,d);else try{b.sl?b.ck.call(b.context):Qd(b,c,d)}catch(e){Rd.call(null,e)}Bd.put(b)}function Qd(a,b,c){b==xd?a.ck.call(a.context,c):a.Qh&&a.Qh.call(a.context,c)}function Pd(a,b){a.mm=!0;nd(function(){a.mm&&Rd.call(null,b)})}var Rd=$c;function Id(a){Ua.call(this,a)}u(Id,Ua);Id.prototype.name="cancel";function Gd(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Sd(){}t("H.util.ICancelable",Sd);Sd.prototype.cancel=function(){};Sd.prototype.cancel=Sd.prototype.cancel;function Td(a,b,c){this.type=a;this.data=b;this.zr=Fd();this.resolve=A(this.resolve,this);this.reject=A(this.reject,this);this.priority=Ud;c!==B&&(this.priority=c);this.Bp().add(this)}var Ud=1,Vd={ED:0,HD:Ud,CD:2};m=Td.prototype;m.then=function(a,b,c){return this.zr.promise.then(a,b,c)};m.resolve=function(a){this.state=3;this.zr.resolve(a)};m.reject=function(a){this.state=5;this.zr.reject(a)};m.state=0;m.cancel=function(){3>this.state&&(this.Si(),this.Bp().remove(this),this.state=4)};
Td.prototype.cancel=Td.prototype.cancel;function Wd(a){var b;this.og={};for(b in Vd)this.og[Vd[b]]=[];this.yk=a;this.yk.addEventListener("allocatable",A(this.Ot,this))}t("H.util.JobManager",Wd);var Xd=Object.keys(Vd).map(function(a){return Vd[a]}).sort().reverse();Wd.prototype.add=function(a){C(a,Td,this.add,0);this.og[a.priority].push(a);this.Ot()};Wd.prototype.contains=function(a){return-1<this.og[a.priority].indexOf(a)};
Wd.prototype.remove=function(a){var b=a.priority,c=this.og[b].indexOf(a);if(-1<c)return this.og[b].splice(c,1),!0;a.zs&&this.yk.Sl(a.zs);return!1};Wd.prototype.Ot=function(){Xd.forEach(function(a){this.og[a]=this.og[a].filter(function(b){var c;if((c=this.yk.zo(b))!==z){var d=A(this.yk.Sl,this.yk,c,b);b.zs=c;b.then(d,d);b.state=b.Nt(c)?1:5}else return!0},this)},this)};function Yd(a){a&&"function"==typeof a.u&&a.u()};function Zd(){0!=$d&&(ae[Ca(this)]=this);this.fh=this.fh;this.be=this.be}var $d=0,ae={};Zd.prototype.fh=!1;Zd.prototype.u=function(){if(!this.fh&&(this.fh=!0,this.i(),0!=$d)){var a=Ca(this);if(0!=$d&&this.be&&0<this.be.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete ae[a]}};
Zd.prototype.bc=function(a,b){this.fh?void 0!==b?a.call(b):a():(this.be||(this.be=[]),this.be.push(void 0!==b?Ia(a,b):a))};Zd.prototype.i=function(){if(this.be)for(;this.be.length;)this.be.shift()()};var be=0;function ce(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.om=e;this.key=++be;this.fi=this.yl=!1}function de(a){a.fi=!0;a.listener=null;a.proxy=null;a.src=null;a.om=null};function ee(a){this.src=a;this.qb={};this.dl=0}m=ee.prototype;m.add=function(a,b,c,d,e){var f=a.toString();a=this.qb[f];a||(a=this.qb[f]=[],this.dl++);var g=fe(a,b,d,e);-1<g?(b=a[g],c||(b.yl=!1)):(b=new ce(b,this.src,f,!!d,e),b.yl=c,a.push(b));return b};m.remove=function(a,b,c,d){a=a.toString();if(!(a in this.qb))return!1;var e=this.qb[a];b=fe(e,b,c,d);return-1<b?(de(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.qb[a],this.dl--),!0):!1};
function ge(a,b){var c=b.type;if(!(c in a.qb))return!1;var d=a.qb[c],e=Va(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(de(b),0==a.qb[c].length&&(delete a.qb[c],a.dl--));return f}m.ja=function(a){a=a&&a.toString();var b=0,c;for(c in this.qb)if(!a||c==a){for(var d=this.qb[c],e=0;e<d.length;e++)++b,de(d[e]);delete this.qb[c];this.dl--}return b};m.Fp=function(a,b,c,d){a=this.qb[a.toString()];var e=-1;a&&(e=fe(a,b,c,d));return-1<e?a[e]:null};
m.Xp=function(a,b){var c=void 0!==a,d=c?a.toString():"",e=void 0!==b;return Pa(this.qb,function(f){for(var g=0;g<f.length;++g)if(!(c&&f[g].type!=d||e&&f[g].capture!=b))return!0;return!1})};function fe(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.fi&&f.listener==b&&f.capture==!!c&&f.om==d)return e}return-1};var he=function(){if(!wa.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{wa.addEventListener("test",za,b),wa.removeEventListener("test",za,b)}catch(c){}return a}();function ie(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.mk=!1}ie.prototype.stopPropagation=function(){this.mk=!0};ie.prototype.preventDefault=function(){this.defaultPrevented=!0};function je(a,b){ie.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key="";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.pj=null;a&&this.xm(a,b)}u(je,ie);var ke={2:"touch",3:"pen",4:"mouse"};
je.prototype.xm=function(a,b){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(fd){a:{try{ed(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=
d.screenY||0):(this.offsetX=gd||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=gd||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||"";this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=
a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:ke[a.pointerType]||"";this.state=a.state;this.pj=a;a.defaultPrevented&&je.g.preventDefault.call(this)};je.prototype.stopPropagation=function(){je.g.stopPropagation.call(this);this.pj.stopPropagation?this.pj.stopPropagation():this.pj.cancelBubble=!0};je.prototype.preventDefault=function(){je.g.preventDefault.call(this);var a=this.pj;a.preventDefault?a.preventDefault():a.returnValue=!1};var le="closure_listenable_"+(1E6*Math.random()|0);function me(a){return!(!a||!a[le])};var ne="closure_lm_"+(1E6*Math.random()|0),oe={},pe=0;function qe(a,b,c,d,e){if(d&&d.once)return re(a,b,c,d,e);if(Array.isArray(b)){for(var f=0;f<b.length;f++)qe(a,b[f],c,d,e);return null}c=se(c);return me(a)?a.nd.add(String(b),c,!1,ya(d)?!!d.capture:!!d,e):te(a,b,c,!1,d,e)}
function te(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=ya(e)?!!e.capture:!!e,h=ue(a);h||(a[ne]=h=new ee(a));c=h.add(b,c,d,g,f);if(c.proxy)return c;d=ve();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)he||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(we(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");pe++;return c}
function ve(){function a(c){return b.call(a.src,a.listener,c)}var b=xe;return a}function re(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)re(a,b[f],c,d,e);return null}c=se(c);return me(a)?a.nd.add(String(b),c,!0,ya(d)?!!d.capture:!!d,e):te(a,b,c,!0,d,e)}
function ye(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)ye(a,b[f],c,d,e);return null}d=ya(d)?!!d.capture:!!d;c=se(c);if(me(a))return a.nd.remove(String(b),c,d,e);if(!a)return!1;if(a=ue(a))if(b=a.Fp(b,c,d,e))return ze(b);return!1}
function ze(a){if("number"===typeof a||!a||a.fi)return!1;var b=a.src;if(me(b))return ge(b.nd,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(we(c),d):b.addListener&&b.removeListener&&b.removeListener(d);pe--;(c=ue(b))?(ge(c,a),0==c.dl&&(c.src=null,b[ne]=null)):de(a);return!0}function we(a){return a in oe?oe[a]:oe[a]="on"+a}function Ae(a,b){var c=a.listener,d=a.om||a.src;a.yl&&ze(a);return c.call(d,b)}
function xe(a,b){return a.fi?!0:Ae(a,new je(b,this))}function ue(a){a=a[ne];return a instanceof ee?a:null}var Be="__closure_events_fn_"+(1E9*Math.random()>>>0);function se(a){if("function"===typeof a)return a;a[Be]||(a[Be]=function(b){return a.handleEvent(b)});return a[Be]};function J(){Zd.call(this);this.nd=new ee(this);this.Wx=this;this.$q=null}u(J,Zd);J.prototype[le]=!0;m=J.prototype;m.Jc=function(){return this.$q};m.fa=function(a){this.$q=a};m.addEventListener=function(a,b,c,d){qe(this,a,b,c,d)};m.removeEventListener=function(a,b,c,d){ye(this,a,b,c,d)};
m.dispatchEvent=function(a){var b,c=this.Jc();if(c)for(b=[];c;c=c.Jc())b.push(c);c=this.Wx;var d=a.type||a;if("string"===typeof a)a=new ie(a,c);else if(a instanceof ie)a.target=a.target||c;else{var e=a;a=new ie(d,c);Ta(a,e)}e=!0;if(b)for(var f=b.length-1;!a.mk&&0<=f;f--){var g=a.currentTarget=b[f];e=g.Ef(d,!0,a)&&e}a.mk||(g=a.currentTarget=c,e=g.Ef(d,!0,a)&&e,a.mk||(e=g.Ef(d,!1,a)&&e));if(b)for(f=0;!a.mk&&f<b.length;f++)g=a.currentTarget=b[f],e=g.Ef(d,!1,a)&&e;return e};
m.i=function(){J.g.i.call(this);this.nd&&this.nd.ja(void 0);this.$q=null};m.Ef=function(a,b,c){a=this.nd.qb[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.fi&&f.capture==b){var g=f.listener,h=f.om||f.src;f.yl&&ge(this.nd,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};m.Fp=function(a,b,c,d){return this.nd.Fp(String(a),b,c,d)};m.Xp=function(a,b){return this.nd.Xp(void 0!==a?String(a):void 0,b)};t("H.util.EventTarget",J);J.prototype.fa=J.prototype.fa;J.prototype.setParentEventTarget=J.prototype.fa;J.prototype.Jc=J.prototype.Jc;J.prototype.getParentEventTarget=J.prototype.Jc;J.prototype.addEventListener=J.prototype.addEventListener;J.prototype.addEventListener=J.prototype.addEventListener;J.prototype.removeEventListener=J.prototype.removeEventListener;J.prototype.removeEventListener=J.prototype.removeEventListener;J.prototype.dispatchEvent=J.prototype.dispatchEvent;
J.prototype.dispatchEvent=J.prototype.dispatchEvent;J.prototype.u=J.prototype.u;J.prototype.dispose=J.prototype.u;J.prototype.bc=J.prototype.bc;J.prototype.addOnDisposeCallback=J.prototype.bc;J.prototype.Wy=J.prototype.Ef;
J.prototype.Ef=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=J.prototype.Wy.apply(this,arguments),d&&this.Jc&&null===this.Jc()&&delete c.eventPhase;return f};J.prototype.Pw=function(a){for(var b,c=this;c&&(b=c.Jc())&&b!==a;)c=b;b||c.fa(a)};J.prototype.setRootParentEventTarget=J.prototype.Pw;t("H.util.Event",ie);ie.prototype.stopPropagation=ie.prototype.stopPropagation;ie.prototype.stopPropagation=ie.prototype.stopPropagation;ie.prototype.CAPTURING_PHASE=1;ie.prototype.CAPTURING_PHASE=ie.prototype.CAPTURING_PHASE;ie.prototype.AT_TARGET=2;ie.prototype.AT_TARGET=ie.prototype.AT_TARGET;ie.prototype.BUBBLING_PHASE=3;ie.prototype.BUBBLING_PHASE=ie.prototype.BUBBLING_PHASE;ie.prototype.eventPhase=0;ie.prototype.eventPhase=ie.prototype.eventPhase;function Ce(a){a=a||{};var b=a.callback;this.Vb=a.label;ab(b)&&(this.callback=b);this.Db=!!a.disabled;Ce.g.constructor.call(this)}u(Ce,J);t("H.util.ContextItem",Ce);Ce.prototype.Cp=function(){return this.Vb};Ce.prototype.getLabel=Ce.prototype.Cp;Ce.prototype.se=function(a){this.Vb!==a&&(this.Vb=a,this.dispatchEvent("update"));return this};Ce.prototype.setLabel=Ce.prototype.se;Ce.prototype.hq=function(){return this.Db};Ce.prototype.isDisabled=Ce.prototype.hq;
Ce.prototype.wa=function(a){a!==this.Db&&(this.Db=a,this.dispatchEvent("update"));return this};Ce.prototype.setDisabled=Ce.prototype.wa;var De=new Ce;Ce.SEPARATOR=De;function Ee(a,b,c){Ee.g.constructor.call(this,a,c);this.message=b}u(Ee,ie);t("H.util.ErrorEvent",Ee);function Fe(a,b,c){Fe.g.constructor.call(this,a,c);this.data=b}u(Fe,ie);t("H.util.DataEvent",Fe);function Ge(a,b,c){var d=[],e=arguments.length;a&&d.push(fb(a));1<e&&(e=2<e&&ib(c)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,Ge.prototype);return d}u(Ge,Error);t("H.lang.OutOfRangeError",Ge);Ge.prototype.name="OutOfRangeError";function He(a){if(x.document){var b=document.createElement("canvas");b.width=b.height=1;return b.getContext("2d",{PD:a})}return null}function Ie(){return window.devicePixelRatio||1}t("H.util.getPixelRatio",Ie);var Je=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;
function Le(a){var b=Me[a],c=x.RegExp;b||(x.Uint8ClampedArray||(x.Uint8ClampedArray=function(d){return d instanceof Number?Array(d):d.map(function(e){return ec(Eb(e),0,255)})}),"none"===a?b=new Uint8ClampedArray([0,0,0,0]):(Ne.fillStyle="black",Ne.fillStyle=a,Je.test(Ne.fillStyle)?b=new Uint8ClampedArray([c.$1,c.$2,c.$3,255*c.$4]):(Ne.clearRect(0,0,1,1),Ne.fillRect(0,0,1,1),b=Ne.getImageData(0,0,1,1).data)),Me[a]=b);return b}function Oe(a){return"none"!==a&&0<Le(a)[3]}var Me=Wa(),Pe=!!x.VBArray;
t("H.util.eval",function(a){return eval(a)});function Qe(a,b){return a!==B?a:b}function Re(a){return/^<svg/.test(a)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a):a}t("H.util.provide",function(a){var b=wa.$jscomp;if(b&&("function"!=typeof b.pz?0:b.pz()))throw Error("goog.provide cannot be used within a module.");xa(a,void 0,void 0)});function Se(a){this.xd=0<+a?Bb.round(a):0}
Se.prototype.next=function(a){if(9007199254740992===this.xd)throw new Ge(a,this.xd,[0,9007199254740991]);return this.xd++};var Te=new Se,Ue=A(Te.next,Te);function Ve(){return!0}function We(){return!1}function Xe(){}var Ye=Ya([]),Ze=Ya({});function $e(a){return"CANVAS"===a.tagName?[a]:a.getElementsByTagName("CANVAS")}function af(a,b,c){var d;b=a.ownerDocument===b?a.cloneNode(!0):b.importNode(a,!0);if(c)for(a=$e(a),c=$e(b),d=c.length;d--;)c[d].getContext("2d").drawImage(a[d],0,0);return b}
var Ne=He(!0),bf=He(!1);function cf(a){var b=a.complete,c=0<a.naturalWidth;if(b&&!c&&Pe)try{bf.drawImage(a,0,0),c=!0}catch(d){}return b&&c}var df=x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder;function ef(a,b){b=b||"";if(df){var c=new df;c.append(a);a=c.getBlob(b)}else a=new Blob([a],{type:b});return a}var ff=x.navigator;La=/Edge\/\d+/.test(ff.appVersion);Ma=/(A|a)ndroid/.test(ff.appVersion);function K(a){K.g.constructor.call(this);a&&gf(a,K,0);this.T=a||[];this.ed=hf(this,0,this.T.length)}u(K,oc);t("H.geo.LineString",K);function hf(a,b,c){a=a.T;var d=0;b=Db(b,0);c=Cb(c,a.length);c-=2;for(b+=1;b<c;)d+=nc(a[b],a[b+=3]);return d}K.prototype.nr=function(a,b,c){jf(this,a,b,c,this.nr)};K.prototype.pushLatLngAlt=K.prototype.nr;function jf(a,b,c,d,e){var f=a.T.length;b=kc(b,e);c=lc(c,e);a.T.push(kc(b,e),lc(c,e),d===B?0:mc(d,e));f&&(a.ed+=nc(a.T[f-2],c));delete a.I;delete a.pr}
K.prototype.Ok=function(a,b,c){c&&gf(c,this.Ok,2);void 0===b&&(b=this.T.length);b&&(this.ed-=hf(this,a-3,a+b+3));var d=c?this.T.splice.apply(this.T,[a,b].concat(c)):this.T.splice(a,b);c&&(this.ed+=hf(this,a-3,a+c.length+3));b&&!c&&(this.ed+=hf(this,a-3,a-3));delete this.I;delete this.pr;return d};K.prototype.spliceLatLngAlts=K.prototype.Ok;K.prototype.Gu=function(a,b,c,d){this.Ok(a,0,[b,c,d])};K.prototype.insertLatLngAlt=K.prototype.Gu;K.prototype.rw=function(a){this.Ok(a,3)};
K.prototype.removeLatLngAlt=K.prototype.rw;K.prototype.ng=function(a){jf(this,a.lat,a.lng,a.alt,this.ng)};K.prototype.pushPoint=K.prototype.ng;K.prototype.Wd=function(a,b){this.Gu(3*a,b.lat,b.lng,b.alt)};K.prototype.insertPoint=K.prototype.Wd;K.prototype.tk=function(a){this.rw(3*a)};K.prototype.removePoint=K.prototype.tk;K.prototype.rj=function(a,b){var c=this.T,d=3*a;a=c[d];var e=c[d+1];c=c[d+2];b&&(b.lat=a,b.lng=e,b.alt=c);return b||new pc(a,e,c)};K.prototype.extractPoint=K.prototype.rj;
K.prototype.Oy=function(a,b,c){var d=this.T;b=b||0;c=Qe(c,d.length/3);for(var e=3*b;b<c;)a(d[e++],d[e++],d[e++],b++)};K.prototype.eachLatLngAlt=K.prototype.Oy;K.isDBC=nc;K.prototype.yp=function(a){var b=this.ed;a&&(a=this.T,b+=nc(a[a.length-2],a[1]));return b};K.prototype.getDBCs=K.prototype.yp;K.prototype.Ej=function(){return this.T.length/3};K.prototype.getPointCount=K.prototype.Ej;K.prototype.Pz=function(){return this.T};K.prototype.getLatLngAltArray=K.prototype.Pz;K.prototype.I=z;
K.prototype.C=function(){var a;if(!(a=this.I)){a=this.T;var b=a.length,c=3,d,e,f=z;if(3<=b){var g=d=a[0];var h=e=a[1];for(f=new F(g,h,d,e);c<b;c+=3){g=a[c-3];h=a[c-2];d=a[c];e=a[c+1];if(h>e&&180<e-h||h<e&&-180>h-e||e<h&&180>Hb(e-h)){var k=h;h=e;e=k}g<d&&(k=g,g=d,d=k);Hc(f.ga,f.X,f.ha,f.da,g,h,d,e,f)}}a=this.I=f}return a};K.prototype.getBoundingBox=K.prototype.C;K.prototype.IA=function(){return this.I!==z};K.prototype.hasBoundingBox=K.prototype.IA;
function gf(a,b,c){for(var d=a.length,e=!(d%3),f;e&&d;)e=!(E(a[--d]=mc((f=a[d])===B?0:f))||E(a[--d]=lc(a[d]))||E(a[--d]=kc(a[d])));if(!e&&b)throw new D(b,c,a);}function kf(a){var b=new K,c=0,d=a.length;if(d%2)throw new D(kf,0,a);for(;c<d;)jf(b,a[c++],a[c++],0,kf);return b}K.fromLatLngArray=kf;K.prototype.ea=function(a){var b=this===a,c;if(!b&&(b=C(a,K))){var d=this.T;a=a.T;for(b=(c=d.length)===a.length;b&&c--;)b=d[c]==a[c]}return b};K.prototype.equals=K.prototype.ea;
function lf(a,b){return a.oo-b.oo}
function mf(a,b){var c=a.T,d=-2,e=[],f;var g=a.pr;if(!g){g=a.pr=new Mc;var h=0;var k=a.T;var l=k.length;for(f=0;f<l;f+=3){var n=k[f];var p=k[f+1];if(f){var q=g.Hu(q,r,n,p);q.oo=h++}q=n;var r=p}}g=g.ym(b).sort(lf);k=g.length;for(b=0;b<k;b++){h=g[b];h=h.oo;l=3*h;if(h>d+1){var v=[c[l],c[l+1]];e.push(v)}d=h;v.push(c[l+3],c[l+4])}if(a.ed){c=[];d=e.length;for(b=0;b<d;b++)if(v=e[b],g=v.length){k=[];for(a=0;a<g;a+=2)h=v[a],l=v[a+1],k.push(h,l),f=v[a-1],a&&nc(l,f)&&(c.push(k),k=[],f+=0>f?360:-360,k.push(v[a-
2],f,h,l));c.push(k)}e=c}return e}m=K.prototype;m.ac="LineString";m.sf=function(a,b){var c=this.T,d=c.length,e;if(d){a.push("(");for(e=0;e<d;e+=3)e&&a.push(","),a.push(c[e+1]," ",c[e]);b&&(c[0]!==c[d-3]||c[1]!==c[d-2])&&a.push(",",c[1]," ",c[0]);a.push(")")}else a.push("EMPTY");return a};m.Ec="LineString";m.rf=function(){var a=[],b=this.T,c=b.length,d;for(d=0;d<c;d+=3)a.push([b[d+1],b[d],b[d+2]]);return a};
m.Od=function(){var a=this.T,b;if(this.C().oc()){a=a.slice();var c=1;for(b=a.length;c<b;c+=3)0>a[c]&&(a[c]+=360)}return a};m.nD=function(a){a=void 0===a?5:a;for(var b=this.T,c=b.length,d=[],e=0;e<c;e+=3)d.push([b[e],b[e+1],b[e+2]]);return Xc({polyline:d,precision:a,thirdDim:2,thirdDimPrecision:a})};K.prototype.toFlexiblePolyline=K.prototype.nD;
function nf(a){var b=Yc(a);a=b.polyline;var c=b.thirdDim;b=2===c||3===c;c=0===c;if(!a)throw new D(nf,0,"data");if(b||c){c=a.length;var d=Array(3*c);for(var e=0,f=0;e<c;e++){var g=a[e];d[f++]=g[0];d[f++]=g[1];d[f++]=b?g[2]:0}}if(!d)throw new D(nf,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new K(d)}K.fromFlexiblePolyline=nf;function L(a,b){this.x=+a;this.y=+b}t("H.math.Point",L);L.prototype.set=L;L.prototype.set=L.prototype.set;L.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new L(this.x,this.y);return a};L.prototype.clone=L.prototype.clone;L.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};L.prototype.add=L.prototype.add;L.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};L.prototype.sub=L.prototype.sub;L.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};
L.prototype.scale=L.prototype.scale;L.prototype.round=function(){this.x=Eb(this.x);this.y=Eb(this.y);return this};L.prototype.round=L.prototype.round;L.prototype.floor=function(){this.x=Fb(this.x);this.y=Fb(this.y);return this};L.prototype.floor=L.prototype.floor;L.prototype.ceil=function(){this.x=Gb(this.x);this.y=Gb(this.y);return this};L.prototype.ceil=L.prototype.ceil;L.prototype.ea=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};L.prototype.equals=L.prototype.ea;
L.prototype.ju=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new L(a.x+e*c,a.y+e*d);return e};L.prototype.getNearest=L.prototype.ju;L.prototype.lb=function(a){return Jb(Kb(this.x-a.x,2)+Kb(this.y-a.y,2))};L.prototype.distance=L.prototype.lb;function of(a){if(!a)throw Error("invalid argument");return a instanceof L?a:new L(a.x,a.y)}L.fromIPoint=of;function pf(a,b,c,d,e,f){var g,h,k=a.length,l,n;if(k)for(g=[];k--;){var p=a[k];var q=p.length;var r=0;for(l=1;l<q;l++)if(n=qf(p[l-1],p[l],c,b,d,e)){var v=n[0];var w=n[1];r&&r.ea(v)?h.push(w):g.push(h=n);r=w;f&&(l=q,k=0)}}else g=a;return g}t("H.math.clipping.clipStrips",pf);
function qf(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var l=a;g=h;a=b;h=k;b=l;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;l=f;f=-c;c=-l}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new L(h,-b),new L(g,-a)]:[new L(g,-a),new L(h,-b)]}
function rf(a,b,c){a=sf(a,!0);b=sf(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.fj=new tf(b.x,b.y,null,uf(b));a.fj=new tf(a.x,a.y,null,uf(a));for(g=b;g.next;g=g.next)if(!g.pb)for(d=a;d.next;d=d.next)if(!d.pb){var k=vf(g.next);var l=vf(d.next);if(e=wf(g,k,d,l,f)){e=f.ay;var n=f.by;var p=f.yD;var q=f.zD;e=new tf(p,q,null,null,null,null,!0,0,0,e);xf(e,g,k);k=new tf(p,q,null,null,null,null,!0,0,0,n);xf(k,d,l);e.Hq=
k;k.Hq=e}}f=ic(b,yf(a));c&&(f=!f);for(g=b;g;g=g.next)g.pb&&(g.iq=f,f=!f);f=ic(a,yf(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.pb&&(d.iq=f,f=!f);zf(b);for(zf(a);(a=Af(b))!=b;){for(c=null;!a.eo;a=a.Hq){for(f=a.iq;;){c=new tf(a.x,a.y,c);c.artificial=a.pb||a.Nu;a.eo=1;a=f?a.next:a.Ad;if(!a)break;if(a.pb){a.eo=1;break}}if(!a)break}c.Iq=r||null;var r=c}return r}}t("H.math.clipping.clipPolygon",rf);
function tf(a,b,c,d,e,f,g,h,k,l){this.x=a;this.y=b;this.next=c||null;this.Ad=d||null;this.Iq=e||null;this.Hq=f||null;this.pb=!!g;this.iq=!!h;this.eo=k||0;this.alpha=l||0;d&&(d.next=this);c&&(c.Ad=this);this.Nu=!1;this.fj=null}function vf(a){for(;a&&a.pb;)a=a.next;return a}function uf(a){if(a)for(;a.next;)a=a.next;return a}function Af(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.pb||b.pb&&b.eo))}return b}function zf(a){var b=uf(a);b.Ad.next=a;a.Ad=b.Ad}
function wf(a,b,c,d,e,f){var g,h=b.x-a.x,k=b.y-a.y;var l=d.x-c.x;var n=d.y-c.y;var p=h*n-k*l;if(!p)return 0;l=((c.x-a.x)*n-(c.y-a.y)*l)/p;p=(k*(c.x-a.x)-h*(c.y-a.y))/p;if(0>l||1<l||0>p||1<p)return 0;0===l?g=a:1===l?g=b:0===p?g=c:1===p&&(g=d);if(g&&!f)return g.x+=2.480549651603763E-5,g.y+=7.321997314118067E-5,g.fj&&(g.fj.x=g.x,g.fj.y=g.y),wf(a,b,c,d,e);e.yD=a.x+l*h;e.zD=a.y+l*k;e.ay=l;e.by=p;return 1}function yf(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}
function xf(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.Ad=b.Ad;a.next.Ad=a;a.Ad.next=a}function sf(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new tf(a[e].x,a[e].y,d);c.Nu=b;if(c.next=d)d.Ad=c;d=c}return d};function M(a,b){var c;M.g.constructor.call(this);C(a,K,M,0);if(b!==B&&ib(b,M,1)){for(c=0;c<b.length;c++)C(b[c],K,M,1,"index "+c);this.eb=b}else this.eb=[];this.Fb=a;this.Lj=[]}u(M,oc);t("H.geo.Polygon",M);function Bf(a){var b=M,c=K,d=a.ga,e=a.X,f=a.ha,g=a.da;e=[d,e,B,d,g,B,f,g,B,f,e,B];180<=a.nc()&&(e.splice(9,0,f,a=a.wb().lng,B),e.splice(3,0,d,a,B));return new b(new c(e))}M.fromRect=Bf;var Cf={NORTH:90,SOUTH:-90};M.Direction=Cf;M.prototype.ef=Cf.NORTH;
M.prototype.Ow=function(a){this.ef!==a&&(this.I=z,this.Lj.length=0,this.ef=a);return this};M.prototype.setPoleCovering=M.prototype.Ow;M.prototype.fA=function(){return this.ef};M.prototype.getPoleCovering=M.prototype.fA;M.prototype.Az=function(){return this.Fb};M.prototype.getExterior=M.prototype.Az;M.prototype.Lw=function(a){if(!C(a,K))throw new D(this.Lw,0,a);this.Fb=a;this.I=z};M.prototype.setExterior=M.prototype.Lw;M.prototype.Mz=function(){return this.eb};M.prototype.getInteriors=M.prototype.Mz;
M.prototype.ao=function(a,b,c){var d=arguments.length,e;for(e=2;e<d;e++)C(arguments[e],K,this.ao,e);var f=this.eb.splice.apply(this.eb,arguments);for(e=2;e<d;e++)arguments[e]=B;this.Lj.splice.apply(this.Lj,arguments);return f};M.prototype.spliceInteriors=M.prototype.ao;M.prototype.rC=function(a){return this.ao(a,1)[0]};M.prototype.removeInteriorAt=M.prototype.rC;M.prototype.qC=function(a){a=this.eb.indexOf(a);return 0>a?B:this.ao(a,1)[0]};M.prototype.removeInterior=M.prototype.qC;
M.prototype.nw=function(a){if(!C(a,K))throw new D(this.nw,0,a);this.eb.push(a)};M.prototype.pushInterior=M.prototype.nw;M.prototype.C=function(){var a=this.I;a||(this.I=a=Df(this.Fb,this.ef));return a};M.prototype.getBoundingBox=M.prototype.C;m=M.prototype;m.$t=function(a){var b=this.eb.length;if(0>a||a>=b)throw new Ge(this.$t,a,[0,b-1]);(b=this.Lj[a])||(this.Lj[a]=b=Df(this.eb[a],this.ef));return b};
function Df(a,b){var c,d,e;if(e=a.C())(c=a.yp(!0))&&(d=a.Ej())&&(e=e.wd(Jc([a.rj(0),a.rj(d-1)],!0),!0)),360===e.nc()&&1===c%2&&(e=e.Ze(b,0));return e}m.ac="Polygon";m.sf=function(a){var b=this.eb,c=b.length,d;if(this.Fb.Ej()){a.push("(");this.Fb.sf(a,!0);for(d=0;d<c;d++)b[d].Ej()&&(a.push(","),b[d].sf(a,!0));a.push(")")}else a.push("EMPTY");return a};m.Ec="Polygon";
m.rf=function(){var a,b=[],c=this.eb,d=this.Fb.rf();d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]);b.push(d);for(a=0;a<c.length;a++)d=c[a].rf(),d[0].toString()!==d[d.length-1].toString()&&d.push(d[0]),b.push(d);return b};m.R=function(){var a=M.g.R.call(this);this.C().oc()&&(a.type="Multi"+a.type);return a};m.Od=function(){var a=[],b=this.eb,c=b.length;for(a.push(this.Fb.Od());c--;)a[c+1]=b[c].Od();return this.C().oc()?[a]:a};
m.ea=function(a){var b=!1;if(C(a,M)){var c=a.eb,d=this.eb.length;b=c.length;var e=0;for(b=this.Fb.ea(a.Fb)&&d===b;b&&e<d;)b=b&&this.eb[e].ea(c[e]),e++}return b};M.prototype.equals=M.prototype.ea;function Ef(a,b,c,d){var e=a.eb,f=Ff.bind(null,b,c);return hc(b,c,a.Fb.T,0,!0,3)!==gc.NONE?void 0===d||d?!e.some(f):!0:!1}function Ff(a,b,c){return hc(a,b,c.T,0,!0,3)===gc.SURFACE}
function Gf(a,b){b=b.T;a=a.Fb.T;var c,d,e=b.length-3,f=a.length-3,g={};for(c=0;c<e;c+=3){var h=b[c];var k=b[c+1];var l=b[c+3];var n=b[c+4];for(d=0;d<f;d+=3){var p=a[d];var q=a[d+1];var r=a[d+3];var v=a[d+4];if(wf(new tf(k,h),new tf(n,l),new tf(q,p),new tf(v,r),g,!0))return!0}}return!1}
function Hf(a,b){var c=b.Fb,d=b.eb,e=d.length,f=c.T,g=f.length,h=a.Fb.T,k=h.length;if(Gf(a,c))return!0;for(c=0;c<g;c+=3)if(Ef(a,f[c],f[c+1]))return!0;for(c=0;c<k;c+=3)if(Ef(b,h[c],h[c+1]))return!0;for(c=0;c<e;c++)if(Gf(a,d[c]))return!0;return!1};function If(a){eb(this,If);If.g.constructor.call(this);this.ia=Jf(this,a,this.constructor,0)}u(If,oc);t("H.geo.MultiGeometry",If);If.prototype.splice=function(a,b,c){a=[a];b!==B&&a.push(b);c&&(b=Jf(this,c,this.splice,2),a=a.concat(b));this.I=z;return this.ia.splice.apply(this.ia,a)};If.prototype.splice=If.prototype.splice;If.prototype.Bd=function(a){var b=this.ia.length;if(!(0<=a&&a<b))throw new Ge(this.Bd,a,[0,b-1]);this.I=z;return this.ia.splice(a,1)[0]};If.prototype.removeAt=If.prototype.Bd;
If.prototype.remove=function(a){a=this.ia.indexOf(a);if(0<=a){var b=this.ia.splice(a,1)[0];this.I=z}return b||z};If.prototype.remove=If.prototype.remove;If.prototype.Hz=function(){return this.ia};If.prototype.getGeometries=If.prototype.Hz;If.prototype.push=function(a){var b=Jf(this,[a],this.push,0)[0];this.I&&(this.I=this.I.wd(a.C()));this.ia.push(b)};If.prototype.push=If.prototype.push;
If.prototype.C=function(){var a;if(!(a=this.I)){a=z;var b,c;if(this.ia.length)for(a=this.ia[0].C(),c=1;c<this.ia.length;c++)if(b=this.ia[c].C())a=a?a.wd(b):b}return this.I=a};If.prototype.getBoundingBox=If.prototype.C;If.prototype.I=z;function Jf(a,b,c,d){var e,f=[];if(!ib(b))throw new D(c,d);for(e=0;e<b.length;e++)if(a.oq(b[e]))f.push(a.gw(b[e]));else throw new D(c,d);return f}If.prototype.gw=function(a){return a};
If.prototype.ea=function(a){var b=this===a,c;if(!b&&(b=C(a,this.constructor))){var d=this.ia;a=a.ia;for(b=(c=d.length)===a.length;b&&c--;)b=d[c].ea(a[c])}return b};If.prototype.equals=If.prototype.ea;If.prototype.sf=function(a){var b=this.ia,c=b.length,d,e,f=!1;if(c){a.push("(");for(d=0;d<c;d++)(e=0<d&&f)&&a.push(","),b[d].sf(a),"EMPTY"===a[a.length-1]?a.splice(-1-+e,1+ +e):f=!0;f?a.push(")"):a.splice(-1,1,"EMPTY")}else a.push("EMPTY");return a};
If.prototype.Od=function(){for(var a=[],b=this.ia,c=b.length;c--;)a[c]=b[c].Od();return a};If.prototype.R=function(){var a=If.g.R.call(this);a.type=this.ac;return a};If.prototype.rf=function(){for(var a=[],b=this.ia,c=b.length;c--;)a[c]=b[c].rf();return a};function Kf(a){Kf.g.constructor.call(this,a)}u(Kf,If);t("H.geo.MultiPolygon",Kf);Kf.prototype.oq=function(a){return C(a,M)};Kf.prototype.ac="Multi"+M.prototype.ac;Kf.prototype.Ec="Multi"+M.prototype.Ec;function Lf(a){Lf.g.constructor.call(this,a)}u(Lf,If);t("H.geo.MultiPoint",Lf);Lf.prototype.oq=function(a){return qc(a)};Lf.prototype.gw=function(a){return C(a,pc)?a:sc(a)};Lf.prototype.ac="Multi"+pc.prototype.ac;Lf.prototype.Ec="Multi"+pc.prototype.Ec;function Mf(a){Mf.g.constructor.call(this,a)}u(Mf,If);t("H.geo.MultiLineString",Mf);Mf.prototype.oq=function(a){return C(a,K)};Mf.prototype.ac="Multi"+K.prototype.ac;Mf.prototype.Ec="Multi"+K.prototype.Ec;function Nf(a,b,c){var d,e=6;if(b){for(d=' expected close to: "'+b;e--;)b=a.jt.next(),-1!==b&&(d+=String.fromCharCode(b));d+='"'}throw new D(Of,0,"- Malformed WKT: "+(d?c+d:"unexpected end of stream"));}function Pf(a,b){var c=a.next();b=b?")":"(";c!==b&&Nf(a,c,'"'+b+'"')}function Qf(a){return","===a.fb()?(a.next(),!0):!1}function Rf(a,b,c,d,e){var f,g,h=2+b+c;for(g=1;g<=h;g++)(c=a.next())?(f=+c)!==f?Nf(a,c,"number"):1===g?d[e+1]=f:2===g?d[e+0]=f:3===g&&(d[e+2]=f):Nf(a,c);b||(d[e+2]=0)}var Sf=[];
function Tf(a,b,c,d){d||Pf(a,0);Rf(a,b,c,Sf,0);d||Pf(a,1);return new pc(Sf[0],Sf[1],b?Sf[2]:B)}function Uf(a,b,c){var d=[];Pf(a,0);do Rf(a,b,c,d,d.length);while(Qf(a));Pf(a,1);return new K(d)}function Vf(a,b,c){Pf(a,0);var d=Uf(a,b,c);if(Qf(a)){var e=[];do e.push(Uf(a,b,c));while(Qf(a))}Pf(a,1);return new M(d,e)}
var Wf=[],Xf=[Vf],Yf=[Tf],Zf={POINT:Yf,LINESTRING:[Uf],POLYGON:Xf,MULTIPOINT:[Tf,Lf],MULTILINESTRING:[Uf,Mf],MULTIPOLYGON:[Vf,Kf],GEOMETRY:Wf,GEOMETRYCOLLECTION:Wf,CIRCULARSTRING:Wf,COMPOUNDCURVE:Wf,CURVEPOLYGON:Wf,MULTICURVE:Wf,MULTISURFACE:Wf,CURVE:Wf,SURFACE:Wf,POLYHEDRALSURFACE:Wf,TIN:Wf,TRIANGLE:Wf},$f={Z:1,M:2,ZM:3};
function Of(a){a=new ag(a);var b;var c=a.next();(b=Zf[c.toUpperCase()])||Nf(a,c,"type name");if(b!==Wf){c=a.fb();c=$f[c.toUpperCase()];var d=c&1;var e=c>>1;d|e&&a.next();c=a.fb();if("EMPTY"===c)if(a.next(),d=b[1])var f=new d([]);else b!==Yf&&(f=new K([]),b===Xf&&(f=new M(f)));else if("("===c){f=b[0];b=b[1];if(b){var g=[];Pf(a,0);if(f===Tf){var h="("!==a.fb();do g.push(f(a,d,e,h));while(Qf(a))}else{do g.push(f(a,d,e));while(Qf(a))}Pf(a,1);d=new b(g)}else d=f(a,d,e);f=d}else Nf(a,c,'"Z", "M", "ZM", "(" or "EMPTY"');
a.next()&&Nf(a,c,"end of stream")}return f||z}function ag(a){this.jt=a}ag.prototype.fb=function(){var a=this.Wv;if(a===B){for(a=this.jt;a.fb()===bg;)a.next();if(cg[a.fb()])a=a.next(),a=a===dg?"":String.fromCharCode(a);else{a.ui();do a.next();while(!cg[a.fb()]);a=String.fromCharCode.apply(null,a.ih())}this.Wv=a}return a};ag.prototype.next=function(){var a=this.fb();""!==a&&delete this.Wv;return a};
var bg=32,dg=-1,eg={JD:bg,DD:40,ID:41,AD:44,BD:dg},cg=Object.keys(eg).reduce(function(a,b){a[eg[b]]=!0;return a},Wa());t("H.util.wkt.toGeometry",function(a){return Of(new Oa(a))});function fg(a,b,c,d){this.left=+a;this.top=+b;this.right=+c;this.bottom=+d}t("H.math.Rect",fg);fg.prototype.set=fg;fg.prototype.set=fg.prototype.set;fg.prototype.Kc=function(){return this.al||(this.al=new L(this.left,this.top))};fg.prototype.getTopLeft=fg.prototype.Kc;fg.prototype.Gc=function(){return this.Ni||(this.Ni=new L(this.right,this.bottom))};fg.prototype.getBottomRight=fg.prototype.Gc;fg.prototype.Il=function(a,b){return this.left<=a&&this.right>=a&&this.top<=b&&this.bottom>=b};
fg.prototype.containsXY=fg.prototype.Il;function gg(a,b){return new fg(a.x,a.y,b.x,b.y)}fg.fromPoints=gg;fg.prototype.clone=function(){return new fg(this.left,this.top,this.right,this.bottom)};fg.prototype.clone=fg.prototype.clone;t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);var hg;function ig(a,b){if(x.URL)return(new x.URL(a,b)).toString();if(!a||!jg(a))return a;if(!b||jg(b))throw new TypeError("Failed to construct 'URL': Invalid base URL");hg||(hg=document.createElement("a"),rb(hg));var c=hg;c.href=b;"/"!==a[0]?a=c.href.replace(/\/[^\/]*$/,"/")+a:((b=c.origin)||(b=c.protocol+"//"+c.host),a=b+a);return a}function jg(a){var b=!1;"string"===typeof a&&(b=!(-1<a.search(/^(http|https|data|blob):/)||"//"===a.substr(0,2)));return b};function kg(a,b){kg.g.constructor.call(this);if(b&&jg(b))throw new D(kg,1,"Base URL must be absolute");this.o=lg.INIT;this.Ia=null;this.hd=b}u(kg,J);t("H.map.render.Style",kg);kg.prototype.load=kg.prototype.load;kg.prototype.getState=function(){return this.o};kg.prototype.getState=kg.prototype.getState;kg.prototype.G=function(a){this.o=a};kg.prototype.setState=kg.prototype.G;kg.prototype.Fc=function(){return this.hd};kg.prototype.getBaseUrl=kg.prototype.Fc;kg.prototype.Pd=function(){return $a(this.Ia)};
kg.prototype.getConfig=kg.prototype.Pd;kg.prototype.nz=function(){return this.Ia};kg.prototype.getConfigReference=kg.prototype.nz;kg.prototype.yg=function(a){this.Ia=a};kg.prototype.setConfig=kg.prototype.yg;kg.prototype.Dc=function(a){this.Ia=null;this.G(lg.ERROR);this.Xp(mg)?this.dispatchEvent(new Ee(mg,a,this)):console.error(a)};kg.prototype.dispatchError=kg.prototype.Dc;kg.prototype.i=function(){kg.g.i.call(this);this.Ia=null};
var mg="error",ng={uf:"change",Fs:mg},lg={ERROR:-1,INIT:0,LOADING:1,READY:2};kg.State=lg;var og={FEATURE:1,SOURCE:2,PROVIDER:3};t("H.map.provider.PickingMode",og);function pg(a,b){var c,d=arguments.length,e,f;for(c=1;c<d;c++)if((e=arguments[c])&&e!==a&&e!==g){var g=e;for(f in e){var h=e[f];a[f]!==h&&(qg(h)?qg(a[f])?a[f]=pg(a[f],h):a[f]=$a(h):void 0!==h&&(a[f]=$a(h)))}}return a}t("H.util.webgl.mergeObjects",pg);var rg=Wa();function sg(a,b,c){var d=c[a];return b&&d in b&&0>cb.indexOf(d)?(b=b[d],++a<c.length?sg(a,b,c):b):rg}
var tg=sg.bind(null,0),ug={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},vg={data:1,draw:1,enabled:1,filter:1,properties:1},wg=Object.keys(vg);function xg(a,b,c,d,e,f){var g=d[a],h=c[g];if(++a<d.length){var k=b[g]||{};for(c=wg.length;c--;){var l=wg[c];if("draw"!==l||!f){var n=h[l];n!==B&&(k[l]=$a(n))}}xg(a,k,h,d,e,f)}else e?k=$a(h):(k=h,delete c[g]);b[g]=b[g]?pg(b[g],k):k}var yg=xg.bind(null,0);function zg(a,b){a in ug&&(b[a]=1)}
function Ag(a,b,c){var d,e,f;for(d in a)if(vg[d]){if("draw"===d){var g=a[d];for(e in g){var h=g[e];(f=h.style)?(h.style=b+f,zg(f,c)):(delete g[e],g[b+e]=h,zg(e,c))}}}else Ag(a[d],b,c)}
function Bg(a,b){var c={},d,e,f,g;b+="_";a=pg({},a);if(d=a.styles)for(e in d){var h=d[e];delete d[e];d[b+e]=h;if(f=h.mix)for(jb(f)&&(f=[f]),g=f.length;g--;)zg(f[g],c),f[g]=b+f[g];if(g=h.base)f||(f=h.mix=[]),f.unshift(b+g),delete h.base,zg(g,c);zg(e,c)}else d=a.styles={};if(h=a.layers)for(e in h)f=h[e],delete h[e],(g=f.data)&&!g.layer&&(g.layer=e),h[b+e]=f,Ag(f,b,c);for(e in c)d[b+e]={base:e};return a}
function Cg(a,b){var c=a.sources,d=Object.keys(c)[0],e=pg(c[d],{uid:b});c=a.layers;var f;a.sources={};a.sources[b]=e;for(f in c)a=c[f],a.data?a.data.source===d&&(a.data.source=b):a.data={source:b}}function Dg(a,b){var c;var d=a.textures;a=a.fonts;for(c in d){var e=d[c];e.url&&(e.url=ig(e.url,b))}for(c in a)if(e=a[c],ib(e))for(d=0;d<e.length;d++){var f=e[d];f.url=f.url&&ig(f.url,b)}else f=e,f.url=f.url&&ig(f.url,b)}function Eg(a,b){return"function(){return "+("feature."+a+(b||""))+";}"}
function Fg(a){return Eg("style."+a,void 0)}function Gg(a,b,c,d){a={base:a,blend:b,blend_order:c};d&&(a.clean_depth=!!d);return a}function Hg(a){var b={};b["translucent-"+(a?"extruded-":"")+"polygons"]={color:Fg("fillColor"),order:1,interactive:!0,extrude:a};return b}function Ig(a,b,c,d){a={data:{source:a,layer:b}};c&&(a.draw=c);d&&(a.filter=d);return a}function qg(a){return ya(a)&&!ib(a)};function Jg(){var a=Jg.hv;a||(a=this,Jg.hv=a,rb(Jg.hv),J.call(a),this.ug());return a}u(Jg,J);m=Jg.prototype;m.i=function(){Jg.g.i.call(this);this.ug()};m.ug=function(){this.mB=10;this.nB=6;this.gi=Wa();this.xr=Wa();this.Cr=0};m.zo=function(a){a=a.type;var b=this.gi[a]||0;if(this.Cr<this.mB&&b<this.nB){var c=++this.bB;this.Cr++;this.gi[a]=b+1;this.xr[c+""]=a;return c}return z};
m.Sl=function(a){var b=this.xr[a];if(!db(b)||!this.gi[b])throw new Ab(this.Sl,"Unknown requestId");this.Cr--;this.gi[b]--;this.gi[b]||delete this.gi[b];delete this.xr[a];this.dispatchEvent("allocatable")};m.bB=-1;function Kg(a,b){b=b||{};"status"in b&&(this.status=+b.status);"statusText"in b&&(this.statusText=b.statusText);this.ok=200<=this.status&&300>this.status;this.Mu=!1;a?"string"===typeof a?this.Fo=a:(b=x.ArrayBuffer)&&b.prototype.isPrototypeOf(a)?this.vf=a:b&&a.buffer?this.vf=a.buffer:x.Blob.prototype.isPrototypeOf(a)&&(this.vl=a):this.Fo=""}t("H.net.Response",Kg);Kg.prototype.type="default";Kg.prototype.type=Kg.prototype.type;Kg.prototype.status=200;Kg.prototype.status=Kg.prototype.status;
Kg.prototype.statusText="OK";Kg.prototype.statusText=Kg.prototype.statusText;function Lg(a){if(a.Mu)return Ed(new TypeError("Already read"));a.Mu=!0}Kg.error=function(){Kg.hp||(Kg.hp=new Kg(null,{status:0,statusText:""}),Kg.hp.type="error");return Kg.hp};Kg.error=Kg.error;
Kg.prototype.text=function(){var a=Lg(this);if(!a)if(this.Fo)a=Dd(this.Fo);else if(this.vf){a=new Uint8Array(this.vf);var b=a.length,c=Array(b),d;for(d=0;d<b;d++)c[d]=String.fromCharCode(a[d]);a=Dd(c.join(""))}else a=this.vl?Mg(this.vl):Ed("Unsupported response body");return a};Kg.prototype.json=function(){return this.text().then(x.JSON.parse)};Kg.prototype.blob=function(){var a,b=Lg(this);b||(this.vl?a=this.vl:this.vf&&(a=new Blob([this.vf],{type:"application/octet-stream"})));return b||Dd(a)};
Kg.prototype.arrayBuffer=function(){return this.vf?Lg(this)||Dd(this.vf.slice(0)):this.blob().then(Kg.hy)};Kg.hy=function(a){var b=new FileReader;b.readAsArrayBuffer(a);return new ud(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})};function Mg(a){var b=new FileReader;b.readAsText(a);return new ud(function(c,d){b.onload=function(){c(b.result)};b.onerror=function(){d(b.error)}})}!yb&&x.Response&&x.Response.error&&(Kg=x.Response,rb(Kg.prototype));function Ng(a,b,c){function d(){var n=A(l.Th,l),p=+k.timeout||0;Og?(Pg(l,"timeout",n),e.timeout=p):p&&(l.Ax=setTimeout(function(){e.abort();l.Th({type:"timeout"})},p));Pg(l,"error",n);Pg(l,"load",n);e.send(k.data)}var e,f,g,h=c&&c.headers||{},k={},l=this;if(!ab(b))throw new D(Ng,1,"function required");a+="";Ta(h,Qg.headers,h);Ta(k,Qg,c||{});k.headers=h;this.gt=b;this.K=e=new XMLHttpRequest;b=k.method;try{e.open(b,a,!0);for(f in h)h.hasOwnProperty(f)&&(g=h[f])&&e.setRequestHeader(f,g);e.withCredentials=
!!k.withCredentials;d()}catch(n){this.Th({type:"cors"})}}t("H.net.Xhr",Ng);var Qg={method:"GET",headers:{},data:null},Rg="withCredentials"in new XMLHttpRequest,Og="timeout"in new XMLHttpRequest;function Pg(a,b,c){Rg?a.K.addEventListener(b,c):a.K["on"+b]=c}function Sg(a,b,c){Rg?a.K.removeEventListener(b,c):a.K["on"+b]=null}Ng.prototype.abort=function(){this.K&&(this.K.abort(),this.K&&this.Th({type:"abort"}))};Ng.prototype.abort=Ng.prototype.abort;
Ng.prototype.Th=function(a){var b=a.type;a=this.K;var c;this.Ax&&clearTimeout(this.Ax);"load"===b?a instanceof XMLHttpRequest&&200!==a.status&&(c="network"):c=4===a.readyState&&0===a.status&&"error"==b?"cors":"error"!=b?b:"network";b=this.Th;Sg(this,"timeout",b);Sg(this,"error",b);Sg(this,"load",b);a=0===a.status||c&&"network"!==c?Kg.error():new Kg(a.responseText||null,a);c=this.gt;delete this.Th;delete this.gt;delete this.K;c(a)};function Tg(a,b,c,d){if(!Ug[a])throw new D(Tg,0,"Mime type is not supported");this.tB=a;a=d?Ra(d):{};"crossOrigin"in a||(a.crossOrigin="anonymous");this.Fa=a;Vg.href=b.toString();Td.call(this,Vg.protocol+"//"+Vg.hostname,b,c)}u(Tg,Td);Tg.prototype.Nt=function(){this.Xq=Ug[this.tB].call(this);return!0};Tg.prototype.Si=function(){this.Xq&&(this.Xq.abort(),delete this.Xq)};
var Ug={"application/json":function(){var a=this,b=Wg(this.Fa),c=b.headers;b.headers=c=c?Ra(c):{};c.Accept="application/json";return new Ng(this.data,function(d){200<=d.status&&300>d.status?a.resolve(d.json()):a.reject(d)},b)},"text/plain":function(){var a=this;return new Ng(this.data,function(b){200<=b.status&&300>b.status?a.resolve(b.text()):a.reject(b)},Wg(this.Fa))},image:function(){var a=x.document.createElement("img"),b=this,c=this.data;a.onload=A(this.resolve,this,a);a.onerror=function(){b.reject(Kg.error())};
a.crossOrigin=this.Fa.crossOrigin;a.src=c;return{abort:function(){a.onerror=a.onload=null;Pe&&cf(a)||a.removeAttribute("src")}}}};
(function(){try{var a=new XMLHttpRequest;a.open("get","/",!0)}catch(b){a={}}"response"in a&&(Ug.arraybuffer=function(){var b=new XMLHttpRequest,c=this,d=this.Fa,e=d.headers,f;b.open("GET",this.data);Xg(b,d);b.responseType="arraybuffer";if(e)for(f in e)b.setRequestHeader(f,e[f]);b.onerror=b.ontimeout=function(){c.reject(Kg.error())};b.onload=function(){c.resolve(new Kg(b.response))};b.send();return b})})();var Yg=new Wd(new Jg);Tg.prototype.Bp=function(){return Yg};var Vg=x.document.createElement("a");
function Wg(a){var b=Ra(a);delete b.crossOrigin;Xg(b,a);return b}function Xg(a,b){a.withCredentials="use-credentials"===b.crossOrigin};function Zg(a,b){Zg.g.constructor.call(this,a,b);if(jb(a))$g.test(a)&&-1===a.indexOf("import:")?(this.uc=a,b||(this.OA=jg(this.uc)?B:this.uc)):this.ko=a;else if(ya(a))this.yg($a(a));else throw new D(Zg,0,"invalid style configuration");}u(Zg,kg);t("H.map.render.webgl.Style",Zg);
Zg.prototype.load=function(){var a=this,b=this.Fc();this.uc?(this.G(lg.LOADING),(new Tg("text/plain",this.uc)).then(function(c){var d={};return ah(c,b,!1,(d[b]=!0,d))}).then(function(c){return a.yg(c)},function(c){return a.Dc(c.message)}),delete this.uc):this.ko&&(this.G(lg.LOADING),ah(this.ko,b).then(function(c){return a.yg(c)},function(c){return a.Dc(c.message)}),delete this.ko)};Zg.prototype.load=Zg.prototype.load;
Zg.prototype.Nw=function(a,b,c){var d;bh(this);a=ch(this,a,this.Nw,c);for(c=0;c<a.length;c++){var e=a[c].yb.draw;for(d in e){var f=e[d];qg(f)&&(f.interactive=!!b)}}dh(this)};Zg.prototype.setInteractive=Zg.prototype.Nw;
Zg.prototype.setProperty=function(a,b,c){var d,e=a.split("."),f=0,g=e.length;bh(this);if(!db(b))throw new D(this.setProperty,1,"value");if(d=eh(this.Ia,e)){if(!(d.parent instanceof Object)||d.parent instanceof Array)if(c)e.pop(),e=eh(this.Ia,e),d.parent=e.parent[e.An]={};else throw new D(this.setProperty,0,a+" property is not primitive type");d.parent[d.An]=b}else{for(d=this.Ia;f!==g-1;)d[e[f]]={},d=d[e[f++]];d[e[f]]=b}fh(this)&&dh(this)};Zg.prototype.setProperty=Zg.prototype.setProperty;
Zg.prototype.Kp=function(a){bh(this);return(a=eh(this.Ia,a.split(".")))?$a(a.node):void 0};Zg.prototype.getProperty=Zg.prototype.Kp;Zg.prototype.removeProperty=function(a){bh(this);(a=eh(this.Ia,a.split(".")))&&a.parent&&a.parent.hasOwnProperty(a.An)&&(delete a.parent[a.An],fh(this)&&dh(this))};Zg.prototype.removeProperty=Zg.prototype.removeProperty;
Zg.prototype.qj=function(a,b,c){var d;bh(this);var e=this.Ia;var f=e.layers;var g=ch(this,a,this.qj,!1);a=g.length;for(d={};a--;)yg(d,f,g[a].id,!!b,!!c);c={};g=Object.keys(e);for(a=g.length;a--;){var h=g[a];var k=e[h];c[h]=k===f?d:$a(k)}b||dh(this);return c};Zg.prototype.extractConfig=Zg.prototype.qj;Zg.prototype.Wj=function(a){bh(this);if(!ya(a))throw new D(this.Wj,0,"config");this.yg(pg(this.Ia,a))};Zg.prototype.mergeConfig=Zg.prototype.Wj;Zg.prototype.Yb=ba(2);
Zg.prototype.toString=function(){return this.getState()===lg.READY?x.H.gl.yaml.dump(this.Ia,{lineWidth:120}):""};Zg.prototype.i=function(){Zg.g.i.call(this);delete this.ko;delete this.uc};function fh(a){var b=a.Ia,c;if(ya(b)){var d;if(d=a.ps){b=b&&b.sources;d=!1;for(var e in b)if(b[e].type===a.ps){d=!0;break}d=!(b?d:1)}d&&(c="invalid source, the only valid type is "+a.ps)}else c="invalid style configuration";c&&a.Dc(c);return!c}function dh(a){a.dispatchEvent(new ie("change",a))}
function bh(a){if(a.getState()!==lg.READY)throw new Ab(a.Wj,"style is not ready yet");}function ch(a,b,c,d){var e=[],f=ib(b)?b:[b],g,h;void 0===d&&(d=!0);for(f=f.sort().reverse();g=f.pop();){b=String(g).split(".");a:{var k=a.Ia;for(var l=b.length;l--&&!vg[b[l]];);if(k&&0>l&&(k=tg(k.layers,b),qg(k)))break a;k=rg}if(k===rg)throw new D(c,0,'Unresolvable layer ID "'+g+'"');e.push({id:b,yb:k});if(d)for(h in k)!vg[h]&&qg(k[h])&&f.push(g+"."+h)}return e}
function eh(a,b){var c=0,d;for(d=b.length;c!==d;){var e=b[c++];var f=a;a=f[e];if(!a)break}return c===d?{node:a,parent:f,An:e}:void 0}var $g=/^(http[s]?)?.*\.ya?ml/i;
function ah(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?{}:d;try{var e=x.H.gl.yaml.load(a,{json:!0})}catch(f){return Promise.reject(f)}return e&&(a=e["import"],jb(a)&&(a=[a]),c&&b&&gh(e,b),delete e["import"],ib(a)&&a.length)?(c=a.reduce(function(f,g){var h=b?ig(g,b):g;d[h]||(d[h]=!0,f.push((new Tg("text/plain",h)).then(function(k){return ah(k,h,!0,d)})));return f},[]),Promise.all(c).then(function(f){var g={};f.forEach(function(h){return h&&pg(g,h)});pg(g,e);return g})):Promise.resolve(e)}
function gh(a,b){function c(g){g.url&&(g.url=ig(g.url,b))}var d=a&&a.fonts;if(d)for(var e in d)ib(d[e])?d[e].forEach(c):c(d[e]);if(a=a&&a.textures)for(var f in a)c(a[f])}Zg.normalize=gh;Zg.prototype.yg=function(a){Zg.g.yg.call(this,a);fh(this)&&(this.G(lg.READY),dh(this))};Zg.prototype.Pd=function(){return Zg.g.Pd.call(this)};Zg.prototype.getConfig=Zg.prototype.Pd;Zg.prototype.Fc=function(){return this.OA||Zg.g.Fc.call(this)};Zg.prototype.getBaseUrl=Zg.prototype.Fc;var hh={PROVIDES_BY_VIEWPORT:1,PROVIDES_RASTERS:2,PROVIDES_SPATIALS:4,PROVIDES_OVERLAYS:8,PROVIDES_MARKERS:16,PROVIDES_DOM_MARKERS:32,PROVIDES_GEOJSON:64,PROVIDES_OMV:128,CROP_LINES_BY_TILE:256,CROP_POLYGONS_BY_TILE:512,HAS_VOLATILE_DATA:1024};t("H.map.provider.Capabilities",hh);hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS=hh.PROVIDES_SPATIALS|hh.PROVIDES_OVERLAYS|hh.PROVIDES_MARKERS;function ih(a){this.Ba=a}
ih.prototype.Fe=function(){var a={};this.Ba&hh.PROVIDES_RASTERS&&(a={"translucent-raster":Gg("raster","inlay",1)});if(this.Ba&hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS){var b=!!(this.Ba&hh.CROP_LINES_BY_TILE),c={"translucent-polygons":Gg("polygons","inlay",2),"translucent-extruded-polygons":Gg("polygons","translucent",3),"translucent-pattern-lines":Gg("pattern-lines","translucent",4),"translucent-overlays":Gg("overlays","inlay",5),markers:Gg("custom_icons","overlay",6,!1)};c["translucent-polygons"].crop_by_tile=!!(this.Ba&
hh.CROP_POLYGONS_BY_TILE);c["translucent-pattern-lines"].crop_by_tile=b;c.markers.suppress_fade=!0;c.markers.stick=!0;Ta(a,c)}return a};function jh(a,b,c){this.Ba=a;this.uid=b;this.opacity=c;this.Tm=this.Ba&hh.PROVIDES_BY_VIEWPORT?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":B;this.Vf={}}
jh.prototype.Fe=function(){this.Ba&hh.PROVIDES_RASTERS&&(this.Vf["tile_layer_"+this.uid]=Ig(this.uid,"_default",{"translucent-raster":{color:[1,1,1,this.opacity],order:0}}));if(this.Ba&hh.PROVIDES_SPATIALS){var a={"translucent-pattern-lines":{color:Fg("strokeColor"),width:Fg("lineWidth * $meters_per_pixel"),join:Fg("lineJoin"),cap:Fg("lineCap"),tail_cap:Fg("lineTailCap"),head_cap:Fg("lineHeadCap"),miter_limit:Fg("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,
dash:Fg("lineDash"),extrude:!0,dash_phase:Fg("lineDashOffset")}};var b=this.Vf,c="polygon_layer_"+this.uid;var d=Ig(this.uid,"polygons",void 0,this.Tm);d.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:Hg(!1)};d.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:Hg(!0)};b[c]=d;this.Vf["outline_layer_"+this.uid]=Ig(this.uid,"outlines",a,this.Tm);this.Vf["polyline_layer_"+this.uid]=Ig(this.uid,"polylines",a,this.Tm)}this.Ba&hh.PROVIDES_OVERLAYS&&
(this.Vf["overlay_layer_"+this.uid]=Ig(this.uid,"overlays",{"translucent-overlays":{color:[1,1,1,this.opacity],order:8190,interactive:!0}}));this.Ba&hh.PROVIDES_MARKERS&&(this.Vf["marker_layer_"+this.uid]=Ig(this.uid,"markers",{markers:{sprite:Eg("icon.id"),offset:Eg("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:Eg("icon.stick_color"),height:Eg("icon.stick_height")}}},this.Tm));return this.Vf};function kh(a,b,c,d,e){this.Ba=a;this.uid=b;this.vv=c;this.Fq=d;this.tileSize=e}kh.prototype.Fe=function(){var a={};a[this.uid]=this.Ba&hh.PROVIDES_BY_VIEWPORT?lh(this,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(this.Ba&hh.HAS_VOLATILE_DATA)}):this.Ba&hh.PROVIDES_RASTERS?lh(this,"RemoteRasterTileSource",!0,{url:""}):lh(this,"ObjectTileSource",!0,{tile_size:this.tileSize});return a};function lh(a,b,c,d){a={type:b,uid:a.uid,tiled:c,max_zoom:a.Fq};d&&Ta(a,d);return a};function mh(a,b,c,d,e,f){this.Ba=a;this.uid=b;this.vv=c;this.Fq=d;this.opacity=e;this.tileSize=f}mh.prototype.Fe=function(){if(this.Ba&hh.PROVIDES_DOM_MARKERS&&!(this.Ba&hh.PROVIDES_MARKERS))return{};var a=new kh(this.Ba,this.uid,this.vv,this.Fq,this.tileSize);var b=new ih(this.Ba);var c=new jh(this.Ba,this.uid,this.opacity);a=a.Fe();b=b.Fe();c=c.Fe();return{sources:a,styles:b,layers:c}};function nh(a,b,c){nh.g.constructor.call(this,a);this.oldValue=c;this.newValue=b}u(nh,ie);t("H.util.ChangeEvent",nh);function N(a){var b=""+Ue(),c;N.g.constructor.call(this);a=a||{};this.min=a.min||0;this.max=a.max||22;if(c=a.uri){if(/_/.test(c))throw new D(N,0,"uri "+c);}else c=b;this.uri=c||b;this.uid=b;a.getCopyrights&&gb(a.getCopyrights,"Function",N)&&(this.getCopyrights=a.getCopyrights);this.Eb=this.Eb.bind(this);this.gq=!0;this.vb=a.engineType||oh;if(this.vb===ph.HARP&&!H.map.render.harp)throw new D(N,0,"HARP engine is not supported, module not found");}u(N,J);t("H.map.provider.Provider",N);m=N.prototype;
m.l={Hi:"configchange",Aa:"update"};m.kb=function(a,b){this.dispatchEvent(new Fe(this.l.Aa,b,a))};m.Eb=function(a){a=new nh(this.l.Hi,a&&a.newValue,a&&a.oldValue);this.dispatchEvent(a)};m.i=function(){J.prototype.i.call(this);this.Za&&(this.Za.removeEventListener("change",this.Eb),this.Za.u(),delete this.Za)};m.V=function(){return null};N.prototype.getCopyrights=N.prototype.V;
N.prototype.getCapabilities=function(){var a=0;this.kr()&&(a|=hh.PROVIDES_BY_VIEWPORT);this.providesRasters()&&(a|=hh.PROVIDES_RASTERS);this.providesSpatials()&&(a|=hh.PROVIDES_SPATIALS);this.providesOverlays()&&(a|=hh.PROVIDES_OVERLAYS);this.providesMarkers()&&(a|=hh.PROVIDES_MARKERS);this.providesDomMarkers()&&(a|=hh.PROVIDES_DOM_MARKERS);this.providesGeoJSON()&&(a|=hh.PROVIDES_GEOJSON);this.providesOMV()&&(a|=hh.PROVIDES_OMV);return a};N.prototype.getCapabilities=N.prototype.getCapabilities;
N.prototype.kr=We;N.prototype.nk=We;N.prototype.providesRasters=N.prototype.nk;N.prototype.ie=We;N.prototype.providesSpatials=N.prototype.ie;N.prototype.mr=We;N.prototype.providesOverlays=N.prototype.mr;N.prototype.Sc=We;N.prototype.providesMarkers=N.prototype.Sc;N.prototype.Rc=We;N.prototype.providesDomMarkers=N.prototype.Rc;N.prototype.lr=We;N.prototype.providesGeoJSON=N.prototype.lr;N.prototype.Tc=We;N.prototype.providesOMV=N.prototype.Tc;N.prototype.yz=function(){return this.vb};
N.prototype.getEngineType=N.prototype.yz;N.prototype.NC=function(a){this.vb=a};N.prototype.setEngineType=N.prototype.NC;N.prototype.lk=Xe;N.prototype.preprocessData=N.prototype.lk;N.prototype.Oc=1;N.prototype.zg=function(a){a=ec(a,0,1);E(a)&&(a=1);this.Oc!==a&&(this.Oc=a,this.gq&&qh(this),this.Eb(),this.kb())};N.prototype.$z=function(){return this.Oc};N.prototype.getOpacityInternal=N.prototype.$z;
N.prototype.Ya=function(a,b){var c=this;if(this.vb===ph.WEBGL&&!C(a,Zg)||this.vb===ph.HARP&&!C(a,H.map.render.harp.Style))throw a=Object.entries(ph).find(function(d){return d[1]===c.vb}),new D(this.Ya,0,"Invalid style for engineType "+a);this.Za&&(this.Za.removeEventListener("change",this.Eb),this.Za.removeEventListener(mg,this.Eb),this.Za.u());this.Za=a;this.Za.addEventListener("change",this.Eb);this.Za.addEventListener(mg,this.Eb);b||this.Eb();this.gq=!1};N.prototype.setStyleInternal=N.prototype.Ya;
N.prototype.nb=function(){this.Za||qh(this);return this.Za};N.prototype.getStyleInternal=N.prototype.nb;function qh(a){if(a.vb===ph.WEBGL){var b=new mh(a.getCapabilities(),a.uid,a.min,a.max,a.Oc,a.tileSize);a.Za=new Zg(b.Fe())}else a.vb===ph.HARP&&H.map.render.harp&&(a.Za=new H.map.render.harp.Style({}));a.gq=!0}
N.prototype.mu=function(){var a=this.getCapabilities(),b=og.FEATURE;a&hh.PROVIDES_BY_VIEWPORT?b=og.SOURCE:a&hh.PROVIDES_RASTERS?b=null:a&hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS&&(b=og.PROVIDER);return b};N.prototype.getPickingMode=N.prototype.mu;N.prototype.Dz=function(){return!1};N.prototype.getFeatureProxy=N.prototype.Dz;function rh(){}function sh(a){return Cb(1,Db(0,.5-Ib(Pb(Vb+Ub*a/180))/Tb/2))}rh.prototype.Km=function(a,b,c){c?(c.x=b/360+.5,c.y=sh(a)):c=new L(b/360+.5,sh(a));return c};rh.prototype.latLngToPoint=rh.prototype.Km;rh.prototype.Ne=function(a,b){return this.Km(a.lat,a.lng,b)};rh.prototype.geoToPoint=rh.prototype.Ne;function th(a){return 0>=a?90:1<=a?-90:Zb*(2*Qb(Lb(Tb*(1-2*a)))-Ub)}
rh.prototype.$a=function(a,b,c){c?(c.lat=th(b),c.lng=360*(1===a?1:cc(a,1))-180):c=new pc(th(b),360*(1===a?1:cc(a,1))-180);return c};rh.prototype.xyToGeo=rh.prototype.$a;rh.prototype.sn=function(a,b){return this.$a(a.x,a.y,b)};rh.prototype.pointToGeo=rh.prototype.sn;var uh=new rh;t("H.geo.mercator",uh);function vh(a,b){this.projection=a||uh;this.Ei=0;this.Zk=this.exp=Ib(b||256)/Sb;wh(this);this.y=this.x=0}t("H.geo.PixelProjection",vh);var xh=Hb(24)+Hb(-8);vh.prototype.zn=uh;vh.prototype.projection=vh.prototype.zn;vh.prototype.x=0;vh.prototype.x=vh.prototype.x;vh.prototype.y=0;vh.prototype.y=vh.prototype.y;vh.prototype.w=Kb(2,xh);vh.prototype.w=vh.prototype.w;vh.prototype.GA=Kb(2,xh);vh.prototype.h=vh.prototype.GA;
vh.prototype.Wa=function(a){if(E(a))throw new D(this.Wa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.Ei=a;this.Zk=this.exp+a;wh(this);this.x=b*this.w;this.y=c*this.h};vh.prototype.rescale=vh.prototype.Wa;function wh(a){a.Zk>xh&&(a.Zk=xh);a.w=Kb(2,a.Zk);a.h=Kb(2,a.Zk)}vh.prototype.su=function(){return this.Ei||0};vh.prototype.getZoomScale=vh.prototype.su;vh.prototype.Gb=function(a,b){a=this.projection.Km(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};
vh.prototype.geoToPixel=vh.prototype.Gb;vh.prototype.gk=function(a,b){return this.projection.$a((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};vh.prototype.pixelToGeo=vh.prototype.gk;vh.prototype.$a=function(a,b,c){return this.projection.$a((a+this.x)/this.w,(b+this.y)/this.h,c)};vh.prototype.xyToGeo=vh.prototype.$a;vh.prototype.rq=function(a,b,c){a=this.projection.Km(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};vh.prototype.latLngToPixel=vh.prototype.rq;
vh.prototype.Zh=function(a){return new L(a.x*this.w-this.x,a.y*this.h-this.y)};vh.prototype.pointToPixel=vh.prototype.Zh;function yh(a){a=a||{};yh.g.constructor.call(this);this.min=0;this.max=22;this.By=this.dark=!!a.dark;a.min&&this.Or(a.min);a.max&&this.Mr(a.max);this.pixelProjection=new vh(a.projection,a.minWorldSize);a.provider&&(this.D=a.provider,this.kb=A(this.kb,this),this.D.addEventListener(N.prototype.l.Aa,this.kb,!1,this),this.Eb=A(this.Eb,this),this.D.addEventListener(N.prototype.l.Hi,this.Eb,!1,this))}u(yh,J);t("H.map.layer.Layer",yh);yh.prototype.min=0;yh.prototype.min=yh.prototype.min;
yh.prototype.max=22;yh.prototype.max=yh.prototype.max;yh.prototype.l={Aa:"update",Hi:"configchange",Ms:"minchange",Ls:"maxchange"};yh.prototype.Lp=function(){return this.D};yh.prototype.getProvider=yh.prototype.Lp;yh.prototype.VA=function(a){return this.min<=a&&a<=this.max};yh.prototype.isValid=yh.prototype.VA;
function zh(a,b,c){var d=a[b],e="min"===b,f=e?a.Or:a.Mr;if(c!==d)if(e?c<=a.max:c>=a.min)a[b]=c,a.kb(),a.Eb(),a.dispatchEvent(new nh(e?a.l.Ms:a.l.Ls,c,d));else throw new D(f,0,"Invalid condition min <= max");return a}yh.prototype.Or=function(a){return zh(this,"min",+a)};yh.prototype.setMin=yh.prototype.Or;yh.prototype.Mr=function(a){return zh(this,"max",+a)};yh.prototype.setMax=yh.prototype.Mr;yh.prototype.kb=function(){this.dispatchEvent(this.l.Aa)};
yh.prototype.Eb=function(a){a=new nh(this.l.Hi,a&&a.newValue,a&&a.oldValue);this.dispatchEvent(a)};yh.prototype.i=function(){yh.g.i.call(this)};yh.prototype.V=function(){return null};yh.prototype.getCopyrights=yh.prototype.V;function Ah(a,b){b=b||{};if(!a)throw new D(Ah,0,a);this.tileSize=a.tileSize;this.kx={};yh.call(this,{min:void 0!==b.min?b.min:a.min,max:void 0!==b.max?b.max:a.max,minWorldSize:this.tileSize,projection:b.zn,dark:b.dark,provider:a})}u(Ah,yh);t("H.map.layer.BaseTileLayer",Ah);Ah.prototype.wj=function(a,b){var c=this.pixelProjection;if(!C(a,F))throw new D(this.wj,0,a);if(!E(b)){var d=c.su();c.Wa(b)}a=gg(c.Gb(a.Kc()),c.Gb(a.Gc()));!E(d)&&c.Wa(d);return a};Ah.prototype.geoRectToRect=Ah.prototype.wj;
Ah.prototype.Bh=function(a,b){var c=Kb(2,Fb(b)),d=this.tileSize;if(!C(a,fg))throw new D(this.Bh,0,a);if(E(b=+b))throw new D(this.Bh,1,b);b=Fb(a.left/d);b===c&&--b;var e=Fb(a.right/d);e===c&&--e;return new fg(b,ec(Fb(a.top/d),0,c-1),e,ec(Fb(a.bottom/d),0,c-1))};Ah.prototype.getTileBounds=Ah.prototype.Bh;Ah.prototype.Oa=function(a,b,c,d){return this.D.requestTile(a,b,c,d)};Ah.prototype.requestTile=Ah.prototype.Oa;Ah.prototype.Kd=function(a,b,c){this.D.cancelTile(a,b,c)};Ah.prototype.cancelTile=Ah.prototype.Kd;
Ah.prototype.V=function(a,b){return this.D.getCopyrights?this.D.getCopyrights(a,b):null};Ah.prototype.getCopyrights=Ah.prototype.V;function Bh(a,b,c,d,e){d=Fb(d);var f=Kb(2,d),g=b.left,h=b.top,k=b.right;c=k+(c?f+(k===b.left?0:1):1);var l=b.bottom,n=[];if(e){var p=g+(1+k-g)/2+e.x/a.tileSize-.5;var q=h+(1+l-h)/2+e.y/a.tileSize-.5}for(;g<c;){for(h=b.top;h<=l;)a=g%f,n.push([a,h,d,e?Hb(p-g)+Hb(q-h):0]),h++;g++}return n}
Ah.prototype.Gj=function(a,b,c,d,e,f){var g,h=[],k,l=this.D;f=null!=f?f:"__default__";var n=l.requestTile;if(!C(a,fg))throw new D(this.Gj,0,a);if(E(c=+c))throw new D(this.Gj,1,c);d||(g={});b=Bh(this,a,b,c,e);if(a=b.length)for(d||b.sort(Ch),c=a;c--;)e=b[c],d||(g[l.Sd.apply(l,e)]=!0),e[3]=+d,(k=n.apply(l,e))&&h.push(k);if(!d){d=g;var p;g=this.kx[f]||{};for(p in g)g.hasOwnProperty(p)&&g[p]&&!d[p]&&this.D.cancelTileByKey(p);this.kx[f]=d}return{total:a,tiles:h}};Ah.prototype.getProviderTiles=Ah.prototype.Gj;
function Ch(a,b){return b[3]-a[3]};function Dh(a,b){Dh.g.constructor.call(this,a,b)}u(Dh,Ah);t("H.map.layer.MarkerTileLayer",Dh);var Eh={markers:[],total:0,requested:0};function Fh(a,b,c,d,e){var f=Fb(c);a.pixelProjection.Wa(f);b=a.Bh(a.wj(b),f);c=a.Gj(b,b.left>b.right,~~c,d,e);a=c.tiles;c=c.total;d=a.length;e=[];var g;for(g=0;g<d;g++)for(b=a[g],f=b.data.length;f--;)e.push(b.data[f]);return{markers:e,total:a.length,requested:c}}Dh.prototype.le=function(a,b,c,d){return this.D.providesDomMarkers()?Eh:Fh(this,a,b,c,d)};
Dh.prototype.requestMarkers=Dh.prototype.le;Dh.prototype.ke=function(a,b,c,d){return this.D.providesDomMarkers()?Fh(this,a,b,c,d):Eh};Dh.prototype.requestDomMarkers=Dh.prototype.ke;t("H.util.events.listenOnce",re);t("H.util.events.dispatchEvent",function(a,b){return a.dispatchEvent(b)});t("H.util.events.fireListeners",function(a,b,c,d){if(me(a))c=a.Ef(b,c,d);else{var e=!0;if(a=ue(a))if(b=a.qb[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.fi&&(f=Ae(f,d),e=e&&!1!==f)}c=e}return c});t("H.util.events.listen",qe);t("H.util.events.unlisten",ye);var Gh=Ae;
Ae=function(a,b){var c,d,e=!0;var f=b[b.currentTarget===b.target?"AT_TARGET":a.capture?"CAPTURING_PHASE":(c=!0,"BUBBLING_PHASE")];if(!c||"pointerenter"!==(d=b.type)&&"pointerleave"!==d)b.eventPhase=f,e=Gh(a,b),c&&a.src&&a.src.Jc&&null===a.src.Jc()&&delete b.eventPhase;return e};function Hh(){}t("H.map.provider.Invalidations",Hh);Hh.MARK_INITIAL=ac;Hh.prototype.update=function(a,b){b!==Ih.NONE&&(this.Jd=a,b&Ih.SPATIAL&&(this.Xw=a),b&Ih.VISUAL&&(this.xx=a),b&Ih.ADD&&(this.Ws=a),b&Ih.REMOVE&&(this.sw=a),b&Ih.Z_ORDER&&(this.Bx=a),b&Ih.VOLATILITY&&(this.yx=a))};Hh.prototype.update=Hh.prototype.update;Hh.prototype.Wz=function(){return this.Jd};Hh.prototype.getMark=Hh.prototype.Wz;Hh.prototype.Jd=ac;Hh.prototype.RA=function(a){return this.Jd>a};Hh.prototype.isAny=Hh.prototype.RA;
Hh.prototype.xx=ac;Hh.prototype.Gh=function(a){return this.xx>a};Hh.prototype.isVisual=Hh.prototype.Gh;Hh.prototype.Xw=ac;Hh.prototype.nq=function(a){return this.Xw>a};Hh.prototype.isSpatial=Hh.prototype.nq;Hh.prototype.Ws=ac;Hh.prototype.Ku=function(a){return this.Ws>a};Hh.prototype.isAdd=Hh.prototype.Ku;Hh.prototype.sw=ac;Hh.prototype.Dm=function(a){return this.sw>a};Hh.prototype.isRemove=Hh.prototype.Dm;Hh.prototype.Bx=ac;Hh.prototype.pq=function(a){return this.Bx>a};Hh.prototype.isZOrder=Hh.prototype.pq;
Hh.prototype.yx=ac;Hh.prototype.WA=function(a){return this.yx>a};Hh.prototype.isVolatility=Hh.prototype.WA;var Ih={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};Hh.Flag=Ih;function Jh(a,b){this.w=+a;this.h=+b}t("H.math.Size",Jh);function Kh(a,b,c,d,e){b&&(this.bf=b);db(c)&&(this.Co=!!c);this.Co&&d&&(this.Do=new Jh(d.w,d.h));db(e)&&(this.wk={crossOrigin:e});switch(Lh[hb(a)]){case 2:this.hb=a;Mh(this,1);break;case 1:if(cf(a)){this.hb=a;Nh(this);Mh(this,1);break}a=a.src;case 0:if(a){a=Re(a);this.vm=new Tg("image",a,B,this.wk);this.vm.then(A(this.NB,this),A(this.MB,this));break}default:throw Mh(this,-1),new D(Kh,0,"No image data");}}Kh.prototype.o=0;Kh.prototype.getState=function(){return this.o};
function Mh(a,b){a.o=b;delete a.vm;a.bf&&a.bf(b,a)}Kh.prototype.Co=!0;function Nh(a){if(a.Co){var b=a.hb,c=Oh(a),d=c&&c.w||+b.width,e=c&&c.h||+b.height,f=Ie();if(C(b,x.HTMLCanvasElement))c=b;else{c=b.ownerDocument.createElement("canvas");c.width=Gb(d*f);c.height=Gb(e*f);var g=c.getContext("2d");g.scale(f,f);g.drawImage(b,0,0,d,e);La&&(g.clearRect(0,0,d,e),g.drawImage(b,0,0,d,e))}a.hb=c}}Kh.prototype.getData=function(){return this.hb||z};var Lh={String:0,HTMLImageElement:1,HTMLCanvasElement:2};m=Kh.prototype;
m.Do=z;m.lc=function(){return 1===this.o?Oh(this):z};function Oh(a){var b=a.Do,c;if(!b){var d=a.hb;b=d.naturalWidth||d.width;if(0===b&&Pe&&1===Lh[hb(d)]){var e=!0;if(c=d.parentNode)var f=d.nextSibling;document.body.appendChild(d)}a.Do=b=new Jh(d.naturalWidth||d.width,d.naturalHeight||d.height);e&&(c?c.insertBefore(d,f):document.body.removeChild(d))}return b}m.NB=function(a){this.hb=a;Nh(this);Mh(this,1)};m.MB=function(){Mh(this,-1)};m.cancel=function(){this.vm&&this.vm.cancel()};function Ph(a,b){var c;var d=a;var e=b||[];if(a!==Qh.NONE){b=c=e.length;if(-1===Rh.indexOf(d))throw new D(Ph,0,a);if(!e)throw new D(Ph,1,e);for(;c--;)if(E(e[c]))throw new D(Ph,1,e);d===Qh.RECT&&3<b&&(e=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]],d=Qh.POLYGON);if(d===Qh.CIRCLE&&2<b&&(a=e[2],0<a)){d=e[0];var f=e[1];c=Cb(2*Gb(a),40);var g=360/c;for(e=[];c--;){var h=g*c*Yb;e.push(d+Mb(h)*a,f+Ob(h)*a)}d=Qh.POLYGON}if(d!==Qh.POLYGON||!b||e.length%2)throw new D(Ph,1,e);this.aw=e}}t("H.map.HitArea",Ph);
var Qh={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Ph.ShapeType=Qh;var Rh=[Qh.RECT,Qh.CIRCLE,Qh.POLYGON];Ph.prototype.um=function(a,b,c){return this.aw?hc(a,b,this.aw,c,!0):gc.NONE};Ph.prototype.hitTest=Ph.prototype.um;function Sh(a,b){var c,d="anonymous";this.uid=Th.next();Sh.g.constructor.call(this);if(b){var e="size";if(e in b){var f=b[e];if(!f||isNaN(f.w)||isNaN(f.h))throw new D(Sh,1,e);this.Zn=new Jh(f.w,f.h)}e="anchor";if(e in b){f=b[e];if(!f||isNaN(f.x)||isNaN(f.y))throw new D(Sh,1,e);this.Cb=new L(f.x,f.y)}e="hitArea";e in b&&(f=b[e],C(f,Ph,Sh,1),this.tm=b[e]);e="asCanvas";e in b&&(c=b[e]);e="crossOrigin";e in b&&(d=b[e]);f=b.stickHeight;f===+f&&0<f&&(this.aD=f);e="stickColor";f=b[e];e in b&&jb(f)&&(this.$C=
f)}a=new Kh(a,A(this.Sg,this),c,this.Zn,d);b=this.o=a.getState();0!==b?this.Sg(b,a):this.ul=a}u(Sh,J);t("H.map.Icon",Sh);var Th=new Se;Sh.State={ERROR:-1,LOADING:0,READY:1};Sh.prototype.getState=function(){return this.o};Sh.prototype.getState=Sh.prototype.getState;Sh.prototype.Sg=function(a,b){this.hb=b.getData();if(1===a){var c=this.Zn;c||(c=this.Zn=b.lc());this.Cb||(this.Cb=new L(c.w/2|0,c.h))}this.ul&&(this.o=a,delete this.ul,this.dispatchEvent("statechange"))};Sh.prototype.hb=z;
Sh.prototype.Oe=function(){return this.hb};Sh.prototype.getBitmap=Sh.prototype.Oe;Sh.prototype.lc=function(){return this.Zn||z};Sh.prototype.getSize=Sh.prototype.lc;Sh.prototype.Cb=z;Sh.prototype.tp=function(){return this.Cb};Sh.prototype.getAnchor=Sh.prototype.tp;Sh.prototype.tm=z;Sh.prototype.Iz=function(){return this.tm};Sh.prototype.getHitArea=Sh.prototype.Iz;Sh.prototype.i=function(){Sh.g.i.call(this);this.hb?(this.hb.removeAttribute("src"),delete this.hb):(this.ul.cancel(),delete this.ul)};function Uh(a){Uh.g.constructor.call(this);void 0!==a&&(this.data=a)}u(Uh,J);t("H.map.Feature",Uh);Uh.prototype.getData=function(){return this.data};Uh.prototype.getData=Uh.prototype.getData;Uh.prototype.i=function(){Uh.g.i.call(this);delete this.data};function O(a){eb(this,O);O.g.constructor.call(this,a?a.data:B);this.Jj=Vh.next();if(a){var b="min";ob(a[b])&&(this.zb=a[b]);b="max";ob(a[b])&&(this.Nc=a[b]);b="visibility";b in a&&(this.Id=!!a[b]);b="volatility";b in a&&(this.fo=!!a[b]);b="zIndex";b in a&&(this.Di=+a[b]||0);b="provider";b in a&&!C(a[b],P)&&(this.D=a[b],this.sa(Ih.ADD))}}u(O,Uh);t("H.map.Object",O);var Vh=new Se(1),Wh={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};O.Type=Wh;O.prototype.xb=function(){return this.Jj};
O.prototype.getId=O.prototype.xb;O.prototype.Ur=function(a){if(!ob(a)&&!jb(a))throw new D(this.Ur,0,"id must be a number or a string");this.di=a;return this};O.prototype.setRemoteId=O.prototype.Ur;O.prototype.mA=function(){return this.di};O.prototype.getRemoteId=O.prototype.mA;O.prototype.zb=-1/0;O.prototype.Nc=1/0;O.prototype.gu=function(a){var b=this.Nc;if(a)for(a=this;a=a.Ma;)b=Cb(b,a.Nc);return b};O.prototype.getMax=O.prototype.gu;
O.prototype.iu=function(a){var b=this.zb;if(a)for(a=this;a=a.Ma;)b=Db(b,a.zb);return b};O.prototype.getMin=O.prototype.iu;O.prototype.Id=!0;O.prototype.Zb=function(a){var b=this.Id;(a=!!a)!==b&&(this.Id=a,this.invalidate(Ih.VISUAL));return this};O.prototype.setVisibility=O.prototype.Zb;O.prototype.Td=function(a){for(var b=this,c;(c=b.Id)&&a&&(b=b.Ma););return c};O.prototype.getVisibility=O.prototype.Td;O.prototype.fo=!1;O.prototype.lm=function(a){for(var b=this,c;!(c=b.fo)&&a&&(b=b.Ma););return c};
O.prototype.getVolatility=O.prototype.lm;O.prototype.Rw=function(a){var b=this.fo;b!==!!a&&(this.fo=!b,this.invalidate(Ih.VOLATILITY));return this};O.prototype.setVolatility=O.prototype.Rw;O.prototype.Di=B;O.prototype.ru=function(){return this.Di};O.prototype.getZIndex=O.prototype.ru;O.prototype.pi=function(a){a!==this.Di&&(this.xk(),this.Di=a,this.invalidate(Ih.Z_ORDER));return this};O.prototype.setZIndex=O.prototype.pi;O.prototype.lo=B;
O.prototype.Re=function(){var a=this.lo,b,c;if(!a){var d=+((b=this.Di)!==B);(a=this.Ma)?(a=a.Re().slice(),a[0]|=d):a=[d];a.push(b||0,0>(c=this.Yr)?this.Jj:c);this.lo=a}return a};O.prototype.getZInfo=O.prototype.Re;O.prototype.xk=function(){this.lo=B};function Xh(a,b,c){var d,e;if(!c||a[0]|b[0]){var f=a.length;var g=b.length;var h=Cb(f,g);var k=1;for(e=1+ +c;k<h;k+=e)if(d=a[k]-b[k])return d}return c?0:f-g}O.compareZInfo=Xh;function Yh(a,b){return a.mt(b)}O.compareZOrder=Yh;
O.prototype.mt=function(a){return this.mo-a.mo||Xh(this.Re(),a.Re(),!1)};O.prototype.compareZOrder=O.prototype.mt;m=O.prototype;m.previousSibling=z;m.nextSibling=z;m.Yr=-1;m.Ma=z;m.aA=function(){return this.Ma};O.prototype.getParentGroup=O.prototype.aA;O.prototype.pd=function(){for(var a=this,b;b=a.Ma;)a=b;return a};O.prototype.getRootGroup=O.prototype.pd;O.prototype.contains=function(a){return this===a};O.prototype.contains=O.prototype.contains;
O.prototype.fa=function(a){if(this.Ma)throw new Ab(this.fa,"Not allowed for a child of a group");O.g.fa.call(this,a)};O.prototype.setParentEventTarget=O.prototype.fa;O.prototype.draggable=O.prototype.draggable=!1;O.prototype.D=z;O.prototype.Lp=function(){return this.D};O.prototype.getProvider=O.prototype.Lp;
O.prototype.oi=function(a,b){var c=this.D,d;if(d=c!==a){if(b&&(c&&!C(c,P)||a&&!C(a,P)))throw new Ab(b,"Only LocalObjectProvider allows an object transfers");b=this.type!==Wh.GROUP;c&&(this.invalidate(Ih.REMOVE),b&&c.Na(this));if(this.D=a)b&&a.$(this),this.Qf=z,this.invalidate(Ih.ADD)}return d};O.prototype.Qf=z;O.prototype.Hc=function(){return this.Qf||(this.Qf=new Hh)};O.prototype.getInvalidations=O.prototype.Hc;O.prototype.sa=function(a){var b=this.D,c;(c=!!b)&&b.invalidateObject(this,a);return c};
O.prototype.invalidate=O.prototype.sa;O.prototype.i=function(){this.Ma&&this.Ma.Na(this);O.g.i.call(this)};O.prototype.setData=function(a){this.data=a;return this};O.prototype.setData=O.prototype.setData;O.prototype.ue=function(a){if(a&&!ab(a))throw new D(O.prototype.ue,0,"opt_callback must be a function");a=Zh(this,a?a(this.data):this.data,!!a);a=ab(this.W)?{type:"Feature",properties:a,geometry:this.W().ue()}:{type:"FeatureCollection",features:Ye};this.di&&(a.id=this.di);return a};
O.prototype.toGeoJSON=O.prototype.ue;function Zh(a,b,c){if(null===b||b===B)return null;if(0<=Object.keys(b).length&&"[object Object]"!==Object.prototype.toString.call(b))throw Error($h(a,c));try{return JSON.stringify(b),b}catch(d){throw Error($h(a,c));}}
function $h(a,b){return"Object Remote-Id: "+a.di+" - "+(b?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}O.prototype.R=function(){return{id:this.Jj,properties:{min:this.iu(),max:this.gu(),zIdx:this.Di,sIdx:this.Yr,parent:this.Ma?this.Ma.xb():0,visible:this.Td(),"volatile":this.lm()},type:"Feature"}};O.prototype.forWorkerMessage=O.prototype.R;function ai(a,b){var c;eb(this,ai);ai.g.constructor.call(this,b);this.Y(a);b&&"icon"in b&&(c=b.icon);this.re(c||this.zp())}u(ai,O);t("H.map.AbstractMarker",ai);ai.prototype.W=function(){return this.$l};ai.prototype.getGeometry=ai.prototype.W;ai.prototype.Y=function(a){var b=this.$l;C(a,pc)||C(a,Lf)?this.$l=a:(qc(a,this.Y,0),this.$l=sc(a));b&&this.sa(Ih.SPATIAL);return this};ai.prototype.setGeometry=ai.prototype.Y;ai.prototype.C=function(){return this.$l.C()};ai.prototype.kc=function(){return this.icon};
ai.prototype.getIcon=ai.prototype.kc;ai.prototype.re=function(a){var b=this.icon,c=!b;if(b!==a){if(!this.Ru(a)){if(c)throw new D(this.constructor,1,a);throw new D(this.re,0,a);}this.icon=a;c||this.sa(Ih.VISUAL)}return this};ai.prototype.setIcon=ai.prototype.re;ai.prototype.zp=function(){var a=this.Dy;a||(a=this.constructor.prototype.Dy=this.pt(bi));return a};
var bi={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Jh(38,
47),anchor:new L(19,45),hitArea:new Ph(Qh.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};ai.prototype.R=function(){var a=ai.g.R.call(this),b=this.kc(),c=b.lc(),d=b.Cb;a.geometry=this.W().R();c&&(b=a.properties.icon={id:b.uid},b.size={w:c.w,h:c.h},b.offset=[c.w/2-(d?d.x:0),c.h/2-(d?d.y:0)]);return a};ai.prototype.forWorkerMessage=ai.prototype.R;function ci(a,b){ci.g.constructor.call(this,a,b)}u(ci,ai);t("H.map.Marker",ci);ci.prototype.type=Wh.MARKER;ci.prototype.mo=1;ci.prototype.sa=function(a){if(a!==Ih.VISUAL||1===this.ew||1===this.icon.getState())var b=ci.g.sa.call(this,a);return b||!1};ci.prototype.invalidate=ci.prototype.sa;m=ci.prototype;m.ew=0;m.Ru=function(a){return C(a,Sh)};m.lq=!1;m.Fv=function(){this.sa(Ih.VISUAL)};
m.re=function(a){var b=this.icon;this.lq&&(b.removeEventListener("statechange",this.Fv,!1,this),delete this.lq);b&&(this.ew=b.getState());ci.g.re.call(this,a);0===a.getState()&&(this.lq=!0,re(a,"statechange",this.Fv,!1,this));return this};ci.prototype.setIcon=ci.prototype.re;ci.prototype.pt=function(a){return new Sh(a.svg,a)};ci.prototype.R=function(){var a=this.getIcon(),b=a.aD||0,c=ci.g.forWorkerMessage.call(this),d=c.properties.icon;d&&0<b&&Ta(d,{stick_color:a.$C,stick_height:b});return c};
ci.prototype.forWorkerMessage=ci.prototype.R;function di(a){var b;if(a){var c=ei;for(b=C(a,di);c--;){var d=fi[c];if(a.hasOwnProperty(d)){var e=a[d];if(b)this[d]=e;else{if((e=gi[c](e))===hi)throw new D(di,0,d+": "+a[d]);e!==this[d]&&e!==B&&(this[d]=e)}}}c=b?a.Pj:this.lineWidth&&Oe(this.strokeColor);c||(this.Pj=c);c=b?a.Mc:Oe(this.fillColor);c||(this.Mc=c);c=b?a.Nj:"none"!==this.strokeColor&&this.lineWidth;c||(this.Nj=c)}Ya(this)}t("H.map.SpatialStyle",di);di.prototype.Mc=!0;di.prototype.Pj=!0;di.prototype.Nj=!0;var fi="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineDashImage lineHeadCap lineTailCap".split(" ");
di.prototype.strokeColor="rgba(0,85,170,.6)";di.prototype.strokeColor=di.prototype.strokeColor;di.prototype.fillColor="rgba(0,85,170,.4)";di.prototype.fillColor=di.prototype.fillColor;di.prototype.lineWidth=2;di.prototype.lineWidth=di.prototype.lineWidth;di.prototype.lineCap="round";di.prototype.lineCap=di.prototype.lineCap;di.prototype.lineJoin="miter";di.prototype.lineJoin=di.prototype.lineJoin;di.prototype.miterLimit=1;di.prototype.miterLimit=di.prototype.miterLimit;di.prototype.fB=Ye;
di.prototype.lineDash=di.prototype.fB;di.prototype.lineDashOffset=0;di.prototype.lineDashOffset=di.prototype.lineDashOffset;di.prototype.gB=B;di.prototype.lineDashImage=di.prototype.gB;di.prototype.hB=B;di.prototype.lineHeadCap=di.prototype.hB;di.prototype.iB=B;di.prototype.lineTailCap=di.prototype.iB;var ei=fi.length;di.prototype.ea=function(a){var b=this===a;if(!b&&a){for(b=0;b<ei;b++){var c=fi[b];if(this[c]!==a[c])break}b=b===ei}return b};di.prototype.equals=di.prototype.ea;
di.prototype.bu=function(a){if(a){var b={};Ta(b,this,a)}else b=this;return new di(b)};di.prototype.getCopy=di.prototype.bu;
var hi=Ya({}),gi=[function(a){return a?Xa(a):hi},function(a){return a?Xa(a):hi},function(a){return 0<=a&&100>=a?+a:hi},function(a){a=Xa(a);return"butt"===a||"square"===a||"round"===a||"arrow-head"===a||"arrow-tail"===a?a:hi},function(a){return"round"===a||"bevel"===a||"miter"===a?a:hi},function(a){return 0<a&&100>=a?+a:hi},function(a){return a&&a.every&&a.every(pb)?a:hi},function(a){return E(+a)?hi:+a},function(a){return a===B||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||Object.values(ii).includes(a)?
a:hi},function(a){return db(a)?gi[3](a):B},function(a){return db(a)?gi[3](a):B}],ji=new Image;ji.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g id="arrow"><path style="fill:#ff0000" d="M 0,0 32,64 2,128 128,64 Z"/></g></svg> ');var ki=new Image;ki.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><circle style="fill:#ffffff" cx="64" cy="64" r="64" /></svg>');
var ii={ARROW:ji,CIRCLE:ki};di.DashImage=ii;di.MAX_LINE_WIDTH=100;var li=new di;di.DEFAULT_STYLE=li;var mi="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");di.prototype.R=function(){for(var a={},b=mi.length,c;b--;)c=mi[b],a[c]=this[c];return a};di.prototype.forWorkerMessage=di.prototype.R;function ni(a,b,c){this.paths=this.Pc=a;b!==B&&(this.interiorsIndex=this.Mj=b);c!==B&&(this.outlinesIndex=this.on=c)}ni.prototype.Mj=$b;ni.prototype.interiorsIndex=ni.prototype.Mj;ni.prototype.on=$b;ni.prototype.outlinesIndex=ni.prototype.on;var oi=Za(new ni([])),pi=Ya([]);function qi(a){var b;if(a){var c=C(a,qi);for(b in a)if(b in this){var d=a[b];d!==this[b]&&("fillColor"===b||0<(d=+d))&&(this[b]=d)}a=c?a.Mc:!!(Oe(this.fillColor)&&this.width&&this.width);a||(this.Mc=a)}Ya(this)}t("H.map.ArrowStyle",qi);qi.prototype.Mc=!0;qi.prototype.fillColor="rgba(255,255,255,.75)";qi.prototype.width=1.2;qi.prototype.length=1.6;qi.prototype.frequency=5;qi.prototype.au=function(){return new qi(this)};
qi.prototype.ea=function(a){var b=this===a;!b&&a&&(b=a.width===this.width&&a.fillColor===this.fillColor&&a.length===this.length&&a.frequency===this.frequency);return b};qi.prototype.equals=qi.prototype.ea;function ri(a,b){var c;ri.g.constructor.call(this,b);b&&this.Bb(b.style);a&&(this.Se=!0);b&&(c=b.arrows)&&this.Iw(c)}u(ri,O);t("H.map.Spatial",ri);ri.prototype.type=Wh.SPATIAL;ri.prototype.mo=0;ri.prototype.style=li;ri.prototype.L=function(){return this.style};ri.prototype.getStyle=ri.prototype.L;ri.prototype.Bb=function(a){var b=!0;a?this.style=C(a,di)?a:new di(a):this.style?delete this.style:b=!1;b&&this.invalidate(Ih.VISUAL);return this};ri.prototype.setStyle=ri.prototype.Bb;
ri.prototype.gz=function(){return this.Og};ri.prototype.getArrows=ri.prototype.gz;ri.prototype.Iw=function(a){var b=this.Og,c=!1;!a&&b?(delete this.Og,c=!0):!a||b&&b.ea(a)||(this.Og=new qi(a),c=!0);c&&"none"!==this.style.strokeColor&&this.sa(1);return this};ri.prototype.setArrows=ri.prototype.Iw;function si(a,b){var c=!1,d=!1,e;if(b.length){for(c=0;c<b.length;c++)if(b[c]!==oi){d=!0;break}b=a.style;c=d?b.Pj||b.Mc&&a.Se||(e=a.Og||!1)&&b.Nj&&e.Mc:b.Mc}return c&&a.Td(!0)}ri.prototype.Se=!1;
ri.prototype.SA=function(){return this.Se};ri.prototype.isClosed=ri.prototype.SA;ri.prototype.getGeometriesForTile=ri.prototype.sh;ri.prototype.Dp=function(){return B};ri.prototype.getLabels=ri.prototype.Dp;function ti(a,b){ti.g.constructor.call(this,a,b)}u(ti,ri);t("H.map.GeoShape",ti);ti.prototype.getBoundingBox=ti.prototype.C;function ui(a,b,c,d){var e=[],f=b.length,g;for(g=0;g<f;g++){var h=b[g];if(h.length){var k=e,l=k.push,n=void 0,p=a,q=c,r=d,v=[],w=h.length,y=0;p.Bt=0;for(n=n||0;y<w;)v.push(vi(p,h[y++],h[y++],n,r));q&&v.push(vi(p,h[0],h[1],n,r));l.call(k,v)}}return e}function vi(a,b,c,d,e){var f=a.Bt;f&&180<Hb(f-c)&&(c+=0>f?-360:360);a.Bt=c;return e.rq(b,c+d)}
function wi(a,b,c){for(var d=b,e,f=a.length+b,g,h;d--;){b=a[d];g=b.length;for(e=Array(g);g--;)h=b[g],e[g]=new L(h.x+c,h.y);a[--f]=e}};function xi(a,b){xi.g.constructor.call(this,!1,b);this.Y(a)}u(xi,ti);t("H.map.Polyline",xi);xi.prototype.C=function(){return this.Hb.C()};xi.prototype.getBoundingBox=xi.prototype.C;xi.prototype.Y=function(a){var b=this.Y,c,d;if(C(a,Mf)){var e=a.ia;if(c=e.length)for(d=0;d<c;d++)yi(e[d],b);else throw new D(b,0);}else yi(a,b);this.Of=!!e;this.Hb=a;this.sa(Ih.SPATIAL);return this};xi.prototype.setGeometry=xi.prototype.Y;xi.prototype.W=function(){return this.Hb};xi.prototype.getGeometry=xi.prototype.W;
xi.prototype.clip=function(a){var b=this.Hb;return mf(this.Of?b.ia[0]:b,a)};xi.prototype.clip=xi.prototype.clip;xi.prototype.sh=function(a){var b=this.Hb;var c,d=[];if(this.Of)for(b=b.ia,c=b.length;c--;)zi(this,b[c],a,d);else zi(this,b,a,d);return d.length?d:B};xi.prototype.getGeometriesForTile=xi.prototype.sh;function yi(a,b){if(!C(a,K)||2>a.Ej())throw new D(b,0);}
function zi(a,b,c,d){var e=mf(b,c.gm());if(e.length&&(b=c.im(),a=ui(a,e,!1,b),e=a.length)){var f=c.Hj();b=b.w;c.x||wi(a,e,-b);c.x===(1<<c.z)-1&&wi(a,e,b);c=pf(a,f.left,f.top,f.right,f.bottom,!1);c.length&&d.push(new ni(c))}}xi.prototype.R=function(){var a=xi.g.R.call(this),b=a.properties;a.geometry=this.W().R();b.style=this.L().R();b.height=0;return a};xi.prototype.forWorkerMessage=xi.prototype.R;function Ai(a,b,c){var d="anonymous",e=1;this.Sg=A(this.Sg,this);O.call(this,c);this.Y(a);c&&(a="crossOrigin",a in c&&(d=c[a]),a="opacity",a in c&&(e=c[a]));this.Kw(b,d);this.Cd(e)}u(Ai,O);t("H.map.Overlay",Ai);Ai.prototype.type=Wh.OVERLAY;Ai.prototype.C=function(){return this.I};Ai.prototype.getBoundingBox=Ai.prototype.C;Ai.prototype.ni=function(a){C(a,F,this.ni,0,a);return this.Y(a)};Ai.prototype.setBoundingBox=Ai.prototype.ni;Ai.prototype.W=function(){return this.I};
Ai.prototype.getGeometry=Ai.prototype.W;Ai.prototype.Y=function(a){var b=this.I,c=!b;C(a,F,this.Y,0,a);if(c||!b.ea(a))this.I=a,c||this.sa(Ih.SPATIAL);return this};Ai.prototype.setGeometry=Ai.prototype.Y;Ai.prototype.Oe=function(){return this.hb.getData()};Ai.prototype.getBitmap=Ai.prototype.Oe;Ai.prototype.Kw=function(a,b){var c=this.hb;c&&1!==c.getState()&&c.cancel();this.hb=new Kh(a,this.Sg,!0,B,b);return this};Ai.prototype.setBitmap=Ai.prototype.Kw;
Ai.prototype.Sg=function(a,b){this.hb=b;1===a&&this.sa(Ih.VISUAL)};Ai.prototype.Qe=function(){return this.Oc};Ai.prototype.getOpacity=Ai.prototype.Qe;Ai.prototype.Cd=function(a){var b=this.Oc,c=2>b;a-=0;if(0<=a&&1>=a)a!==b&&(this.Oc=a,c&&this.sa(Ih.VISUAL));else throw new D(this.Cd,0);return this};Ai.prototype.setOpacity=Ai.prototype.Cd;Ai.prototype.R=function(){var a=Ai.g.R.call(this);a.geometry=Bf(this.I).R();a.properties.overlay=!0;return a};Ai.prototype.forWorkerMessage=Ai.prototype.R;function Bi(a,b){var c=b&&(+b.extrusion||+b.extrude)||0,d=b&&+b.elevation||0,e=0;Bi.g.constructor.call(this,!0,b);0<d&&(e+=d,this.Cf=d);0<c&&(e+=c,this.jh=c);if(2047<e)throw new Ge(Bi,e,[0,2047]);C(a,K)?this.Y(new M(a)):this.Y(a)}u(Bi,ti);t("H.map.Polygon",Bi);var Ci=new M(new K([0,0,0,0,0,0,0,0,0]));Bi.prototype.jh=0;Bi.prototype.Cf=0;Bi.prototype.Hb=Ci;Bi.MAX_EXTRUDE_HEIGHT=2047;
Bi.prototype.Kr=function(a){var b=+a;if(b!==a)throw new D(this.Kr,0,a);if(0>b||2047<this.Cf+b)throw new Ge(this.Kr,this.Cf+b,[0,2047]);this.jh=b;this.sa(Ih.SPATIAL)};Bi.prototype.setExtrusion=Bi.prototype.Kr;Bi.prototype.Bz=function(){return this.jh};Bi.prototype.getExtrusion=Bi.prototype.Bz;Bi.prototype.Jr=function(a){var b=+a;if(b!==a)throw new D(this.Jr,0,a);if(0>b||2047<this.jh+b)throw new Ge(this.Jr,this.jh+b,[0,2047]);this.Cf=b;this.sa(Ih.SPATIAL)};Bi.prototype.setElevation=Bi.prototype.Jr;
Bi.prototype.wz=function(){return this.Cf};Bi.prototype.getElevation=Bi.prototype.wz;Bi.prototype.W=function(){return this.Hb};Bi.prototype.getGeometry=Bi.prototype.W;Bi.prototype.Y=function(a){if(C(a,M))var b=!1;else C(a,Kf,this.Y,0),b=!0;this.Of=b;b=this.Hb;this.Hb=a;b!==Ci&&this.sa(Ih.SPATIAL);return this};Bi.prototype.setGeometry=Bi.prototype.Y;Bi.prototype.C=function(){return this.W().C()};Bi.prototype.getBoundingBox=Bi.prototype.C;
Bi.prototype.sh=function(a){var b,c=this.W(),d,e;if(this.Of){c=c.ia;var f=0;for(e=c.length;f<e;f++)if(d=Di(this,c[f],a,c[f].ef))b||(b=[]),b.push(d)}else d=this.ef,d===B&&(d=this.Of?Cf.NORTH:this.W().ef),(d=Di(this,c,a,d))&&(b=[d]);return b};Bi.prototype.getGeometriesForTile=Bi.prototype.sh;
function Di(a,b,c,d){var e,f,g=0,h=!0;if(e=Ei(a,b.Fb,c,d,b.C())){var k=new ni(e);var l=b.eb;if(f=l.length)for(k.Mj=k.Pc.length;g<f;g++)if(e=Ei(a,l[g],c,d,b.$t(g)))k.Pc=k.Pc.concat(e);f=k.Pc.length;for(g=0;g<f;g++)if(k.Pc[g]!==pi){h=!1;break}h&&(k=g%2?oi:B)}return k}
function Ei(a,b,c,d,e){var f=c.Hj(),g=e,h=g.nc();var k=[[]];var l=b.T;var n=[],p=l.length,q,r=!1;for(q=0;q<p;q+=3){var v=l[q];var w=l[q+1];r||180!=Hb(w)||(n.push(v),n.push(w),n.push(v),n.push(-w),r=!0);n.push(v);n.push(w)}l=n;360>h&&-180==g.X&&(g=new F(g.ga,180,g.ha,g.da));360>h&&180==g.da&&(g=new F(g.ga,g.X,g.ha,-180));if(g.oc()){h=l;v=h.length;l=-1;for(n=0;n<v-2;n+=2)if(nc(h[n+1],h[n+3])){l=n+2;break}-1===l&&nc(h[v-1],h[1])&&(l=v);-1!==l&&(p=h[l-2],n=h[l-1],q=h[l%v],r=h[(l+1)%v],180!==Hb(p)&&180!==
Hb(q)&&(w=Hb(q-p),v=Hb(r-n),v+=180<v?-360:0,r=Hb(180-r),r+=180<r?-360:0,v&&r&&(w/=Hb(v)/Hb(r),p=q+(q>p?-w:w),n=0<n?180:-180,h.splice(l,0,p,n,p,-n))));l=h}k[0]=Fi([].concat(l),g.X);360>g.nc()&&g.zf(new pc(g.ga,180))&&(l=Fi([].concat(l),g.da),k.push(l));g=c.im();a=ui(a,k,!0,g);if(360===e.nc()&&1===b.yp(!0)%2){b=a;a=c.Hj();b[0][1].x>b[0][b[0].length-1].x&&(b[0]=b[0].reverse());l=[];h=b[0].length-1;for(k=0;k<h;k++)n=b[0][k],l[k]=new L(n.x-2*g.w,n.y),l[k+h]=new L(n.x-g.w,n.y),l[k+2*h]=new L(n.x,n.y),l[k+
3*h]=new L(n.x+g.w,n.y),l[k+4*h]=new L(n.x+2*g.w,n.y);b[0]=l;k=g.rq(d,0);k.y=2*a[d===Cf.NORTH?"top":"bottom"];d=k.clone();k.x=b[0][b[0].length-1].x+1;d.x=b[0][0].x-1;b[0].push(k,d);a=b}d=f.left;b=f.top;k=f.right;f=f.bottom;if(pf(a,d,b,k,f,!0).length){if(!c.gm().Qo(e)){c=a;e=[new L(d,b),new L(k,b),new L(k,f),new L(d,f)];f=[];for(a=c.length;a--;)if(d=rf(e,c[a]))for(b=Gi(d),f.push(b);d.Iq;)d=d.Iq,b=Gi(d),f.push(b);a=f}}else c=Hi(d,b,a[0]),a[1]&&(c=c!==Hi(d,b,a[1])),a=c?[pi]:B;return a}
function Hi(a,b,c){var d,e,f;var g=d=c[0].x;var h=e=c[0].y;var k=1;for(f=c.length;k<f;k++){var l=c[k].x;var n=c[k].y;l>d?d=l:l<g&&(g=l);n>e?e=n:n<h&&(h=n)}return g<=a&&a<=d&&h<=b&&b<=e&&ic({x:a,y:b},jc(c.concat(c[0])))}function Gi(a){var b=[],c=a;do{var d=Eb(100*(c.aC?c.aC:c.x))/100;var e=Eb(100*(c.bC?c.bC:c.y))/100;if(!f||.01<Jb(Kb(f.x-d,2)+Kb(f.y-e,2))){var f=new L(d,e);b.push(f)}c=c.next}while(c&&c!==a);return b}Bi.prototype.Oi=z;
function Fi(a,b){var c,d=Number.POSITIVE_INFINITY,e=-1,f=a.length;for(c=0;c<f;c+=2){var g=Hb(a[c+1]-b);g+=180<g?360-g:g;g<d&&(d=g,e=c)}return 0<c?(b=a.splice(e,a.length-e),b.concat(a)):a}
Bi.prototype.R=function(){var a=Bi.g.R.call(this),b=this.W(),c=this.Of?b.ia:[b],d,e=a.properties;var f=a.geometry=b.R();e.style=this.L().R();e.height=this.jh+this.Cf;e.min_height=this.Cf;if(this.C().oc()&&(f.type="MultiPolygon",this.Of)){var g=[];c.forEach(function(h,k){d=f.coordinates[k];h.C().oc()?g=g.concat(d):g.push(d)});f.coordinates=g}return a};Bi.prototype.forWorkerMessage=Bi.prototype.R;function Ii(a,b,c){Ii.g.constructor.call(this,Ci,c);this.Vn(a);this.Tr(b);c&&this.cw in c&&this.Sr(c[this.cw])}u(Ii,Bi);t("H.map.Circle",Ii);Ii.prototype.Vn=function(a){(a=sc(a)).ea(this.xf)||(this.xf=a,Ji(this))};Ii.prototype.setCenter=Ii.prototype.Vn;Ii.prototype.wb=function(){return this.xf};Ii.prototype.getCenter=Ii.prototype.wb;Ii.prototype.Tr=function(a){if(E(a=ec(a,0,6371000.79*Tb/2)))throw new D(this.Tr,0,a);this.rr!==a&&(this.rr=a,Ji(this))};Ii.prototype.setRadius=Ii.prototype.Tr;
Ii.prototype.lA=function(){return this.rr};Ii.prototype.getRadius=Ii.prototype.lA;Ii.prototype.vn=60;Ii.prototype.Sr=function(a){if(!ob(a))throw new D(this.Sr,0,a);this.vn!==(a=ec(Eb(a),4,360))&&(this.vn=a,Ji(this))};Ii.prototype.setPrecision=Ii.prototype.Sr;Ii.prototype.cw="precision";Ii.prototype.iA=function(){return this.vn};Ii.prototype.getPrecision=Ii.prototype.iA;Ii.prototype.Y=function(){return this};Ii.prototype.setGeometry=Ii.prototype.Y;
Ii.prototype.W=function(){this.Hb===Ci&&Ii.g.Y.call(this,Ki(this));return this.Hb};Ii.prototype.getGeometry=Ii.prototype.W;function Ji(a){a.Hb!==z&&Ii.g.Y.call(a,Ki(a))}function Ki(a){var b=a.xf,c=b.lat,d=a.rr,e=0,f=new K;if(90===Hb(c))for(c=b.ho(0,d,!0).lat;360>e;e+=120)f.nr(c,e-180,B);else for(a=a.vn,a=360/a;360>e;e+=a)f.ng(b.ho(e,d,!0));b=new M(f);0>c&&b.Ow(Cf.SOUTH);return b};function Li(a,b){Li.g.constructor.call(this,Ci,b);this.ni(a)}u(Li,Bi);t("H.map.Rect",Li);Li.prototype.ni=function(a){if(!C(a,F))throw new D(this.ni,0,a);a.ea(this.Oi)||(this.Oi=this.I=a,this.Hb!==z&&Li.g.Y.call(this,Bf(a)))};Li.prototype.setBoundingBox=Li.prototype.ni;Li.prototype.C=function(){return this.I};Li.prototype.getBoundingBox=Li.prototype.C;Li.prototype.Y=function(){return this};Li.prototype.setGeometry=Li.prototype.Y;
Li.prototype.W=function(){this.Hb===Ci&&Li.g.Y.call(this,Bf(this.Oi));return this.Hb};Li.prototype.getGeometry=Li.prototype.W;t("H.util.Disposable",Zd);Zd.prototype.bc=Zd.prototype.bc;Zd.prototype.addOnDisposeCallback=Zd.prototype.bc;t("H.util.dispose",Yd);Zd.prototype.u=Zd.prototype.u;Zd.prototype.dispose=Zd.prototype.u;Zd.prototype.i=Zd.prototype.i;Zd.prototype.disposeInternal=Zd.prototype.i;function Mi(a,b,c,d){Mi.g.constructor.call(this);this.jd=a;this.ka=d;this.element=a.appendChild(this.createElement(a.ownerDocument));this.Kk(b,c)}u(Mi,Zd);Mi.prototype.F=function(){return this.element};Mi.prototype.Kk=function(a,b){this.size?(this.size.w=a,this.size.h=b):this.size=new Jh(a,b);this.Qw(this.element,this.element.style,a,b,this.ka)};Mi.prototype.setSize=Mi.prototype.Kk;m=Mi.prototype;m.lc=function(){return this.size};m.mb=function(){return this.ka};m.Su=!0;
m.Zb=function(a){a!==this.Su&&(this.element.style.display=a?"block":"none",this.Su=a)};m.opacity=1;m.Cd=function(a){this.opacity!==a&&(this.zg(a),this.opacity=a)};m.Qe=function(){return this.opacity};m.pi=function(a){this.element.style.zIndex=a};Mi.prototype.setZIndex=Mi.prototype.pi;Mi.prototype.ru=function(){return+this.element.style.zIndex};Mi.prototype.Me=function(){};Mi.prototype.clear=function(){};
Mi.prototype.i=function(){this.clear();this.jd.removeChild(this.element);this.Kk(0,0);delete this.element;delete this.jd;Mi.g.i.call(this)};Mi.prototype.disposeInternal=Mi.prototype.i;Mi.prototype.pw=0;Mi.prototype.On=function(){++this.pw};Mi.prototype.release=function(){--this.pw||this.u()};var Ni={PENDING:0,ACTIVE:1,DONE:2};t("H.map.render.RenderState",Ni);function Oi(a,b){var c=b||{},d=c.contextType;c=c.contextAttributes;Oi.g.constructor.call(this,b);gb(a,"Function",Oi,0,"invalid render callback");if(d){if(-1===Pi.indexOf(d))throw new D(Oi,1,"invalid context type");this.dj=d}c&&(this.cj=c);this.vr=a}u(Oi,yh);t("H.map.layer.CanvasLayer",Oi);var Pi=["2d","webgl","webgl2","experimental-webgl"];m=Oi.prototype;m.dj="2d";m.ph=function(){return this.dj};m.getContextAttributes=function(){return this.cj};
m.N=function(a,b){this.Kl&&this.Kl.canvas===a||(this.Kl=a.getContext(this.dj,this.cj));return this.vr(this.Kl,b)};m.i=function(){Oi.g.i.call(this);delete this.Kl};function Qi(a,b){Qi.g.constructor.call(this,b);gb(a,"Function",Qi,0,"invalid render callback");this.vr=a}u(Qi,yh);t("H.map.layer.DomLayer",Qi);Qi.prototype.N=function(a,b){return this.vr(a,b)};t("H.map.Style",Zg);Zg.State=lg;function Ri(a,b){if(!C(a,Element)){Si.innerHTML=a;a=Si.firstElementChild;if(!a)throw new D(Ri,0,"No element data");Si.removeChild(a);var c=!0;Si.innerHTML=""}this.Po=0!==$e(a).length;this.Jt=c?a:af(a,x.document,this.Po);b&&(c="onAttach",c in b&&gb(a=b[c],"Function",Ri,1,c)&&(this.Jq=a),c="onDetach",c in b&&gb(a=b[c],"Function",Ri,1,c)&&(this.Nq=a))}t("H.map.DomIcon",Ri);var Si=document.createElement("DIV");Ri.prototype.Jq=null;Ri.prototype.Nq=null;
Ri.prototype.au=function(a){return af(this.Jt,a,this.Po)};Ri.prototype.Po=!1;function Ti(a,b){Ti.g.constructor.call(this,a,b)}u(Ti,ai);t("H.map.DomMarker",Ti);Ti.prototype.type=Wh.DOM_MARKER;Ti.prototype.mo=2;Ti.prototype.pt=function(a){var b=new Ri(a.svg,a);a=a.anchor;b.Jt.style.margin=-a.y+"px 0 0 -"+a.x+"px";return b};Ti.prototype.Ru=function(a){return C(a,Ri)};function Ui(){Ui.g.constructor.call(this);this.dd=Vi(this);this.yn=Wa();this.jn=A(this.jn,this);this.dd.addEventListener("message",this.jn);this.Vk={}}u(Ui,J);Ui.prototype.i=function(){this.dd.terminate()};Ui.prototype.iw=function(a){var b=a.type,c=!!this.yn[b],d=a.data,e=Wi++,f=d&&d.rD?d.rD:B,g=!0;c?(this.Vk[e]=a,Xi(this,b,e,d&&d.message,f)):(a.reject(new D(this.iw,0,"processor_not_found")),g=!1);return g};
Ui.prototype.jn=function(a){a=a.data;var b=this.Vk[a.taskId],c=a.taskId,d=a.data,e=this;if(2===a.type)(new Tg("arraybuffer",d)).then(function(f){return f.arrayBuffer()}).then(function(f){e.dd.postMessage(["3",c,[f]],[f])},function(){e.dd.postMessage(["3",c,[null,"ERROR"]])});else{if(b){switch(a.type){case 1:b.resolve(d);break;case 0:b.reject(d)}delete this.Vk[c]}this.dispatchEvent(new ie(this.l.IDLE))}};var Wi=0;function Yi(a,b,c){var d=Wi++,e;a.Vk[d]=e=Fd();Xi(a,b,d,c);return e.promise}
function Xi(a,b,c,d,e){d===B||Ba(d)||(d=[d]);try{a.dd.postMessage([b,c,d],e)}catch(f){a=a.Vk[c],a.reject(f.message)}}Ui.prototype.l={IDLE:"idle",Fs:"error"};Ui.prototype.Yx=function(a,b){var c=this.Qy||(this.Qy=new ie(this.l.Fs));c.data=b;delete this.yn[a];this.dispatchEvent(c)};Ui.prototype.importScripts=function(a){Yi(this,"0",a)};
function Vi(a){var b=x.H.__bootstrap__;b=ab(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b;if(x.Worker&&x.URL)try{var c=new x.Worker(x.URL.createObjectURL(ef(b,"application/javascript")))}catch(d){}c||(a=new Zi(a),function(){eval("var self = arguments[0];"+b)}(a),c=new $i(a));return c}function $i(a){J.call(this);this.dd=a}u($i,J);$i.prototype.postMessage=function(a){x.setTimeout(A(this.iC,this,a),0)};$i.prototype.iC=function(a){var b=new ie("message");b.data=a;this.dd.dispatchEvent(b)};
$i.prototype.terminate=function(){this.dd.u();this.u()};function Zi(a){J.call(this);this.dd=a;this.addEventListener=A(this.addEventListener,this);this.removeEventListener=A(this.removeEventListener,this);this.postMessage=A(this.postMessage,this);this.eval=A(eval,this)}u(Zi,J);Zi.prototype.postMessage=function(a){var b=new ie("message");b.data=a;x.setTimeout(A(this.dd.jn,this.dd,b),0)};function aj(){var a=bj;a||(a=bj=this,J.call(a),this.ug());return a}var bj;u(aj,J);m=aj.prototype;m.i=function(){aj.g.i.call(this);this.ug()};m.ug=function(){var a=this.jo,b;if(a)for(b=a.length;b--;)a[b].u();this.jo=[];rb(this.jo);this.wm={};this.kw=Wa()};
m.zo=function(a){var b;a=a.type;if(b=this.kw[a]){var c=this.jo;var d=c[0];d||(d=c[0]=new Ui,this.bc(Ja(Yd,d)),Qa(this.wm)||d.importScripts(x.Object.keys(this.wm)));c=d;c.yn[a]||(c.yn[a]=b,Yi(c,"1",[a,ab(b)?b+"":b]).then(Xe,A(c.Yx,c,a)))}else throw new Ab(this.zo,'Unknown type "'+a+'"');return d};m.Sl=function(){};m.registerProcessor=function(a,b){var c=this.kw,d=c[a];if(d){if(b!==d)throw new Ab(this.registerProcessor,'Type "'+a+'" is already registered');}else c[a]=b};
m.importScripts=function(a){[].concat(a).forEach(function(b){this.wm[b]||(this.wm[b]=!0,this.jo.forEach(function(c){c.importScripts(b)}))},this)};function cj(a,b,c){Td.call(this,a,b,c)}var dj;u(cj,Td);cj.prototype.Bp=function(){dj||(dj=new Wd(new aj));return dj};cj.prototype.Si=function(){};cj.prototype.Nt=function(a){return a.iw(this)};function ej(a,b){Ah.call(this,a,b)}u(ej,Ah);t("H.map.layer.TileLayer",ej);ej.prototype.sg=function(a,b,c,d,e){if(!C(a,F))throw new D(this.sg,0,a);if(E(b=+b))throw new D(this.sg,1,b);b=Fb(b);this.pixelProjection.Wa(b);a=this.wj(a);var f=this.Bh(a,b);return this.Gj(f,a.left>a.right,b,c,d,e)};ej.prototype.requestTiles=ej.prototype.sg;function fj(a){eb(this,fj);fj.g.constructor.call(this,a);if(a&&"tileSize"in a){var b=Ib(+a.tileSize)/Sb;if(isNaN(b)||b%1||0>b||30<b)throw new D(fj,0,"tileSize: "+a.tileSize);this.tileSize=+a.tileSize}}u(fj,N);t("H.map.provider.TileProvider",fj);function gj(a,b){return bc(a)-8-Eb(bc(b))}fj.getZoomLevelOffset=gj;fj.prototype.requestTile=fj.prototype.Oa;fj.prototype.cancelTile=fj.prototype.Kd;fj.prototype.cancelTileByKey=fj.prototype.Ti;fj.prototype.createTileInternal=fj.prototype.ld;
fj.prototype.Sd=function(a,b,c){return this.uri.concat("_",a,"_",b,"_",c)};fj.prototype.getTileKey=fj.prototype.Sd;fj.prototype.tileSize=256;fj.prototype.tileSize=fj.prototype.tileSize;function hj(){}t("H.util.ICache",hj);hj.prototype.add=function(){};hj.prototype.add=hj.prototype.add;hj.prototype.get=function(){};hj.prototype.get=hj.prototype.get;hj.prototype.Vl=function(){};hj.prototype.drop=hj.prototype.Vl;hj.prototype.forEach=function(){};hj.prototype.forEach=hj.prototype.forEach;hj.prototype.ja=function(){};hj.prototype.removeAll=hj.prototype.ja;hj.prototype.ci=function(){};hj.prototype.registerOnDrop=hj.prototype.ci;hj.prototype.ap=function(){};
hj.prototype.deRegisterOnDrop=hj.prototype.ap;function ij(a,b,c){this.bk=[];b&&this.ci(b);if(c&&!ab(c))throw new D(ij,2,c);this.Je=0;this.filter=c;this.ba={};this.Sj=this.lh=null;this.Nr(a)}t("H.util.Cache",ij);ij.prototype.add=function(a,b,c){var d,e;c=+c;if(!ob(c)||0>c)throw new D(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.ba[a])?(d.data!==b&&jj(this,d),this.Je+=c-d.size,d.size=c,d.data=b,kj(this,d)):this.ba[a]=lj(this,{id:a,data:b,size:c,xd:null,gf:null},this.lh),mj(this);return e};ij.prototype.add=ij.prototype.add;
ij.prototype.ci=function(a){if(!ab(a))throw new D(this.ci,0,a);this.bk.push(a)};ij.prototype.registerOnDrop=ij.prototype.ci;ij.prototype.ap=function(a){this.bk=this.bk.filter(function(b){return b!==a})};ij.prototype.deRegisterOnDrop=ij.prototype.ap;ij.prototype.get=function(a,b){return(a=b?this.ba[a]:kj(this,this.ba[a]))&&a.data};ij.prototype.get=ij.prototype.get;ij.prototype.Vl=function(a){var b;(b=this.ba[a])&&this.jf(b,!0)};ij.prototype.drop=ij.prototype.Vl;
ij.prototype.forEach=function(a,b,c){var d;for(d in this.ba){var e=this.ba[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};ij.prototype.forEach=ij.prototype.forEach;ij.prototype.ja=function(a){var b;for(b in this.ba){var c=this.ba[b];(a?a(b,c.data,c.size):1)&&this.jf(this.ba[b],!0)}};ij.prototype.removeAll=ij.prototype.ja;ij.prototype.Nr=function(a){if(!(0<+a))throw new D(ij.prototype.Nr,0,a);this.pv=+a;mj(this);return this};ij.prototype.setMaxSize=ij.prototype.Nr;ij.prototype.Xz=function(){return this.pv};
ij.prototype.getMaxSize=ij.prototype.Xz;ij.prototype.rz=function(){return this.Je};ij.prototype.getCurrentSize=ij.prototype.rz;function kj(a,b){b&&(a.lh=lj(a,b,a.lh));return b}function mj(a){for(;a.Je>a.pv&&a.Sj;)a.jf(a.Sj,!0)}function lj(a,b,c){if(c!==b){(b.xd||b.gf)&&a.jf(b,!1);if(b.xd=c)b.gf=c.gf,c.gf=b;b.gf||(a.lh=b);b.xd||(a.Sj=b);a.Je+=b.size}return b}
ij.prototype.jf=function(a,b){var c=a.gf,d=a.xd;if(c||d||a==this.lh&&a==this.Sj)c?c.xd=d:this.lh=d,d?d.gf=c:this.Sj=c,this.Je-=a.size,b&&(delete this.ba[a.id],jj(this,a));a.xd=a.gf=null;return a};function jj(a,b){for(var c=a.bk.length;c--;)a.bk[c].call(a,b.id,b.data,b.size)};function nj(a,b,c,d){a-=c;b-=d;return a*a+b*b}function oj(a,b,c){return pj(a,b*b,c||0,0,a.length-1)}t("H.math.simplifyDP",oj);
function pj(a,b,c,d,e){var f=0,g=d,h=a[d].x,k=a[d].y,l=a[e].x,n=a[e].y,p=d+1,q=nj(h,k,l,n);if(q)for(;p<e;){var r=a[p++];var v=r.x;r=r.y;var w=((v-h)*(l-h)+(r-k)*(n-k))/q;v=0>w?nj(v,r,h,k):1<w?nj(v,r,l,n):nj(v,r,h+w*(l-h),k+w*(n-k));v>f&&(f=v,g=p-1)}else for(;p<e;)r=a[p++],v=r.x,r=r.y,v=nj(v,r,h,k),v>f&&(f=v,g=p-1);f>=b||0<c&&g-d?(--c,1<g-d?(d=pj(a,b,c,d,g),d.splice(d.length-1,1)):d=[a[d]],d=1<e-g?d.concat(pj(a,b,c,g,e)):d.concat(a.slice(g,e+1))):d=[a[d],a[e]];return d};function qj(a,b,c,d){this.key="";this.x=a;this.y=b;this.z=c;this.data=d;this.valid=!0}t("H.map.provider.Tile",qj);function rj(a,b,c,d,e,f,g,h){rj.g.constructor.call(this,b,c,d,null);this.key=a;this.yd=h;this.cd=e;this.oa=f;this.ai={};this.zL=g;this.Om=Gb(di.MAX_LINE_WIDTH/2*this.oa+1)}u(rj,qj);t("H.map.provider.SpatialTile",rj);rj.prototype.tg=ac;rj.prototype.sr=ac;rj.prototype.kf=ac;function sj(a){return a.yd.getInvalidations(Wh.SPATIAL)}
function tj(a){var b=sj(a),c=b.Jd,d=a.tg,e=d===c,f;if(!(e||b.Ku(d)||b.nq(d))){e=a.Dg;var g=a.ai;if(b.Dm(d))for(f=e.length;f--;){var h=e[f];if(h.Hc().Dm(d)){e.splice(f,1);var k=k||uj(a,h.xb())}}if(b.pq(d)){for(f=e.length;f--;)if(h=e[f],h.Hc().pq(d)){var l=1;if((h=g[h.xb()])&&h.pm){k=1;break}}l&&e.sort(vj)}if(!k&&b.Gh(d))for(f=e.length;f--;)if(e[f].Hc().Gh(d)){var n=1;break}a.sr!==d||n||(a.sr=c,a.kf!==d||k||(a.kf=c));a.tg=c;e=!0}return e}
rj.prototype.Eh=function(){var a=sj(this),b=a.Jd,c=this.kf,d=c===b;d||(this.yd.mw&&!a.Gh(c)?d=!0:tj(this)&&(d=this.kf===b));return d};rj.prototype.isCanvasValid=rj.prototype.Eh;Object.defineProperty(rj.prototype,"valid",{get:function(){return this.Eh()},set:Xe,configurable:!0});function wj(a,b){this.Zl=a;this.pm=b}function uj(a,b){a=a.ai;var c=a[b];if(c)return delete a[b],c.pm}rj.prototype.Dg=Ye;
function xj(a){var b=sj(a),c=a.tg,d=a.Dg,e;if(!tj(a)){for(e=d.length;e--;){var f=d[e];var g=f.Hc();(g.Dm(c)||g.nq(c))&&uj(a,f.xb())}a.Dg=a.yd.requestSpatialsByTile(a,!1,!1).sort(vj);a.tg=b.Jd}}function vj(a,b){return Xh(a.Re(),b.Re(),!1)}rj.prototype.cb=function(){return this.Dg};rj.prototype.getObjects=rj.prototype.cb;rj.prototype.vA=function(){return this.cd};rj.prototype.getTileSize=rj.prototype.vA;var yj={};
rj.prototype.Hj=function(){var a=this.cd+"_"+this.oa,b=yj[a];if(!b){b=-this.Om;var c=this.cd-b;b=yj[a]=new fg(b,b,c,c)}return b};rj.prototype.getPxClipRect=rj.prototype.Hj;rj.prototype.gm=function(){var a=this.bz;if(!a){var b=this.im();a=0;var c=this.cd;this.z&&(c-=a+=this.Hj().top);a=this.bz=Ic(b.gk(new L(a,a)),b.gk(new L(c,c)))}return a};rj.prototype.getGeoClipRect=rj.prototype.gm;
rj.prototype.im=function(){var a=this.mC;if(!a){var b=this.cd;a=this.mC=new vh(B,b);a.Wa(this.z);a.x=this.x*b;a.y=this.y*b}return a};rj.prototype.getPxProj=rj.prototype.im;rj.prototype.mb=function(){return this.oa};rj.prototype.getPixelRatio=rj.prototype.mb;rj.prototype.Dn=function(){var a=this.data;a&&(this.data=null,this.kf=ac);return a};rj.prototype.releaseCanvas=rj.prototype.Dn;rj.prototype.En=function(){this.ai={};delete this.Dg;this.tg=ac};rj.prototype.releaseData=rj.prototype.En;
rj.prototype.N=function(a){var b=a.getContext("2d"),c,d,e,f,g=0;xj(this);if(this.kf<this.tg){var h=this.Dg;if(c=h.length){a.width=a.height=this.cd;b.clearRect(0,0,this.cd,this.cd);var k=this.ai;for(d=0;d<c;d++){var l=h[d];var n=l.xb();if(f=(e=k[n])?e.Zl:l.getGeometriesForTile(this)){if(e)l.Hc().Gh(this.kf)&&(e.pm=si(l,f)),e=e.pm;else{e=si(l,f);var p;var q=f;for(var r=l.Se?2:0,v=q.length;v--;){var w=q[v];if(w!==oi){var y=w.Pc;for(p=y.length;p--;)w=y[p],4<w.length&&(y[p]=oj(w,.6,r))}}this.ai[n]=new wj(f,
e)}if(e){b.save();q=l.Se?this.sC:this.tC;for(n=0;n<f.length;n++)q.call(this,l,f[n],l.L(),b);if(f=l.getLabels(this))for(l=b,n=f.length;n--;)for(r=f[n],q=r.size,l.font=q+"px "+r.font,l.fillStyle=r.color,l.textAlign="center",l.translate(r.x,r.y),l.rotate(r.angle),q=r.lineHeight||1.375*q,v=r.lines,r=v.length;r--;)l.fillText(v[r],0,r*q);b.restore()}g|=+e}}}this.data=g?a:null;this.sr=this.kf=this.tg}else this.data&&(g=1);return 0<g};rj.prototype.render=rj.prototype.N;rj.prototype.data=null;
rj.prototype.tC=function(a,b,c,d){var e;c.Pj&&(zj(d,c,this.oa),Aj(b,d,!1,!0,!1,this.cd,this.Om));c.Nj&&(e=a.Og)&&e.Mc&&(Bj(d,e),Cj(this,d,b,e,c.lineWidth))};
rj.prototype.sC=function(a,b,c,d){var e=c.Mc,f=c.Pj,g,h=this.cd,k=this.Om;if(b===oi)e&&(Bj(d,c),d.fillRect(0,0,h,h));else{f&&zj(d,c,this.oa);if(c.Nj&&(g=a.Og)){var l=c.lineWidth;g.Mc||(g=null)}a=b.on;if(a===$b){if(f||e)Bj(d,c),Aj(b,d,!0,f,e,h,this.Om);g&&(Bj(d,g),Cj(this,d,b,g,l,0))}else e&&(Bj(d,c),Aj(b,d,!0,!1,e,h,k,0,a)),f&&Aj(b,d,!1,f,!1,h,k,a),g&&(Bj(d,g),Cj(this,d,b,g,l,a))}};
function Aj(a,b,c,d,e,f,g,h,k){var l=a.Pc,n=-g;g=f+g;h=h||0;k===B&&(k=l.length);if(e&&a===oi)b.fillRect(0,0,f,f);else if(k>h){b.beginPath();for(f=h;f<k;f++){var p=l[f];var q=p.length;if(p===pi)b.moveTo(n,n),b.lineTo(n,g),b.lineTo(g,g),b.lineTo(g,n);else{var r=p[0];b.moveTo(r.x,r.y);for(h=1;h<q;h++)r=p[h],b.lineTo(r.x,r.y)}c&&b.closePath()}c&&e&&b.fill(a.Mj!==$b?"evenodd":"nonzero");d&&b.stroke()}}
function zj(a,b,c){var d;a.strokeStyle=b.strokeColor;a.lineWidth=b.lineWidth*c;a.lineCap=b.lineCap;a.lineJoin=b.lineJoin;a.miterLimit=b.miterLimit;a.setLineDash&&(d=b.lineDash)!==Ye&&(a.setLineDash(d),a.lineDashOffset=b.lineDashOffset)}function Bj(a,b){a.fillStyle=b.fillColor}
function Cj(a,b,c,d,e,f){var g=e*d.width/2;e=e*d.length/2;var h=e/2;d=2*e*d.frequency;var k=Jb(Kb(e,2)+Kb(g,2));a=a.cd-k;a=new fg(k,k,a,a);c=c.Pc;var l,n,p,q,r,v,w,y=Tb/2;f=f||0;for(k=c.length;k-- >f;){var I=0;var G=c[k];if(n=l=G.length){var S=G;n=S.length;for(p=0;--n;)p+=S[n].lb(S[n-1]);n=(S=p)>=d}if(n)for(n=Cb(Fb(S/d),1E3),n=S/(n+1),p=n/2;--l;){for(q=(r=G[l]).lb(v=G[l-1]);p<=I+q;){var X=r.x+(v.x-r.x)*(w=(p-I)/q);w=r.y+(v.y-r.y)*w;a.Il(X,w)&&(b.save(),b.translate(X,w),b.rotate(-Qb((v.y-r.y)/(r.x-
v.x))+(r.x<v.x?y:-y)),b.beginPath(),b.moveTo(-g,-e),b.lineTo(0,e),b.lineTo(g,-e),b.lineTo(0,-h),b.closePath(),b.fill(),b.restore());p+=n}I+=q}}}var Dj=[];
rj.prototype.La=function(a,b,c){for(var d=this.Dg,e=d.length,f,g,h,k,l,n,p=Ye,q,r=this.oa;e--;)if(g=d[e],g.Td(!0)&&(h=this.ai[g.xb()])&&(k=h.Zl)){f=g.L();n="none"!==f.fillColor&&g.Se;q="none"===f.strokeColor?0:f.lineWidth*r;for(f=k.length;f--;){l=k[f];var v;if(!(v=n&&l===oi)&&(v=n||q)){var w;v=a;var y=b,I=n,G=q,S=l.Mj,X=l.on,Ga=X!==$b,ha=l.Pc,mb=ha.length,ta=0,nb=0,zd=!1;for(l=0;l<mb;l++){var rc=ha[l];var bb=l>=X;var Ke=!bb&&l>=S;if(rc===pi&&I)Ke?ta++:nb++;else{var pd=rc.length;Dj.length=2*pd;for(w=
0;w<pd;w++){var np=rc[w];Dj[2*w]=np.x;Dj[2*w+1]=np.y}w=I&&!bb;bb=Ga&&!bb?0:G;if(w||bb)if(bb=hc(v,y,Dj,bb,w),bb===gc.EDGE||bb===gc.VERTEX){zd=!0;break}else if(bb===gc.SURFACE)if(Ke)ta++;else if(nb++,S===$b)break}}v=zd||0<nb&&!(ta%2)}if(v){p===Ye&&(p=[]);p.push(g);break}}if(c&&p.length)break}return p};var Ej,Fj=function(){function a(){}for(var b,c,d,e=Xa("o ms moz webkit ").split(void 0!==B?void 0:" "),f=5;f--&&!b;)b=e[f],b=(c=x[b+(b?"R":"r")+"equestAnimationFrame"])&&!E(c.call(window,a))&&(d=x[b+(b?"C":"c")+"ancelAnimationFrame"]);Ej=b?function(g){return c.call(x,g)}:function(g){return x.setTimeout(g,25)};return b?function(g){return d.call(x,g)}:function(g){return x.clearTimeout(g)}}(),Gj=x.performance&&x.performance.now?function(){return x.performance.now()}:function(){return x.Date.now()};function Hj(a,b){var c=this;if(!ab(b))throw new D(Hj,1,b);if(!ab(a.next||ab(a.cycle)))throw new D(Hj,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.pk=[];this.jw=[];this.xB=a;this.process=b;this.kC=function(){Ij(c)};this.ir=null;this.Dw=function(){c.ir||(c.ir=x.setTimeout(c.kC,1))}}t("H.util.AsyncQueue",Hj);Hj.prototype.push=function(a,b){if(!ab(b))throw new D(this.push,1,b);a=Jj(new Kj,a,this.Dw,b);this.pk.push(a);this.Dw();return a};Hj.prototype.push=Hj.prototype.push;
Hj.prototype.wn=function(){Ij(this)};function Ij(a){var b=a.jw,c=0,d=a.xB;d.tt();for(a.ir=null;c<b.length;){var e=b[c];e.Ou?b.splice(c,1):c++}for(;e=d.next(a.pk,a.jw);)e.cancelled?e.done(null,"cancelled"):(b.push(e),a.process(e,e.data))}function Kj(){Jj(this,null,null,null)}Hj.Task=Kj;function Jj(a,b,c,d){a.data=b;a.cancelled=!1;a.Ou=!1;a.HB=c;a.IB=d;a.Lo=null;return a}Kj.prototype.done=function(a,b){this.Ou=!0;this.HB();this.IB(this,a,b)};Kj.prototype.done=Kj.prototype.done;
Kj.prototype.cancel=function(){this.Lo&&this.Lo();this.cancelled=!0};Kj.prototype.cancel=Kj.prototype.cancel;Kj.prototype.MC=function(a){this.Lo=a;return this};Kj.prototype.setCancelFn=Kj.prototype.MC;function Lj(){}Hj.Mode=Lj;Lj.prototype.next=function(){};Lj.prototype.tt=function(){};function Mj(a,b){Mj.g.constructor.call(this,new Nj(a),b)}u(Mj,Hj);t("H.util.SequentialQueue",Mj);function Nj(a){if(isNaN(a)||0>a)throw new D(Mj,1,'Argument "maxTime" must be a positive number');this.qB=a;this.Qk=Gj()}Nj.prototype.next=function(a){return a.length&&Gj()-this.Qk<this.qB?a=a.shift():null};Nj.prototype.tt=function(){this.Qk=Gj()};function Oj(a,b){var c;Oj.g.constructor.call(this,b);this.lw=a;this.oa=a=b.pixelRatio;this.tileSize=c=1<<Eb(bc((b.tileSize||256)*a));this.rs=gj(c,a);this.fe=A(this.fe,this);this.Lq=A(this.Lq,this);this.mg=A(this.mg,this);this.fg=A(this.fg,this);this.de=A(this.de,this);this.lw.addEventListener(N.prototype.l.Aa,this.de,!1,this);this.Vg=[];this.qf=new ij(b.tileCacheSize||256,this.fe);this.Yo=new ij(b.dataCacheSize||512,this.Lq);this.In=new Mj(20,this.mg);this.jg={};this.Zu=Gj()}u(Oj,fj);
Oj.prototype.de=function(a){a=a.target;a.type===Wh.SPATIAL&&this.kb(a)};Oj.prototype.Oa=function(a,b,c,d){var e=this.getTileKey(a,b,c),f;if(f=this.qf.get(e,d)){if(d||f.Eh())return f;d||this.qf.Vl(e)}if((f=this.Yo.get(e,d))&&(d||tj(f)))return a=this.Vg.pop()||document.createElement("canvas"),f.N(a)||this.Vg.push(a),this.qf.add(e,f,1),f;d||((f=this.jg[e])?f.count++:(f=this.In.push([e,a,b,c],this.fg),f.count=1,this.jg[e]=f))};Oj.prototype.requestTile=Oj.prototype.Oa;Oj.prototype.ld=function(){};
Oj.prototype.createTileInternal=Oj.prototype.ld;Oj.prototype.wn=function(){var a=Gj();33<a-this.Zu&&(this.In.wn(),this.Zu=a)};Oj.prototype.Kd=function(a,b,c){this.Ti(this.getTileKey(a,b,c))};Oj.prototype.cancelTile=Oj.prototype.Kd;Oj.prototype.Ti=function(a){var b;if(b=this.jg[a])b.count--,b.count||(b.cancel(),delete this.jg[a])};Oj.prototype.cancelTileByKey=Oj.prototype.Ti;m=Oj.prototype;
m.mg=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];c=this.qf.get(c)||new rj(c,d,e,f,this.tileSize,this.oa,f+this.rs,this.lw);d=c.data||this.Vg.pop()||document.createElement("canvas");c.N(d)||this.Vg.push(d);b.push(c);a.done(c)};m.fg=function(a,b){a=a.data[0];b&&this.qf.add(a,b,1);delete this.jg[a];this.kb()};m.fe=function(a,b){b.data&&this.Vg.push(b.Dn());this.Yo.add(a,b,1)};m.Lq=function(a,b){b.En()};
m.i=function(){for(var a in this.jg)this.jg[a].cancel();this.qf.ja();this.Yo.ja();this.Vg.length=0;Oj.g.i.call(this)};function Pj(a,b){b=b?Ra(b):{};b.tileSize=b.tileSize||256;b.pixelRatio=b.pixelRatio||Ie();b.max=24;this.Cg=new Oj(a,b);this.si=new ej(this.Cg);b.minWorldSize=this.Cg.tileSize;b.provider=a;Pj.g.constructor.call(this,b);this.tileSize=this.si.tileSize;this.fn=A(this.fn,this);this.Cg.addEventListener(this.Cg.l.Aa,this.fn);a.addEventListener(a.l.Aa,this.fn)}u(Pj,yh);t("H.map.layer.ObjectLayer",Pj);Pj.prototype.fn=function(a){a.currentTarget!==this.Cg&&a.target.type===Wh.SPATIAL||this.kb()};
var Qj={markers:Ye,total:0};Pj.prototype.le=function(a,b,c){var d=this.D,e;return d.providesMarkers()&&(e=d.requestMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:Qj};Pj.prototype.requestMarkers=Pj.prototype.le;Pj.prototype.ke=function(a,b,c){var d=this.D,e;return d.providesDomMarkers()&&(e=d.requestDomMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:Qj};Pj.prototype.requestDomMarkers=Pj.prototype.ke;var Rj={tiles:Ye,total:0};
Pj.prototype.sg=function(a,b,c,d){if(this.D.providesSpatials()){var e=this.si.sg(a,b,c,d);c||(this.Cg.wn(),e=this.si.sg(a,b,!0,d))}else e=Rj;return e};Pj.prototype.requestTiles=Pj.prototype.sg;Pj.prototype.Oa=function(a,b,c,d){return this.si.Oa(a,b,c,d)};Pj.prototype.requestTile=Pj.prototype.Oa;Pj.prototype.Kd=function(a,b,c){this.si.Kd(a,b,c)};Pj.prototype.cancelTile=Pj.prototype.Kd;var Sj={overlays:Ye,total:0};
Pj.prototype.rg=function(a,b,c){var d=this.D,e=Sj;d.providesOverlays&&d.providesOverlays()&&(a=d.requestOverlays(a,b,!0,c),b=a.length)&&(e={overlays:a,total:b});return e};Pj.prototype.requestOverlays=Pj.prototype.rg;Pj.prototype.i=function(){this.Cg.u();this.si.u();this.D.dispose();Pj.g.i.call(this)};function Tj(a,b){ab(a)&&(this.Mv=a);ob(b)&&(this.bl=b)}t("H.util.Request",Tj);Tj.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var Uj=[0,1,2,3,4];Tj.prototype.o=0;Tj.prototype.getState=function(){return this.o};Tj.prototype.getState=Tj.prototype.getState;Tj.prototype.G=function(a){if(0>Uj.indexOf(a))throw new D(this.G,0,a);if(this.o!==a||1===a&&1<this.bl)this.o=a,this.Mv&&this.Mv(this)};Tj.prototype.bl=1;Tj.prototype.yA=function(){return this.bl};Tj.prototype.getTotal=Tj.prototype.yA;
Tj.prototype.xn=0;Tj.prototype.jA=function(){return this.xn};Tj.prototype.getProcessed=Tj.prototype.jA;Tj.prototype.Rt=0;Tj.prototype.Cz=function(){return this.Rt};Tj.prototype.getFailed=Tj.prototype.Cz;function Vj(a,b){a.xn<a.bl&&(db(b)||(b=2),0===b||1===b||0!==a.o&&1!==a.o||(a.xn++,2!==b&&a.Rt++,a.G(a.xn<a.bl?1:2)))}Tj.prototype.Si=function(){};Tj.prototype.cancel=function(){3!==this.o&&(this.Si(),this.G(3))};Tj.prototype.cancel=Tj.prototype.cancel;function Wj(a,b,c,d,e,f){var g;for(g=[];d<=e;d++){var h=g.concat,k=a;var l=c;var n=Fb(d);k.pixelProjection.Wa(n);var p=k.wj(l);l=k.Bh(p,n);n=Bh(k,l,p.left>p.right,n);g=h.call(g,n)}a=g.length;Tj.call(this,f,a);this.cx=c=[];this.Uq=A(this.Uq,this);this.Tq=A(this.Tq,this);for(this.G(1);a--;)f=g[a],c.push(Xj(b,f[0],f[1],f[2],this.Uq,this.Tq))}u(Wj,Tj);Wj.prototype.Uq=function(){Vj(this,2)};Wj.prototype.Tq=function(){Vj(this,4)};
Wj.prototype.Si=function(){for(var a=this.cx,b=a.length;b--;)a[b].cancel();delete this.cx};function Yj(a,b,c,d){Yj.g.constructor.call(this,a,b,c);this.modifiers=d}u(Yj,nh);t("H.map.ChangeEvent",Yj);var Zj={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64};Yj.Type=Zj;Yj.prototype.Sx=Zj.SIZE;Yj.prototype.SIZE=Yj.prototype.Sx;Yj.prototype.Os=Zj.POSITION;Yj.prototype.POSITION=Yj.prototype.Os;Yj.prototype.Gs=Zj.HEADING;Yj.prototype.HEADING=Yj.prototype.Gs;Yj.prototype.Rs=Zj.TILT;Yj.prototype.TILT=Yj.prototype.Rs;Yj.prototype.Hs=Zj.INCLINE;Yj.prototype.INCLINE=Yj.prototype.Hs;
Yj.prototype.Ss=Zj.ZOOM;Yj.prototype.ZOOM=Yj.prototype.Ss;Yj.prototype.As=Zj.BOUNDS;Yj.prototype.BOUNDS=Yj.prototype.As;function ak(){this.ba=[];ak.g.constructor.call(this)}u(ak,J);t("H.util.OList",ak);function bk(a,b,c){a=a.ba.length;if(c)var d=a;else if(E(d=0>(d=+b)?Db(0,a+d):Cb(a,d)))throw new Ge(ak,b,[0,a-1]);return d}ak.prototype.wo=function(a,b){this.ba.splice(b,0,a);this.dispatchEvent(new ck(this,this.l.Gi,b,a,null,null))};ak.prototype.add=function(a,b){this.wo(a,bk(this,b,E(b)))};ak.prototype.add=ak.prototype.add;
ak.prototype.jf=function(a){var b=this.ba.splice(a,1)[0];this.dispatchEvent(new ck(this,this.l.Ii,a,null,b,null));return b};ak.prototype.Bd=function(a){this.get(a);return this.jf(a)};ak.prototype.removeAt=ak.prototype.Bd;ak.prototype.remove=function(a){a=this.indexOf(a);return 0<=a?(this.jf(a),!0):!1};ak.prototype.remove=ak.prototype.remove;
ak.prototype.set=function(a,b){if(0!==this.ba.length||0!==a){this.get(a);a=bk(this,a,!1);var c=this.ba[a]}this.ba[a]=b;this.dispatchEvent(new ck(this,this.l.Ji,a,b,c,null));return c};ak.prototype.set=ak.prototype.set;ak.prototype.indexOf=function(a){return this.ba.indexOf(a)};ak.prototype.indexOf=ak.prototype.indexOf;ak.prototype.get=function(a){var b=bk(this,a,!1),c=this.ba;if(b>=c.length)throw new Ge(this.get,a,[0,c.length-1]);return c[b]};ak.prototype.get=ak.prototype.get;ak.prototype.Tz=function(){return this.ba.length};
ak.prototype.getLength=ak.prototype.Tz;ak.prototype.Ta=function(){return[].concat(this.ba)};ak.prototype.asArray=ak.prototype.Ta;ak.prototype.flush=function(){for(var a=this.ba.length;a--;)this.jf(a)};ak.prototype.flush=ak.prototype.flush;ak.prototype.i=function(){this.flush();ak.g.i.call(this)};ak.prototype.l={Gi:"add",Ii:"remove",Ji:"set",GD:"move"};function ck(a,b,c,d,e,f){ck.g.constructor.call(this,b,a);this.idx=c;this.added=d;this.removed=e;this.moved=f}u(ck,ie);ak.Event=ck;function dk(a){var b;dk.g.constructor.call(this);this.dispatchEvent=A(this.dispatchEvent,this);if(a){var c=a.length;for(b=0;b<c;b++)this.add(a[b])}}u(dk,ak);t("H.map.DataModel",dk);function ek(a,b){var c=b.getProvider&&b.getProvider();c&&(fk[c.uid]=c);b.fa(a)}function gk(a){var b=a.getProvider&&a.getProvider();b&&delete fk[b.uid];a.fa(null)}dk.prototype.add=function(a,b){C(a,yh,this.add,0);ek(this,a);dk.g.add.call(this,a,b)};dk.prototype.add=dk.prototype.add;
dk.prototype.set=function(a,b){C(b,yh,this.set,0);ek(this,b);(a=dk.g.set.call(this,a,b))&&gk(a);return a};dk.prototype.set=dk.prototype.set;dk.prototype.Bd=function(a){var b;(b=dk.g.Bd.call(this,a))&&gk(b);return b};dk.prototype.removeAt=dk.prototype.Bd;dk.prototype.remove=function(a){var b;(b=dk.g.remove.call(this,a))&&gk(a);return b};dk.prototype.remove=dk.prototype.remove;dk.prototype.flush=function(){for(var a=this.ba.length;a--;)this.Bd(a);dk.g.flush.call(this)};dk.prototype.flush=dk.prototype.flush;
var fk={};rb(fk);function hk(a,b,c){if(a=fk[a])return C(a[b],Function,hk,1,"invalid method"),a[b].apply(a,c)}dk.invoke=hk;function ik(){ik.g.constructor.call(this);this.Ln={};this.vk={position:new pc(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new M(kf([90,-180,90,0,90,180,-90,180,-90,-180]))}}u(ik,J);t("H.map.ViewModel",ik);ik.prototype.l={Aa:"update",Ki:"sync"};
ik.prototype.Xc=function(a,b){if(!a)throw new D(this.Xc,0,a);var c=a[jk];if(db(c)&&!qc(c))throw new D(this.Xc,0,jk);c=a[kk];if(db(c)&&E(+c))throw new D(this.Xc,0,kk);c=a[lk];if(db(c)&&!C(c,oc))throw new D(this.Xc,0,lk);a=x.Object.assign({},a);c=mk(a,this.Ln,this.vk);nk(this,this.Ln,a);this.dispatchEvent(new ok(this.Ln,c,b));return this};ik.prototype.setLookAtData=ik.prototype.Xc;ik.prototype.Ib=function(){var a={};a[jk]=sc(this.vk[jk]);nk(this,a,this.vk,!0);return a};ik.prototype.getLookAtData=ik.prototype.Ib;
var jk="position",kk="zoom",lk="bounds",pk={Os:jk,Ss:kk,Gs:"heading",Rs:"tilt",Hs:"incline",As:lk},qk=Object.keys(pk).map(function(a){return pk[a]});
function nk(a,b,c,d){a.zv={};a.yv={};a.gv=[];for(var e=a.SB,f=a.RB,g=qk.length,h,k,l;g--;)if(h=qk[g],l=c[h],k=b[h],null==k||!d)if(null!=l){if(db(e)&&e.call(a,h,k,l),b[h]="position"!==h||l&&!E(l.lat)&&!E(l.lng)?l:sc(l),db(f)){switch(h){case "position":k=l&&k&&(l.lat!==k.lat||l.lng!==k.lng);break;case "bounds":k=l&&k&&!l.ea(k);break;default:k=l!==k}k&&f.call(a,h)}}else delete b[h]}ik.prototype.SB=function(a,b,c){this.zv[a]=b;this.yv[a]=c};ik.prototype.RB=function(a){this.gv.push(rk[a])};
var rk=qk.reduce(function(a,b){a[b]=Zj[b.toUpperCase()];return a},{});function mk(a,b,c){var d=0;["tilt","incline","heading",kk].forEach(function(e){E(a[e])?a[e]=E(b[e])?c[e]:b[e]:d|=rk[e]});[jk,lk].forEach(function(e){a[e]?d|=rk[e]:a[e]=b[e]||c[e]});return d}ik.prototype.sb=function(a){var b={},c={};nk(this,this.vk,a);this.Ln={};b.lookAt=this.yv;c.lookAt=this.zv;a=this.gv;a=a.length?a.reduce(sk):0;this.dispatchEvent(new Yj(this.l.Ki,b,c,a))};ik.prototype.synchronize=ik.prototype.sb;
function sk(a,b){return a|b}ik.prototype.Lk=function(a,b){if(E(a=+a))throw new D(this.Lk,0,kk);this.Xc({zoom:a},b)};ik.prototype.Tb=function(){return this.vk.zoom};ik.prototype.Fd=zb;ik.prototype.startControl=ik.prototype.Fd;ik.prototype.control=zb;ik.prototype.control=ik.prototype.control;ik.prototype.hc=zb;ik.prototype.endControl=ik.prototype.hc;function ok(a,b,c){ok.g.constructor.call(this,ik.prototype.l.Aa,a,null,b);this.animate=this.animate=ob(c)&&0<c&&Infinity>c?c:!!c}u(ok,Yj);function tk(a,b){b=b||{};var c;if(!C(a,Element))throw new D(tk,0,a);var d=a.ownerDocument.createElement("div");this.J=a;tk.g.constructor.call(this);this.padding=new fg(0,0,0,0);this.center=new L(0,0);this.margin=0;this.element=d;d.style.zIndex=0;d.style.height=d.style.width="100%";d.style.direction="ltr";d.style.position="relative"===a.style.position?"absolute":"relative";this.resize();a.appendChild(d);(c=b.padding)!==B&&this.Qr(c.top,c.right,c.bottom,c.left);this.Lr((c=b.margin)!==B?c:0)}u(tk,J);
t("H.map.ViewPort",tk);tk.prototype.l={Aa:"update",Ki:"sync"};tk.prototype.Lr=function(a){if(this.margin!==+a){if(E(this.margin=+a))throw new D(this.Lr,0,a);this.ye();this.dispatchEvent(this.l.Aa)}};tk.prototype.setMargin=tk.prototype.Lr;tk.prototype.Qr=function(a,b,c,d){var e=this.padding;if(e.top!==a||e.right!==b||e.bottom!==c||e.left!==d){if(E(a+b+c+d))throw new D(this.Qr);e.top=a;e.right=b;e.bottom=c;e.left=d;this.ye();this.dispatchEvent(this.l.Aa)}};tk.prototype.setPadding=tk.prototype.Qr;
tk.prototype.ye=function(){var a=this.padding;this.center.set((this.width+a.left-a.right)/2<<0,(this.height+a.top-a.bottom)/2<<0)};tk.prototype.resize=function(){var a=this.J.offsetWidth,b=this.J.offsetHeight;if(this.width!==a||this.height!==b)this.EB=new Jh(this.width,this.height),this.width=a,this.height=b,this.ye(),this.dispatchEvent(this.l.Aa)};tk.prototype.resize=tk.prototype.resize;tk.prototype.sb=function(a){this.dispatchEvent(new Yj(this.l.Ki,this.EB,a,Zj.SIZE))};
tk.prototype.synchronize=tk.prototype.sb;tk.prototype.i=function(){this.J.removeChild(this.element);delete this.J;delete this.element;tk.g.i.call(this)};tk.prototype.Gd=zb;tk.prototype.startInteraction=tk.prototype.Gd;tk.prototype.td=zb;tk.prototype.interaction=tk.prototype.td;tk.prototype.ic=zb;tk.prototype.endInteraction=tk.prototype.ic;function uk(a,b,c,d){var e=new fg(0,0,0,0);uk.g.constructor.call(this);if(!a)throw new D(uk,0,a);if(!b)throw new D(uk,1,b);if(!c)throw new D(uk,2,c);if("object"!==typeof d)throw new D(uk,3,d+" is not an object");if("number"!==typeof d.pixelRatio)throw new D(uk,3,d.pixelRatio+" is not a number");this.ka=d.pixelRatio;this.zoom=0;this.Ab=Ib(this.ka)/Sb;this.pixelProjection=new vh;this.hl={1:e.clone(),2:e.clone(),4:e.clone()};this.vd=new L(.5,.5);this.za=a;vk(this,this.ka);this.Gd=A(this.Gd,this);this.td=
A(this.td,this);this.ic=A(this.ic,this);a.startInteraction=this.Gd;a.interaction=this.td;a.endInteraction=this.ic;a.addEventListener(a.l.Aa,this.gg,!1,this);this.getCapabilities=this.getCapabilities;this.capture=this.capture;this.zoomAt=this.Ig;this.relaunch=this.ca;this.dispose=this.u;this.screenToGeo=this.Xa;this.geoToScreen=this.Ka;this.screenToLookAtData=this.Qn;this.ze=b;this.Fd=A(this.Fd,this);this.control=A(this.control,this);this.hc=A(this.hc,this);b.startControl=this.Fd;b.control=this.control;
b.endControl=this.hc;b.addEventListener(b.l.Aa,this.Wq,!1,this);this.jb=c;this.an=A(this.an,this);this.dg=A(this.dg,this);this.eg=A(this.eg,this);this.$m=A(this.$m,this);c.addEventListener(yh.prototype.l.Aa,this.an,!1,this);c.addEventListener(c.l.Gi,this.dg,!1,this);c.addEventListener(c.l.Ii,this.eg,!1,this);c.addEventListener(c.l.Ji,this.$m,!1,this)}u(uk,J);t("H.map.render.RenderEngine",uk);uk.prototype.Ig=function(){};
function vk(a,b){var c=a.za,d=c.width,e=c.height,f=c.padding,g=f.top,h=f.left,k=f.bottom;f=f.right;c=c.margin;var l=-(d+h-f)/2<<0,n=-(e+g-k)/2<<0;d+=l;e+=n;a=a.hl;a[1].set((l-c)*b,(n-c)*b,(d+c)*b,(e+c)*b);a[2].set(l*b,n*b,d*b,e*b);a[4].set((l+h)*b,(n+g)*b,(d-f)*b,(e-k)*b)}uk.prototype.gg=function(){vk(this,this.ka)};
uk.prototype.i=function(){var a=this.za,b=this.ze,c=this.jb;a.removeEventListener(a.l.Aa,this.gg,!1,this);a.startInteraction===this.Gd&&(a.startInteraction=tk.prototype.Gd);a.interaction===this.td&&(a.interaction=tk.prototype.td);a.endInteraction===this.ic&&(a.endInteraction=tk.prototype.ic);b.removeEventListener(b.l.Aa,this.Wq,!1,this);b.startControl===this.Fd&&(b.startControl=ik.prototype.Fd);b.control===this.control&&(b.control=ik.prototype.control);b.endControl===this.hc&&(b.endControl=ik.prototype.hc);
c.removeEventListener(yh.prototype.l.Aa,this.an,!1,this);c.removeEventListener(c.l.Gi,this.dg,!1,this);c.removeEventListener(c.l.Ii,this.eg,!1,this);c.removeEventListener(c.l.Ji,this.$m,!1,this)};uk.prototype.Hr=function(a){this.Ao=a};uk.prototype.setAnimationCallback=uk.prototype.Hr;uk.prototype.yr=function(){this.Ao=void 0};uk.prototype.resetAnimationCallback=uk.prototype.yr;uk.prototype.control=function(){};uk.prototype.capture=function(){return Ed(Error("not implemented"))};
function wk(a,b){a.style.transition="opacity 1.5s";re(a,"transitionend",b,!1);a.style.opacity=0}var xk={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};uk.InteractionModifiers=xk;m=uk.prototype;m.l={Qs:"render"};m.an=function(a){this.Gv(a);this.ca()};m.dg=function(a){this.dk(a.idx,a.added)};m.eg=function(a){this.Pq(a.idx,a.removed,a.type===this.jb.l.Ji)};m.$m=function(a){a.removed&&this.eg(a);this.dg(a)};m.Gv=Xe;m.dk=function(a,b){this.bq(a,b);0===a&&this.wc();C(b,yh)&&yk(this,b,!0);this.hi();this.ca()};
m.wc=function(){var a=this.jb.Ta();if(0<a.length){var b=a[0].max;this.uq=a[0].min;this.tq=b}else a=this.getCapabilities().lookAt.zoom,b=a.max,this.uq=a.min,this.tq=b;a=zk(this,this.zoom);a!==this.zoom&&(this.zoom=a,this.pixelProjection.Wa(a),this.sb())};m.sb=function(a){this.pf=this.Ib();a&&(this.pf.position=a);this.pf.zoom=this.zoom-this.Ab;this.pf.position.alt=0};m.lx=0;m.heading=180;
m.Ib=function(){return Ak(this,{position:this.pixelProjection.projection.sn(this.vd),zoom:this.zoom,tilt:this.lx,heading:this.heading})};function Ak(a,b){b.tilt=Bk(a,b.tilt);b.heading=Ck(a,b.heading);b.incline=a.getCapabilities().lookAt.incline.min;return b}function zk(a,b){var c=a.getCapabilities().lookAt.zoom;return ec(b,Db(c.min,a.uq),Cb(c.max,a.tq))}function Bk(a,b){a=a.getCapabilities().lookAt.tilt;return ec(b,a.min,a.max)}
function Ck(a,b){a=a.getCapabilities().lookAt.heading;return ec((b%360+360)%360,a.min,a.max)}function yk(a,b,c){c=c?b.addEventListener:b.removeEventListener;c.call(b,b.l.Ms,a.Qq,!1,a);c.call(b,b.l.Ls,a.Qq,!1,a)}m.bq=Xe;m.Pq=Xe;m.OC=function(a,b){this.af={before:a,after:b}};uk.prototype.setOnRenderCallbacks=uk.prototype.OC;var Dk={P2D:0,WEBGL:1,HARP:2};uk.EngineType=Dk;function Ek(){}t("H.util.ICapturable",Ek);Ek.prototype.capture=function(){};Ek.prototype.capture=Ek.prototype.capture;function Fk(a,b){var c=a.F(),d=c.ownerDocument;Fk.g.constructor.call(this);this.v=a;this.J=c=c.appendChild(Gk(d,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint"));this.wl=Gk(d,"DIV","margin: 0 0 16px 16px;display:inline-block;",'<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',
"H_logo");c.appendChild(this.wl);c=c.appendChild(Gk(d,"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright"));this.fs=c.appendChild(Gk(d,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use"));this.fs.target="_blank";this.Ml=c.appendChild(Gk(d,"SPAN","margin:0px 8px"));this.Xf=c.appendChild(Gk(d,"SPAN"));this.Wu=Ra(Hk);this.Pr(b);this.zi=A(this.zi,this);this.ce=A(this.ce,
this);this.v.addEventListener(this.v.l.Ks,this.zi);this.v.P.addEventListener("add",this.ce);this.v.P.addEventListener("remove",this.ce);this.v.P.addEventListener("set",this.ce);this.ce()}var Ik;u(Fk,Zd);t("H.map.Imprint",Fk);var Hk={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US",mark:""};
Fk.prototype.Pr=function(a){var b,c=this.wl.firstElementChild.firstElementChild.children;a||(this.Wu=Ra(Hk));var d=this.Wu;for(b in d)a&&b in a&&(d[b]=a[b]);a=(this.jq=a=d.invert)?Jk:Kk;c[0].style.fill=a.Uw;c[0].style.fillOpacity=""+a.Vw;c[1].style.fill=a.gx;c[1].style.fillOpacity=""+a.hx;a=d.locale;Lk[a]||(a="en-US",d.locale=a);this.fs.innerHTML=Lk[a];a=a.split("-");this.fs.href=d.href.replace("{LN}",a[0]).replace("{CN}",a[1].toLowerCase());d.mark?(this.Xf.innerHTML=d.mark,this.Xf.style.margin="0px 8px"):
(this.Xf.innerHTML="",this.Xf.style.margin="0px");this.J.style.font=d.font};Fk.prototype.setOptions=Fk.prototype.Pr;function Gk(a,b,c,d,e){a=a.createElement(b);c&&(a.style.cssText=c);d&&(a.innerHTML=d);e&&(a.className=e);return a}Fk.prototype.F=function(){return this.J};Fk.prototype.zi=function(){this.Ml.innerHTML=this.Cs+" "+this.V()};Fk.prototype.ce=function(){this.zi();setTimeout(this.zi,5E3)};
var Kk={gx:"#0F1621",hx:.3,Uw:"#fff",Vw:.6},Jk={gx:"#fff",hx:1,Uw:"#0F1621",Vw:.7},Mk="1987&ndash;"+Db(2015,(new Date).getFullYear())+" HERE";Fk.prototype.V=function(){var a=this.v,b=a.Tb(),c=a.xa.Ib().bounds;a=a.P;var d=a.ba.length,e={},f=0,g,h,k,l=[Mk];if(c)for(;f<d;f++)if(h=a.get(f).getCopyrights(c.C(),b))for(g=0;g<h.length;g++)e[k=h[g].label]||(l.push(k),e[k]=1);return l.join(", ")};Fk.prototype.getCopyrights=Fk.prototype.V;Fk.prototype.L=function(){return this.J.style};Fk.prototype.Cs=String.fromCharCode(169);
Fk.prototype.i=function(){this.v.removeEventListener(this.v.l.Ks,this.zi);this.v.P.removeEventListener("add",this.ce);this.v.P.removeEventListener("remove",this.ce);this.v.P.removeEventListener("set",this.ce);if(this.J.parentNode){var a=this.J;a.parentNode.removeChild(a)}};Fk.prototype.disposeInternal=Fk.prototype.i;
Fk.prototype.capture=function(a,b,c,d){var e=a.getContext("2d"),f=window.getComputedStyle(this.Ml.parentElement),g=2*kb(f.paddingLeft,10),h=(this.Ml.offsetWidth+2*g)*b,k=this.Ml.offsetHeight*b,l=0!==this.Xf.innerHTML.length?this.Xf.offsetWidth*b:0,n=lb(f.getPropertyValue("font-size")),p=this.J.ownerDocument,q=+a.width,r=+a.height,v=16*b,w=this.wl.childNodes[0].getBoundingClientRect(),y=w.width*b,I=w.height*b,G=Xe;ab(d)&&(G=function(){d("capture_error")});e.fillStyle=f.backgroundColor;e.fillRect(q-
h-l,r-k,h+l,k);h=this.Xf.innerHTML;h=this.Cs+" "+function(S){S=Gk(p,"div",null,S);return S.textContent||S.innerText||""}(this.V())+(h?" "+h:"");e.font=n*b+"px "+f.getPropertyValue("font-family");e.fillStyle=f.getPropertyValue("color");e.textBaseline="bottom";e.textAlign="right";e.fillText(h,q-g*b,r);Nk(this,e.font,function(S){(new Tg("image",S)).then(function(X){e.drawImage(X,v,r-(I+v),y,I);c(a)},G)},G)};Fk.prototype.capture=Fk.prototype.capture;
function Nk(a,b,c,d){Ok(A(function(e){e?this.jq?c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):
(e=this.wl.cloneNode(!0),e.firstChild.setAttribute("style","font:"+b),c(Re(e.innerHTML)))},a),d)}Fk.prototype.jq=!1;
function Ok(a,b){var c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>'),d=
Ik;db(d)?a(d):(new Tg("image",c)).then(function(e){Ne.drawImage(e,0,0);try{Ne.getImageData(0,0,1,1),d=!1}catch(f){d=18===f.code}finally{Ik=d,a(d)}},b)}Fk.prototype.Xx=function(a,b){Lk[a]=b};Fk.prototype.addL11NString=Fk.prototype.Xx;
var Lk={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki \u015bwiadczenia us\u0142ugi","pt-BR":"Termos de servi\u00e7o","pt-PT":"Termos do servi\u00e7o","ru-RU":"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","tr-TR":"Servis Ko\u015fullar\u0131",
"zh-CN":"\u4f7f\u7528\u6761\u6b3e"};function Q(a){var b={};this.zu=b.previousSibling=b.nextSibling=b;this.XC=new Se;Q.g.constructor.call(this,a);a&&"objects"in a&&this.fd(a.objects)}u(Q,O);t("H.map.Group",Q);Q.prototype.type=Wh.GROUP;Q.prototype.oi=function(a,b){this.gr=!0;a=Q.g.oi.call(this,a,b);this.gr=!1;a&&this.forEach(Pk,!0);return a};Q.prototype.setProvider=Q.prototype.oi;function Pk(a,b,c){a.oi(c.D)}Q.prototype.contains=function(a){var b=this===a;if(!b&&this.Xg&&C(a,O))for(;!b&&a;)a===this?b=!0:a=a.Ma;return b};
Q.prototype.contains=Q.prototype.contains;Q.prototype.xk=function(){this.lo=B;this.forEach(Qk,!0)};Q.prototype.resetZInfo=Q.prototype.xk;function Qk(a){a.xk()}Q.prototype.gr=!1;Q.prototype.sa=function(a){var b=Q.g.sa.call(this,a);b&&!this.gr&&(this.Vt=a,this.forEach(Rk,!0),delete this.Vt);return b};Q.prototype.invalidate=Q.prototype.sa;function Rk(a,b,c){a.sa(c.Vt)}
Q.prototype.forEach=function(a,b,c){var d;if(this.Xg){var e=this.zu;var f=e.nextSibling;for(d=0;f!==e;){var g=f.nextSibling;a.call(c,f,d++,this);b&&C(f,Q)&&f.forEach(a,b,c);f=g}}};Q.prototype.forEach=Q.prototype.forEach;Q.prototype.cb=function(a){var b=[];this.forEach(Sk,a,b);return b};Q.prototype.getObjects=Q.prototype.cb;Q.prototype.C=function(){var a=null;this.Xg&&this.forEach(function(b){b.C&&(b=b.C())&&(a=a?a.wd(b):b)});return a};Q.prototype.getBoundingBox=Q.prototype.C;
function Sk(a){this.push(a)}Q.prototype.Xg=0;Q.prototype.lz=function(){return this.Xg};Q.prototype.getChildCount=Q.prototype.lz;
Q.prototype.$=function(a){var b=this.zu,c=b.previousSibling;C(a,O,this.$,0);if(a.contains(this))throw new Ab(this.$,"The new object contains the parent group");var d=a.lm(!0);var e=a.Ma;if(e!==this){if(e){e=a.previousSibling;var f=a.nextSibling;e.nextSibling=f;f.previousSibling=e}a.Ma=this;O.g.fa.call(a,this);c.nextSibling=a;a.previousSibling=c;a.nextSibling=b;b.previousSibling=a;this.Xg++}a.Yr=this.XC.next();a.xk();b=a.oi(this.D,this.$);a.lm(!0)!==d&&a.sa(Ih.VOLATILITY);b||a.sa(Ih.Z_ORDER);return a};
Q.prototype.addObject=Q.prototype.$;Q.prototype.fd=function(a){var b;ib(a,this.fd,0);var c=a.length;for(b=0;b<c;b++)this.$(a[b])};Q.prototype.addObjects=Q.prototype.fd;Q.prototype.Na=function(a){if(!a||a.Ma!==this)throw new Ab(this.Na,"object not found");var b=a.previousSibling,c=a.nextSibling;b.nextSibling=c;c.previousSibling=b;a.Ma=null;O.g.fa.call(a,null);delete a.previousSibling;delete a.nextSibling;C(a.D,P)&&a.oi(null,this.Na);this.Xg--;return a};Q.prototype.removeObject=Q.prototype.Na;
Q.prototype.pg=function(a){var b;ib(a,this.pg,0);var c=a.length;for(b=0;b<c;b++)this.Na(a[b])};Q.prototype.removeObjects=Q.prototype.pg;Q.prototype.ja=function(){var a=this.cb();this.pg(a)};Q.prototype.removeAll=Q.prototype.ja;
Q.prototype.ue=function(a){for(var b=this.cb(),c=0,d=b.length,e=[],f,g,h;c<d;c++)h=b[c],h instanceof Q?(f=a?a(h.getData()):h.getData(),g=Zh(this,f,!!a),f={type:"Feature"},f.properties=g,h.di&&(f.id=h.di),f.geometry={},f.geometry.type="GeometryCollection",f.geometry.geometries=Tk(this,h.cb()),e.push(f)):e.push(h.ue(a));return{type:"FeatureCollection",features:e}};Q.prototype.toGeoJSON=Q.prototype.ue;
function Tk(a,b){for(var c=0,d=b.length,e,f=[];c<d;c++)e=b[c],e=e instanceof Q?{type:"GeometryCollection",geometries:Tk(a,e.cb())}:e instanceof ai||e instanceof Ai||e instanceof xi||e instanceof Bi?e.W().ue():{type:"FeatureCollection",features:Ye},f.push(e);return f}Q.prototype.R=function(){var a=Q.g.R.call(this);a.type="Group";return a};Q.prototype.forWorkerMessage=Q.prototype.R;function Uk(a,b,c,d,e,f){Uk.g.constructor.call(this,isNaN(a)?15:a,b,c,d,e,f)}u(Uk,tc);Uk.prototype.Bl=function(a){for(var b,c,d=this.head,e=a;e;){if(a=e.entries)if(b=a.length){if(2>b&&(c=e.parent)&&1===c.ib){c.removeChild(e);d===e&&(d=c);c.entries=a;e=a[0].node=c;continue}}else if(delete e.entries,c=e.parent)if(c.removeChild(e),d===e&&(d=c),1===c.ib){e=c.ib?c[0]||c[1]||c[2]||c[3]:null;continue}break}this.head!==d&&(this.head=d,this.gd())};
Uk.prototype.Wd=function(a,b){if(Ac(this.root,a,b,a,b))return this.Ub(this.root,a,b,this.Lh);throw Error("Coordinates out of bounds");};Uk.prototype.Ub=function(a,b,c,d){var e=a.entries;if(d)if(a.ib)e=this.Kj(a,b,c,d);else if(e){e=e[0];var f=a.oh(+(e[1]>=a[8])|+(e[0]>=a[9])<<1);f.entries=a.entries;delete a.entries;e.node=f;this.gd(f);e=this.Kj(a,b,c,d)}else a.Lg(e=new Vk(b,c)),this.gd(a),wc(this,e,!0);else e||this.gd(a),a.Lg(e=new Vk(b,c)),wc(this,e,!0);return e};
Uk.prototype.Kj=function(a,b,c,d){return this.Ub(a.oh(+(b>=a[8])|+(c>=a[9])<<1),b,c,d-1)};function Vk(a,b){this.id=zc++;this[0]=b;this[1]=a}Vk.prototype.Hf=function(a){return this[a%2]};function Wk(){this.we=new Uk(10,180,90,0,0,!0)}m=Wk.prototype;m.jc=0;m.I=null;m.C=function(){var a=this.I,b;!a&&(b=uc(this.we))&&(this.I=a=new F(-b[0],b[3],-b[2],b[1]));return a};m.Wd=function(a){++this.jc;this.I=null;return this.we.Wd(a.lng,-a.lat)};m.remove=function(a){if(a=this.we.remove(a))--this.jc,this.I=null;return a};m.ym=function(a,b,c){var d=this.we,e=a.Kc(),f=a.Gc(),g=-e.lat;e=e.lng;var h=-f.lat;f=f.lng;return a.oc()?d.pb(-180,g,f,h,c,b).concat(d.pb(e,g,180,h,c,b)):d.pb(e,g,f,h,c,b)};function Xk(a){var b;eb(this,Xk);Xk.g.constructor.call(this,a);this.Qf=a=[];for(b in Wh)a[Wh[b]]=new Hh}u(Xk,N);t("H.map.provider.ObjectProvider",Xk);Xk.prototype.kr=Ve;Xk.prototype.providesByViewport=Xk.prototype.kr;Xk.prototype.Hc=function(a){return this.Qf[a||Wh.ANY]};Xk.prototype.getInvalidations=Xk.prototype.Hc;Xk.prototype.Dh=function(a,b){if(b!==Ih.NONE){var c=this.Qf[Wh.ANY];var d=c.Jd+1;c.update(d,b);c=this.Qf[a.type];c.update(d,b);a.Hc().update(d,b);this.kb(a)}};
Xk.prototype.invalidateObject=Xk.prototype.Dh;Xk.prototype.requestOverlays=Xk.prototype.rg;Xk.prototype.requestSpatials=Xk.prototype.Jn;Xk.prototype.requestSpatialsByTile=Xk.prototype.Kn;Xk.prototype.mw=!1;Xk.prototype.requestMarkers=Xk.prototype.le;Xk.prototype.requestDomMarkers=Xk.prototype.ke;function P(a){a=a||{};P.g.constructor.call(this,a);this.vg=a=new Q({min:a.min,max:a.max});a.D=this;a.fa(this);a.sa(Ih.ADD);this.fk=new Mc;this.ti=new Mc;this.Vj=new Wk;this.$j=new Mc;this.Ul=new Wk;this.Sm=new Mc}u(P,Xk);t("H.map.provider.LocalObjectProvider",P);P.prototype.getCapabilities=function(){return hh.PROVIDES_BY_VIEWPORT|hh.PROVIDES_WEBGL_RENDERABLE_OBJECTS|hh.PROVIDES_DOM_MARKERS|hh.CROP_LINES_BY_TILE};
P.prototype.nb=function(){if(!this.Qi&&(this.Qi=P.g.nb.call(this),this.Qi instanceof Zg)){var a=new mh(this.getCapabilities()|hh.HAS_VOLATILE_DATA,this.uid+"_vol",this.min,this.max,this.Oc,this.tileSize);this.Qi.Wj(a.Fe())}return this.Qi};P.prototype.getStyleInternal=P.prototype.nb;P.prototype.Ya=function(a,b){P.g.Ya.call(this,a,b);this.Qi=null};P.prototype.setStyleInternal=P.prototype.Ya;P.prototype.pd=function(){return this.vg};P.prototype.getRootGroup=P.prototype.pd;
P.prototype.Dh=function(a,b){b&Ih.SPATIAL&&this.$(a);P.g.Dh.call(this,a,b)};P.prototype.invalidateObject=P.prototype.Dh;P.prototype.$=function(a){var b;C(a,O,this.$,0);if(a.D!==this)throw new Ab(this.$,"foreign object");this.Na(a);var c=a.type;if(c===Wh.MARKER)if((b=a.W())instanceof pc){var d=!0;c=this.Vj}else c=this.$j;else c===Wh.DOM_MARKER?(b=a.W())instanceof pc?(d=!0,c=this.Ul):c=this.Sm:c=c===Wh.OVERLAY?this.fk:this.ti;d=d?c.Wd(b):c.Fu(a.C());d.ys=a;a.ws=d};
P.prototype.Na=function(a){var b;if(a)if(a.D!==this){if(C(a,O))throw new Ab(this.Na,"foreign object");}else if(b=a.ws){var c=a.type;c===Wh.MARKER?this.Vj.remove(b)||this.$j.remove(b):c===Wh.DOM_MARKER?this.Ul.remove(b)||this.Sm.remove(b):c===Wh.OVERLAY?this.fk.remove(b):this.ti.remove(b);delete b.ys;delete a.ws}};P.prototype.removeObject=P.prototype.Na;
function Yk(a,b,c,d,e,f,g){g=g||[];if(b.jc)for(a=b!==a.Vj&&b!==a.$j,e=!e,b=b.ym(c,f,f),c=b.length,f=0;f<c;f++){var h=b[f].ys;var k;if(k=void 0!==d){for(var l=Fb(d),n=h;(k=n.zb<=l&&n.Nc>=l)&&(n=n.Ma););k=!k}k||!e&&!h.Td(!0)||(a||1===h.kc().getState())&&g.push(h)}return g}P.prototype.mr=function(){return 0<this.fk.jc};P.prototype.providesOverlays=P.prototype.mr;P.prototype.rg=function(a,b,c){return Yk(this,this.fk,a,b,c,!1).filter(function(d){return d.Oe()})};P.prototype.requestOverlays=P.prototype.rg;
P.prototype.ie=function(){return 0<this.ti.jc};P.prototype.providesSpatials=P.prototype.ie;P.prototype.Jn=function(a,b,c){return Yk(this,this.ti,a,b,c,!1)};P.prototype.requestSpatials=P.prototype.Jn;P.prototype.Kn=function(a,b){return Yk(this,this.ti,a.gm(),a.zL,b,!1)};P.prototype.requestSpatialsByTile=P.prototype.Kn;P.prototype.Sc=function(){return 0<this.Vj.jc+this.$j.jc};P.prototype.providesMarkers=P.prototype.Sc;P.prototype.le=function(a,b,c){return Zk(this,a,b,c,!1)};
P.prototype.requestMarkers=P.prototype.le;function Zk(a,b,c,d,e){var f=Yk(a,a.Vj,b,c,d,e);Yk(a,a.$j,b,c,d,e,f);return f}P.prototype.Rc=function(){return 0<this.Ul.jc+this.Sm.jc};P.prototype.providesDomMarkers=P.prototype.Rc;P.prototype.ke=function(a,b,c){return $k(this,a,b,c,!1)};P.prototype.requestDomMarkers=P.prototype.ke;function $k(a,b,c,d,e){var f=Yk(a,a.Ul,b,c,d,e);Yk(a,a.Sm,b,c,d,e,f);return f}
function al(a,b,c){var d=c.W(),e,f=bl.bind(null,a);a=cl.bind(null,a);C(c,xi)?e=C(d,K)?f(d):d.ia.some(f):C(c,Bi)?e=C(d,M)?a(d):d.ia.some(a):C(c,Ai)&&(e=a(Bf(d)));e&&b.push(c)}function bl(a,b){a:{var c=b.T;var d=Gf(a,b);if(!d){b=b.T.length;for(var e=0;e<b;e+=3)if(Ef(a,c[e],c[e+1])){a=!0;break a}}a=d}return a}function cl(a,b){return Hf(a,b)}
function dl(a,b,c){for(var d=a.length;d--;){var e=a[d],f=e.W();if(C(f,Lf)){f=f.ia;for(var g=f.length,h;g--;)if(h=f[g],Ef(b,h.lat,h.lng)){c.push(e);break}}else Ef(b,f.lat,f.lng)&&c.push(e)}}
P.prototype.cb=function(a,b,c,d,e){var f=this,g=a.C(),h=[],k=Dd(),l=1;if(g)for(;l&Wh.ANY;){if(l&d)switch(l){case Wh.MARKER:k=k.then(function(){return Zk(f,g,c,b,!0)}).then(function(n){return dl(n,a,h)});break;case Wh.DOM_MARKER:k=k.then(function(){return $k(f,g,c,b,!0)}).then(function(n){return dl(n,a,h)});break;case Wh.SPATIAL:k=k.then(function(){return Yk(f,f.ti,g,c,b,!0)}).then(function(n){n.forEach(al.bind(null,a,h))});break;case Wh.OVERLAY:k=k.then(function(){return Yk(f,f.fk,g,c,b,!0)}).then(function(n){n.forEach(al.bind(null,
a,h))})}l<<=1}k.then(function(){return e(h)})};P.prototype.If=function(a,b,c){c=c||Ze;var d=c.zoom,e=c.visiblesOnly;c=c.types;var f=Wh.ANY;C(a,M,this.If,0,"area");gb(b,"Function",this.If,1,"callback");gb(d,"Number",this.If,2,"options");this.cb(a,db(e)?!!e:!0,d,db(c)?c&f:f,b)};P.prototype.getObjectsWithin=P.prototype.If;P.prototype.i=function(){P.g.i.call(this);this.vg.ja()};function el(){this.constructor=this.constructor;if(!jb("STATIC_DB"))throw new D(this.constructor,0);this.Du=fl();if(!this.Du)throw new Ab(this.constructor,"This browser does not support IndexedDB");this.zB="STATIC_DB";this.cf=[];this.Uh=[];this.Vq=A(this.Vq,this)}var gl,hl;m=el.prototype;m.put=function(a,b,c,d){if(!jb(a)&&!ob(a))throw new D(this.put,0);if(!il(b))throw new D(this.put,1);jl(this,function(e){kl(e.put(b,a),c,d)},d)};
m.get=function(a,b,c){var d;if(!jb(a)&&!ob(a))throw new D(this.get,0);if(!ab(b))throw new D(this.get,1);jl(this,function(e){d=e.get(a);kl(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=Xe)}}};m.remove=function(a,b,c){if(!jb(a)&&!ob(a))throw new D(this.remove,0);jl(this,function(d){kl(d["delete"](a),b,c)},c)};m.clear=function(a,b){jl(this,function(c){kl(c.clear(),a,b)},b)};m.ol="data";m.Hx=500;m.Vq=function(){var a=this.hg.result;a.objectStoreNames.contains(this.ol)||a.createObjectStore(this.ol)};
function ll(a,b,c){if(a.hg)a.cf?(a.cf.push(b),c&&a.Uh.push(c)):a.ln?c&&c(a.ln):b(a.hg.result);else{a.hg=a.Du.open("H_"+a.zB,1);a.hg.onupgradeneeded=a.Vq;var d=a.hg.onerror=function(){clearTimeout(a.Nv);a.ln=this.error;a.Uh.forEach(function(e){e(a.ln)});delete a.cf;delete a.Uh};a.Nv=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},a.Hx);a.hg.onsuccess=function(){clearTimeout(a.Nv);a.cf?(a.cf.forEach(function(e){e(this.result)},this),delete a.cf,delete a.Uh):(delete a.hg,delete a.ln,
a.cf=[],a.Uh=[])};a.cf.push(b);c&&a.Uh.push(c)}}function jl(a,b,c){ll(a,function(d){d=d.transaction([a.ol],"readwrite");b(d.objectStore(a.ol))},c)}function kl(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}function il(a){var b=Object.prototype.toString.call(a);return"[object Blob]"===b||"[object ArrayBuffer]"===b||jb(a)||ya(a)}function ml(){gl||(gl=new el);return gl}t("H.util.IndexedDBStorage.getInstance",ml);
function fl(){return x.indexedDB||x.webkitIndexedDB||x.mozIndexedDB||x.msIndexedDB}function nl(){var a="";if(!db(hl))if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)hl=!1;else{try{var b=fl();a="H_TEST_DB";var c=b&&b.open(a,1)}catch(d){}hl=!!c&&null===c.onupgradeneeded;c&&b.deleteDatabase&&b.deleteDatabase(a)}return hl}t("H.util.IndexedDBStorage.isSupported",nl);function R(a){eb(this,R);R.g.constructor.call(this,a);this.dD=new ol;this.cc=A(this.cc,this);this.ft=pl;this.createTileInternal=this.ld.bind(this)}u(R,fj);t("H.map.provider.RemoteTileProvider",R);R.prototype.zz=function(){return 1};R.prototype.getEntryWeight=R.prototype.zz;var pl,ql=screen.width,rl=screen.height,sl=Ie();sl=Db(sl,1);var tl=Gb(ql*sl*rl*sl/1E6);pl=new ij(Kb(2,Db(8,Cb(12,7+tl))));var ul={},vl={};R.prototype.Rb=function(){return this.ft};R.prototype.getCache=R.prototype.Rb;
R.prototype.Un=ba(3);R.prototype.cc=function(a){var b=this.uri;return!a.indexOf(b)&&"_"===a.charAt(b.length)};R.prototype.cacheFilter=R.prototype.cc;R.prototype.QA=function(a,b){b.valid=!1};R.prototype.reload=function(a){var b=this.getCache();a?b.ja(this.cc):b.forEach(this.QA,this,this.cc);wl(this);this.kb(this,{isReload:!0})};R.prototype.reload=R.prototype.reload;R.prototype.Ri=function(){return!1};R.prototype.MAX_STORE_TIME=Infinity;R.prototype.qd=function(){return this.dD};
R.prototype.hw=function(a,b){b(a)};function Xj(a,b,c,d,e,f){d=~~d;return a.requestInternal(b,c,d,function(g,h){a.qd().put(a.Sd(b,c,d),{raw:h&&h.raw||g,timestamp:x.Date.now()},e,f)},f,0)}R.prototype.requestInternal=R.prototype.s;
R.prototype.Oa=function(a,b,c,d){var e=this;var f=this.getCache();if(E(a=+a))throw new D(this.Oa,0,a);if(E(b=+b))throw new D(this.Oa,0,b);if(E(c=+c))throw new D(this.Oa,0,c);c=~~c;var g=this.getTileKey(a,b,c);f=f.get(g);f&&f.valid||d||ul[g]||(f=B,this.requestTileAsPromise(a,b,c,d).then(function(h){e.kb(h)},Xe));return f};R.prototype.requestTile=R.prototype.Oa;
R.prototype.zw=function(a,b,c,d){var e=this,f=this.getCache(),g=this.getTileKey(a,b,c),h,k,l=this.qd();if(vl[g])return vl[g];vl[g]=h=new ud(function(n,p){function q(r){var v=0,w;var y=function(I,G){w=e.createTileInternal(a,b,c,I,G);w.key=g;f.add(g,w,1);n(w);xl(g)};r&&(v=x.Date.now()-r.timestamp);r&&v<e.MAX_STORE_TIME?e.hw(r.raw,y):(0<v&&l.remove(g),(w=f.get(g))&&w.valid||d?n(w||null):ul[g]=e.requestInternal(a,b,c,y,p))}k=l.get(g,q,q)});ul[g]||(ul[g]=k);h.then(function(){xl(g)},function(){xl(g)});
return h};R.prototype.requestTileAsPromise=R.prototype.zw;R.prototype.yw=function(a,b){var c=this,d=a.id,e=a.tile.coords;return new ud(function(f,g){c.zw(e.x,e.y,e.z,b).then(function(h){var k=z;h=h.cb?h.cb():h.data;for(var l=h.length,n;l--;)if(n=h[l],n.xb()===d){k=n;break}f(k)},g)})};R.prototype.requestObjectAsPromise=R.prototype.yw;function xl(a){delete ul[a];delete vl[a]}function wl(a){for(var b in ul)a.cc(b)&&a.cancelTileByKey(b)}var yl={cancel:Xe};
R.prototype.ld=function(a,b,c,d){return new qj(a,b,c,d)};R.prototype.createTileInternal=R.prototype.ld;R.prototype.Ti=function(a){var b=ul[a];b&&(b.cancel(),xl(a))};R.prototype.cancelTileByKey=R.prototype.Ti;R.prototype.Kd=function(a,b,c){this.cancelTileByKey(this.getTileKey(a,b,c))};R.prototype.cancelTile=R.prototype.Kd;R.prototype.i=function(){R.g.i.call(this);this.getCache().ja(this.cc);wl(this)};function ol(){}R.NullStorage=ol;ol.prototype.get=function(a,b){b();return yl};ol.prototype.get=ol.prototype.get;
ol.prototype.put=function(a,b,c){c&&c()};ol.prototype.put=ol.prototype.put;ol.prototype.clear=function(a){a&&a()};ol.prototype.clear=ol.prototype.clear;ol.prototype.remove=function(a,b){b&&b()};ol.prototype.remove=ol.prototype.remove;function zl(a){this.yb=a}u(zl,Zd);zl.prototype.Sb=function(){return this.yb};zl.prototype.getLayer=zl.prototype.Sb;zl.prototype.tA=function(){return this.Ob};zl.prototype.getSurface=zl.prototype.tA;zl.prototype.nf=function(a){var b=this.Ob;a!==b&&(this.Ob=a,a.On(),b&&b.release())};zl.prototype.setSurface=zl.prototype.nf;zl.prototype.i=function(){this.Ob.release()};zl.prototype.disposeInternal=zl.prototype.i;zl.prototype.Ah=function(){};zl.prototype.render=zl.prototype.N;function Al(a,b){Al.g.constructor.call(this,a);this.Nd=!(!b||!b.Nd);this.Cq={}}u(Al,zl);Al.prototype.nf=function(a){Al.g.nf.call(this,a);this.dC=a.jd.ownerDocument};Al.prototype.setSurface=Al.prototype.nf;var Bl=function(a,b){b=b.W();return C(b,If)?b.ia:(a[0]=b,a)}.bind(null,[]);
Al.prototype.N=function(a,b,c,d,e,f,g){var h=this.yb,k,l,n,p;this.jC=b=this.Cq;this.Cq=c={};if(d>=h.min&&d<=h.max){var q=this.Tt(a,d,e,f);var r=q.markers;if(a=r.length){d=[];e=this.Ob;for(f=0;f<a;f++){h=r[f];var v=Bl(h);for(k=v.length;k--;)if(l=g(v[k]))(p=b[n=h.xb()+"_"+k])?delete b[n]:p={nv:h},c[n]=p,d.push([p,h,h.kc(),e,l.x,l.y])}d.sort(Cl);a=d.length;for(f=0;f<a;f++)this.ww.apply(this,d[f])}}return!q||q.requested&&q.requested===q.total||!q.requested&&r.length===q.total?Ni.DONE:Ni.PENDING};
Al.prototype.render=Al.prototype.N;function Cl(a,b){var c=a[1].Re(),d=b[1].Re();return Xh(c,d,!0)||a[5]-b[5]||Xh(c,d,!1)}Al.prototype.La=function(){};Al.prototype.getObjectsAt=Al.prototype.La;function Dl(a,b){Dl.g.constructor.apply(this,arguments);this.Bq=0;this.Ph=[];this.np=A(this.np,this)}u(Dl,Al);t("H.map.render.dom.MarkerRenderer",Dl);Dl.prototype.Tt=function(){return this.yb.ke.apply(this.yb,arguments)};Dl.prototype.N=function(a,b,c,d,e,f,g){this.np();this.AB=0;var h=Dl.g.N.apply(this,arguments);var k=this.Ob,l=this.jC,n;for(n in l)El(this,k,l[n]);return 0===this.Ph.length&&h?Ni.DONE:Ni.PENDING};Dl.prototype.render=Dl.prototype.N;
Dl.prototype.nf=function(a){Dl.g.nf.call(this,a);this.oa=a.mb()};Dl.prototype.setSurface=Dl.prototype.nf;Dl.prototype.np=function(){for(var a=this.Ph.length,b,c,d;a--;)d=this.Ph[a],b=d.po,c=b.kc(),c.Jq(d,c,b);this.Ph.length=0};
Dl.prototype.ww=function(a,b,c,d,e,f){var g;var h=d.mb();var k=b.Hc();e*=h;f*=h;this.Nd||(e=Eb(e),f=Eb(f));a.detail&&(k.Gh(a.PA)?El(this,d,a):g=a.detail);g||(a.detail=g=c.au(this.dC),this.Bq++,ab(c.Jq)&&this.Ph.push(g));a.PA=k.Jd;g.style.zIndex=this.AB++;g.po=b;d.Me(g,e,f,0,0)};var Fl,Gl="pointer-events",Hl;if(Pe){var Il;Pe&&Ka!==z&&(Ka=(Il=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+Il[2]:z);Hl=Ka;9===Hl?Gl="display":10===Hl&&(Gl="visibility")}Fl=Gl;
Dl.prototype.La=function(a,b,c){var d=this.oa,e=Ye,f,g,h,k,l;if(this.Bq){a/=d;b/=d;d=this.Ob.jd.getRootNode();var n=d.documentElement;var p=this.Ob.F();var q=p.getBoundingClientRect();a+=q.left;for(b+=q.top;(g=h=d.elementFromPoint(a,b))&&g!==p&&g!==n&&g!==d.host&&h!==r;){for(;(k=g.parentNode)&&(!ab(k.contains)||!k.contains(p));)g=k;if(k===p&&(g!==h||"svg"!==g.nodeName)&&0>e.indexOf(l=g.po)&&(e===Ye&&(e=[]),e.push(l),c))break;f||(f=[]);var r=g.style;f.push({st:r.getPropertyValue(Fl),KA:r.getPropertyPriority(Fl),
style:r});r.setProperty(Fl,"visibility"===Fl?"hidden":"none","important");r=h}if(f)for(b=f.length;b--;)a=f[b],a.style.removeProperty(Fl),jb(a.st)&&a.style.setProperty(Fl,a.st,a.KA)}return e};Dl.prototype.getObjectsAt=Dl.prototype.La;Dl.prototype.Ah=function(){return"dom"};function El(a,b,c){b.clear(b=c.detail);delete b.po;a.Bq--;c=(a=c.nv).kc();c.Nq&&c.Nq(b,c,a)}Dl.prototype.i=function(){this.Ph.length=0;var a=this.Ob,b=this.Cq,c;for(c in b)El(this,a,b[c]);this.Ob.u();Dl.g.i.call(this)};
Dl.prototype.disposeInternal=Dl.prototype.i;var Jl={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:xk.ZOOM,COORD:xk.COORD},capture:!0};t("H.map.render.webgl.capabilities",Jl);function Kl(a){Kl.g.constructor.call(this,a);a&&(this.wk={crossOrigin:a.crossOrigin||"anonymous",headers:a.headers||{}},this.Qp=a.getURL);if(Ll(this)){var b=a&&a.style&&a.style instanceof H.map.render.harp.Style?a.style:new H.map.render.harp.Style({styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]});this.Ya(b)}if(!ab(this.Qp))throw new D(Kl,0,"getURL");this.zg(a.opacity);this.pl=x.URL||x.webkitURL;a=this.wk.crossOrigin;if(!(a="anonymous"===a||"use-credentials"===a)){a=this.Qp(0,0,0);b=window.location;
var c=document.createElement("a");c.href=a;a=c.hostname===b.hostname&&c.port===b.port&&c.protocol===b.protocol}(this.Ww=a&&!!Ug.arraybuffer&&!!this.pl)&&this.Rb().ci(A(this.fe,this))}u(Kl,R);t("H.map.provider.ImageTileProvider",Kl);function Ll(a){return!!H.map.render.harp&&a.vb===ph.HARP}Kl.prototype.Cd=function(a){this.zg(a)};Kl.prototype.setOpacity=Kl.prototype.Cd;Kl.prototype.Qe=function(){return this.Oc};Kl.prototype.getOpacity=Kl.prototype.Qe;Kl.prototype.nk=Ve;
Kl.prototype.providesRasters=Kl.prototype.nk;Kl.prototype.s=function(a,b,c,d,e,f){var g=this,h=this.Qp(a,b,c),k;a=yl;if(h){var l=x.setTimeout(function(){g.Ww?(k=new Tg("arraybuffer",h,f,g.wk),k.then(function(n){return n.blob()}).then(function(n){var p=new Image;p.onload=A(d,null,p,{raw:n});p.onerror=A(e,null,"bad url");try{p.src=g.pl.createObjectURL(n)}catch(q){}},e)):(k=new Tg("image",h,f,g.wk),k.then(d,e))},150);a={cancel:function(){k?k.cancel():x.clearTimeout(l)}}}else d(null);return a};
Kl.prototype.requestInternal=Kl.prototype.s;Kl.prototype.hw=function(a,b){var c=new Image;c.onload=function(){b(this)};c.src=this.pl.createObjectURL(a)};Kl.prototype.fe=function(a,b){(a=b.data)&&a instanceof HTMLImageElement&&this.pl.revokeObjectURL(a.src)};Kl.prototype.L=function(){return this.nb()};Kl.prototype.getStyle=Kl.prototype.L;Kl.prototype.Bb=function(a){Ll(this)&&a instanceof H.map.render.harp.Style&&this.Ya(a)};Kl.prototype.setStyle=Kl.prototype.Bb;function Ml(a){var b,c=this,d=x.H.gl;Ml.g.constructor.call(this);this.m=b=d.Scene.create(x.URL.createObjectURL(ef(JSON.stringify(Nl))),{viewport:a.viewport,container:a.jd,disableRenderLoop:!0,devicePixelRatio:a.devicePixelRatio,logLevel:"error"});a.QB&&b.subscribe({load:a.QB});b.subscribe({view_complete:function(){c.Er=!0;a.Iv()}});var e=b.requestRedraw;b.requestRedraw=function(){e.apply(b);a.Iv()};this.Fr=A(this.Fr,this);this.Gn=A(this.Gn,this);this.ns=0;this.Oh={};this.Ed={}}u(Ml,Zd);m=Ml.prototype;
m.Er=!1;function Ol(a){a=a.m.sources;var b;for(b in a){var c=a[b];if(c.hasPendingCommands&&c.hasPendingCommands())return!0}return x.H.gl.Task.hasPendingTasks()}m.N=function(){var a=x.H.gl.Task;this.m.immediateRedraw();a.setState({user_moving_view:this.m.view.user_input_active});a.processAll();return this.Er&&!this.m.dirty&&!this.m.building&&!Ol(this)&&!Object.keys(this.Ed).length};function Pl(a){a.Er=!1;a.m.resetViewComplete()}function Ql(a){return a.m.view}
function Rl(a,b){function c(){var e=b.Ta(),f={},g={},h,k,l,n=++a.ns,p,q;pg(g,Nl);for(k=0;k<e.length;k++){var r=e[k];if(h=r.D){var v=h.nb();if(v.getState()===lg.READY){var w=v.Pd();if(!Qa(w)){delete w.cameras;delete w.camera;f[k]=w=Bg(w,k);!C(r,Pj)&&w.sources&&Cg(w,h.uid);for(l in w.sources){var y=w.sources[l];y.max_zoom=Cb(h.max,Jl.lookAt.zoom.max);y.max_display_zoom=r.max;y.min_display_zoom=r.min;if(q=h.tileSize)2<=d&&256<q&&h instanceof Kl&&(q/=2),y.tile_size=q}(p=v.Fc())&&Dg(w,p);pg(g,w)}}}}pg(g.layers.skybox.draw.skybox.color,
g.scene.sky);a.m.config=g;return a.m.updateConfig().then(function(){var I={},G,S;if(n!==a.ns)return!1;a.ns=0;for(S in f){r=e[+S];var X=f[S].sources;for(G in X)if(X=a.m.sources[G])I[G]=X,X.initialize&&r.getProvider()&&X.initialize(r.getProvider(),a.Fr,a.m.getWorkers().length,X.tiled?B:a.m.tile_manager.getWorkerForTile(z,X))}for(G in a.Oh)!I[G]&&a.Oh[G].dispose&&a.Oh[G].dispose();a.Oh=I;return!0})}var d=a.m.pixelRatio();a.m.initialized?c():a.m.load(z,{blocking:!1}).then(c)}
m.Fr=function(a,b,c){var d=this,e=this.m.sources[a],f=c&&c.isReload;b?!0!==this.Ed[a]&&(this.Ed[a]||(this.Ed[a]={jx:{},et:[]}),C(b,qj)?this.Ed[a].jx[b.x+"/"+b.y+"/"+b.z]=!0:(b=b.boundingBox,this.Ed[a].et.push(new F(b[0],b[1],b[2],b[3])))):this.Ed[a]=!0;e&&e.has_volatile_data?Sl(this,f):(x.clearTimeout(this.tw),this.tw=x.setTimeout(function(){return Sl(d,f)},100))};
m.Gn=function(a){var b=!1,c=this.Ed[a.source.name],d=x.H.gl;if(c)if(!0===c)b=!0;else{var e=d.Tile.coord(d.Geo.wrapTile(a.coords));b=!!c.jx[e.key];if(!b){var f=d.Geo.getTileBoundingBox(e,a.source.tile_size,di.MAX_LINE_WIDTH/2);f=Ic(f.getTopLeft(),f.getBottomRight());b=c.et.some(function(g){return g.Pf(f,!0)||f.zf(g.wb(),!0)})}}return b};function Sl(a,b){var c=a.m.tile_manager;c.removeTiles(a.Gn);c.updateTilesForView();b&&c.removeCachedTiles(a.Gn);Pl(a);a.Ed={}}m.Pd=function(){return this.m.config};
function Tl(a,b,c,d){a.m.getFeatureAt(b,c,d);a.m.update()}function Ul(a){return a.m.screenshot(void 0).then(function(b){return new ud(function(c,d){new Kh(URL.createObjectURL(b.blob),function(e,f){1===e?c(f.getData()):d()},!1)})})}m.mb=function(){return this.m.pixelRatio()};m.i=function(){var a=this.Oh;Ml.g.i.call(this);this.m.destroy();this.Ed={};a&&Object.keys(a).forEach(function(b){a[b].dispose()});x.clearTimeout(this.tw);delete this.Oh;delete this.m};Ml.prototype.disposeInternal=Ml.prototype.i;
var Nl={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}};function Vl(a,b){if(E(this.so=+a))throw new D(Vl,0,a);this.$n=this.mj=0;b&&this.Mw(b)}t("H.util.kinetics.KineticMove",Vl);Vl.prototype.Mw=function(a){this.$n=a;this.mj=this.cu();return this};Vl.prototype.setInitialSpeed=Vl.prototype.Mw;Vl.prototype.cu=function(){return Math.abs(this.$n/this.so)};Vl.prototype.getDuration=Vl.prototype.cu;Vl.prototype.Aj=function(a){return this.$n+this.so*a};Vl.prototype.getCurrentSpeed=Vl.prototype.Aj;Vl.prototype.qz=function(a){return this.$n*a+this.so*a*a/2};
Vl.prototype.getCurrentPath=Vl.prototype.qz;function Wl(a){return a}t("H.util.animation.ease.LINEAR",Wl);t("H.util.animation.ease.EASE_IN_QUAD",function(a){return a*a});function Xl(a){return-a*(a-2)}t("H.util.animation.ease.EASE_OUT_QUAD",Xl);t("H.util.animation.ease.EASE_IN_OUT_QUINT",function(a){a*=2;return 1>a?Kb(a,5)/2:(a-=2,Kb(a,5)/2+1)});function Yl(a){return 1-Math.sqrt(1-a*a)}function Zl(a){return Jb(2*a-a*a)}t("H.util.animation.ease.EASE_OUT_CIRC",Zl);function $l(a){return 1-Math.cos(a*Math.PI/2)}
function am(a){return Math.sin(a*Math.PI/2)};function bm(a,b){this.Wf={tilt:cm(a.tilt,b.tilt),heading:cm(a.heading,b.heading),zoom:b.zoom-a.zoom};var c=this.Xo=sc(a.position),d=b.position;a=d.lat*Yb;var e=c.lat*Yb;c=d.lng*Yb-c.lng*Yb;a=Math.atan2(Mb(c)*Ob(a),Ob(e)*Mb(a)-Mb(e)*Ob(a)*Ob(c));this.gy=(0<=a?a:Wb+a)*Zb;this.gh=this.Xo.lb(b.position);b=this.Wf.zoom;this.xv=0===b?dm:Object.assign({},dm,{zoom:0>b?Zl:Yl,position:0>b?$l:am});this.$u=Object.assign({},{tilt:0,heading:0,zoom:0})}
function cm(a,b){a=b-a;return-180<a&&180>=a?a:180<a?a-360:a+360}var dm={tilt:Wl,heading:Wl,zoom:Wl,position:Wl};function em(a,b){if(E(this.x=+a))throw new D(em,0,a);if(E(this.y=+b))throw new D(em,1,b);}m=em.prototype;m.add=function(a){return new em(this.x+a.x,this.y+a.y)};m.Ht=function(a){if(!C(a,em))throw new D(this.Ht,0,a);a=this.multiply(a);return a.x+a.y};m.multiply=function(a){if(!C(a,em))throw new D(this.multiply,0,a);return new em(this.x*a.x,this.y*a.y)};m.Wa=function(a){return new em(this.x*a,this.y*a)};function fm(a){return Jb(a.Ht(a))}
m.normalize=function(){var a=fm(this);return 0!==a?new em(this.x/a,this.y/a):this};function gm(a){a=a||Ze;this.vB=db(a.uB)?a.uB:3;this.qv=db(a.pB)?a.pB:300;this.wx=db(a.wD)?a.wD:3;this.lD=db(a.kD)?a.kD:50;this.bi=[];this.clear()}t("H.map.render.InteractionUtils",gm);gm.prototype.TA=function(){return this.Fh};gm.prototype.isGestureDetected=gm.prototype.TA;gm.prototype.start=function(a,b){var c=xk.HEADING,d=xk.TILT;this.S&&this.clear();this.Zj=a;this.Cm=!!b;this.S=!0;this.Fh=!(a&(c|d))||a===c||a===d};gm.prototype.start=gm.prototype.start;
gm.prototype.store=function(a,b,c,d,e){var f=!1;if(this.S){a=new hm(a,b,c,d,e);f=a.Lu;this.Rn=this.We;this.We=a;if(this.tj){if(this.rm=!0,f){b=this.Zj;var g=this.Fh;if(!g&&this.rm){e=xk.HEADING;var h=xk.TILT;c=xk.COORD;d=xk.ZOOM;var k=b&(c|h)?this.vh(!0):im;var l=b&d?this.bm(!0):1;var n=b&e?Hb(this.wp(!0)):0;var p=Hb(k.x);var q=Hb(k.y);k=10<p||10<q;p=10<q&&q>3*p;l=.8>l||1.2<l;n=7<n;b&h&&(n||l||k&&!p?jm(this,h):p&&(jm(this,~h>>>0),g=!0));!g&&b&e&&b&(c|d)&&(l||k?(jm(this,e),g=!0):n&&(jm(this,h),g=!0));
this.Fh=g}}}else this.tj=a,f||(this.Fh=!0);this.Cm&&this.bi.push(a)}return f};gm.prototype.store=gm.prototype.store;gm.prototype.clear=function(){this.bi.length=0;this.S=this.Cm=this.rm=this.Fh=!1;this.tj=this.Rn=this.We=void 0};gm.prototype.clear=gm.prototype.clear;gm.prototype.Yd=function(a){return 0<(this.Zj&a)};gm.prototype.isModifierEnabled=gm.prototype.Yd;function jm(a,b){a.Zj^=a.Zj&b}gm.prototype.Em=function(){return this.S};gm.prototype.isRunning=gm.prototype.Em;var im=Ya(new em(0,0));
gm.prototype.Gf=function(){var a;if(this.Cm){var b=this.bi;var c=b.length;var d=0;for(a=new em(0,0);--c&&d<this.wx;)a=a.add(km(b[c-1],b[c])),d++}else a=this.vh();return a.normalize()};gm.prototype.getDirection=gm.prototype.Gf;gm.prototype.mc=function(a){a=a||Gj();var b,c;if(this.Cm){var d=this.bi;var e=this.bi.length;var f=this.bi[e-1];for(c=b=0;--e&&b<this.wx;)c+=fm(km(d[e],d[e-1])),b++;d=c/b}else f=this.We,d=fm(this.vh());return d=d>=this.vB&&a-f.timestamp<=this.lD?d>this.qv?this.qv:d:0};
gm.prototype.getSpeed=gm.prototype.mc;gm.prototype.am=function(){return this.We?lm(this.We):B};gm.prototype.getBifocalCenter=gm.prototype.am;gm.prototype.vh=function(a){return(a=a?this.tj:this.Rn)?km(a,this.We):new em(0,0)};gm.prototype.getMoveVector=gm.prototype.vh;gm.prototype.bm=function(a){var b=1;if(this.rm){var c=this.We;a=a?this.tj:this.Rn;if(a=mm(a))if(c=mm(c))b=c/a}return b};gm.prototype.getBifocalScaling=gm.prototype.bm;
gm.prototype.wp=function(a){if(this.rm){var b=a?this.tj:this.Rn,c=this.We;a=b.kg;var d=c.kg,e=0;a&&d&&(b=b.ge,c=c.ge,e-=Rb(d.y-c.y,d.x-c.x)*Zb-Rb(a.y-b.y,a.x-b.x)*Zb);a=e}else a=0;return a};gm.prototype.getBifocalRotation=gm.prototype.wp;function hm(a,b,c,d,e){this.ge=new L(a,b);c!==B&&(this.kg=new L(c,d),this.Lu=!0);this.timestamp=e!==B?e:Gj()}hm.prototype.Lu=!1;function lm(a){var b=a.ge;return(a=a.kg)?new L(b.x-(b.x-a.x)/2,b.y-(b.y-a.y)/2):B}
function nm(a,b){var c=a.ge;return(a=a.kg)&&a.lb(b)<c.lb(b)?a:c}function km(a,b){var c=a.kg,d=b.kg;d&&c?(b=lm(b),a=lm(a)):c?(b=b.ge,a=nm(a,b)):d?(a=a.ge,b=nm(b,a)):(b=b.ge,a=a.ge);return new em(b.x-a.x,b.y-a.y)}function mm(a){var b=a.kg;return b?a.ge.lb(b):0};function om(){J.call(this);this.reset()}u(om,J);om.prototype.start=function(a,b){this.S&&this.reset();E(a-b)||(this.Pg=+a,this.Qg=+b);this.S=!0};om.prototype.reset=function(){this.S=!1;this.Pg=this.Qg=B;this.Mo=new pm(0,0,0,0,0,0)};om.prototype.Em=function(){return this.S};om.prototype.l={ro:"animationupdate"};function qm(a){qm.g.constructor.call(this,om.prototype.l.ro);this.it=a}u(qm,ie);
om.prototype.set=function(a,b,c,d,e,f){var g=this.Mo;this.S&&(a=new pm(a/1E3,b/1E3,c/1E3,d/1E3,e/1E3,f/1E3),g.ea(a)||(this.Mo=a,this.dispatchEvent(new qm(rm(this)))))};function rm(a){return x.Object.create(a.Mo)}om.prototype.mc=function(){return rm(this).mc()};om.prototype.Gf=function(){var a=rm(this),b=this.mc()||1;return new pm(a.Jb/b,a.Kb/b,a.Lb/b,a.ii,a.ji,a.zk)};om.prototype.i=function(){this.reset();om.g.i.call(this)};
function pm(a,b,c,d,e,f){this.Jb=a;this.Kb=b;this.Lb=c;this.ii=d;this.ji=e;this.zk=f}pm.prototype.mc=function(){return Jb(this.Jb*this.Jb+this.Kb*this.Kb+this.Lb*this.Lb)};pm.prototype.Gf=function(){var a=this.mc()||1;return new pm(this.Jb/a,this.Kb/a,this.Lb/a,this.ii,this.ji,this.zk)};pm.prototype.ea=function(a){var b=a===this;!b&&(b=C(a,pm))&&(b=this.Jb===a.Jb&&this.Kb===a.Kb&&this.Lb===a.Lb&&this.ii===a.ii&&this.ji===a.ji&&this.zk===a.zk);return b};function sm(a,b,c,d,e,f){var g=e||"2d";sm.g.constructor.apply(this,arguments);this.Rl=this.element.getContext(g,f);this.wu="2d"===g;this.dj=g;this.cj=f}u(sm,Mi);m=sm.prototype;m.createElement=function(a){a=a.createElement("canvas");var b=a.style;b.position="absolute";b.top=b.left="0";return a};m.Qw=function(a,b,c,d,e){a.width=Db(c,1);a.height=Db(d,1);b.width=Eb(c/e)+"px";b.height=Eb(d/e)+"px"};m.zg=function(a){this.Rl.globalAlpha=a};m.Me=function(a,b,c,d,e){this.wu&&this.Rl.drawImage(a,b,c,d,e)};
m.getContextAttributes=function(){return this.cj};m.ph=function(){return this.dj};m.clear=function(a){var b,c;this.wu&&(a?this.Rl.clearRect(b=a.left,c=a.top,a.right-b,a.bottom-c):this.element.width=this.size.w)};m.i=function(){var a=this.element;a.width=a.height=0;delete this.Rl;sm.g.i.call(this)};sm.prototype.disposeInternal=sm.prototype.i;function tm(a){var b="dom";tm.g.constructor.call(this,a);C(this.yb,Oi)&&(b="2d"===a.ph()?"2d":"webgl");this.gD=b}u(tm,zl);tm.prototype.N=function(a,b,c,d,e,f,g,h){g=this.yb;var k=this.Ob,l=!(C(k,sm)&&"2d"===k.ph());if(d>=g.min&&d<=g.max)return l&&k.Zb(!0),g.N(k.F(),{boundingBox:a,zoom:d,screenCenter:b,priorityCenter:f,projection:c,cacheOnly:e,size:k.lc(),pixelRatio:k.mb(),cameraMatrix:h});l&&k.Zb(!1);return Ni.DONE};tm.prototype.Ah=function(){return this.gD};function um(a){var b=vm[a];if(!b)if(a in wm)b=vm[a]=a;else{b=xm.length;var c="",d=a.substr(0,1).toUpperCase()+a.substr(1),e="",f=!1;ym&&(e=ym+d,f=e in wm);for(;b--&&!f;)c=xm[b],e=c+d,f=e in wm;f&&(ym=c);if(b=f?e:null)vm[a]=b;else throw Error("Could not find any variant of CSS property ["+a+"]");}return b}t("H.dom.cssPrefixer.prefix",um);var xm=["O","Ms","ms","Moz","Webkit"],vm={},ym="",wm=document.createElement("span").style;function zm(a,b,c,d){zm.g.constructor.apply(this,arguments)}u(zm,Mi);t("H.map.render.dom.Surface",zm);m=zm.prototype;m.ph=function(){return"dom"};m.createElement=function(a){a=a.createElement("DIV");a.style.position="absolute";a.style.pointerEvents="none";return a};m.Qw=function(a,b,c,d){b.width=c+"px";b.height=d+"px"};m.zg=function(a){this.element.style.opacity=a};
m.Me=function(a,b,c){var d=this.ka,e=a.style;e[um("transform")]="matrix(1,0,0,1,"+b/d+","+c/d+")";a.parentNode!==this.element&&(e.position="absolute",this.element.appendChild(a),this.element.style.pointerEvents="auto","auto"===getComputedStyle(a).pointerEvents&&(a.style.pointerEvents="all"),this.element.style.pointerEvents="none")};m.clear=function(a){a?this.element.removeChild(a):this.element.innerHTML=""};function Am(a,b){this.sy=a;this.oa=b}
function Bm(a,b,c){var d=[],e={jd:a.sy,width:b.w,height:b.h,ka:a.oa};for(a=0;a<c.length;a++){b=c[a];var f=b.Ah();var g={};Ta(g,e);var h=b.Ob;switch(f){case "2d":C(b.Sb(),Oi)&&(g.Ro=b.Sb().getContextAttributes());if(f=n&&"2d"===n.ph()){f=g.Ro;var k=n.cj;f=k===f?!0:k&&!f?!k.alpha&&!k.willReadFrequently:f&&!k?!f.alpha&&!f.willReadFrequently:!f.alpha===!f.alpha&&!k.willReadFrequently===!f.willReadFrequently}if(f)var l=!1;else if(h&&!l){var n=h;l=!1}else n=new sm(g.jd,g.width,g.height,g.ka,"2d",g.Ro),
l=!0;break;case "dom":n=h||new zm(g.jd,g.width,g.height,g.ka);l=!h;break;default:n=h||new sm(g.jd,g.width,g.height,g.ka,b.Sb().ph(),g.Ro),l=!h}d[d.length-1]!==n&&(n.pi(d.length),d.push(n));b.nf(n)}return d};function Cm(a,b,c,d,e){if(!ab(a.Hr)||!ab(a.yr))throw new D(Cm,0,a);this.Ys=a;if(!ab(this.sD=b))throw new D(Cm,1,b);if(E(this.mj=+c))throw new D(Cm,2,c);if(!ab(this.Av=d)&&null!=d)throw new D(Cm,3,d);if(!ab(this.It=e)&&null!=e)throw new D(Cm,4,e);this.id=(new Se).next();this.S=!1}t("H.util.animation.Animation",Cm);
Cm.prototype.start=function(){var a=this;this.Qk=Gj();this.S=!0;var b=this.Qk;this.Ys.Hr(function(){if(a.S){var c=Gj(),d=c-a.Qk,e=d/a.mj,f=!1;1<=e&&(e=1,f=!0);a.sD(a.It?a.It(e):e,d,c-b,c);b=c;f&&a.stop()}else a.stop()})};Cm.prototype.start=Cm.prototype.start;Cm.prototype.stop=function(a){this.S=!1;this.Ys.yr();a||this.Av&&this.Av(this)};Cm.prototype.stop=Cm.prototype.stop;Cm.prototype.Em=function(){return this.S};Cm.prototype.isRunning=Cm.prototype.Em;function T(a,b,c,d){var e;T.g.constructor.call(this,a,b,c,d);this.lp=new ij(this.Px);this.Xb=new L(0,0);if(e=d.renderBaseBackground)this.vw=e.lower,this.uw=e.higher;this.oj=!!d.enableSubpixelRendering;this.Fg=Dm;this.na=new gm;this.U=d=new om;this.ag=A(this.ag,this);d.addEventListener(d.l.ro,this.ag);d=a.element;this.pc=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.Tk=new Am(this.pc,this.ka);
this.Nm=b.Ib().position;b=x.H.gl;if(!b)throw new Ab(T,'"H-webgl" module is missing');this.m=new Ml({viewport:this.za,jd:this.pc,devicePixelRatio:this.ka,Iv:A(this.ca,this)});b.WorkerBroker.addTarget("model",dk);this.aq();this.Oq=A(this.Oq,this);this.qg=A(this.qg,this);this.Ka=A(this.Ka,this);c.addEventListener(yh.prototype.l.Hi,this.Oq);this.o=Em;this.zoom=zk(this,this.ze.Tb());this.wc();this.gg()}u(T,uk);t("H.map.render.webgl.RenderEngine",T);T.prototype.Px=100;
T.prototype.Ib=function(){var a=this.Nm;return Ak(this,{position:{cB:a.cB,jB:a.jB},zoom:this.zoom,tilt:this.lx,heading:this.heading})};T.prototype.Oq=function(a){a=(a=a.target.D)&&a.nb();(a&&a.getState())===lg.INIT?a.load():(Pl(this.m),Rl(this.m,this.jb),this.ca())};T.prototype.type=Dk.WEBGL;var Em=2;T.prototype.getState=function(){return this.o};T.prototype.getState=T.prototype.getState;T.prototype.xj=function(a,b){a=b-a;var c=Kb(2,8+this.zoom);return a<c/2?a:a-c*b/Hb(b)};
function Fm(a,b,c){function d(h){return e[h]+cm(e[h],b[h])/2}if(!(c&Zj.POSITION||c&Zj.BOUNDS))return null;var e=Ql(a.m).getLookAtData();c=e.position;var f=b.position,g=b.bounds;if(Ef(e.bounds,f.lat,f.lng,!1)||g&&Ef(g,c.lat,c.lng,!1))return null;c=Gm(a,{tilt:d("tilt"),heading:d("heading"),incline:0,bounds:Jc([c,f])});c.zoom=zk(a,c.zoom-.5);delete c.bounds;return c}T.prototype.hr=!1;function Hm(a,b,c,d){a=a.getCapabilities().lookAt[d];return Hb("zoom"===d?c[d]-b[d]:cm(b[d],c[d]))/(a.max-a.min)||0}
function Im(a,b,c){a=Db(8*Hm(a,b,c,"zoom"),Hm(a,b,c,"heading"),Hm(a,b,c,"tilt")/2);return ec(3E3*a,300,4E3)}
T.prototype.Wq=function(a){var b=this,c=a.newValue,d=a.modifiers,e=Ql(this.m);this.Eg();this.Xb.set(0,0);var f=this.yo(c);qk.forEach(function(n){d&a[n.toUpperCase()]||delete f[n]});if(a.animate){e=Ql(this.m).getLookAtData();var g=Gm(this,f);c=Fm(this,g,d);var h=1;ob(a.animate)&&(h=1/a.animate);var k=function(){return b.hr=!1};delete g.bounds;this.hr=!0;if(c){e=Im(this,e,c);var l=Im(this,c,g);Jm(this,c,e*h,function(){return Jm(b,g,l*h,k)})}else c=Im(this,e,g),Jm(this,g,c*h,k)}else Km(f),e.setLookAtData(f);
Lm(this);Pl(this.m);this.ca()};function Gm(a,b){Km(b);return Ql(a.m).getBestLookAtData(b)}function Km(a){var b=a.bounds;!b||b instanceof M||(a.bounds=Bf(b.C()))}function Mm(a,b,c){Ql(a.m).setLookAtData(b);Pl(a.m);Lm(a);a.ca();c&&setTimeout(c,0)}
function Jm(a,b,c,d){var e=Ql(a.m).getLookAtData(),f=new bm(e,b);0!==f.Wf.tilt+f.Wf.heading+f.Wf.zoom+f.gh?a.Zc(function(g){for(var h in f.Wf)if(0!==f.Wf[h]){var k=f.xv[h](g);e[h]+=f.Wf[h]*(k-f.$u[h]);f.$u[h]=k}0!==f.gh&&(e.position=f.Xo.ho(f.gy,f.gh*f.xv.position(g),!0));return Mm(a,e)},c,function(){return Mm(a,b,d)}):Mm(a,b,d)}T.prototype.Sn=function(){};T.prototype.setAnimationDuration=T.prototype.Sn;T.prototype.up=function(){};T.prototype.getAnimationDuration=T.prototype.up;T.prototype.Tn=function(){};
T.prototype.setAnimationEase=T.prototype.Tn;T.prototype.vp=function(){};T.prototype.getAnimationEase=T.prototype.vp;T.prototype.Mn=function(){};T.prototype.resetAnimationDefaults=T.prototype.Mn;function Nm(a,b){a.lp.ja(function(c,d){return d.Jc()===b})}m=T.prototype;m.Gv=function(a){Nm(this,a.target.D);Pl(this.m);this.ca()};m.dk=function(a,b){T.g.dk.call(this,a,b);Om(b)&&(Pl(this.m),(a=(a=b.D)&&a.nb())&&a.getState()===lg.INIT&&a.load())};
m.Pq=function(a,b,c){var d;this.Rj=Gj();Nm(this,b.D);if(b.requestDomMarkers||C(b,Oi)||C(b,Qi)){var e=this.me.la;for(d=e.length;d--;){var f=e[d];if(f.Sb()===b){e.splice(d,1);f.u();break}}}Om(b)&&Rl(this.m,this.jb);this.Xe=this.jb.Ta();0===a&&(yk(this,b,!1),this.wc());Bm(this.Tk,this.Mf(),this.Jf());this.hi();c||this.ca()};function Om(a){return!(C(a,Qi)||C(a,Oi))}m.aq=function(){var a=this.jb.Ta(),b=0,c=a.length;this.me={Le:[],la:[]};for(this.Xe=a;b<c;b++){var d=a[b];this.dk(b,d);yk(this,d,!0)}this.wc()};
m.Qq=function(){this.wc()};m.wc=function(){T.g.wc.call(this);var a=this.getCapabilities().lookAt.zoom;Ql(this.m).setZoomConstraints(Db(a.min,this.uq),Cb(a.max,this.tq))};m.bq=function(a,b){var c;if(b){a={Nd:this.oj,Ab:this.Ab};b.N?C(b,Oi)?c=new tm(b):C(b,Qi)&&(c=new tm(b)):b.requestDomMarkers&&(c=new Dl(b,a));if(c){this.me.la.push(c);var d=this.jb.Ta();this.me.la.sort(function(e,f){return d.indexOf(e.yb)-d.indexOf(f.yb)});Bm(this.Tk,this.Mf(),this.Jf())}Om(b)&&Rl(this.m,this.jb)}this.Xe=this.jb.Ta()};
m.Jf=function(){return this.me.la.filter(db)};m.Ko=function(){return this.o===Em};m.yo=function(a){var b=a.position;return Ak(this,{zoom:zk(this,a.zoom),position:new pc(b.lat,b.lng),tilt:a.tilt,heading:a.heading,bounds:a.bounds})};function Lm(a){var b=Ql(a.m).getLookAtData();a.zoom=b.zoom;a.Nm=b.position}m.Bs=4.007501668557849E7;function Pm(a,b){b=Ql(a.m).geoToMeters(b);return new L(b.x/a.Bs+.5,1-(b.y/a.Bs+.5))}function Qm(a,b){return b.sub(Pm(a,a.Nm)).scale(Kb(2,8+a.zoom))}m.Ka=function(a){return Ql(this.m).geoToPixel(a)};
T.prototype.geoToScreen=T.prototype.Ka;T.prototype.Xa=function(a,b){return Ql(this.m).xyToGeo(a,b)};T.prototype.screenToGeo=T.prototype.Xa;T.prototype.Qn=function(a,b){a=this.Xa(a,b);b=this.ze.Ib();b.position=a;return b};
function Rm(a,b,c,d,e,f,g,h){var k,l,n=0,p;var q=function(){0===--n&&f(e)};if(h&&h.features)for(n=l=h.features.length,p=0;p<l;p++){var r=h.features[p];var v=r.id;if(k=a.m.m.sources[r.source_name]){var w=k.provider;var y=w.mu();if(y===og.SOURCE){var I=r.source_layer;if("overlays"===I)Sm(a,b,c,d,e,k,r.properties.overlays_config);else if(k=k.getMapObjectById(v))if("markers"!==I)e.push(k);else if(Tm(a,b,c,k))e.push(k);else if(d&&!g){var G=!0;Tl(a.m,{x:b,y:c},{radius:3.5,top_most_only:!1},function(S){Rm(a,
b,c,d,e,f,!0,S)})}n--}else y===og.FEATURE?(I=r.tile.coords,G=w.getFeatureProxy(r.properties,I,function(S){S&&(S.Pw(w),e.push(S));q()}),G||(k=a.lp.get(v),k||(k=new Uh(r),k.fa(w),a.lp.add(v,k,1)),e.push(k),n--)):y===og.PROVIDER&&(G=!0,w.yw(r,!1).then(function(S){S&&(S instanceof ai?Tm(this,b,c,S):1)&&e.push(S);q()},function(){q()},a))}}y&&(G||0!==n)||f(e)}
function Sm(a,b,c,d,e,f,g){var h;a=a.Xa(b,c);for(b=g.length;b--&&(!(h=f.getMapObjectById(g[b].id))||0<=e.indexOf(h)||!h.W().zf(a)||(e.push(h),!d)););}function Tm(a,b,c,d){var e=d.kc(),f=e.tm,g,h=!f;if(f)if(e=e.Cb,b+=e.x,c+=e.y,e=d.W(),C(e,Lf))for(d=e.ia,g=d.length;g--&&!h;)e=a.Ka(d[g]),h=f.um(b-e.x,c-e.y,0)!==gc.NONE;else e=a.Ka(e),h=f.um(b-e.x,c-e.y,0)!==gc.NONE;return h}
T.prototype.La=function(a,b,c,d){var e=this,f=[];f=this.Ip(f,this.me.la,a*this.ka,b*this.ka,c);c&&f.length?d(f):this.m.m.initialized?Tl(this.m,{x:a,y:b},{radius:3.5,top_most_only:c},function(g){Rm(e,a,b,c,f,d,!1,g)}):d(f)};T.prototype.getObjectsAt=T.prototype.La;m=T.prototype;m.Ip=function(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.La&&(a=a.concat(g.La(c,d,e)),a.length&&e)););return a};m.te=z;m.Mf=function(){var a=this.hl[2];return{w:a.right-a.left,h:a.bottom-a.top}};
m.gg=function(){var a=this.me.la.length;vk(this,this.ka);this.Xb.set(0,0);var b=this.Mf();var c=b.w;var d=b.h;for(this.m.m.handleViewportUpdate();a--;){b=this.me.la[a].Ob;var e=b.lc();e.w===c&&e.h===d||b.Kk(c,d)}this.te=new Jh(c,d);Pl(this.m);this.ca()};m.getCapabilities=function(){return Jl};T.prototype.getCapabilities=T.prototype.getCapabilities;m=T.prototype;
m.Bk=function(){this.ta&&this.ta.S||(Ol(this.m)||Gj()-this.Rj<this.Fg)&&!this.je?this.mh||(this.mh=Ej(this.qg)):(this.je&&(this.hi(),this.kj()),this.o=Em)};m.mh=0;m.hi=function(){this.me.Le.length=0};
m.qg=function(){this.mh=0;this.af&&this.af.before();var a=Ql(this.m);var b=a.getLookAtData(!1);var c=a.getLookAtData(!0);a=this.za.center.clone();c=c.bounds.C();var d=this.zoom;var e=this.Xb;var f=this.Xe;var g=f.length;for(this.Fg=Dm;g--;){var h=f[g];C(h,yh)&&h.D&&h.D.lk(c,d)}this.je=this.m.N();this.ze.sb(b);this.je=this.Hn(c,a,d,!1,e,this.me)&&this.je;this.te&&(this.za.sb(this.te),this.te=z);this.ta&&this.ta.S&&this.Ao();this.af&&this.af.after();this.Bk()};
m.Hn=function(a,b,c,d,e,f){var g=f.la.length,h=!0,k;for(k=0;k<g;k++){var l=f.la[k];var n=f.Le;if(l){var p=l.N(a,b,void 0,c,d,e,this.Ka,this.m.m.getCameraMatrix());p===Ni.ACTIVE&&(this.Fg=Infinity);p!==Ni.DONE||n[k]||(this.kj(l.Sb()),n[k]=!0);n[k]||(h=!1)}}return h};m.kj=function(a){this.hr||setTimeout(A(this.dispatchEvent,this,{type:this.l.Qs,target:a||this}),1)};
m.i=function(){var a=this.jb.Ta()[0],b=this.za;Fj(this.mh);this.$c(!0);a&&yk(this,a,!1);this.Jf().forEach(function(c){c.u()});b.element&&b.element.removeChild(this.pc);delete this.pc;this.o=3;this.m.u();T.g.i.call(this)};m.ca=function(){this.Rj=Gj();this.Ko()&&(this.je=!1,this.o=1,this.Bk())};m.xc=function(a,b){this.Ng(a,b);this.Xb.set(0,0);Pl(this.m);this.ca()};m.Ng=function(a,b){Ql(this.m).applyPxOffset([a,b]);Lm(this)};m.Ig=function(a,b,c){a=zk(this,zk(this,a));this.tb(a,b,c)};
T.prototype.zoomAt=T.prototype.Ig;T.prototype.tb=function(a,b,c){Ql(this.m).setLookAtData({zoom:a},ob(b)&&ob(b)?[b,c]:B);Lm(this);Pl(this.m);this.ca()};T.prototype.Eg=function(){this.$c(!0);this.U.S&&this.hc(!0);this.na.S&&this.ic(!0)};T.prototype.Hk=function(a){if(a){var b={};b.kk=a.power;b.nj=a.ease;b.duration=a.duration;this.ua=b}};T.prototype.Gd=function(a,b){var c=!!(b||a&(xk.HEADING|xk.TILT));this.Eg();this.Hk(b);this.na.start(a,c);Ql(this.m).setPanning(!0)};T.prototype.startInteraction=T.prototype.Gd;
T.prototype.td=function(a,b,c,d,e){var f=this.na;var g=!1;if(f.S){var h=Ql(this.m);var k=h.getLookAtData();var l=this.za.center;l=[l.x,l.y];b=f.store(a,b,c,d,e);c=f.am();a=f.vh();d=this.na.bm();e=this.na.wp();f.Fh&&(f.Yd(xk.TILT)&&(h.setLookAtData({tilt:Bk(this,k.tilt+a.y/this.za.height*-180)},l),g=!0),b&&1!==d&&f.Yd(xk.ZOOM)&&(g=f.am(),this.tb(zk(this,Ib(Kb(2,this.zoom)*d)/Sb),g.x,g.y),g=!0),f.Yd(xk.COORD)&&0<fm(a)&&(this.xc(-a.x,-a.y),g=!0),f.Yd(xk.HEADING)&&(b?h.setLookAtData({heading:k.heading+
Ck(this,e)},[c.x,c.y]):a.x&&h.setLookAtData({heading:Ck(this,k.heading+a.x/this.za.width*360)},l),g=!0),g&&(Pl(this.m),this.ca()))}};T.prototype.interaction=T.prototype.td;
T.prototype.ic=function(a){var b=this;if(this.na.S&&!a){if(this.ua){a=this.na.mc();var c=this.na.Gf();var d=this.ua.duration;var e=(this.ua.kk||1)*a;var f=new Vl(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.na.Yd(xk.COORD)&&this.Zc(function(g){e=f.Aj(g*d);E(e)||b.xc(Eb(-c.x*e),Eb(-c.y*e))},d,void 0,this.ua.nj)}delete this.ua;this.na.clear()}Ql(this.m).setPanning(!1);this.ca()};T.prototype.endInteraction=T.prototype.ic;T.prototype.Fd=function(a,b,c){this.Eg();this.U.start(b,c);this.Hk(a);Ql(this.m).setPanning(!0)};
T.prototype.startControl=T.prototype.Fd;T.prototype.control=function(a,b,c,d,e,f){for(var g=0,h;g<arguments.length;g++)if(h=+arguments[g],h!==h)throw new D(this.control,g,h);this.U.S&&this.U.set(a,b,c,d,e,f)};T.prototype.control=T.prototype.control;
T.prototype.hc=function(a,b){var c=this,d;if(this.U.S){this.$c(!0);var e=Gj();var f=e-this.ej;if(1<=f){var g=rm(this.U);this.Mi(g,f)}if(!this.ua||a||b)"function"===typeof b&&(a=Ql(this.m),a=a.getLookAtData(),b(a),this.Bo(a));else{b=this.U.mc();var h=this.U.Gf();var k=this.ua.duration;var l=(this.ua.kk||1)*b;var n=new Vl(-l/(0<k?k:1),l);!E(h.Jb)&&!E(h.Kb)&&0<l&&this.Zc(function(p,q,r,v){e&&(r=v-e,e=0);l=n.Aj(p*k)*r;E(l)||((d=h.Lb*l)&&c.tb(zk(c,c.zoom+d),c.U.Pg,c.U.Qg),c.xc(Eb(h.Jb*l),Eb(h.Kb*l)))},
k,void 0,this.ua.nj)}this.U.reset();Ql(this.m).setPanning(!1);this.ca()}};T.prototype.endControl=T.prototype.hc;m=T.prototype;
m.Bo=function(a){var b=this,c=Qm(this,Pm(this,a.position)),d=c.y;c=c.x;var e=a.zoom,f=Qm(this,Pm(this,this.Nm));a=f.y;var g=f.x;f=this.zoom;var h=this.U.mc(),k=this.U.Pg,l=this.U.Qg,n=0;c=this.xj(g,c);c-=g;d-=a;f=e-f;a=Jb(c*c+d*d+f*f);if(0!==h&&0!==a){var p=c/a;var q=d/a;var r=f/a;var v=h*h/(2*a);this.Zc(function(w,y){var I;if(1!==w){w=h*y-v*y*y/2;y=w-n;if(I=r*y)I=zk(b,b.zoom+I),b.tb(I,k,l);b.xc(Eb(p*y),Eb(q*y));n=w}else b.tb(zk(b,e),k,l),b.ca()},2*a/h)}};
m.ag=function(a){var b=this,c=a.it;this.Xb.set(0,0);c.Jb||c.Kb||c.Lb||c.ii||c.ji||c.zk?(this.ej=Gj(),this.Zc(function(d,e,f,g){b.ej=g;b.Mi(c,f)},$b),this.ca()):this.$c(!0)};m.Mi=function(a,b){b=b||0;var c=this.U,d=Ql(this.m),e=d.getLookAtData();a.Lb&&this.tb(zk(this,e.zoom+a.Lb*b),c.Pg,c.Qg);d.setLookAtData({heading:Ck(this,e.heading+a.ji*b),tilt:Bk(this,e.tilt+a.ii*b)});Lm(this);this.xc(a.Jb*b,a.Kb*b)};m.Zc=function(a,b,c,d){this.ta&&this.ta.S&&this.ta.stop(!0);this.ta=new Cm(this,a,b,c,d);this.ta.start()};
m.$c=function(a){this.ta&&this.ta.S&&this.ta.stop(a)};m.fp=function(){};T.prototype.enter=T.prototype.fp;T.prototype.kp=function(a){wk(this.pc,a)};T.prototype.exit=T.prototype.kp;T.prototype.capture=function(a,b,c,d){var e=this;return Ul(e.m).then(function(f){var g=e.pc.ownerDocument.createElement("canvas"),h=e.ka,k=g.getContext("2d"),l=e.m.mb()/h,n=(c-a)*h;h*=d-b;g.width=n;g.height=h;k.drawImage(f,a*l,b*l,n*l,h*l,0,0,n,h);return g})};T.prototype.cz=function(a){return Ql(this.m).geoToMeters(a)};
T.prototype.geoToMeters=T.prototype.cz;T.prototype.sB=function(a){return Ql(this.m).metersToGeo(a)};T.prototype.metersToGeo=T.prototype.sB;var Dm=5E3;function U(a,b,c){var d={};if(!(a instanceof HTMLElement))throw new D(U,0);U.g.constructor.call(this);this.Fa=Um(c,U);this.xa=c=new ik;this.Aq=!1;c.addEventListener(c.l.Ki,this.Jv,!1,this);if(!C(a,Element))throw new D(U,0,a);c=this.J=a.ownerDocument.createElement("div");var e=c.style;e.position="relative";e.height=c.style.width="100%";e.overflow="hidden";e.webkitTapHighlightColor="transparent";"transparent"!==e.webkitTapHighlightColor&&(e.webkitTapHighlightColor="rgba(0,0,0,0)");a.appendChild(c);
this.pa=new tk(this.J,this.Fa);this.pa.addEventListener(this.pa.l.Ki,this.Jv,!1,this);a=this.P=new dk(this.Fa.layers);a.addEventListener(a.l.Ji,this.Mq,!1,this);a.addEventListener(a.l.Gi,this.Mq,!1,this);a.addEventListener(a.l.Ii,this.Mq,!1,this);!this.rb&&Vm(this);this.qa=null;this.P.add(b,0);this.Ca=this.To(null!=this.Fa.engineType?this.Fa.engineType:oh,this.Fa);this.ep=A(this.ep,this);b=this.Fa.imprint;if(b!==B&&"object"!==typeof b)throw new D(U,1,"imprint");Wm&&(b||(b={}),b.mark=b.mark||"GS (2022) 5659");
this.Vd=null===b?b:new Fk(this,b);b=this.Fa.autoColor;this.dt=b===B||!!b;Xm(this);(b=this.Fa.zoom)&&(d.zoom=b);(b=this.Fa.bounds)&&(d.bounds=b);(b=this.Fa.center)&&(d.position=b);this.xa.Xc(d)}u(U,J);t("H.Map",U);U.prototype.draggable=U.prototype.draggable=!1;function Um(a,b){if(a){var c=a.pixelRatio;if(c===B)a.pixelRatio=Ie();else if(!(0<c))throw new D(b,0,"pixelRatio: "+c);}else a={},a.pixelRatio=Ie();a.renderBaseBackground||(a.renderBaseBackground={lower:3,higher:2});return a}
U.prototype.Rx=333;U.prototype.i=function(){this.dt=!1;this.Vd&&this.Vd.u();this.Ca.dispose();this.xa.u();this.pa.u();this.rb.u();this.qc.u();this.P.u();var a=this.J;a.parentNode.removeChild(a);delete this.J;J.prototype.i.call(this)};U.prototype.F=function(){return this.J};U.prototype.getElement=U.prototype.F;U.prototype.mb=function(){return this.Fa.pixelRatio};U.prototype.getPixelRatio=U.prototype.mb;function Xm(a){a.Vd&&a.dt&&a.Vd.Pr({invert:a.qa&&a.qa.By})}
U.prototype.Mq=function(a){var b=a.added,c=a.removed;b&&b.D&&b.D.fa(this);c&&c.D&&c.D.fa(null);c===this.rb&&(delete this.rb,delete this.qc);c===this.qa&&(this.qa=null);0===a.idx&&(this.dispatchEvent(new nh(this.l.nl,this.qa=a.type!==this.P.l.Ii?b:0<this.P.ba.length?this.P.get(0):z,a.type!==this.P.l.Gi?c:1<this.P.ba.length?this.P.get(1):z)),Xm(this))};
U.prototype.Jv=function(a){a.modifiers&&(this.Aq||(Ym(this,"start"),this.Aq=!0),Ym(this,"",a),this.lv&&x.clearTimeout(this.lv),this.lv=x.setTimeout(this.ep,this.Rx))};function Ym(a,b,c){a.dispatchEvent(c?new Yj(a.l.Js,c.newValue,c.oldValue,c.modifiers):a.l.Js+b)}U.prototype.ep=function(){Ym(this,"end");this.Aq=!1};U.prototype.Vn=function(a,b){this.Ca.getCapabilities().lookAt&&this.xa.Xc({position:a},!!b);return this};U.prototype.setCenter=U.prototype.Vn;
U.prototype.wb=function(){var a=this.xa.Ib();return a?a.position:z};U.prototype.getCenter=U.prototype.wb;U.prototype.Lk=function(a,b){this.xa.Lk(a,!!b);return this};U.prototype.setZoom=U.prototype.Lk;U.prototype.Tb=function(){return this.xa.Tb()};U.prototype.getZoom=U.prototype.Tb;U.prototype.Ig=function(a,b,c){this.Ca.zoomAt(a,b,c)};U.prototype.zoomAt=U.prototype.Ig;U.prototype.DA=function(){return this.pa};U.prototype.getViewPort=U.prototype.DA;U.prototype.CA=function(){return this.xa};
U.prototype.getViewModel=U.prototype.CA;U.prototype.Rz=function(){return this.P};U.prototype.getLayers=U.prototype.Rz;U.prototype.Lz=function(){return this.Vd};U.prototype.getImprint=U.prototype.Lz;
U.prototype.capture=function(a,b,c,d,e,f){function g(G,S){q?G.cancel():(w.save(),S.capture(v,n,function(X){w.restore();G.done(X)},function(X){G.done(null,X);h(null)}))}function h(G){q||(q=!0,a(G))}var k=this.Ca,l=k.getCapabilities(),n=this.Fa.pixelRatio,p=this.pa,q=!1,r=this,v,w;if(!ab(a))throw new D(this.capture,0,a);c=c||0;d=d||0;e=e||p.width;f=f||p.height;var y=Db(0,Cb(c,e));var I=Db(0,Cb(d,f));c=Cb(p.width,Db(c,e));d=Cb(p.height,Db(d,f));l.capture?k.capture(y,I,c,d).then(function(G){var S=r.Vd,
X=b||[];v=G;w=v.getContext("2d");v.style.width=v.width/n+"px";v.style.height=v.height/n+"px";var Ga=new Mj(10,g);X=X.concat(S).filter(function(ha){return ab(ha&&ha.capture)});X.length?(G=X.pop(),X.forEach(function(ha){Ga.push(ha,Xe)}),Ga.push(G,A(h,r,v)),Ga.wn()):h(v)},function(){h(z)}):a(null)};U.prototype.capture=U.prototype.capture;U.prototype.xz=function(){return this.Ca};U.prototype.getEngine=U.prototype.xz;
U.prototype.To=function(a,b){b=b?Um(b,this.To):this.Fa;Xm(this);if(a===ph.P2D)return new x.H.map.render.p2d.RenderEngine(this.pa,this.xa,this.P,b);if(a===ph.WEBGL)return new T(this.pa,this.xa,this.P,b);if(a===ph.HARP)return new x.H.map.render.harp.RenderEngine(this.pa,this.xa,this.P,b);throw new D(this.To,0,a);};
U.prototype.Rk=function(a,b,c,d,e){b=db(b)?C(b,F,this.Rk,1,b)&&b:this.xa.Ib().bounds.C();e=e||this.qa;if(!C(e,Ah))throw new D(this.Rk,4);var f=e.D,g=this.mb(),h=e.tileSize;2<=g&&256<h&&f instanceof Kl&&(h/=2);g=this.Tb();h=Math.log2(h)-8;c=db(c)?+c:g;d=db(d)?+d:g;if(!(c<=d))throw new D(this.Rk,B,"!(min <= max)");g=f.min;var k=f.max,l=this.Ca.type===ph.WEBGL?Fb:Eb;c=ec(l(c)-h,g,k);d=ec(l(d)-h,g,k);if(!(f&&C(f,R)&&nl()&&f.Ri()))throw new Ab(this.Rk,"Storing is not supported");return new Wj(e,f,b,c,
d,a)};U.prototype.storeContent=U.prototype.Rk;function Zm(a){Tj.call(this,a)}u(Zm,Tj);Zm.prototype.$B=function(){Vj(this,2)};Zm.prototype.ZB=function(){Vj(this,4)};U.prototype.py=function(a){a=new Zm(a);ml().clear(A(a.$B,a),A(a.ZB,a));return a};U.prototype.clearContent=U.prototype.py;U.prototype.rl=function(a,b){var c=this.P,d=c.indexOf(a),e=b!==+b;b=e?c.ba.length-1:b;0>d?c.add(a,b):d-b&&(c.Bd(d),c.add(a,e?b-1:b));return this};U.prototype.addLayer=U.prototype.rl;
U.prototype.ei=function(a){var b=this.P.indexOf(a);a!==this.qa&&a!==this.rb&&-1!==b&&this.P.Bd(b);return this};U.prototype.removeLayer=U.prototype.ei;U.prototype.xg=function(a){this.qa!==a&&(this.P.ba.length&&this.P.get(0)!==this.rb?this.P.set(0,a):this.P.add(a,0),this.qa=a);return this};U.prototype.setBaseLayer=U.prototype.xg;U.prototype.iz=function(){return this.qa};U.prototype.getBaseLayer=U.prototype.iz;
U.prototype.Ka=function(a){if(!qc(a))throw new D(this.Ka,0,a);return(a=this.Ca.geoToScreen(a))?of(a):z};U.prototype.geoToScreen=U.prototype.Ka;U.prototype.Xa=function(a,b){var c;if(c=+E(a)||2*+E(b))throw new D(this.Xa,c-1,arguments[c-1]);return(c=this.Ca.screenToGeo(a,b))?sc(c):z};U.prototype.screenToGeo=U.prototype.Xa;U.prototype.Qn=function(a,b){return this.Ca.screenToLookAtData(a,b)};U.prototype.screenToLookAtData=U.prototype.Qn;
U.prototype.$=function(a){if(!C(a,O))throw new D(this.$,0,a);!this.rb&&Vm(this);this.qc.pd().$(a);return a};U.prototype.addObject=U.prototype.$;U.prototype.Na=function(a){if(!C(a,O))throw new D(this.Na,0,a);!this.rb&&Vm(this);this.qc.pd().Na(a);return a};U.prototype.removeObject=U.prototype.Na;U.prototype.cb=function(a){!this.rb&&Vm(this);return this.qc.pd().cb(a)};U.prototype.getObjects=U.prototype.cb;
U.prototype.fd=function(a){var b;ib(a,this.fd,0,a);!this.rb&&Vm(this);var c=a.length;for(b=0;b<c;b++)this.$(a[b]);return this};U.prototype.addObjects=U.prototype.fd;U.prototype.pg=function(a){var b;ib(a,this.pg,0,a);!this.rb&&Vm(this);var c=a.length;for(b=0;b<c;b++)this.Na(a[b]);return this};U.prototype.removeObjects=U.prototype.pg;U.prototype.xh=function(a,b,c){var d;if(d=+E(a)||2*+E(b))throw new D(this.xh,d-1,arguments[d-1]);this.Ca.getObjectsAt(a,b,!0,function(e){c(e[0])})};
U.prototype.getObjectAt=U.prototype.xh;U.prototype.La=function(a,b,c,d){var e;if(e=+E(a)||2*+E(b))throw new D(this.xh,e-1,arguments[e-1]);this.Ca.getObjectsAt(a,b,!1,c,!!d)};U.prototype.getObjectsAt=U.prototype.La;U.prototype.If=function(a,b,c){c=c||{};var d=c.zoom;c.zoom=db(d)?d:this.xa.Tb();this.qc.If(a,b,c)};U.prototype.getObjectsWithin=U.prototype.If;function Vm(a){a.qc=new P({max:24,engineType:a.Fa.engineType});a.rb=new Pj(a.qc,a.Fa);a.P.add(a.rb)}
var $m=Dk.HARP,ph={P2D:Dk.P2D,WEBGL:Dk.WEBGL,HARP:$m};U.EngineType=ph;U.prototype.l={FD:"mapviewchangestart",Js:"mapviewchange",Ks:"mapviewchangeend",nl:"baselayerchange"};function an(a,b,c,d){if(!a||!b||!c)throw new D(an,B,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Ta(this,d)}t("H.util.BuildInfo",an);an.prototype.toString=function(){var a,b=[];for(a in this)jb(this[a])&&b.push(this[a]);return b.join(";")};var bn={};function cn(a,b,c,d){if(!a)throw new D(cn,1,"Must specify a name parameter");return bn[a]||(bn[a]=new an(a,b,c,d))}an.get=cn;function dn(){return cn("H-core","1.54.1","17144d2",{region:"row"})}t("H.buildInfo",dn);var Wm="cn"===dn().region,oh=ph[Wm?"HARP":"WEBGL"],en,fn="maps".concat("js-"),gn,hn,jn,kn,ln;gn=x.document.querySelector('script[src*="'+fn+'"]');if(!gn)for(hn=x.document.getElementsByTagName("script"),kn=new RegExp("^.*"+fn),ln=0,jn=hn.length;ln<jn;ln++)if(kn.test(hn[ln].src)){gn=hn[ln];break}en=gn?gn.src.replace(/\/[^\/]*$/,"/"):"";t("H.getScriptPath",function(){return en});
function mn(){var a=decodeURIComponent(en);if(a){a="/"===a[a.length-1]?a.substring(0,a.length-1):a;var b=x.document,c="";b?(b=b.createElement("a"),b.href=a,c=b.href):/[\w]+:\/\//.test(a)&&(c=a);a=new URL(c);a.pathname+="/"===a.pathname[a.pathname.length-1]?"styles":"/styles";a=a.toString()}else a="https://js.api.here.com/v3/3.1.54.1/styles";return a}t("H.getStylePath",mn);

function nn(a,b,c,d,e,f){if(isNaN(a))throw Error("x needs to be a number");if(isNaN(b))throw Error("y needs to be a number");if(isNaN(c))throw Error("pointer must have an id");this.viewportX=a;this.viewportY=b;this.target=null;this.id=c;this.type=d;this.dragTarget=null;this.button=db(e)?e:-1;this.buttons=db(f)?f:0;this.Hm=this.button}t("H.mapevents.Pointer",nn);
function on(a,b,c){if(isNaN(b))throw Error("x needs to be a number");if(isNaN(c))throw Error("y needs to be a number");a.viewportX=b;a.viewportY=c}nn.prototype.Oz=function(){return this.Hm};nn.prototype.getLastChangedButton=nn.prototype.Oz;function pn(a,b){a.Hm=b;a.buttons|=qn[+b]||0}function rn(a,b){a.Hm=b;a.buttons&=~(qn[+b]||0)}var qn=[1,4,2],sn={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2};nn.Button=sn;function tn(a){this.Ea=a instanceof Array?a.slice(0):[]}m=tn.prototype;m.clear=function(){this.Ea.splice(0,this.Ea.length)};m.length=function(){return this.Ea.length};m.item=function(a){return this.Ea[a]||null};m.indexOf=function(a){for(var b=this.Ea.length;b--;)if(this.Ea[b].id===a)return b;return-1};function un(a,b){b=a.indexOf(b);return-1!==b?a.Ea[b]:null}m.remove=function(a){a=this.indexOf(a);return-1!==a?this.Ea.splice(a,1)[0]:null};
function vn(a,b){for(var c=a.Ea.length,d=[];c--;)a.Ea[c].type!==b&&d.push(a.Ea[c]);a.Ea=d}function wn(a,b){for(var c=a.Ea.length;c--;)if(a.Ea[c].dragTarget===b)return!0;return!1}m.push=function(a){if(a instanceof nn)return this.Ea.push(a);throw Error("list needs a pointer");};m.Ta=function(){return this.Ea};m.clone=function(){return new tn(this.Ea)};function xn(a,b,c,d,e,f,g){xn.g.constructor.call(this,a);this.pointers=b;this.changedPointers=c;this.targetPointers=d;this.currentPointer=e;this.originalEvent=g;this.target=f}u(xn,ie);t("H.mapevents.Event",xn);function yn(a,b,c){c=c||{};if(!(a instanceof U))throw Error("events: map instance required");if(!(b instanceof Array))throw Error("events: map array required");Zd.call(this);this.$o=c.$o||300;this.ut=c.ut||50;this.ex=c.ex||50;this.fx=c.fx||500;this.yq=c.yq||900;this.xq=c.xq||8;this.map=a;this.za=this.map.pa;this.element=this.za.element;this.ip=b;this.pointers=new tn;this.changedPointers=new tn;this.Tf={};this.Ja=null;this.Xl=!0;this.Dk={};this.mf={};this.Tj=null;this.hj=A(this.hj,this);this.Mt={pointerdown:this.Jy,
pointermove:this.Ky,pointerup:this.Ly,pointercancel:this.Iy};zn(this)}u(yn,Zd);function zn(a,b){var c,d=a.ip.length;for(c=0;c<d;c++){var e=a.ip[c];var f=e.listener;"function"===typeof f&&(b?(e.target||a.element).removeEventListener(e.ab,f):(e.target||a.element).addEventListener(e.ab,f))}}
function An(a,b,c){var d;if("function"===typeof a.Mt[b]){"pointermove"!==b&&(a.Xl=!0);var e=0;for(d=a.changedPointers.length();e<d;e++){var f=a.changedPointers.item(e);a.element.contains(c.composedPath()[0])?Bn(a,f,a.Et.bind(a,c,b,f)):a.Et(c,b,f,null)}}a.changedPointers.clear()}m=yn.prototype;m.Et=function(a,b,c,d){Cn(c.id,this.Dk);this.Mt[b].call(this,c,d,a)};
function Bn(a,b,c){if(a.Ja===b)c(b.target);else{var d=a.za;var e=b.viewportX;b=b.viewportY;if(0>e||0>b||e>=d.width||b>=d.height)c(z);else{var f=a.map;f.xh(e,b,function(g){c(g||f)})}}}
m.Ly=function(a,b,c){var d=a.id;a.target=b;Dn(this,a,c);En(this,b,"pointerup",c,a);"mouse"!==a.type&&En(this,b,"pointerleave",c,a);b=this.Tf[a.id];var e={x:a.viewportX,y:a.viewportY},f=c.timeStamp,g=a.target,h=this.Tj;b&&b.target===g&&b.jk.lb(e)<this.ex&&f-b.ls<this.fx?(En(this,g,"tap",c,a),h&&h.target===g&&f-h.ls<this.$o?h.jk.lb({x:a.viewportX,y:a.viewportY})<this.ut&&(En(this,g,"dbltap",c,a),this.Tj=null):this.Tj={target:g,jk:new L(a.viewportX,a.viewportY),ls:c.timeStamp}):this.Tj=null;this.Tf=
{};Cn(d,this.mf)};function Dn(a,b,c){b===a.Ja&&(En(a,b.dragTarget,"dragend",c,b),a.Ja=null,Cn(b.id,a.Dk));b.dragTarget=null}m.hj=function(a,b){var c=this;En(this,a.dragTarget,"drag",b,a);Cn(a.id,this.Dk);this.Dk[a.id]=setTimeout(function(){c.hj(a,b)},150)};function Cn(a,b){b[a]&&(b[a].timeout?clearTimeout(b[a].timeout):clearTimeout(b[a]),delete b[a])}
function Fn(a,b,c){var d=b.target,e=new L(b.viewportX,b.viewportY),f=b.id;Cn(f,a.mf);var g=setTimeout(function(){d&&d===b.target&&e.lb({x:b.viewportX,y:b.viewportY})<a.xq&&(En(a,d,"longpress",c,b),delete a.Tf[b.id])},a.yq);a.mf[f]={timeout:g,jk:e}}
m.Ky=function(a,b,c){var d=a.dragTarget,e=a.id;var f=a.target;a.target=b;f!==b&&(En(this,f,"pointerleave",c,a),En(this,b,"pointerenter",c,a));d?this.Ja?(this.hj(a,c),this.mf[e]&&this.mf[e].jk.lb({x:a.viewportX,y:a.viewportY})>this.xq&&Cn(e,this.mf)):this.Xl?this.Xl=!1:(this.Ja=a,En(this,d,"dragstart",c,a),this.hj(a,c),delete this.Tf[e],this.Xl=!0):(!this.Ja||this.Ja&&this.Ja.dragTarget!==b&&this.Ja.dragTarget!==this.map)&&En(this,b,"pointermove",c,a)};
m.Jy=function(a,b,c){var d=!(/^(?:mouse|pen)$/.test(a.type)&&0!==c.button);if(b){a.target=b;this.Tf[a.id]={jk:new L(a.viewportX,a.viewportY),target:a.target,ls:c.timeStamp};"mouse"!==a.type&&En(this,b,"pointerenter",c,a);var e=En(this,b,"pointerdown",c,a);!this.Ja&&d&&(b.draggable&&!wn(this.pointers,b)?a.dragTarget=b:!this.map.draggable||e.defaultPrevented||wn(this.pointers,this.map)||(a.dragTarget=this.map));Fn(this,a,c)}};
m.Iy=function(a,b,c){var d=a.id;a.target=null;b?(En(this,b,"pointerleave",c,a),En(this,b,"pointercancel",c,a)):En(this,this.map,"pointercancel",c,a);Dn(this,a,c);this.Tf={};Cn(d,this.mf)};
function En(a,b,c,d,e){if(b&&"function"===typeof b.dispatchEvent){var f=xn;var g=a.pointers.Ta(),h=a.changedPointers.Ta();a=a.pointers;var k,l=a.Ea.length,n=[];for(k=0;k<l;k++)a.Ea[k].target===b&&n.push(a.Ea[k]);f=new f(c,g,h,n,e,b,d);e.button=/^(?:longpress|(?:dbl)?tap|pointer(?:down|up))$/.test(c)?e.Hm:sn.NONE;b.dispatchEvent(f)}return f}
m.i=function(){zn(this,!0);this.pointers.clear();this.changedPointers.clear();var a=this.Dk,b;for(b in a)Cn(b,a);a=this.mf;for(var c in a)Cn(c,a);delete this.element;delete this.ip;delete this.pointers;delete this.changedPointers;delete this.map;this.Tj=null;delete this.Tf;this.Ja=null;Zd.prototype.i.call(this)};function Gn(a){var b=a.ownerDocument;b=b.documentElement||b.body.parentNode||b.body;try{var c=a.getBoundingClientRect()}catch(d){c={top:0,right:0,bottom:0,left:0,height:0,width:0}}return{x:c.left+("number"===typeof window.pageXOffset?window.pageXOffset:b.scrollLeft),y:c.top+("number"===typeof window.pageYOffset?window.pageYOffset:b.scrollTop)}}var Hn=function(){return this}.apply(null);function In(a,b,c,d,e){In.g.constructor.call(this,"wheel");this.delta=a;this.viewportX=b;this.viewportY=c;this.target=d;this.originalEvent=e}u(In,ie);t("H.mapevents.WheelEvent",In);function Jn(a){var b="onwheel"in document;this.Qx=b;this.Ox=(b?"d":"wheelD")+"elta";this.Wp=A(this.Wp,this);Jn.g.constructor.call(this,a,[{ab:(b?"":"mouse")+"wheel",listener:this.Wp}]);this.pa=this.map.pa}u(Jn,yn);
Jn.prototype.normalize=function(a,b,c){var d=this.Ox,e=a[d+(d+"Y"in a?"Y":"")],f;La&&"rtl"===x.getComputedStyle(this.pa.element).direction&&(b-=(x.devicePixelRatio-1)*this.pa.width);if(e){var g=Math.abs;var h=g(e);e=(!(f=a[d+"X"])||3<=h/g(f))&&(!(f=a[d+"Z"])||3<=h/g(f))?(+(0<e)-+(0>e))*(this.Qx?1:-1):0}return new In(e,b,c,null,a)};
Jn.prototype.Wp=function(a){if(!a.Ex){var b=Gn(this.element);b=this.normalize(a,a.pageX-b.x,a.pageY-b.y);b.delta&&(a.stopImmediatePropagation(),a.preventDefault(),this.map.xh(b.viewportX,b.viewportY,this.Hp.bind(this,b)))}};Jn.prototype.Hp=function(a,b){var c=a.target=b||this.map,d,e;setTimeout(function(){c.dispatchEvent(a);a.defaultPrevented||(d=a.originalEvent,e=new x.WheelEvent("wheel",d),e.Ex=!0,d.target.dispatchEvent(e))},0)};function Kn(a){var b=Ln(this);(window.PointerEvent||window.MSPointerEvent)&&b.push({ab:"MSHoldVisual",listener:"prevent"});yn.call(this,a,b)}u(Kn,yn);function Ln(a){var b=!!window.PointerEvent,c,d,e=[];a.Vp=A(a.Vp,a);"MSPointerDown MSPointerMove MSPointerUp MSPointerCancel MSPointerOut MSPointerOver".split(" ").forEach(function(f){c=f.toLowerCase().replace(/ms/g,"");d=b?c:f;e.push({ab:d,listener:a.Vp,target:/^pointer(up|move)$/.test(c)?window:null})});return e}var Mn={2:"touch",3:"pen",4:"mouse"};
Kn.prototype.Vo=function(a,b){var c=a.pointerType;"number"===typeof c&&(c=Mn[c]);a=new nn(b.x,b.y,a.pointerId,c,a.button,a.buttons);this.pointers.push(a);return a};
Kn.prototype.Vp=function(a){var b=window.PointerEvent?a.type:a.type.toLowerCase().replace(/ms/g,""),c=Gn(this.element),d=un(this.pointers,a.pointerId),e=a.pageX-c.x;c=a.pageY-c.y;var f=Mn[a.pointerType]||a.pointerType;La&&"rtl"===x.getComputedStyle(this.za.element).direction&&(e-=(x.devicePixelRatio-1)*this.za.width);d||/^pointer(up|out|cancel)$/.test(b)||"touch"===f&&"pointerdown"!==b||(d=this.Vo(a,{x:e,y:c}));if(d)if(/^pointer(up|cancel)$/.test(b)?("touch"===f&&this.pointers.remove(d.id),rn(d,a.button)):
"pointerdown"===b&&("touch"===a.pointerType&&(vn(this.pointers,"mouse"),vn(this.pointers,"pen")),pn(d,a.button)),this.changedPointers.push(d),"pointermove"!==b)on(d,e,c),An(this,/^pointer(over|out)$/.test(b)?"pointermove":b,a);else if(d.viewportX!==e||d.viewportY!==c)on(d,e,c),An(this,b,a);this.changedPointers.clear()};function Nn(a,b,c,d){Nn.g.constructor.call(this,"contextmenu");this.items=[];this.viewportX=a;this.viewportY=b;this.target=c;this.originalEvent=d}u(Nn,ie);t("H.mapevents.ContextMenuEvent",Nn);function On(a){this.Sp=A(this.Sp,this);this.Up=A(this.Up,this);this.Tp=A(this.Tp,this);this.mn=!1;this.eh=-1;this.av=0;On.g.constructor.call(this,a,[{ab:"contextmenu",listener:this.Sp},{target:a,ab:"longpress",listener:this.Up},{target:a,ab:"dbltap",listener:this.Tp}])}u(On,yn);m=On.prototype;m.Up=function(a){var b=a.currentPointer;"touch"===b.type&&1===a.pointers.length&&Pn(this,b.viewportX,b.viewportY,a.originalEvent,a.target)};m.Tp=function(a){"touch"===a.currentPointer.type&&(this.av=Date.now())};
m.Sp=function(a){var b=this;-1===this.eh?this.eh=setTimeout(function(){var c=Gn(b.element),d=a.pageX-c.x;c=a.pageY-c.y;b.eh=-1;Pn(b,d,c,a)},this.$o):(clearInterval(this.eh),this.eh=-1);a.preventDefault()};function Pn(a,b,c,d,e){var f=a.map,g=Date.now()-a.av;e?!a.mn&&g>a.yq&&(a.mn=!0,e.dispatchEvent(new Nn(b,c,e,d)),re(f.F(),Qn,a.Dt,!1,a)):f.xh(b,c,a.Hp.bind(a,b,c,d))}m.Hp=function(a,b,c,d){Pn(this,a,b,c,d&&ab(d.dispatchEvent)?d:this.map)};
m.Dt=function(){this.mn&&(this.mn=!1,this.map.dispatchEvent(new ie("contextmenuclose",this.map)))};m.i=function(){var a=this.map.F();clearInterval(this.eh);a&&ye(a,Qn,this.Dt,!1,this);yn.prototype.i.call(this)};var Qn=["mousedown","touchstart","pointerdown","wheel"];function Rn(a){this.Ch=A(this.Ch,this);yn.call(this,a,[{ab:"touchstart",listener:this.Ch},{ab:"touchmove",listener:this.Ch},{ab:"touchend",listener:this.Ch},{ab:"touchcancel",listener:this.Ch}]);this.rx={touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",touchcancel:"pointercancel"};this.Cu=(a=(a=a.Vd)?a.F():null)?Array.prototype.slice.call(a.querySelectorAll("a"),0):[]}u(Rn,yn);
Rn.prototype.Ch=function(a){var b=a.touches,c=this.pointers.length(),d;if("touchstart"===a.type&&c>=b.length){c=this.pointers.clone();for(d=b.length;d--;)c.remove(b[d].identifier);for(d=c.length();d--;)this.pointers.remove(c.item(d).id);this.changedPointers=c;An(this,"pointercancel",a);this.changedPointers.clear()}if(this.rx[a.type]){b=Gn(this.za.element);c=a.type;d=a.changedTouches;var e=d.length,f;this.changedPointers.clear();for(f=0;f<e;f++){var g=d[f];var h=un(this.pointers,g.identifier);var k=
g.pageX-b.x;var l=g.pageY-b.y;if(h)if("touchmove"===c){g=Math.abs(h.viewportX-k);var n=Math.abs(h.viewportY-l);if(1<g||1<n||1===g&&1===n)on(h,k,l),this.changedPointers.push(h)}else"touchend"===c&&(this.pointers.remove(h.id),this.changedPointers.push(h),rn(h,sn.LEFT));else h=new nn(k,l,g.identifier,"touch",sn.LEFT,1),this.pointers.push(h),this.changedPointers.push(h)}An(this,this.rx[a.type],a);-1===this.Cu.indexOf(a.target)&&a.preventDefault()}};Rn.prototype.i=function(){this.Cu=null;yn.prototype.i.call(this)};function Sn(a){this.Nf=A(this.Nf,this);yn.call(this,a,[{ab:"mousedown",listener:this.Nf},{ab:"mousemove",listener:this.Nf,target:window},{ab:"mouseup",listener:this.Nf,target:window},{ab:"mouseover",listener:this.Nf},{ab:"mouseout",listener:this.Nf},{ab:"dragstart",listener:this.YB}])}u(Sn,yn);Sn.prototype.Vo=function(a){a=new nn(a.x,a.y,1,"mouse");this.pointers.push(a);return a};
Sn.prototype.Nf=function(a){var b=a.type,c=Gn(this.element),d={x:a.pageX-c.x,y:a.pageY-c.y};c=this.pointers.item(0)||this.Vo(d);this.changedPointers.push(c);on(c,d.x,d.y);/^mouse(?:move|over|out)$/.test(b)?An(this,"pointermove",a):(/^mouse(down|up)$/.test(b)&&(d=a.which-1,"up"===Hn.RegExp.$1?rn(c,d):pn(c,d)),An(this,b.replace("mouse","pointer"),a));this.changedPointers.clear()};Sn.prototype.YB=function(a){a.preventDefault()};function Tn(a){var b=a.pa.element.style;if(-1!==Un.indexOf(a))throw Error("InvalidArgument: map is already in use");this.v=a;Un.push(a);b.msTouchAction=b.touchAction="none";Ma||!window.PointerEvent&&!window.MSPointerEvent?(this.qx=new Rn(this.v),this.wv=new Sn(this.v)):this.qx=new Kn(this.v);this.xD=new Jn(this.v);this.ty=new On(this.v);this.v.bc(this.u,this);Zd.call(this)}u(Tn,Zd);t("H.mapevents.MapEvents",Tn);var Un=[];rb(Un);
Tn.prototype.u=function(){delete this.v;this.qx.u();this.xD.u();this.ty.u();this.wv&&this.wv.u();Un.splice(Un.indexOf(this.v),1);Zd.prototype.u.call(this)};Tn.prototype.dispose=Tn.prototype.u;Tn.prototype.hz=function(){return this.v};Tn.prototype.getAttachedMap=Tn.prototype.hz;function Vn(a,b){b=void 0===b?{}:b;var c;Vn.g.constructor.call(this);if(-1!==Wn.indexOf(a))throw new D(Vn,0,"events are already used");this.v=c=a.v;this.jv=a;Wn.push(a);c.draggable=!0;this.ua=b.kinetics||{duration:600,ease:Xl};this.yB=b.modifierKey||"Alt";this.enable(b.enabled);this.Bi=c.pa;this.il=this.Bi.element;this.Jm=0;c.addEventListener("dragstart",this.zd,!1,this);c.addEventListener("drag",this.cg,!1,this);c.addEventListener("dragend",this.$e,!0,this);c.addEventListener("wheel",this.Lv,!1,
this);c.addEventListener("dbltap",this.Ev,!1,this);c.addEventListener("pointermove",this.ee,!1,this);qe(this.il,"contextmenu",this.Wm,!1,this);a.bc(this.u,this)}u(Vn,Zd);t("H.mapevents.Behavior",Vn);var Wn=[];rb(Wn);Vn.prototype.Qb=0;var Xn={PANNING:1,PINCH_ZOOM:2,WHEEL_ZOOM:4,DBL_TAP_ZOOM:8,FRACTIONAL_ZOOM:16,TILT:32,HEADING:64};Vn.Feature=Xn;var Yn=Xn.PANNING,Zn=Xn.PINCH_ZOOM,$n=Xn.WHEEL_ZOOM,ao=Xn.DBL_TAP_ZOOM,bo=Xn.FRACTIONAL_ZOOM,co=Xn.TILT,eo=Xn.HEADING,fo=Yn|Zn|$n|ao|bo|co|eo;
Vn.DRAGGING=Yn;Vn.WHEELZOOM=$n;Vn.DBLTAPZOOM=ao;Vn.FRACTIONALZOOM=bo;function go(a,b){if(a!==+a||a%1||0>a||2147483647<a)throw new D(b,0,"integer in range [0...0x7FFFFFFF] required");}Vn.prototype.disable=function(a){var b=this.Qb;a!==B?(go(a,this.disable),b^=b&a):b=0;this.Bi.endInteraction(!0);this.Qb=b;this.v.draggable=0<(b&(Yn|co|eo|Zn))};Vn.prototype.disable=Vn.prototype.disable;
Vn.prototype.enable=function(a){var b=this.Qb;a!==B?(go(a,this.enable),b|=a&fo):b=fo;this.Qb=b;this.v.draggable=0<(b&(Yn|co|eo|Zn))};Vn.prototype.enable=Vn.prototype.enable;Vn.prototype.isEnabled=function(a){go(a,this.isEnabled);return a===(this.Qb&a)};Vn.prototype.isEnabled=Vn.prototype.isEnabled;
function ho(a,b,c){var d="touch"===b.currentPointer.type,e=0,f;if(f=!d){f=a.yB;var g=b.originalEvent;f=g.getModifierState?g.getModifierState(f):!!g[f.replace(/^Control$/,"ctrl").toLowerCase()+"Key"]}f?e|=co|eo:(e|=Yn,d&&(b=b.pointers,2===b.length&&(e|=Zn|eo,c?55>Hb(b[0].viewportY-b[1].viewportY)&&(e|=co):a.cq&xk.TILT&&(e|=co))));e&=a.Qb;return(e&co?xk.TILT:0)|(e&eo?xk.HEADING:0)|(e&Zn?xk.ZOOM:0)|(e&Yn?xk.COORD:0)}
function io(a){var b=a.pointers;a=b[0];b=b[1];a=[a.viewportX,a.viewportY];b&&a.push(b.viewportX,b.viewportY);return a}m=Vn.prototype;m.cq=0;m.zd=function(a){var b=ho(this,a,!0);if(this.cq=b){var c=this.Bi;a=io(a);c.startInteraction(b,this.ua);c.interaction.apply(c,a);if(this.Qb&$n&&!(this.Qb&bo)&&(b=a[0],c=a[1],this.Jm)){a=this.v.Tb();var d=(0>this.Jm?Gb:Fb)(a);a!==d&&(this.Jm=0,this.Ei(a,d,b,c))}}};
m.cg=function(a){var b=ho(this,a,!1);if(b!==this.cq)"pointerout"!==a.originalEvent.type&&"pointerover"!==a.originalEvent.type&&(this.$e(a),this.zd(a));else if(b){b=this.Bi;var c=io(a);b.interaction.apply(b,c);a.originalEvent.preventDefault()}};m.$e=function(a){ho(this,a,!1)&&this.Bi.endInteraction(!this.ua)};
m.Ei=function(a,b,c,d){var e=this.v.xa;if(isNaN(+a))throw Error("start zoom needs to be a number");if(isNaN(+b))throw Error("to zoom needs to be a number");0!==+b-+a&&(e.startControl(null,c,d),e.control(0,0,6,0,0,0),e.endControl(!0,function(f){f.zoom=b}))};m.Lv=function(a){if(!a.defaultPrevented&&this.Qb&$n){var b=a.delta;var c=this.v.Tb();var d=this.v;var e=d.Ca.type;d=this.Qb&bo?c-b:(0>-b?Gb:Fb)(c)-b;if(e===ph.P2D||e===ph.WEBGL||e===ph.HARP)this.Ei(c,d,a.viewportX,a.viewportY),this.Jm=b;a.preventDefault()}};
m.ee=function(){};m.Ev=function(a){var b=a.currentPointer,c=this.v.Tb(),d=a.currentPointer.type,e=this.v.Ca.type;(e===ph.P2D||e===ph.WEBGL||e===ph.HARP)&&this.Qb&ao&&(a="mouse"===d?0===a.originalEvent.button?-1:1:0<a.pointers.length?1:-1,a=this.Qb&bo?c-a:(0>-a?Gb:Fb)(c)-a,this.Ei(c,a,b.viewportX,b.viewportY))};m.Wm=function(a){return this.Qb&ao?(a.preventDefault(),!1):!0};
m.u=function(){var a=this.v;a&&(a.draggable=!1,a.removeEventListener("dragstart",this.zd,!1,this),a.removeEventListener("drag",this.cg,!1,this),a.removeEventListener("dragend",this.$e,!0,this),a.removeEventListener("wheel",this.Lv,!1,this),a.removeEventListener("dbltap",this.Ev,!1,this),a.removeEventListener("pointermove",this.ee,!1,this),delete this.v);this.il&&(this.il.style.msTouchAction="",ye(this.il,"contextmenu",this.Wm,!1,this),delete this.il);delete this.Bi;delete this.ua;Wn.splice(Wn.indexOf(this.jv),
1);delete this.jv;Zd.prototype.u.call(this)};Vn.prototype.dispose=Vn.prototype.u;t("H.mapevents.buildInfo",function(){return cn("H-mapevents","1.54.1","17144d2",{region:"row"})});

R.prototype.Un=ca(3,function(a){var b=this.getCache(),c=this;if(a!==z){C(a,ij,R.prototype.Un,0);var d=a}else d=pl;d!==b&&b.ja(function(e,f,g){return c.cc(e)?(d.add(e,f,g),!0):!1});this.ft=d});Zg.prototype.Yb=ca(2,function(a){this.ps=a;a=this.getState();a!==lg.INIT&&a!==lg.LOADING&&fh(this)});function jo(a){a=a.Sd("_#-;,:","_#-;,:","_#-;,:");return new RegExp("^"+a.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&").replace(/_#-;,:/g,"\\d+")+"$")}function ko(a,b){Ta.apply(null,arguments);return a}
function lo(a,b){var c=x.console;c&&c.warn&&(a=fb(a)+" is deprecated and will be removed soon. ",b&&(a+=b),c.warn(a))}var mo={};function no(){this.ms={}}function oo(a,b){for(var c in b)b.hasOwnProperty(c)&&a.wo(c,b[c])}no.prototype.wo=function(a,b){a=this.ms[a]||(this.ms[a]=[]);var c,d=b.length;for(c=0;c<d;c++){var e=new mo.Ns(b[c]);a.push(e)}};no.prototype.query=function(a,b,c){a=this.ms[a];var d,e=a?a.length:0,f=[];for(d=0;d<e;d++)a[d].Pf(b,c)&&f.push(a[d]);return f};
mo.Ns=function(a){var b,c=a.boxes;this.alt=a.alt;this.label=a.label;this.min=a.minLevel;this.max=a.maxLevel;this.Cn=[];if(c&&(b=c.length)){var d=c[0];var e=new F(d[0],d[1],d[2],d[3]);this.Cn.push(e);this.nn=new F(d[0],d[1],d[2],d[3]);for(a=1;a<b;a++)d=c[a],e=new F(d[0],d[1],d[2],d[3]),this.Cn.push(e),this.nn.wd(e,!1,this.nn)}};mo.Ns.prototype.Pf=function(a,b){if(a>=this.min&&a<=this.max)if((a=this.Cn.length)&&this.nn){if(this.nn.Pf(b))for(;a--;)if(this.Cn[a].Pf(b))return!0}else return!0;return!1};var po=globalThis;function qo(){}qo.prototype.pop=function(a){this[a]||(this[a]=[]);return this[a].pop()||document.createElement("canvas")};qo.prototype.push=function(a,b){this[b]||(this[b]=[]);this[b].push(a)};var ro=new qo;t("H.service.util.eval",function(a){return eval(a)});function V(a,b,c,d,e,f){if(a&&b)this.Vr(a),this.Gk(b),this.Ag(c),this.Rr(e),this.Gw(f),this.Jk(d);else throw new D(V,B,'Parameters "scheme" and "host" must be specified');}t("H.service.Url",V);
function so(a,b){var c=x.document,d;var e="";if(c){e=c.createElement("a");if(b){var f=(d=c.getElementsByTagName("base")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement("base"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\w]+:\/\//.test(a)&&(e=a);f=/(?:(\w+):\/\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\/[^?#]*)?(\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split("@")[1]);f=V;h=h&&0<h.length?h.substr(1):
"";e={};var k,l;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;l=k.exec(c);)e[decodeURIComponent(l[2])]=l[4]?decodeURIComponent(l[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}V.parse=so;V.prototype.clone=function(){var a={},b;for(b in this.Ga)a[b]=this.Ga[b];return new V(this.ki,this.Ij,this.df,a,this.ik,this.Cb)};V.prototype.clone=V.prototype.clone;
V.prototype.Vr=function(a){if(!a||"string"!==typeof a)throw new D(this.Vr,0,'The "scheme" parameter must be a non-empty string.');this.ki=a;return this};V.prototype.setScheme=V.prototype.Vr;V.prototype.qA=function(){return this.ki};V.prototype.getScheme=V.prototype.qA;V.prototype.Gk=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw new D(this.Gk,0,'The "host" parameter is not a valid host name.');this.Ij=a;return this};
V.prototype.setHost=V.prototype.Gk;V.prototype.Jz=function(){return this.Ij};V.prototype.getHost=V.prototype.Jz;V.prototype.Ag=function(a){this.df=a||void 0;return this};V.prototype.setPath=V.prototype.Ag;V.prototype.cA=function(){return this.df};V.prototype.getPath=V.prototype.cA;V.prototype.Jk=function(a){if(a)if("object"==typeof a)this.Ga=a;else throw new D(this.Jk,0,'Parameter "params" must be an object.');else this.Ga={};return this};V.prototype.setQuery=V.prototype.Jk;V.prototype.xu=function(){return!to(this)};
V.prototype.hasQuery=V.prototype.xu;V.prototype.getQuery=function(){return this.Ga};V.prototype.getQuery=V.prototype.getQuery;V.prototype.Rr=function(a){if(void 0===a)this.ik=a;else{var b=ec(+a<<0,0,65535);if(b!=a)throw new D(this.Rr,0,'Parameter "port" must be an integer in range [0...65535]');this.ik=b}return this};V.prototype.setPort=V.prototype.Rr;V.prototype.hA=function(){return this.ik};V.prototype.getPort=V.prototype.hA;V.prototype.Gw=function(a){this.Cb=a||void 0;return this};
V.prototype.setAnchor=V.prototype.Gw;V.prototype.tp=function(){return this.Cb};V.prototype.getAnchor=V.prototype.tp;V.prototype.B=function(a){if("object"!==typeof a)throw new D(this.B,0,'Parameter "other" must be an object.');var b=this.Ga,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};V.prototype.mergeQuery=V.prototype.B;
V.prototype.Ha=function(a){if(!a||"string"!==typeof a)throw new D(this.Ha,0,'Parameter "subDomain" must be a non-empty string');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Gk(a+"."+this.Ij)};V.prototype.addSubDomain=V.prototype.Ha;V.prototype.A=function(a){if(!a||"string"!==typeof a)throw new D(this.A,0,'Parameter "subPath" must be a non-empty string');return this.Ag((this.df?this.df+"/":"")+a)};V.prototype.addSubPath=V.prototype.A;
V.prototype.toString=function(){return[this.ki+"://",this.Ij,this.ik?":"+this.ik:"",this.df||!to(this)||this.Cb?"/":"",this.df?encodeURI(this.df):"",uo(this),this.Cb?"#"+encodeURIComponent(this.Cb):""].join("")};V.prototype.toString=V.prototype.toString;function vo(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return"%"+b.charCodeAt(0).toString(16)})}
function uo(a){var b=[],c=a.Ga,d={},e;for(e in c){if(c.hasOwnProperty(e)&&"function"!==typeof c[e]){var f=a.Ga[e];d.Jg=vo(e);C(f,wo)?f.co.forEach(function(g){return function(h){b.push(g.Jg+"="+vo(h))}}(d)):C(f,xo)?b.push(d.Jg+"="+f.co.map(function(g){return vo(g)}).join(f.Gy)):b.push(void 0===f?d.Jg:d.Jg+"="+vo(f))}d={Jg:d.Jg}}return 0<b.length?"?"+b.join("&"):""}
function yo(a){var b=cn("H-service","1.54.1","17144d2",{region:"row"});a.Ga.xnlp="CL_JSMv3."+b.version;return a}function to(a){var b,c=0;for(b in a.Ga)if(a.Ga.hasOwnProperty(b)&&"function"!==typeof a.Ga[b]&&(c++,0<c))break;return!c}function zo(a,b){if(ib(a))for(var c=0;c<a.length;c++){var d=a[c];if(!jb(d)&&!ob(d)){var e="The Array does not contain only strings and numbers";break}}else e="Not an Array";if(e)throw new D(b,0,a);return a}
function wo(a){this.co=zo(a,wo)}V.MultiValueQueryParameter=wo;wo.prototype.BA=function(){return this.co};wo.prototype.getValues=wo.prototype.BA;function xo(a,b){this.co=zo(a,xo);if(!/^[!\$\(\)\*\+,;]$/.test(b))throw new D(xo,1,'Invalid delimiter "'+b+'"');this.Gy=b}V.DelimitedQuerySubValues=xo;function Ao(a,b){C(a,Bo,Ao,0);var c={};Object.assign(c,b);c.min=c.min||0;c.max=c.max||20;c.tileSize=c.tileSize||512;c.getURL=function(d,e,f){return a.Lf(d,e,f).clone().B({size:c.tileSize})};Kl.call(this,c);this.aa=a}u(Ao,Kl);t("H.service.rasterTile.Provider",Ao);Ao.prototype.V=function(a,b){var c=this.aa;return c.V().query(c.yi.Nn+"."+c.L(),b,a)};Ao.prototype.getCopyrights=Ao.prototype.V;Ao.prototype.Ri=function(){return nl()};Ao.prototype.qd=function(){return nl()?ml():Ao.g.qd.call(this)};function W(a){a=ko({},this.Ey,a);var b=a.apikey||a.apiKey,c=a.baseUrl;if(c=b?c?0:"baseUrl":"apikey")throw new D(W,0,'"'+c+'" must be specified');this.Jw(a.baseUrl);this.Zs=b;this.hd.B({apikey:b});this.Lc=a.headers||{};this.LC=Ra(a.servicesConfig||{})}t("H.service.Platform",W);W.prototype.Ey={apikey:null,baseUrl:new V("https","hereapi"+(Wm?".cn":".com"))};W.prototype.Jw=function(a){this.hd=yo(a.clone());this.Zs=a=this.Zs;this.hd.B({apikey:a})};W.prototype.setBaseUrl=W.prototype.Jw;
W.prototype.Fc=function(){return this.hd};W.prototype.getBaseUrl=W.prototype.Fc;W.prototype.Ua=function(a,b){try{return a.Am=!0,new a(ko({platformBaseUrl:this.Fc(),headers:this.Lc},this.LC[a.CONFIG_KEY]||{},b||{}))}finally{a.Am=!1}};W.prototype.createService=W.prototype.Ua;
W.prototype.Ql=function(a,b,c){var d=this;if(!H.map.render.harp)throw Error("HARP engine module not found");if(!ya(a)&&!jb(a))throw new D(this.Ql,0,"is invalid: must be either a configuration object or a URL");if(!ab(b))throw new D(this.Ql,1,"is invalid: must be a Function");if(!ab(c))throw new D(this.Ql,2,"is invalid: must be a Function");var e=new H.map.render.harp.Style(a);e.addEventListener("change",function(){var f=e.getState();if(-1===f)c(Error("H.service.platform#createHybridLayers method failed to load style configuration"));
else if(2===f){f={dark:!0};var g=d.Mp({resource:"background",queryParams:{style:"satellite.day"}}),h=e.Pd(),k={styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]};h.definitions&&(void 0!==h.definitions["Satellite.Texture.Gamma"]&&(k.styles[0].attr.gamma=h.definitions["Satellite.Texture.Gamma"]),void 0!==h.definitions["Satellite.Texture.Brightness"]&&(k.styles[0].attr.brightness=h.definitions["Satellite.Texture.Brightness"]));g=new Ao(g,{engineType:$m,style:new H.map.render.harp.Style(k)});
b({raster:new ej(g,f),vector:d.wh().kd(e,{engineType:$m},f),traffic:d.Pp().kd(e,{engineType:$m},f)})}});e.load()};W.prototype.createHybridLayers=W.prototype.Ql;function Co(a,b){b=void 0===b?{}:b;if(!a.Am)throw new Ab(a);Co.g.constructor.call(this);var c=Do(this,b);if(!c.baseUrl&&!c.platformBaseUrl)throw new D(a,0,'either "baseUrl" or "platformBaseUrl" must be specified');this.uc=(c.baseUrl?c.baseUrl:c.platformBaseUrl).clone();a=c.baseUrl?b:c;a.host&&this.uc.Gk(a.host);a.subDomain&&this.uc.Ha(a.subDomain);a.path&&this.uc.Ag(a.path);yo(this.uc);this.Lc=c.headers||{}}u(Co,J);t("H.service.Service",Co);function Do(a,b){a=a.Da();return b?ko({},a,b):a}
Co.prototype.Da=function(){return{}};Co.prototype.j=function(){return this.uc};Co.prototype.getUrl=Co.prototype.j;Co.prototype.s=function(a,b,c,d){d=new Tg(void 0===d?"application/json":d,a.toString(),Ud,{headers:this.Lc});d.then(b,Eo(this,a,c));return d};function Eo(a,b,c){return function(d){return"function"!==typeof d.json?Promise.reject(c(Fo(b,d))):d.json().then(function(e){return c(a.od(e))},function(){return c(Fo(b,d))})}}Co.prototype.od=function(a){return Error(a.message)};
function Fo(a,b){return Error((b.statusText?"["+b.statusText+"] ":"")+a+" request failed")};function Bo(a){a=void 0===a?{}:a;Bo.g.constructor.call(this,Bo,a);this.yi={Nn:a.resource||"base",zn:a.projection||"mc",format:a.format||"png8"};this.Bn=a.queryParams||{}}u(Bo,Co);t("H.service.rasterTile.Service",Bo);m=Bo.prototype;m.L=function(){return this.Bn.style||"explore.day"};m.Lf=function(a,b,c){return this.j().clone().A(this.yi.Nn+"/"+(this.yi.zn+"/")+(c+"/"+a+"/"+b+"/")+this.yi.format).B(this.Bn)};m.Da=function(){return{subDomain:"maps",path:"v3"}};
m.V=function(){this.ec||this.Df();return this.ec};m.Df=function(){this.ec=new no;this.s(this.j().clone().A("copyright"),A(this.el,this),Xe)};m.el=function(a){var b=a.copyrights;a=a.resources;var c={},d=this.yi.Nn+"."+this.L();c[d]=[];a[this.yi.Nn].styles[this.L()].forEach(function(e){b[e].forEach(function(f){var g=[];f.boundingBoxes.forEach(function(h){g.push([h.north,h.west,h.south,h.east])});c[d].push({boxes:g,label:f.label,alt:f.alt,minLevel:f.minLevel,maxLevel:f.maxLevel})})});oo(this.ec,c)};
m.Dj=function(a,b){return this.s(this.j().clone().A("info"),a,b)};Bo.prototype.getInfo=Bo.prototype.Dj;Bo.prototype.Fj=function(a,b){return this.s(this.j().clone().A("politicalViews"),a,b)};Bo.prototype.getPoliticalViews=Bo.prototype.Fj;Bo.prototype.Ez=function(a,b){return this.s(this.j().clone().A("features"),a,b)};Bo.prototype.getFeatures=Bo.prototype.Ez;Bo.prototype.Ep=function(a,b){return this.s(this.j().clone().A("languages"),a,b)};Bo.prototype.getLanguages=Bo.prototype.Ep;Bo.CONFIG_KEY="rasterTile";
W.prototype.Mp=function(a){return this.Ua(Bo,a)};W.prototype.getRasterTileService=W.prototype.Mp;W.prototype.Pl=function(a,b,c,d,e,f){function g(ta,nb,zd){nb=ta.km(nb);nb=r?new Zg(nb):new H.map.render.harp.Style(nb);var rc={engineType:l};p&&p.politicalView&&(rc.politicalView=p.politicalView);c&&(rc.lg=c);d&&(rc.lg2=d);f&&(rc.pois=f);var bb;zd&&(bb={dark:zd});return ta.kd(nb,rc,bb)}function h(ta,nb,zd,rc,bb){return ta.Md(nb,zd,v,rc,w,1,bb,n)}var k=this,l=oh,n={crossOrigin:"anonymous"};if(ya(a)){var p=a;"crossOrigin"in p&&(n.crossOrigin=p.crossOrigin);a=p.tileSize;b=p.ppi;c=p.lg;d=p.lg2;e=p.style;
f=p.pois;void 0!==p.engineType&&(l=p.engineType,n.engineType=l)}var q=l===ph.HARP,r=l===ph.WEBGL,v=a||512,w={};if(0>[72,250,320,500].indexOf(+b)){if(b!==B)throw new D(this.Pl,1,b);}else w.ppi=+b;c&&(w.lg=c);d&&(w.lg2=d);e&&(w.style=e);f&&(w.pois=!!f);if(q&&!H.map.render.harp)throw new D(this.Pl,0,"HARP engine is not supported, module not found");a={};if(Wm)ko(a,{vector:{normal:{map:g(this.wh(),"harp/oslo/normal.day.json")}}});else{e=this.Gp();var y=this.Gp({type:"aerial"}),I=this.Op(),G=I.rt(w.lg?
{lg:w.lg,i18n:!0,engineType:l}:{engineType:l});ko(a,{raster:{normal:{xbase:h(e,"xbasetile","normal.day","png8",!1),xbasenight:h(e,"xbasetile","normal.night","png8",!0),base:h(e,"basetile","normal.day","png8",!1),basenight:h(e,"basetile","normal.night","png8",!0),map:h(e,"maptile","normal.day","png8",!1),mapnight:h(e,"maptile","normal.night","png8",!0),trafficincidents:G,transit:h(e,"maptile","normal.day.transit","png8",!1),labels:h(e,"labeltile","normal.day","png",!1)},satellite:{xbase:h(y,"xbasetile",
"hybrid.day","jpg",!0),base:h(y,"basetile","hybrid.day","jpg",!0),map:h(y,"maptile","hybrid.day","jpg",!0),labels:h(y,"labeltile","hybrid.day","png",!0)},terrain:{xbase:h(y,"xbasetile","terrain.day","jpg",!1),base:h(y,"basetile","terrain.day","jpg",!1),map:h(y,"maptile","terrain.day","jpg",!1),labels:h(y,"labeltile","terrain.day","png",!1)}}});if(q||r){ko(a,{vector:{normal:{traffic:I.qt(void 0,l),trafficincidents:G}}});y=this.wh();e=this.Pp();I=this.wh({queryParams:{content:"default,advanced_roads"}});
G=this.wh({queryParams:{content:"default,hillshade,contours"}});if(r)a.vector.normal.map=g(y,"omv/miami/normal.day.yaml"),a.vector.normal.truck=g(y,"omv/miami/truck.day.yaml");else if(q){a.vector.normal.map=g(y,"harp/oslo/normal.day.json");a.vector.normal.truck=g(y,"harp/oslo/normal.day.json");a.vector.normal.logistics=g(I,"harp/oslo/logistics.day.json");a.vector.normal.logisticsnight=g(I,"harp/oslo/logistics.night.json");G=g(G,"harp/oslo/topo.day.json");G.D.L().setEnabledFeatures([{feature:"terrain",
mode:"hillshading"}]);a.vector.normal.topo=G;var S={ppi:72<b?400:100,size:256<v?512:256,features:"pois:"+(!0===f||jb(f)&&/[^0]/.test(f)?"all":"disabled")};c&&(S.lang=c);d&&(S.lang2=d);p&&p.politicalView&&(S.pview=p.politicalView);b={dark:!0};G=function(ta,nb,zd,rc,bb){var Ke=ko({},S);/^explore\./.test(zd)||delete Ke.features;ta=k.Mp({format:nb,resource:ta,queryParams:ko({style:zd},Ke)});bb=new Ao(ta,{engineType:l,style:bb});return new ej(bb,rc)};ko(a.raster.normal,{base:G("background","png8","explore.day"),
basenight:G("background","png8","explore.night",b),map:G("base","png8","explore.day"),mapnight:G("base","png8","explore.night",b),labels:G("label","png","explore.day")});ko(a.raster.satellite,{xbase:G("background","jpeg","satellite.day",b),base:G("background","jpeg","explore.satellite.day",b),map:G("base","jpeg","explore.satellite.day",b),labels:G("label","png","explore.satellite.day")});ko(a.vector.normal,{mapnight:g(y,"harp/oslo/normal.night.json",!0),lite:g(y,"harp/oslo/lite.day.json"),litenight:g(y,
"harp/oslo/lite.night.json",!0),ism:g(y,"harp/oslo/road.network.day.json"),ismnight:g(y,"harp/oslo/road.network.night.json",!0),roadnetwork:g(y,"harp/oslo/road.network.day.json"),roadnetworknight:g(y,"harp/oslo/road.network.night.json",!0)});for(var X={styles:[{technique:"raster",attr:{gamma:["interpolate",["linear"],["zoom"],0,1,13,1.2,17,1.3],brightness:["interpolate",["linear"],["zoom"],0,.7,13,.9,17,1]}}]},Ga=[],ha=0;6>ha;ha++){var mb=new H.map.render.harp.Style(JSON.parse(JSON.stringify(X)));
mb=G("background","jpeg","satellite.day",b,mb);Ga.push(mb)}a.hybrid={day:{raster:Ga[0],vector:g(y,"harp/oslo/hybrid.day.json",!0),traffic:g(e,"harp/oslo/hybrid.day.json",!0)},night:{raster:Ga[1],vector:g(y,"harp/oslo/hybrid.night.json",!0),traffic:g(e,"harp/oslo/hybrid.night.json",!0)},liteday:{raster:Ga[2],vector:g(y,"harp/oslo/lite.hybrid.day.json",!0),traffic:g(e,"harp/oslo/lite.hybrid.day.json",!0)},litenight:{raster:Ga[3],vector:g(y,"harp/oslo/lite.hybrid.night.json",!0),traffic:g(e,"harp/oslo/lite.hybrid.night.json",
!0)},logistics:{raster:Ga[4],vector:g(I,"harp/oslo/logistics.hybrid.day.json",!0),traffic:g(e,"harp/oslo/logistics.hybrid.day.json",!0)},logisticsnight:{raster:Ga[5],vector:g(I,"harp/oslo/logistics.hybrid.night.json",!0),traffic:g(e,"harp/oslo/logistics.hybrid.night.json",!0)}}}y={traffic:{}};y.traffic.map=g(e,r?"traffic/vector.tile.yaml":"harp/oslo/normal.day.json");q&&(y.traffic.logistics=g(e,"harp/oslo/logistics.day.json"),y.traffic.logisticsnight=g(e,"harp/oslo/logistics.night.json"),y.traffic.mapnight=
g(e,"harp/oslo/normal.night.json"),y.traffic.lite=g(e,"harp/oslo/lite.day.json"),y.traffic.litenight=g(e,"harp/oslo/lite.night.json"));ko(a.vector,y)}}return a};W.prototype.createDefaultLayers=W.prototype.Pl;function Go(a){lo(Go,"Use HERE Geocoding and Search API v7 instead.");Go.g.constructor.call(this,Go,a)}u(Go,Co);t("H.service.PlacesService",Go);Go.prototype.Da=function(){return{subDomain:"places.ls",path:"places/v1"}};Go.CONFIG_KEY="places";Go.EntryPoint={SEARCH:"discover/search",SUGGEST:"suggest",EXPLORE:"discover/explore",AROUND:"discover/around",HERE:"discover/here",CATEGORIES:"categories/places"};Go.prototype.request=function(a,b,c,d){return this.K(a,b,c,d)};Go.prototype.request=Go.prototype.request;
Go.prototype.K=function(a,b,c,d){a=this.j().clone().A(a).B(b||{});return this.s(a,c,d)};Go.prototype.search=function(a,b,c){return this.K("discover/search",a,b,c)};Go.prototype.search=Go.prototype.search;Go.prototype.fD=function(a,b,c){return this.K("suggest",a,b,c)};Go.prototype.suggest=Go.prototype.fD;Go.prototype.Uy=function(a,b,c){return this.K("discover/explore",a,b,c)};Go.prototype.explore=Go.prototype.Uy;Go.prototype.cy=function(a,b,c){return this.K("discover/around",a,b,c)};
Go.prototype.around=Go.prototype.cy;Go.prototype.JA=function(a,b,c){return this.K("discover/here",a,b,c)};Go.prototype.here=Go.prototype.JA;Go.prototype.oy=function(a,b,c){return this.K("categories/places",a,b,c)};Go.prototype.categories=Go.prototype.oy;Go.prototype.Xy=function(a,b,c,d){a=so(a).B(this.j().getQuery()).B(d||{});return this.s(a,b,c)};Go.prototype.follow=Go.prototype.Xy;W.prototype.dA=function(a){return this.Ua(Go,a)};W.prototype.getPlacesService=W.prototype.dA;var Ho="A21 A22 F01 F02 F08 F04 F05 F07 F03 F06 A2F F13 A25 A2C F12 D1B F1B A27 E12 A3A A24 A3D A3F F1F F25 F2C E32 A33 F29 D26 D36 F26 D0F F0F F2B E0C D3A A45 D23 D11 F2E F19 F14 F39 A4A A4B A5C D38 F2A F1A D0A F1C A48 D25 D1D F32 A46 A3E D24 E1C E32 A5F D2E D22 D0A".split(" ");function Io(a,b,c,d){Io.g.constructor.call(this,{min:10,max:21,engineType:d});C(a,Jo,Io,0);this.aa=a;this.Ga=c||Ko;this.Ga.responseattributes="sh,fc";this.tr=setInterval(A(this.reload,this),b||18E4);this.vb===ph.WEBGL?this.Ya(new Zg(a.km("traffic/flow.yaml")),!0):this.Ya(new H.map.render.harp.Style({styles:[{when:["==",["geometry-type"],"LineString"],technique:"solid-line",renderOrder:10002,attr:{color:["case",[">=",["get","JF"],10],"black",[">=",["get","JF"],8],"red",[">=",["get","JF"],4],"yellow",
"green"],lineWidth:3,metricUnit:"Pixel"}}]}))}u(Io,R);t("H.service.traffic.flow.Provider",Io);Io.prototype.lr=Ve;Io.prototype.providesGeoJSON=Io.prototype.lr;Io.prototype.L=function(){return this.nb()};Io.prototype.getStyle=Io.prototype.L;Io.prototype.Bb=function(a){a.Yb&&a.Yb("GeoJSONTileSource");this.Ya(a)};Io.prototype.setStyle=Io.prototype.Bb;var Ko={locationreferences:"tmc,shp"};Io.prototype.i=function(){Io.g.i.call(this);clearInterval(this.tr)};
Io.prototype.s=function(a,b,c,d,e){return this.aa.requestFlowByTile(a,b,c,function(f){f.type&&-1!==f.type.indexOf("Error")?e(f.Details):d(f)},e,this.Ga)};Io.prototype.requestInternal=Io.prototype.s;
Io.prototype.ld=function(a,b,c,d,e){var f,g,h,k,l={type:"FeatureCollection",features:[]},n;var p=d.RWS.length;for(f=0;f<p;f++){var q=d.RWS[f];var r=q.RW;var v=r.length;var w=-1!==Ho.indexOf(q.EXTENDED_COUNTRY_CODE+q.EBU_COUNTRY_CODE);for(q=0;q<v;q++){var y=r[q].FIS;var I=y.length;for(y=0;y<I;y++){var G=r[q].FIS[y].FI;var S=G.length;for(g=0;g<S;g++){var X=G[g];var Ga=[];var ha=X.CF[0];var mb=!!ha.SSS;var ta={type:"Feature",properties:ha,geometry:{type:"MultiLineString",coordinates:Ga}};ta.properties.LHT=
w;X.SHP.length&&(ta.properties.FC=X.SHP[0].FC);mb&&(n=[]);for(ha=0;ha<X.SHP.length;ha++){var nb=X.SHP[ha].value;var zd=nb.length;for(h=0;h<zd;h++){var rc=mb?n:void 0,bb=new Oa(nb[h].trim()),Ke=[],pd={};for(bb.ui();-1!==(k=bb.fb());)k===Lo?(pd.lat=+String.fromCharCode.apply(Io,bb.ih()),bb.next(),bb.ui()):k===Mo?(pd.lng=+String.fromCharCode.apply(Io,bb.ih()),Ke.push([pd.lng,pd.lat]),rc&&rc.push(sc(pd)),pd=[],bb.next(),bb.ui()):bb.next();pd.lng=+String.fromCharCode.apply(Io,bb.ih());Ke.push([pd.lng,
pd.lat]);rc&&rc.push(sc(pd));k=Ke;Ga.push(k)}}l.features.push(ta)}}}}return Io.g.ld.call(this,a,b,c,l,e)};Io.prototype.createTileInternal=Io.prototype.ld;var Mo=32,Lo=44;function No(){this.sd={}}No.prototype.kc=function(a,b){var c=a+b,d;if(d=this.sd[c])return d;a=Oo.MARKER.replace("{{icon}}",Po[a]||Po.OTHER);a=a.replace("{{color}}",Qo[b]||Qo.BLOCKING);b={size:{w:26,h:33},anchor:{x:13,y:30},hitArea:new Ph(Qh.POLYGON,Ro.MARKER)};return this.sd[c]=d=new Sh(a,b)};
var Oo={MARKER:'<svg width="26" height="33" enable-background="new 0 0 26 33" viewBox="0 0 26 33" xmlns="http://www.w3.org/2000/svg"><path d="m26 33h-26v-33h26z" fill="#8c8c8c" opacity="0"/><path d="m17 29.566c0 1.116-1.791 2.022-4 2.022s-4-.906-4-2.022c0-1.118 1.791-2.026 4-2.026s4 .908 4 2.026" fill="#878787" opacity=".6"/><path d="m1.795 17.971c-1.562-1.555-1.574-3.828-.028-5.655l8.343-10.021c.769-.895 1.795-1.384 2.894-1.384 1.117 0 2.197.521 2.889 1.394l8.338 10.014c1.588 1.854 1.578 4.022-.029 5.65l-11.202 11.202z" fill="{{color}}"/>{{icon}}</svg>'},Po=
{CONGESTION:'<path style="fill:#FFFFFF;" d="M12.966,1.177c0.965,0,1.894,0.442,2.496,1.204l8.378,10.258c1.362,1.592,1.482,3.477,0,4.979L12.994,28.464L2.143,17.618c-1.381-1.375-1.38-3.348,0-4.979l8.314-10.258C11.174,1.547,12.085,1.177,12.966,1.177 M12.967,0.177L12.967,0.177c-1.247,0-2.408,0.551-3.269,1.552l-8.332,10.28c-1.711,2.022-1.688,4.567,0.07,6.317l10.85,10.845l0.707,0.707l0.707-0.707l10.847-10.846c1.784-1.807,1.803-4.292,0.053-6.337L16.237,1.748C15.462,0.769,14.236,0.177,12.967,0.177L12.967,0.177z M16.645,10.405l-2.025-2.22c-0.48-0.51-1.15-0.8-1.84-0.8H9.53c-0.69,0-1.36,0.29-1.84,0.8l-1.94,2.22c-0.39,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.44l0.255-0.539c0.204-0.431,0.456-0.837,0.753-1.21l0.962-1.211l0.83-0.9c0.32-0.35,0.72-0.63,1.15-0.82H8.23c-0.28,0-0.55-0.07-0.79-0.22l-0.28-0.17l1.27-1.45c0.28-0.31,0.68-0.48,1.1-0.48h3.25c0.42,0,0.82,0.17,1.1,0.48l1.354,1.54H16.645z M18.31,12.205c-0.35-0.37-0.81-0.63-1.3-0.74c-0.18-0.04-0.36-0.06-0.54-0.06h-3.24c-0.7,0-1.37,0.29-1.84,0.8l-1.13,1.22l-0.82,1c-0.38,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.75v-1h5.99v1h1.75c0.69,0,1.25-0.56,1.25-1.25v-1.64c0-0.74-0.2-1.46-0.59-2.09L18.31,12.205z M12.1,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C12.35,16.993,12.238,17.105,12.1,17.105z M18.59,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C18.84,16.993,18.728,17.105,18.59,17.105z M18.56,14.505c-0.24,0.15-0.51,0.22-0.79,0.22h-5.85c-0.28,0-0.55-0.07-0.78-0.22l-0.29-0.17l1.27-1.45c0.15-0.16,0.33-0.28,0.53-0.37c0.18-0.07,0.38-0.11,0.58-0.11h3.24c0.24,0,0.48,0.06,0.68,0.16c0.16,0.08,0.3,0.19,0.42,0.32l1.27,1.45L18.56,14.505z M8.42,13.03h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C8.67,12.918,8.559,13.03,8.42,13.03z"/>',
ROADWORKS:'<path d="m13.004 1.411c.964 0 1.894.441 2.496 1.204l8.346 10.023c1.363 1.592 1.482 3.477 0 4.979l-10.846 10.847-10.852-10.846c-1.381-1.375-1.379-3.348 0-4.979l8.346-10.023c.717-.835 1.628-1.205 2.51-1.205m0-1c-1.248 0-2.408.551-3.268 1.552l-8.356 10.035c-1.718 2.033-1.695 4.578.064 6.328l10.85 10.845.706.707.707-.707 10.846-10.846c1.784-1.808 1.803-4.293.053-6.337l-8.337-10.012c-.769-.973-1.996-1.565-3.265-1.565zm-.575 15.264c.018-.332-.13-.651-.394-.851l-2.945-2.235-.21.36c-.22.39-.41.78-.58 1.19l-.677 2.129-1.364 3.051h1.314l2.109-4.672 1.317 1.212.138 3.46h1.092zm6.16-1.327c-.401-.54-1.209-.539-1.609.001l-1.17 1.58-2.29-1.74-.139-4.054c-.011-.276-.134-.535-.342-.716l-.7-.61c-.185-.161-.422-.25-.667-.25h-1.885c-.335 0-.648.168-.833.447l-1.144 1.723 7.58 5.76-1.86 2.51c-.098.132-.004.32.161.32h6.648l1.142-1.077zm-8.79-2.989-.876-.665.841-1.018.965.043zm1.63 1.24.969-1.781.118 2.61zm2.76-5.79c-.64 0-1.16.52-1.16 1.16 0 .65.52 1.17 1.16 1.17s1.16-.52 1.16-1.17c0-.64-.52-1.16-1.16-1.16z" fill="#fff"/>',
ACCIDENT:'<path style="fill:#FFFFFF;" d="M12.998,1.091c0.964,0,1.894,0.442,2.496,1.204l8.346,10.344c1.363,1.592,1.482,3.477,0,4.979L12.994,28.465L2.143,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.344C11.205,1.462,12.115,1.091,12.998,1.091 M12.998,0.091L12.998,0.091c-1.248,0-2.408,0.551-3.269,1.552L1.364,12.011c-1.708,2.021-1.685,4.566,0.073,6.316l10.85,10.845l0.707,0.707l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337l-8.327-10.32C15.494,0.684,14.268,0.091,12.998,0.091L12.998,0.091z M7.83,18.982l-3.309-1.855l0.945,1.855H7.83z M16.111,19h3.942l1.596-2L16.111,19z M10.512,20.064l1.021-1.021l1.632,0.076c0.329,0.018,0.651-0.022,0.963-0.123c0.626-0.206,1.122-0.76,1.288-1.44l0.264-1.089l2.066-0.93c0.373-0.17,0.673-0.42,0.861-0.731c0.275-0.449,0.405-0.97,0.369-1.498L18.9,11.676l1.021-1.021l-0.724-0.724l-0.427,0.427l-0.121-0.364c-0.201-0.603-0.54-1.151-0.989-1.6l-1.159-1.159c-0.5-0.5-1.31-0.5-1.809,0l-1.267,1.267l0.724,0.724l-5.066,5.066l-0.724-0.724l-1.267,1.267c-0.5,0.5-0.5,1.31,0,1.809l1.159,1.159c0.449,0.449,0.997,0.788,1.6,0.989l0.364,0.121l-0.427,0.427L10.512,20.064z M14.901,10.349l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0l-0.732-0.732C14.803,10.604,14.803,10.446,14.901,10.349z M9.472,15.777l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0L9.472,16.13C9.375,16.033,9.375,15.874,9.472,15.777z M11.391,17.615c0.069-0.271,0.206-0.518,0.405-0.717l4.961-4.961c0.195-0.195,0.445-0.337,0.717-0.405l0.344-0.083l0.137,1.925c0.022,0.318-0.058,0.63-0.221,0.901c-0.101,0.166-0.279,0.271-0.409,0.329L14.8,15.74l-0.38,1.574c-0.083,0.344-0.318,0.615-0.612,0.713c-0.188,0.058-0.38,0.083-0.579,0.072l-1.925-0.138L11.391,17.615z"/>',
OTHER:'<path style="fill:#FFFFFF;" d="M13.004,1.411c0.964,0,1.894,0.441,2.496,1.204l8.346,10.023c1.363,1.592,1.482,3.477,0,4.979L13,28.465L2.148,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.023C11.211,1.781,12.122,1.411,13.004,1.411 M13.004,0.411L13.004,0.411c-1.248,0-2.408,0.551-3.268,1.552L1.38,11.998c-1.718,2.033-1.694,4.579,0.064,6.328l10.85,10.845L13,29.878l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337L16.269,1.976C15.5,1.003,14.273,0.411,13.004,0.411L13.004,0.411z M14.716,20.139c0,0.947-0.758,1.724-1.724,1.724c-0.947,0-1.704-0.777-1.704-1.724c0-0.928,0.757-1.704,1.704-1.704C13.958,18.435,14.716,19.211,14.716,20.139z M14.204,16.33H11.78l-0.537-8.533h3.5L14.204,16.33z"/>'},
Qo={BLOCKING:"#323232",VERYHIGH:"#d5232f",HIGH:"#ffa100"},Ro={MARKER:[24.1,17.8,14.2,28.42,16.8,29.4,12.8,31.4,8.79,29.4,11.23,28.42,1.7,17.8,1.7,12.1,10,1.9,12.9,.498,15.8,1.9,24.1,12.1,24.1,17.8]};function So(a){if(!a||!ab(a.requestData))throw new D(So,0,"options.requestData");So.g.constructor.call(this,a);this.vC=a.requestData;this.lC=!!a.providesDomMarkers}u(So,R);t("H.map.provider.MarkerTileProvider",So);So.prototype.s=function(a,b,c,d,e){var f=this;return this.vC(a,b,c,function(g){for(var h=[],k,l,n=g.length;n--;)l=g[n],l.hD=f.getTileKey(a,b,c),l.fa(f),k=l.kc(),(C(l,Ti)||1===k.getState())&&h.push(g[n]);d(h)},e)};So.prototype.requestInternal=So.prototype.s;
So.prototype.Dh=function(a,b){b===Ih.VISUAL&&(a=this.Rb().get(a.hD))&&(a.valid=!1,this.kb(a))};So.prototype.invalidateObject=So.prototype.Dh;So.prototype.Rc=function(){return this.lC};So.prototype.providesDomMarkers=So.prototype.Rc;So.prototype.Sc=Ve;So.prototype.providesMarkers=So.prototype.Sc;function To(a,b,c){c=c?c:{};c.criticality||(c.criticality="major,critical");C(a,Jo,To,0);So.call(this,{max:20,min:8,requestData:A(this.zC,this),engineType:c.engineType});this.sd=new No;this.aa=a;this.Ga=c;this.reload=A(this.reload,this);this.tr=setInterval(this.reload,b||18E4)}u(To,So);t("H.service.traffic.incidents.Provider",To);var Uo={minor:"HIGH","low impact":"HIGH",major:"VERYHIGH",critical:"BLOCKING"};
To.prototype.zC=function(a,b,c,d,e){var f=this,g=this.sd;return this.aa.requestIncidentsByTile(a,b,c,function(h){var k=[];h=h.TRAFFIC_ITEMS;var l;if(h)for(h=h.TRAFFIC_ITEM,l=h.length;l--;){var n=h[l];var p=n.TRAFFIC_ITEM_TYPE_DESC;switch(p){case "ACCIDENT":case "CONGESTION":var q=p;break;case "CONSTRUCTION":q="ROADWORKS";break;default:q="OTHER"}q=g.kc(q,Uo[n.CRITICALITY.DESCRIPTION]);p=n.LOCATION.GEOLOC.ORIGIN;p=new ci({lat:p.LATITUDE,lng:p.LONGITUDE},{provider:f,icon:q});p.setData(n);k.push(p)}d(k)},
e,this.Ga)};To.prototype.u=function(){So.prototype.u.call(this);clearInterval(this.tr)};To.prototype.dispose=To.prototype.u;function Vo(a){Vo.g.constructor.call(this,Vo,a)}u(Vo,Co);t("H.service.traffic.Service7",Vo);Vo.prototype.Da=function(){return{subDomain:"data.traffic",path:"v7"}};Vo.CONFIG_KEY="traffic_v7";Vo.prototype.yC=function(a,b,c,d){a=this.j().clone().A(["incidents",a].join("/")).B(b||{});return this.s(a,c,d)};Vo.prototype.requestIncidentById=Vo.prototype.yC;Vo.prototype.wC=function(a,b,c){a=this.j().clone().A("flow").B(a||{});return this.s(a,b,c)};Vo.prototype.requestFlowByArea=Vo.prototype.wC;
Vo.prototype.BC=function(a,b,c){a=this.j().clone().A("incidents").B(a||{});return this.s(a,b,c)};Vo.prototype.requestIncidentsByArea=Vo.prototype.BC;function Wo(a){function b(n){d.contains(e)&&d.removeChild(e);l&&clearTimeout(l);delete Wo.wr[f];n&&a.Kt&&a.Kt.call(k,n)}if(!a.url||!a.Jo)throw Error('Parameter "options" must specify at least a URL and a callback.');if("function"!==typeof a.Jo)throw Error("Parameters options.callback must be a function");var c=a.ND||document;var d=c.getElementsByTagName("head")[0];var e=c.createElement("script");c=a.url instanceof V?a.url:so(a.url,a.LD);var f=Wo.GC++;var g=a.ly||"callback";var h=a.Jo;var k={};var l=
null;k.id=f;k.cancel=function(){b("cancelled")};0!==a.timeout&&(l=x.setTimeout(function(){b("timeout")},a.timeout||3E4));Wo.wr[f]=function(n){b();h.call(k,n)};e.type="text/javascript";e.src=c.toString()+(c.xu()?"&":"?")+g+"="+(a.OD?"H.service.jsonp.handleResponse("+f+")":encodeURI("H.service.jsonp.handleResponse("+f+")"));d.appendChild(e);return k}t("H.service.jsonp",Wo);Wo.HA=function(a){return(a=Wo.wr[a])?a:function(){}};Wo.handleResponse=Wo.HA;Wo.GC=0;Wo.wr={};function Jo(a){Jo.g.constructor.call(this,Jo,a);this.my=Do(this,a).callbackKey;this.Te=!1}u(Jo,Co);t("H.service.traffic.Service",Jo);Jo.prototype.Da=function(){return{subDomain:"traffic.ls",path:"traffic/6.1",callbackKey:"jsoncallback"}};Jo.CONFIG_KEY="traffic";Jo.prototype.qt=function(a,b){return new ej(new Io(this,void 0,a,b),{max:22})};Jo.prototype.createFlowLayer=Jo.prototype.qt;Jo.prototype.rt=function(a){return new Dh(new To(this,void 0,a))};Jo.prototype.createIncidentsLayer=Jo.prototype.rt;
function Xo(a,b,c,d){a.Te||(lo(Jo,"Use HERE Traffic API v7 instead."),a.Te=!0);return Wo({url:b,Jo:c,Kt:function(e){d(Error("["+e+"] "+b+" request failed"))},ly:a.my})}Jo.prototype.AC=function(a,b,c){a=this.j().clone().A("incidents.json").B(a);return Xo(this,a,b,c)};Jo.prototype.requestIncidents=Jo.prototype.AC;Jo.prototype.xC=function(a,b,c,d,e,f){a=this.j().clone().A(["flow/json",c,a,b].join("/")).B(f||{});return Xo(this,a,d,e)};Jo.prototype.requestFlowByTile=Jo.prototype.xC;
Jo.prototype.CC=function(a,b,c,d,e,f){a=this.j().clone().A(["incidents/json",c,a,b].join("/")).B(f||{});return Xo(this,a,d,e)};Jo.prototype.requestIncidentsByTile=Jo.prototype.CC;Jo.prototype.km=function(a){return mn()+"/"+a};W.prototype.Op=function(a,b){b=b||6;if(6===b)b=Jo;else if(7===b)b=Vo;else throw new D(this.Op,1,"allowed values are 6 and 7");return this.Ua(b,a)};W.prototype.getTrafficService=W.prototype.Op;function Yo(a){Yo.g.constructor.call(this,Yo,a);lo(Yo,"Use HERE Routing API v8 instead.")}u(Yo,Co);t("H.service.RoutingService",Yo);Yo.prototype.Da=function(){return{subDomain:"route.ls",path:"routing/7.2"}};Yo.prototype.od=function(a){return Error(a.details)};Yo.CONFIG_KEY="routing";Yo.prototype.Tg=function(a,b,c){a=this.j().clone().A("calculateroute.json").B(a);return this.s(a,b,c)};Yo.prototype.calculateRoute=Yo.prototype.Tg;
Yo.prototype.Ho=function(a,b,c){a=this.j().clone().Ha("isoline").A("calculateisoline.json").B(a);return this.s(a,b,c)};Yo.prototype.calculateIsoline=Yo.prototype.Ho;function Zo(a){Zo.g.constructor.call(this,Zo,a)}u(Zo,Co);t("H.service.RoutingService8",Zo);Zo.CONFIG_KEY="routing_v8";Zo.prototype.Da=function(){return{subDomain:"router",path:"v8/routes"}};Zo.prototype.od=function(a){return Error(401===(a&&void 0===a.status?401:a.status)?a.error_description:a.title,{cause:a})};Zo.prototype.Tg=function(a,b,c){a=this.j().clone().B(a);return this.s(a,b,c)};Zo.prototype.calculateRoute=Zo.prototype.Tg;
Zo.prototype.Ho=function(a,b,c){a=this.j().clone().Ha("isoline").Ag("v8/isolines").B(a);return this.s(a,b,c)};Zo.prototype.calculateIsoline=Zo.prototype.Ho;W.prototype.nu=function(a,b){b=Wm?8:+b||7;if(7===b)b=Yo;else if(8===b)b=Zo;else throw new D(this.nu,1,"allowed values are 7 and 8");return this.Ua(b,a)};W.prototype.getRoutingService=W.prototype.nu;function $o(a){$o.g.constructor.call(this,$o,a);this.pu=a.getToken}u($o,Co);t("H.service.iml.Service",$o);$o.prototype.Da=function(){return{host:"interactive.data.api.platform.here.com",path:"interactive/v1/catalogs"}};
$o.prototype.od=function(a){function b(){for(var d=ea(c),e=d.next();!e.done;e=d.next()){e=e.value;var f=e.format;if(e.keys.every(function(g){return a[g]}))return f()}return JSON.stringify(a)}var c=[{keys:["code","title","cause","action"],format:function(){return a.code+": "+a.title+"; cause: "+a.cause+"; action: "+a.action}},{keys:["error","error_description"],format:function(){return a.error+": "+a.error_description}},{keys:["error","errorMessage"],format:function(){return a.error+": "+a.errorMessage}}];
return Error(ya(a)?b():a)};$o.prototype.zh=function(a,b,c,d,e){var f=this.zh;ap(f,0,a,b);bp(f,2,c,d);a=this.j().clone().A(a+"/layers/"+b+"/statistics").B(e||{});return this.K(a,"GET",c,d)};$o.prototype.getStatistics=$o.prototype.zh;$o.prototype.em=function(a,b,c,d,e,f,g,h,k){var l=k?"":".mvtf";a=this.j().clone().A(d+"/layers/"+e+"/tile/web/"+c+"_"+a+"_"+b+l).B(Object.assign({clip:!0},h));return this.K(a,"GET",k?f:function(n){return n.arrayBuffer().then(f)},g,void 0,k?"application/json":"arraybuffer")};
$o.prototype.getFeaturesByTile=$o.prototype.em;$o.prototype.du=function(a,b,c,d,e,f){var g=this.du;cp(g,a);ap(g,1,b,c);bp(g,3,d,e);a=dp(this,a,b,c,f);return this.K(a,"GET",d,e)};$o.prototype.getFeatureById=$o.prototype.du;$o.prototype.Pe=function(a,b,c,d,e,f){var g=this.Pe;ep(g,a);ap(g,1,b,c);bp(g,3,d,e);a=fp(this,a,b,c,f);return this.K(a,"GET",d,e)};$o.prototype.getFeaturesById=$o.prototype.Pe;
$o.prototype.rh=function(a,b,c,d,e){var f=this.rh;if(!ya(a)||!(a.bbox||a.north&&a.east&&a.south&&a.west))throw new D(f,0,'must be an object with either "bbox" or a full set of "north", "east", "south" and "west"');ap(f,1,b,c);bp(f,3,d,e);a=this.j().clone().A(b+"/layers/"+c+"/bbox").B(a);return this.K(a,"GET",d,e)};$o.prototype.getFeaturesByBoundingBox=$o.prototype.rh;
$o.prototype.fu=function(a,b,c,d,e){var f=this.fu;if(!(ya(a)&&a.radius&&(a.lat&&(a.lng||a.lon)||a.refCatalogHrn&&a.refLayerId&&a.refFeatureId)))throw new D(f,0,'must be an object with "radius" and a combination of either "lat"+"lng" or "refCatalogHrn"+"refLayerId"+"refFeatureId"');ap(f,1,b,c);bp(f,3,d,e);a=this.j().clone().A(b+"/layers/"+c+"/spatial").B(a);return this.K(a,"GET",d,e)};$o.prototype.getFeaturesByPointAndRadius=$o.prototype.fu;
$o.prototype.eu=function(a,b,c,d,e,f){var g=this.eu;if(!ya(a)||!a.radius)throw new D(g,0,'must be an object with "radius"');gp(g,1,b);ap(g,2,c,d);bp(g,4,e,f);a=this.j().clone().A(c+"/layers/"+d+"/spatial").B(a);return this.K(a,"POST",e,f,b)};$o.prototype.getFeaturesByGeometryAndRadius=$o.prototype.eu;$o.prototype.Ew=function(a,b,c,d,e){var f=this.Ew;ap(f,0,a,b);bp(f,2,c,d);a=this.j().clone().A(a+"/layers/"+b+"/search").B(e||{});return this.K(a,"GET",c,d)};$o.prototype.searchFeatures=$o.prototype.Ew;
$o.prototype.Tu=function(a,b,c,d,e){var f=this.Tu;ap(f,0,a,b);bp(f,2,c,d);a=this.j().clone().A(a+"/layers/"+b+"/iterate").B(e||{});return this.K(a,"GET",c,d)};$o.prototype.iterateFeatures=$o.prototype.Tu;$o.prototype.hf=function(a,b,c,d,e,f){var g=this.hf;gp(g,0,a);ap(g,1,b,c);bp(g,3,d,e);b=hp(this,b,c,f);return this.K(b,"PUT",d,e,a)};$o.prototype.putFeatures=$o.prototype.hf;
$o.prototype.ff=function(a,b,c,d,e,f){var g=this.ff;gp(g,0,a);ap(g,1,b,c);bp(g,3,d,e);b=hp(this,b,c,f);return this.K(b,"POST",d,e,a)};$o.prototype.postFeatures=$o.prototype.ff;$o.prototype.Bf=function(a,b,c,d,e){var f=this.Bf;ep(f,a);ap(f,1,b,c);bp(f,3,d,e);a=fp(this,a,b,c);return this.K(a,"DELETE",d,e)};$o.prototype.deleteFeatures=$o.prototype.Bf;$o.prototype.ow=function(a,b,c,d,e,f,g){var h=this.ow;cp(h,a);gp(h,1,b);ap(h,2,c,d);bp(h,4,e,f);a=dp(this,a,c,d,g);return this.K(a,"PUT",e,f,b)};
$o.prototype.putFeature=$o.prototype.ow;$o.prototype.Vv=function(a,b,c,d,e,f,g){var h=this.Vv;cp(h,a);gp(h,1,b);ap(h,2,c,d);bp(h,4,e,f);a=dp(this,a,c,d,g);return this.K(a,"PATCH",e,f,b)};$o.prototype.patchFeature=$o.prototype.Vv;$o.prototype.yt=function(a,b,c,d,e){var f=this.yt;cp(f,a);ap(f,1,b,c);bp(f,3,d,e);a=dp(this,a,b,c);return this.K(a,"DELETE",d,e,void 0,"text/plain")};$o.prototype.deleteFeature=$o.prototype.yt;
function hp(a,b,c,d){return a.j().clone().A(b+"/layers/"+c+"/features").B(d||{})}function fp(a,b,c,d,e){b=Object.assign({},e,{id:new wo(b)});return hp(a,c,d,b)}function dp(a,b,c,d,e){return a.j().clone().A(c+"/layers/"+d+"/features/"+b).B(e||{})}
$o.prototype.K=function(a,b,c,d,e,f){f=void 0===f?"application/json":f;b={method:b,headers:Object.assign({},e?{"Content-Type":"application/geo+json"}:void 0,"function"===typeof this.pu?{Authorization:"Bearer "+this.pu()}:void 0,this.Lc)};e&&(b.data=JSON.stringify(e));e=new Tg(f,a.toString(),Ud,b);e.then(c,Eo(this,a,d));return e};$o.CONFIG_KEY="iml";function ap(a,b,c,d){gb(c,"String",a,b,"must be a string");gb(d,"String",a,b+1,"must be a string")}
function cp(a,b){gb(b,"String",a,0,"must be a string")}function ep(a,b){if(!Array.isArray(b)||0===b.length||b.some(function(c){return"string"!==typeof c}))throw new D(a,0,"must be a non-empty array of strings");}function gp(a,b,c){if(!ya(c))throw new D(a,b,"must be a GeoJSON object");}function bp(a,b,c,d){if(!ab(c))throw new D(a,b,"must be a function");if(!ab(d))throw new D(a,b+1,"must be a function");}W.prototype.Kz=function(a){return this.Ua($o,a)};W.prototype.getIMLService=W.prototype.Kz;function ip(a,b,c,d){ip.g.constructor.call(this,d?{min:d.min,max:d.max,engineType:d.engineType}:void 0);C(a,$o,ip,0);if(!jb(b))throw new D(ip,1,'"catalogHrn" must be a string');if(!jb(c))throw new D(ip,2,'"layerId" must be a string');this.aa=a;this.Wg=b;this.Ih=c;this.Ek=ya(d)&&ya(d.parameters)?d.parameters:{};this.Ya(this.Ap())}u(ip,R);t("H.service.iml.Provider",ip);ip.prototype.s=function(a,b,c,d,e){return this.aa.em(a,b,c,this.Wg,this.Ih,d,e,this.Ek)};ip.prototype.requestInternal=ip.prototype.s;
ip.prototype.Tc=Ve;ip.prototype.providesOMV=ip.prototype.Tc;ip.prototype.L=function(){return this.nb()};ip.prototype.getStyle=ip.prototype.L;ip.prototype.Bb=function(a){C(a,Zg)&&a.Yb("MVT");this.Ya(a)};ip.prototype.setStyle=ip.prototype.Bb;
ip.prototype.Ap=function(){return this.vb===ph.WEBGL?new Zg({sources:{iml:{type:"MVT"}},layers:{iml:{data:{source:"iml",layer:this.Wg+":"+this.Ih},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#0258AE",width:"2px",join:"round",
cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.Wg+":"+this.Ih,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.Wg+":"+this.Ih,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.Wg+":"+this.Ih,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.Wg+
":"+this.Ih,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#0258AE",lineWidth:"2px",renderOrder:203}]})};function jp(a){jp.g.constructor.call(this,jp,a);this.Bw=Do(this,a).reverseSubDomain;lo(jp,"Use HERE Geocoding and Search API v7 instead.")}u(jp,Co);t("H.service.GeocodingService",jp);jp.prototype.Da=function(){return{subDomain:"geocoder.ls",reverseSubDomain:"reverse",path:"6.2"}};jp.CONFIG_KEY="geocoding";jp.prototype.od=function(a){return Error(a.Details||a.message||a.error)};jp.prototype.sp=function(a,b,c){a=this.j().clone().A("geocode.json").B(a);return this.s(a,b,c)};
jp.prototype.geocode=jp.prototype.sp;jp.prototype.Ar=function(a,b,c){a=this.j().clone().A("reversegeocode.json").B(a);this.Bw&&a.Ha(this.Bw);return this.s(a,b,c)};jp.prototype.reverseGeocode=jp.prototype.Ar;jp.prototype.search=function(a,b,c){a=this.j().clone().A("search.json").B(a);return this.s(a,b,c)};jp.prototype.search=jp.prototype.search;W.prototype.Fz=function(a){return this.Ua(jp,a)};W.prototype.getGeocodingService=W.prototype.Fz;function kp(a,b,c){var d=this,e=c||{},f=+e.min,g=+e.max;e.tileSize=e.tileSize||512;e.min=f?ec(f,1,17):1;e.min+=gj(e.tileSize,1);e.max=g?ec(g,1,17):17;kp.g.constructor.call(this,e);C(a,lp,kp,0);C(b,kg,kp,1);this.aa=a;b.Yb&&b.Yb("OMV");this.Ya(b,!0);this.tn=!1;c&&(c.politicalView&&(this.un=c.politicalView),mp(this,c.lg,c.lg2),this.tn=!!c.pois);this.qw=function(){d.xl=jo(d);d.reload(!1)};a.addEventListener("versionupdate",this.qw);this.xl=jo(this);kp.prototype.So=function(){var h=/^v2\/vectortiles\/(.+)\/mc$/.exec(a.j().df);
return h?h[1]:B+""}()}u(kp,R);t("H.service.omv.Provider",kp);kp.prototype.Tc=Ve;kp.prototype.providesOMV=kp.prototype.Tc;kp.prototype.cc=function(a){return this.xl.test(a)};kp.prototype.cacheFilter=kp.prototype.cc;kp.prototype.Sd=function(a,b,c){return this.aa.Lf(a,b,c).toString()};kp.prototype.getTileKey=kp.prototype.Sd;kp.prototype.Rb=function(){return this.FB};kp.prototype.getCache=kp.prototype.Rb;kp.prototype.gA=function(){return this.un};kp.prototype.getPoliticalView=kp.prototype.gA;
kp.prototype.PC=function(a){var b=this.un;this.un=a;this.dispatchEvent(new nh("politicalviewchange",this.un,b))};kp.prototype.setPoliticalView=kp.prototype.PC;kp.prototype.MAX_STORE_TIME=2592E6;kp.prototype.Ri=function(){return nl()};kp.prototype.qd=function(){return nl()?ml():kp.g.qd.call(this)};kp.prototype.s=function(a,b,c,d,e){return this.aa.Oa(a,b,c,d,e)};kp.prototype.requestInternal=kp.prototype.s;kp.prototype.Bb=function(a){a.Yb&&a.Yb("OMV");this.Ya(a)};kp.prototype.setStyle=kp.prototype.Bb;
kp.prototype.L=function(){return kp.g.nb.apply(this)};kp.prototype.getStyle=kp.prototype.L;kp.prototype.nb=function(){var a=kp.g.nb.apply(this),b=a.getState()===lg.READY,c=a.Pd();b&&c&&c.global&&(this.kq&&(this.fw&&(c.global.ux_language=this.fw),this.St&&(c.global.ux_language_fallback=this.St)),this.tn&&c.global.poi&&c.global.poi["default"]&&(c.global.poi["default"].visible=this.tn),this.kq||this.tn)&&(a=new Zg(c,a.Fc()));return a};kp.prototype.getStyleInternal=kp.prototype.nb;
function mp(a,b,c){var d=jb(b),e=jb(c);d&&(a.fw=b);e&&(a.St=c);if(d||e)a.Qj=[],d=/^([a-zA-Z]{2})(-|$)/,(e=d.exec(b))&&("zh"===e[1]?a.Qj.push(b):a.Qj.push(e[1])),(e=d.exec(c))&&("zh"===e[1]?a.Qj.push(c):a.Qj.push(e[1])),a.kq=!0}kp.prototype.kq=!1;var op=["en"];kp.prototype.Ep=function(){return this.Qj||op};kp.prototype.getLanguages=kp.prototype.Ep;kp.prototype.i=function(){kp.g.i.call(this);this.aa.removeEventListener("versionupdate",this.qw)};kp.prototype.FB=new ij(256);
kp.prototype.V=function(a,b){return this.aa.V().query(this.So,b,a)};kp.prototype.getCopyrights=kp.prototype.V;function lp(a){lp.g.constructor.call(this,lp,a);var b=Do(this,a).mapVersion;this.Bn=a.queryParams||{};this.Uj=db(b)?b:pp[this.j().toString()];db(this.Uj)||qp(this)}u(lp,Co);t("H.service.omv.Service",lp);lp.prototype.Da=function(){return{subDomain:"vector",path:"v2/vectortiles/base/mc"}};lp.CONFIG_KEY="omv";var pp={};rb(pp);lp.prototype.Vz=function(){return this.Uj};lp.prototype.getMapVersion=lp.prototype.Vz;
function qp(a){a.s(a.j().clone().A("../../info"),function(b){b=b.mapVersion;var c=a.j().toString();a.Uj=b;b!==pp[c]&&(pp[c]=b,a.dispatchEvent("versionupdate"))},function(){})}lp.prototype.kd=function(a,b,c){b=b||{};var d={min:0,max:22};ya(c)&&ko(d,c);Wm&&(b.min=d.min=4);return new ej(new kp(this,a,b),d)};lp.prototype.createLayer=lp.prototype.kd;lp.prototype.Oa=function(a,b,c,d,e){return this.s(this.Lf(a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};
lp.prototype.Lf=function(a,b,c){a=this.j().clone().A(c+"/"+a+"/"+b+"/omv");db(this.Uj)&&a.B({mv:this.Uj}).B(this.Bn);return a};lp.prototype.km=function(a){return mn()+"/"+a};lp.prototype.Fj=function(a,b){if(!ab(a))throw new D(this.Fj,0,'"onResult" must be a function');if(!ab(b))throw new D(this.Fj,1,'"onError" must be a function');return this.s(this.j().clone().Ag("v2/vectortiles/pviews"),a,b)};lp.prototype.getPoliticalViews=lp.prototype.Fj;W.prototype.wh=function(a){return this.Ua(lp,a)};
W.prototype.getOMVService=W.prototype.wh;lp.prototype.Df=function(){this.ec=new no;this.s(this.j().clone().A("../../copyrights"),A(this.el,this),Xe)};lp.prototype.el=function(a){oo(this.ec,a);this.dispatchEvent("copyrightupdate")};lp.prototype.V=function(){this.ec||this.Df();return this.ec};lp.prototype.getCopyrights=lp.prototype.V;function rp(a){this.js=!!a.toBypassToken;if(!this.js&&!a.token)throw new D(rp,0,'"token" must be specified');lo(rp,"Use HERE IML service instead.");rp.g.constructor.call(this,rp,a);this.ox=a.token;this.ot={};this.Nl={}}u(rp,Co);t("H.service.xyz.Service",rp);rp.prototype.Da=function(){return{host:"xyz.api.here.com",path:"hub/spaces"}};rp.prototype.od=function(a){return Error(a.errorMessage||a.message)};
rp.prototype.Jp=function(a,b,c){gb(a,"String",this.Jp,0,'"projectId" must be a string');sp(this.Jp,1,b,c);a=tp(this.j().clone().Ag("project-api/projects/"+a));return this.s(a,b,c)};rp.prototype.getProject=rp.prototype.Jp;rp.prototype.ou=function(a,b,c){sp(this.ou,0,a,b);c=up(this,this.j().clone().B(c||{}));return this.s(c,a,b)};rp.prototype.getSpaces=rp.prototype.ou;
rp.prototype.jm=function(a,b,c){gb(a,"String",this.jm,0,'"spaceId" must be a string');sp(this.jm,1,b,c);a=up(this,this.j().clone().A(a));return this.s(a,b,c)};rp.prototype.getSpace=rp.prototype.jm;rp.prototype.zh=function(a,b,c){gb(a,"String",this.zh,0,'"spaceId" must be a string');sp(this.zh,1,b,c);a=up(this,this.j().clone().A(a+"/statistics"));return this.s(a,b,c)};rp.prototype.getStatistics=rp.prototype.zh;
rp.prototype.em=function(a,b,c,d,e,f,g){a=up(this,this.j().clone().A(d+"/tile/web/"+c+"_"+a+"_"+b+".mvtf").B(Object.assign({clip:!0},g)));return this.s(a,function(h){return h.arrayBuffer().then(e)},f,"arraybuffer")};rp.prototype.search=function(a,b,c,d){gb(a,"String",this.search,0,'"spaceId" must be a string');sp(this.search,1,b,c);a=up(this,this.j().clone().A(a+"/search").B(d||{}));return this.s(a,b,c)};rp.prototype.search=rp.prototype.search;
rp.prototype.Pe=function(a,b,c,d){gb(a,"String",this.Pe,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.Pe,1,'"params" must be an object');sp(this.Pe,2,c,d);a=up(this,this.j().clone().A(a+"/features").B(b));return this.s(a,c,d)};rp.prototype.getFeaturesById=rp.prototype.Pe;
rp.prototype.rh=function(a,b,c,d){gb(a,"String",this.rh,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.Pe,1,'"params" must be an object');sp(this.rh,2,c,d);a=up(this,this.j().clone().A(a+"/bbox").B(b));return this.s(a,c,d)};rp.prototype.getFeaturesByBoundingBox=rp.prototype.rh;rp.prototype.V=function(a){var b=this.ot[a];if(b)return b;this.Nl[a]||this.Df(a);return null};
rp.prototype.hf=function(a,b,c,d,e){gb(a,"String",this.hf,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.hf,1,'"geojsonObject" must be an object');sp(this.hf,2,c,d);if(e&&!ya(e))throw new D(this.hf,4,'"opt_params" must be an object');return vp(this,a,c,d,"PUT",b,e)};rp.prototype.putFeatures=rp.prototype.hf;
rp.prototype.ff=function(a,b,c,d,e){gb(a,"String",this.ff,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.ff,1,'"featureCollection" must be an object');sp(this.ff,2,c,d);if(e&&!ya(e))throw new D(this.ff,4,'"opt_params" must be an object');return vp(this,a,c,d,"POST",b,e)};rp.prototype.postFeatures=rp.prototype.ff;
rp.prototype.Bf=function(a,b,c,d){gb(a,"String",this.Bf,0,'"spaceId" must be a string');if(!ya(b))throw new D(this.Bf,1,'"params" must be an object');sp(this.Bf,2,c,d);return vp(this,a,c,d,"DELETE",B,b)};rp.prototype.deleteFeatures=rp.prototype.Bf;
function vp(a,b,c,d,e,f,g){var h=Object.assign(a.js?{}:{authorization:"Bearer "+a.ox},{"Content-Type":"application/geo+json"},a.Lc);e={method:e,headers:h};f&&(e.data=JSON.stringify(f));b=tp(a.j().clone().A(b+"/features").B(g||{}));f=new Tg("application/json",b.toString(),Ud,e);f.then(c,Eo(a,b,d));return f}rp.prototype.Df=function(a){var b=this;this.Nl[a]=wp;this.jm(a,function(c){b.Nl[a]=xp;b.ot[a]=c.copyright;b.dispatchEvent("copyrightupdate")},function(c){b.Nl[a]=yp;throw c;})};
function up(a,b){return a.js?b:tp(b).B({access_token:a.ox})}function tp(a){var b=Object.assign({},a.getQuery());delete b.apikey;return a.Jk(b)}rp.CONFIG_KEY="xyz";var wp=1,xp=2,yp=-1;function sp(a,b,c,d){if(!ab(c))throw new D(a,b,'"onResult" must be a function');if(!ab(d))throw new D(a,b+1,'"onError" must be a function');}W.prototype.EA=function(a){return this.Ua(rp,a)};W.prototype.getXYZService=W.prototype.EA;function zp(a,b,c){var d;zp.g.constructor.call(this,c?{min:c.min,max:c.max,engineType:c.engineType}:void 0);C(a,rp,zp,0);if(!jb(b))throw new D(zp,1,'"spaceId" must be a string');this.aa=a;this.Bg=b;this.Ek={};if(c&&(["limit","simplificationLevel","tags"].forEach(function(e){e in c&&(this.Ek[e]=c[e])},this),a=c.parameters))for(d in a)this.Ek[d]=a[d];this.Ya(this.Ap())}u(zp,R);t("H.service.xyz.Provider",zp);zp.prototype.s=function(a,b,c,d,e){return this.aa.em(a,b,c,this.Bg,d,e,this.Ek)};
zp.prototype.requestInternal=zp.prototype.s;zp.prototype.V=function(){return this.aa.V(this.Bg)};zp.prototype.getCopyrights=zp.prototype.V;zp.prototype.Tc=Ve;zp.prototype.providesOMV=zp.prototype.Tc;zp.prototype.L=function(){return this.nb()};zp.prototype.getStyle=zp.prototype.L;zp.prototype.Bb=function(a){C(a,Zg)&&a.Yb("MVT");this.Ya(a)};zp.prototype.setStyle=zp.prototype.Bb;
zp.prototype.Ap=function(){return this.vb===ph.WEBGL?new Zg({sources:{xyz:{type:"MVT"}},layers:{xyz:{data:{source:"xyz",layer:this.Bg},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#000000",width:"2px",join:"round",cap:"round"}}}}}}):
new H.map.render.harp.Style({styles:[{layer:this.Bg,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.Bg,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.Bg,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.Bg,when:["==",["geometry-type"],"LineString"],technique:"solid-line",
color:"#000000",lineWidth:"2px",renderOrder:203}]})};function Ap(a,b,c){c=c||{};var d=+c.min,e=+c.max;c.min=d?ec(d,1,17):1;c.max=e?ec(e,1,17):17;Ap.g.constructor.call(this,c);C(a,Bp,Ap,0);C(b,kg,Ap,1);this.aa=a;b.Yb&&b.Yb("OMV");this.Ya(b,!0);this.xl=jo(this)}u(Ap,R);t("H.service.trafficVectorTile.Provider",Ap);Ap.prototype.Tc=Ve;Ap.prototype.providesOMV=Ap.prototype.Tc;Ap.prototype.cc=function(a){return this.xl.test(a)};Ap.prototype.cacheFilter=Ap.prototype.cc;Ap.prototype.Sd=function(a,b,c){return this.aa.Lf(a,b,c).toString()};
Ap.prototype.getTileKey=Ap.prototype.Sd;Ap.prototype.Rb=function(){return this.qf};Ap.prototype.getCache=Ap.prototype.Rb;Ap.prototype.MAX_STORE_TIME=2592E6;Ap.prototype.Ri=function(){return nl()};Ap.prototype.qd=function(){return nl()?ml():Ap.g.qd.call(this)};Ap.prototype.s=function(a,b,c,d,e){return this.aa.Oa(a,b,c,d,e)};Ap.prototype.requestInternal=Ap.prototype.s;Ap.prototype.Bb=function(a){a.Yb&&a.Yb("OMV");this.Ya(a)};Ap.prototype.setStyle=Ap.prototype.Bb;Ap.prototype.L=function(){return Ap.g.nb.apply(this)};
Ap.prototype.getStyle=Ap.prototype.L;Ap.prototype.qf=new ij(256);Ap.prototype.V=function(){return null};Ap.prototype.getCopyrights=Ap.prototype.V;function Bp(a){Bp.g.constructor.call(this,Bp,a);this.vq=(a||Ze).layer||"traffic";this.he="mc";this.Zy="omv"}u(Bp,Co);t("H.service.trafficVectorTile.Service",Bp);Bp.prototype.Da=function(){return{subDomain:"traffic.vector",path:"v2"}};Bp.CONFIG_KEY="trafficVectorTile";Bp.prototype.kd=function(a,b,c){b=b||{};var d={min:0,max:22};ya(c)&&ko(d,c);return new ej(new Ap(this,a,b),d)};Bp.prototype.createLayer=Bp.prototype.kd;
Bp.prototype.Oa=function(a,b,c,d,e){return this.s(this.Lf(a,b,c),function(f){return f.arrayBuffer().then(d,e)},e,"arraybuffer")};Bp.prototype.Lf=function(a,b,c){return this.j().clone().A("traffictiles/"+this.vq+"/"+this.he+"/"+c+"/"+a+"/"+b+"/"+this.Zy)};Bp.prototype.km=function(a){return mn()+"/"+a};Bp.prototype.Qz=function(){return this.vq};Bp.prototype.getLayerName=Bp.prototype.Qz;W.prototype.Pp=function(a){return this.Ua(Bp,a)};W.prototype.getTrafficVectorTileService=W.prototype.Pp;function Cp(a,b,c,d,e,f,g){var h=this;g=g||{};f=f?f:{};var k=a.j().clone().A(b+"/"+a.gb+"/"+c).B(f),l=a.Yc;this.aa=a;this.ix=k;Kl.call(this,{tileSize:d,max:512===d?19:20,min:512===d?2:0,getURL:function(n,p,q){var r=h.ix.clone();l&&r.Ha(l[(q+p+n)%l.length]);r.A(q+"/"+n+"/"+p+"/"+d+"/"+e);return r.toString()},crossOrigin:g.crossOrigin,headers:g.headers,uri:k.toString().replace(/_/g,"")+d,engineType:g.engineType});this.jD=b;this.ki=c;this.Ga=f;this.So=c.split(".")[0];this.xe=A(this.xe,this);this.getCopyrights=
this.V;this.Te=!1;a.addEventListener("versionupdate",this.xe)}u(Cp,Kl);Cp.prototype.MAX_STORE_TIME=2592E6;Cp.prototype.s=function(a,b,c,d,e,f){this.Te||(lo(Dp,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Te=!0);return Cp.g.s.call(this,a,b,c,d,e,f)};Cp.prototype.requestInternal=Cp.prototype.s;Cp.prototype.i=function(){Kl.prototype.i.call(this);this.aa.removeEventListener("versionupdate",this.xe)};Cp.prototype.V=function(a,b){return this.aa.V().query(this.So,b,a)};
Cp.prototype.getCopyrights=Cp.prototype.V;Cp.prototype.xe=function(){var a=this.aa;this.ix=a.j().clone().A(this.jD+"/"+a.gb+"/"+this.ki).B(this.Ga);this.reload(!1)};Cp.prototype.Ri=function(){return nl()};Cp.prototype.qd=function(){return nl()?ml():Cp.g.qd.call(this)};function Dp(a){Dp.g.constructor.call(this,Dp,a);a=Do(this,a);this.Yc=a.shards;(this.Qa=a.ignoreTypes?null:a.type)&&this.j().Ha(this.Qa);this.gb=a.version;this.ec=new no;this.jr={};this.Ol=0;"newest"===this.gb&&this.mp()}u(Dp,Co);t("H.service.MapTileService",Dp);Dp.prototype.Da=function(){return{subDomain:"maps.ls",path:"maptile/2.1",type:"base",version:"newest",shards:["1","2","3","4"]}};Dp.CONFIG_KEY="maptile";
function Ep(a,b){for(var c={},d=a[b+"s"][b],e=d.length;e--;)c[d[e].id]=d[e];a[b+"s"]=c}Dp.prototype.qu=function(){return this.Qa};Dp.prototype.getType=Dp.prototype.qu;Dp.prototype.Rp=function(){return this.gb};Dp.prototype.getVersion=Dp.prototype.Rp;Dp.prototype.Xr=function(a){this.gb=a};Dp.prototype.V=function(){this.Ol||(this.gb&&"newest"!==this.gb||"traffic"===this.Qa)&&this.Df();return this.ec};Dp.prototype.getCopyrights=Dp.prototype.V;m=Dp.prototype;
m.os=function(a){a=a.response;var b;Ep(a,"map");Ep(a,"scheme");Ep(a,"tiletype");Ep(a,"format");Ep(a,"resolution");Ep(a,"language");if("newest"===this.gb&&"traffic"!==this.Qa)for(b in a.maps)a.maps[b].hash&&a.maps[b].newest&&(this.Xr(a.maps[b].hash),this.dispatchEvent("versionupdate"));this.$p=a;this.dispatchEvent("infoupdate")};m.el=function(a){oo(this.ec,a);this.dispatchEvent("copyrightupdate")};
m.mp=function(){var a=this;var b=this.j().clone().A("info").B({output:"json"});this.Yc&&b.Ha(this.Yc[0]);this.s(b,function(c){a.os(c)},function(c){throw c;})};m.Df=function(){var a=this;var b=this.j().clone().A("copyright").A(a.gb).B({output:"json"});this.Yc&&b.Ha(this.Yc[0]);this.Ol=1;this.s(b,function(c){a.Ol=2;a.el(c)},function(c){a.Ol=-1;throw c;})};m.Dj=function(){return this.$p};Dp.prototype.getInfo=Dp.prototype.Dj;
Dp.prototype.ij=function(a,b,c,d,e,f){var g=this.j().clone().A(a+"/"+this.gb+"/"+b+"/"+c+"/"+d).B(e?e:{}).toString();var h=0,k,l=g.length;if(0!==l)for(k=0;k<l;k++){var n=g.charCodeAt(k);h=(h<<5)-h+n;h|=0}g=h;h=this.jr[g];h||(h=new Cp(this,a,b,c,d,e,ko({headers:this.Lc},f||{})),this.jr[g]=h);return h};Dp.prototype.createTileProvider=Dp.prototype.ij;Dp.prototype.Md=function(a,b,c,d,e,f,g,h){a=this.ij(a,b,c,d,e,h);return new ej(a,{opacity:f,dark:!!g})};Dp.prototype.createTileLayer=Dp.prototype.Md;
W.prototype.Gp=function(a){return this.Ua(Dp,a)};W.prototype.getMapTileService=W.prototype.Gp;function Fp(a){Fp.g.constructor.call(this,Fp,a)}u(Fp,Co);t("H.service.SearchService",Fp);Fp.CONFIG_KEY="search";Fp.prototype.Da=function(){return{subDomain:"search",path:"v1"}};Fp.prototype.od=function(a){a=[a.title,a.action,a.cause].filter(function(b){return b});return Error(a.join(". "))};Fp.prototype.sp=function(a,b,c){a=this.j().clone().Ha("geocode").A("geocode").B(a);return this.s(a,b,c)};Fp.prototype.geocode=Fp.prototype.sp;
Fp.prototype.Ar=function(a,b,c){a=this.j().clone().Ha("revgeocode").A("revgeocode").B(a);return this.s(a,b,c)};Fp.prototype.reverseGeocode=Fp.prototype.Ar;Fp.prototype.ey=function(a,b,c){a=this.j().clone().Ha("autosuggest").A("autosuggest").B(a);return this.s(a,b,c)};Fp.prototype.autosuggest=Fp.prototype.ey;Fp.prototype.Hy=function(a,b,c){a=this.j().clone().Ha("discover").A("discover").B(a);return this.s(a,b,c)};Fp.prototype.discover=Fp.prototype.Hy;
Fp.prototype.lB=function(a,b,c){a=this.j().clone().Ha("lookup").A("lookup").B(a);return this.s(a,b,c)};Fp.prototype.lookup=Fp.prototype.lB;Fp.prototype.iy=function(a,b,c){a=this.j().clone().Ha("browse").A("browse").B(a);return this.s(a,b,c)};Fp.prototype.browse=Fp.prototype.iy;W.prototype.rA=function(a){return this.Ua(Fp,a)};W.prototype.getSearchService=W.prototype.rA;function Gp(a){Gp.g.constructor.call(this,Gp,a)}u(Gp,Co);t("H.service.publicTransit.Service",Gp);Gp.prototype.Da=function(){return{subDomain:"transit.router",path:"v8"}};Gp.CONFIG_KEY="publicTransit";Gp.prototype.oA=function(a,b,c){a=this.j().clone().A("routes").B(a);return this.s(a,b,c)};Gp.prototype.getRoutes=Gp.prototype.oA;Gp.prototype.vz=function(a,b,c){a=this.j().clone().A("departures").B(a);return this.s(a,b,c)};Gp.prototype.getDepartures=Gp.prototype.vz;
Gp.prototype.sA=function(a,b,c){a=this.j().clone().A("stations").B(a);return this.s(a,b,c)};Gp.prototype.getStations=Gp.prototype.sA;Gp.prototype.od=function(a){return Error(JSON.stringify(a))};W.prototype.kA=function(a){return this.Ua(Gp,a)};W.prototype.getPublicTransitService=W.prototype.kA;function Hp(a,b,c,d){if(!ab(c))throw new D(a,b,"has invalid type");if(!ab(d))throw new D(a,b+1,"has invalid type");};function Ip(a,b,c,d,e,f){Hp(Ip,1,b,c);Hp(Ip,2,d,e);(this.Pn=a.length)?(this.Nb=a,this.gn=b,this.Ym=c,this.ak=0,this.rn=A(this.rn,this),this.xy=d,this.vy=e,this.Vh=Wa(),Ta(this.Vh,Jp,f||{}),this.es={},x.setTimeout(this.rn,0)):b(Ye,!0)}var Jp={duration:100,ez:"geometry",dz:"WKT",KC:"searchAttributes",vt:B};
Ip.prototype.rn=function(){var a=[];var b=!1;for(var c=Gj(),d;this.ak<this.Pn;){var e=this.Nb[this.ak];b=e.attributes;d=e.layerId||this.Vh.vt;e.distance&&(b[this.Vh.KC]={nearest:new pc(e.nearestLat,e.nearestLon),distance:e.distance});if(e=e[this.Vh.ez]){try{var f=Of(new Oa(e))}catch(g){this.Ym(new x.Error(g.message));b=!0;break}b[this.Vh.dz]=f}(e=this.es[d])||(e=this.es[d]=this.xy({layerId:d,columnNames:Object.keys(b)}));b=this.vy(e,b);a.push(b);this.ak++;if((b=this.ak===this.Pn)||Gj()-c>=this.Vh.duration){this.gn(a,
b);break}}b?this.es={}:this.$k=x.setTimeout(this.rn,0)};Ip.prototype.cancel=function(){x.clearTimeout(this.$k);this.ak<this.Pn&&this.Ym(new x.Error("parsing canceled"))};Ip.prototype.cancel=Ip.prototype.cancel;function Kp(a){var b=Lp;if(!a||!jb(Qe(a.layerId,a.layer))||!ob(a.level)||db(a.rowFilter)&&!ab(a.rowFilter)||db(a.rowFilterContext)&&!ya(a.rowFilterContext))throw new D(b,1,db("invalid layer config")?"invalid layer config":a);};function Mp(a,b){var c={};this.fC=a;Ta(c,b||c);Xk.call(this,c);this.Fn={};a=this.Hc(Wh.SPATIAL);a.update(a.Jd+1,Ih.ADD)}u(Mp,Xk);t("H.service.remote.ObjectProvider",Mp);Mp.prototype.u=function(){Xk.prototype.u.call(this)};Mp.prototype.dispose=Mp.prototype.u;Mp.prototype.le=function(){return Ye};Mp.prototype.requestMarkers=Mp.prototype.le;Mp.prototype.ke=function(){return Ye};Mp.prototype.requestDomMarkers=Mp.prototype.ke;Mp.prototype.rg=function(){return Ye};Mp.prototype.requestOverlays=Mp.prototype.rg;
Mp.prototype.Sc=Ve;Mp.prototype.providesMarkers=Mp.prototype.Sc;Mp.prototype.Rc=Ve;Mp.prototype.providesDomMarkers=Mp.prototype.Rc;Mp.prototype.ie=Ve;Mp.prototype.providesSpatials=Mp.prototype.ie;Mp.prototype.Jn=function(){return Ye};Mp.prototype.requestSpatials=Mp.prototype.Jn;function Np(a){return a.Td(!0)}Mp.prototype.Kn=function(a,b){a=Op(this,a,Pp);b&&(a=a.filter(Np));return a};Mp.prototype.requestSpatialsByTile=Mp.prototype.Kn;
function Op(a,b,c){var d=b.Fi&&b.Fi[c],e;!d&&(e=b.kl)&&(delete b.kl,(b.Fi=a=a.fC.parse(a,b,e))&&(d=a[c]));return d||Ye}Mp.prototype.$=function(a){var b=a.xb();if(this.Fn[b])throw new Ab(this.$,"Remote object "+b+" already added");return this.Fn[b]=a};Mp.prototype.Na=function(a){delete this.Fn[a.xb()]};var Pp="spatials";function Qp(a){a=a||{};var b=a.tileCacheSize||1024,c=a.resultType,d=a.styleCallback;db(a.min)||(a.min=12);Qp.g.constructor.call(this,a);if(-1===Rp.indexOf(c))throw new D(Qp,2,"invalid resultType");this.resultType=c;if(d&&!ab(d))throw new D(Qp,2,"invalid style callback");this.vi=d;this.oa=a.pixelRatio||Ie();this.Dc=A(this.Dc,this);this.Un(new ij(b,A(this.fe,this)));this.createTileInternal=4===c||8===c?A(this.wy,this):A(this.uy,this)}u(Qp,R);t("H.service.extension.TileProvider",Qp);
Qp.prototype.mq=!1;Qp.prototype.getCapabilities=function(){return Qp.g.getCapabilities.call(this)|hh.CROP_LINES_BY_TILE|hh.CROP_POLYGONS_BY_TILE};Qp.prototype.Oa=function(a,b,c,d){return this.mq?Qp.g.Oa.call(this,a,b,c,d):B};Qp.prototype.requestTile=Qp.prototype.Oa;Qp.prototype.Dc=function(a){this.dispatchEvent(new Ee("error",jb(a)?a:a+"",this))};Qp.prototype.Sc=function(){return 1===this.resultType};Qp.prototype.providesMarkers=Qp.prototype.Sc;Qp.prototype.Rc=function(){return 2===this.resultType};
Qp.prototype.providesDomMarkers=Qp.prototype.Rc;Qp.prototype.ie=function(){return 4===this.resultType||8===this.resultType};Qp.prototype.providesSpatials=Qp.prototype.ie;function Sp(a){var b=a.yd;b||(a.Uv||(a.Uv=a.lu(a.resultType,a.vi,a.Dc)),b=a.yd=new Mp(a.Uv),b.fa(a),b.addEventListener(a.l.Aa,A(a.de,a)),b.mw=!0);return b}
Qp.prototype.uy=function(a,b,c,d){var e=this.getTileKey(a,b,c);e=this.Rb().get(e);var f=2==this.resultType,g=[],h=Sp(this);e?e.valid=!0:(a=e=new qj(a,b,c,z),delete a.Fi,a.kl=d);d=f?Op(h,e,"domMarkers"):Op(h,e,"markers");for(b=d.length;b--;)a=d[b],a.us=e,(f||1===a.kc().getState())&&g.push(a);e.data=g;return e};Qp.prototype.de=function(a){if(a=a.target.us)a.valid=!1};Qp.prototype.RC=function(a){this.xw=!!a};Qp.prototype.setTileCanvasRendering=Qp.prototype.RC;Qp.prototype.xw=!0;
Qp.prototype.wy=function(a,b,c,d){var e=Sp(this),f=this.getTileKey(a,b,c),g=this.tileSize,h=this.Rb().get(f);h||(a=h=new rj(f,a,b,c,g,this.oa,c,e),delete a.Fi,a.kl=d);this.xw?(d=ro.pop(g),h.N(d)||ro.push(d,g)):xj(h);return h};Qp.prototype.fe=function(a,b){var c;if(4===this.resultType||8===this.resultType){a=b.cb();for(c=a.length;c--;)delete a[c].uk[b.key];if(a=b.Dn())ro.push(a,this.tileSize),b.En()}else for(a=b.data,c=a.length;c--;)delete a[c].us};Qp.prototype.i=function(){Qp.g.i.call(this);Sp(this).u()};
var Tp={MARKER:1,DOM_MARKER:2,POLYLINE:4,POLYGON:8};Qp.ResultType=Tp;var Rp=[1,2,4,8];function Up(){}t("H.service.extension.dataView.IColumn",Up);Up.prototype.va=function(){};Up.prototype.getCell=Up.prototype.va;function Vp(a,b){this.$b=a;this.Fl=b}t("H.service.extension.dataView.ObjColumn",Vp);Vp.prototype.va=function(a){return this.$b.va(a,this.Fl)};Vp.prototype.getCell=Vp.prototype.va;function Wp(){}t("H.service.extension.dataView.IRow",Wp);Wp.prototype.bb=function(){};Wp.prototype.getColumnNames=Wp.prototype.bb;Wp.prototype.va=function(){};Wp.prototype.getCell=Wp.prototype.va;Wp.prototype.Kf=function(){};Wp.prototype.getTable=Wp.prototype.Kf;function Xp(a,b){this.$b=a;this.Ak=b}t("H.service.extension.dataView.ObjRow",Xp);Xp.prototype.bb=function(){return this.$b.bb()};Xp.prototype.getColumnNames=Xp.prototype.bb;Xp.prototype.va=function(a){return this.$b.va(this.Ak,a)};Xp.prototype.getCell=Xp.prototype.va;Xp.prototype.Kf=function(){return this.$b};Xp.prototype.getTable=Xp.prototype.Kf;function Yp(){}t("H.service.extension.dataView.ITable",Yp);Yp.prototype.uh=function(){};Yp.prototype.getMeta=Yp.prototype.uh;Yp.prototype.yh=function(){};Yp.prototype.getRowCount=Yp.prototype.yh;Yp.prototype.Rd=function(){};Yp.prototype.getRow=Yp.prototype.Rd;Yp.prototype.bb=function(){};Yp.prototype.getColumnNames=Yp.prototype.bb;Yp.prototype.yj=function(){};Yp.prototype.getColumn=Yp.prototype.yj;Yp.prototype.va=function(){};Yp.prototype.getCell=Yp.prototype.va;Yp.prototype.concat=function(){};
Yp.prototype.concat=Yp.prototype.concat;function Zp(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):B);this.Nb=a;if(b)for(this.$g=b,this.Oo=a=Wa(),d=b.length;d--;)a[b[d]]=!0;c!==B&&(this.Gq=c)}t("H.service.extension.dataView.ObjTable",Zp);m=Zp.prototype;m.Gq=B;m.Nb=B;m.$g=B;m.Oo=B;m.uh=function(){return this.Gq};Zp.prototype.getMeta=Zp.prototype.uh;Zp.prototype.yh=function(){return this.Nb?this.Nb.length:0};Zp.prototype.getRowCount=Zp.prototype.yh;Zp.prototype.Rd=function(a){var b=this.Nb;return b&&b[a]?new Xp(this,a):B};
Zp.prototype.getRow=Zp.prototype.Rd;Zp.prototype.bb=function(){return this.$g||Ye};Zp.prototype.getColumnNames=Zp.prototype.bb;Zp.prototype.yj=function(a){return this.Oo[a]?new Vp(this,a):B};Zp.prototype.getColumn=Zp.prototype.yj;Zp.prototype.va=function(a,b){var c=this.Nb;return(a=c&&this.Oo[b]&&c[a])&&a[b]};Zp.prototype.getCell=Zp.prototype.va;
Zp.prototype.concat=function(){var a=arguments.length,b,c=this.$g,d=""+this.$g,e=(this.Nb||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof Zp))throw new D(this.concat,b);if(f.Nb){if(c&&""+f.$g!==d)throw new D(this.concat,b,"Incompatible columns!");e=e.concat(f.Nb)}}return new Zp(e,this.$g,this.Gq)};Zp.prototype.concat=Zp.prototype.concat;function $p(a,b,c,d){d=d||aq;this.uk={};d.provider=a;this.invalidate=We;$p.g.constructor.call(this,b,d);delete this.invalidate;c&&(this.tD=c);this.sa(Ih.ADD)}u($p,ri);t("H.service.remote.Spatial",$p);var aq={};$p.prototype.xb=function(){return this.tD||ri.prototype.xb.call(this)};$p.prototype.getId=$p.prototype.xb;$p.prototype.On=Xe;$p.prototype.retain=$p.prototype.On;$p.prototype.release=Ve;$p.prototype.release=$p.prototype.release;function bq(a,b){this.Zl=a;b&&(this.labels=b)}var cq=new bq(Ye);
$p.prototype.sh=function(a){return(this.uk[a.key]||cq).Zl};$p.prototype.getGeometriesForTile=$p.prototype.sh;$p.prototype.Dp=function(a){return(this.uk[a.key]||cq).labels};$p.prototype.getLabels=$p.prototype.Dp;function dq(a,b,c){a.uk[b.key]=new bq(c,void 0)};function eq(a,b,c){var d=8===a;this.vi=b;this.Lt=c||Xe;(this.Fm=4===a||d)?this.Se=d:this.Pu=1===a;this.Zt=this.Fm?"$HProjGeometry":"geometry"}
eq.prototype.parse=function(a,b,c){var d,e={},f=[],g,h;var k=0;for(g=c.length;k<g;k++){var l=c[k];var n=l.Rows;if(l=n.length){var p=Object.keys(n[0]).filter(function(v){return"geometry"!==v&&"$HProjGeometry"!==v});p=new Zp(n,p);for(h=0;h<l;h++){var q=n[h];if(d=q[this.Zt]){if(delete q[this.Zt],q=p.Rd(h))try{var r=this.Fm?fq(this,a,b,q,d):gq(this,a,q,d.path);r.fa(a);f.push(r)}catch(v){this.Lt(v.message)}}else this.Lt("Layer must contain geometries")}}}e[this.Fm?"spatials":this.Pu?"markers":"domMarkers"]=
f;return e};function fq(a,b,c,d,e){var f=[],g=e.paths,h=g.length,k=0,l=a.vi&&a.vi(d);for(a=new $p(b,a.Se,B,{style:l||a.Fy,data:d});k!==h;){b=f;d=b.push;l=g[k++];for(var n=0,p=l.length,q=[];n<p;)q.push(new L(l[n++],l[n++]));d.call(b,q)}dq(a,c,[new ni(f,e.interiorsIndex,e.outlinesIndex)]);return a}function gq(a,b,c,d){d=new pc(d[0],d[1]);var e=a.vi&&a.vi(c);a.Pu?(a={icon:e,data:c,provider:b},a=new ci(d,a)):(a={icon:e,data:c,provider:b},a=new Ti(d,a));return a};function Lp(a,b,c){var d=this,e=b&&b.rowFilter,f=c.resultType;Lp.g.constructor.call(this,c);C(a,hq,Lp,0);Kp(b);e?(c=Ra(b),c.rowFilter=e.toString()):c=Ra(b);delete c.layer;c.layerId=Qe(b.layerId,b.layer);(new aj).registerProcessor("pde","H.service.extension.worker.processor");a=a.j().clone().A(iq+"."+jq).B({meta:1});(new cj("pde",{message:[this.uid,0,{tileSize:this.tileSize,projected:!0,onlyOutline:4===f,serverUrl:a.toString(),layerConfigs:[c],horizontalMargin:1}]})).then(function(){d.mq=!0;d.kb()},
this.Dc)}u(Lp,Qp);t("H.service.extension.platformData.TileProvider",Lp);Lp.prototype.lu=function(a,b,c){a=new eq(a,b,c);a.Fy=kq;return a};var kq=new di({strokeColor:"transparent",fillColor:"transparent",lineWidth:0,lineJoin:"round",lineCap:"round"});
Lp.prototype.s=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Rb().get(g);var k={cancel:Xe},l=!0,n=this.resultType;g&&(4===n||8===n?g.Eh()||(d(ro.pop(this.tileSize),null),l=!1):(d(z),l=!1));if(l){var p=po.setTimeout(function(){h=new cj("pde",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():po.clearTimeout(p)}}return k};Lp.prototype.requestInternal=Lp.prototype.s;Lp.prototype.i=function(){Lp.g.i.call(this);new cj("pde",{message:[this.uid,3]})};
Lp.ResultType=Tp;function lq(a){this.ny=a}lq.prototype.cancel=function(){for(var a=this.ny,b=a.length;b--;)a[b].cancel();a.length=0};lq.prototype.cancel=lq.prototype.cancel;function hq(a){hq.g.constructor.call(this,hq,a);lo(hq)}u(hq,Co);t("H.service.extension.platformData.Service",hq);hq.prototype.Da=function(){return{subDomain:"s.fleet.ls",path:"1"}};hq.CONFIG_KEY="platformData";hq.prototype.request=function(a,b,c,d,e){return this.K(a,b,c,d,e)};hq.prototype.request=hq.prototype.request;
hq.prototype.K=function(a,b,c,d,e){var f="text/plain";if(!a)throw new D(this.request,0,a);if(!b)throw new D(this.request,1,b);if(!d)throw new D(this.request,3,d);if(!e)throw new D(this.request,4,e);a=this.j().clone().A(a+"."+b).B(c);b===mq.JSON&&(f="application/json");return this.s(a,d,e,f)};var iq="tiles";
hq.EntryPoint={DOC_ATTRIBUTES:"doc/attributes",DOC_LAYER:"doc/layer",DOC_LAYERS:"doc/layers",DOC_MAPS:"doc/maps",DOC_INDEXES:"doc/indexes",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SERVICE_CONFIGURATION:"serviceconfiguration",STATIC:"static",TILE:"tile",TILES:iq,FILE:"file",INDEX:"index"};var jq="json",mq={TXT:"txt",JSON:jq,HTML:"html",BIN:"bin"};hq.EntryPointType=mq;
hq.prototype.Md=function(a,b){var c=b&&b.resultType;a=new Lp(this,a,b);return 1==c||2===c?new Dh(a):new ej(a)};hq.prototype.createTileLayer=hq.prototype.Md;hq.prototype.wg=function(a,b,c,d){var e=[],f,g=b.layer_id||b.layer_ids;a=this.request(a,jq,b,function(h){f=new Ip(h.geometries,c,d,function(k){return new Zp([],k.columnNames,k)},function(k,l){var n=k.Rd;k.Nb?k.Nb.push(l):k.Nb=[l];return n.call(k,k.Nb.length-1)},{vt:g});e.push(f)},function(h){d(new x.Error(h))});e.push(a);return new lq(e)};
function nq(a,b,c){if(!ib(a))throw new D(c,0,"has invalid type");if(!ib(b))throw new D(c,1,"has invalid type");if(a.length!==b.length||!a.length)throw new D(c,1,"specify one key attribute for each given layer id in the same order");}
hq.prototype.ne=function(a,b,c,d,e,f){function g(l,n){n&&h--;d(l,!h)}var h,k=[];nq(a,b,this.ne);Hp(this.ne,3,d,e);C(c,F,this.ne,2);c={bbox:c.ga+","+c.X+";"+c.ha+","+c.da};f&&Ta(c,f);a=c.layer_id?[c.layer_id]:a;f=0;for(h=a.length;f<h;f++)c.layer_id=a[f],c.key_attribute=b[f],k.push(this.wg("search/bbox",c,g,e));return new lq(k)};hq.prototype.searchByBoundingBox=hq.prototype.ne;
hq.prototype.Vc=function(a,b,c,d,e,f,g){nq(a,b,this.Vc);C(c,pc,this.Vc,2,"has invalid type");if(!ob(d))throw new D(this.Vc,3,"has invalid type");Hp(this.Vc,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),proximity:c.lat+","+c.lng+","+d};g&&Ta(a,g);return this.wg("search/proximity",a,e,f)};hq.prototype.searchByProximity=hq.prototype.Vc;
hq.prototype.Uc=function(a,b,c,d,e,f,g){var h="";nq(a,b,this.Uc);if(!jb(c)&&!C(c,K))throw new D(this.Uc,1,"has invalid type");if(!ob(d))throw new D(this.Uc,2,"has invalid type");Hp(this.Uc,4,e,f);a={layer_ids:a.join(","),key_attributes:b.join(","),radius:d};if(jb(c))a.route_id=c;else{d=c.T;c=0;for(b=d.length;c<b;c+=3)h+=d[c]+","+d[c+1],c<b-3&&(h+=";");a.corridor=h}g&&Ta(a,g);return this.wg("search/corridor",a,e,f)};hq.prototype.searchByCorridor=hq.prototype.Uc;
W.prototype.eA=function(a){return this.Ua(hq,a)};W.prototype.getPlatformDataService=W.prototype.eA;function oq(a){Go.g.constructor.call(this,oq,a);lo(oq)}u(oq,Co);t("H.service.extension.customRoute.Service",oq);oq.prototype.Da=function(){return{subDomain:"s.fleet.ls",path:"2"}};oq.CONFIG_KEY="customRoute";oq.prototype.od=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a)};oq.prototype.Tg=function(a,b,c){Hp(this.Tg,1,b,c);a=this.j().clone().A("calculateroute.json").B(a);return this.s(a,b,c)};oq.prototype.calculateRoute=oq.prototype.Tg;
W.prototype.uz=function(a){return this.Ua(oq,a)};W.prototype.getCustomRoutingService=W.prototype.uz;function pq(a){pq.g.constructor.call(this,pq,a);lo(pq)}u(pq,Co);t("H.service.extension.geofencing.Service",pq);pq.prototype.Da=function(){return{subDomain:"fleet.ls",path:"2"}};pq.CONFIG_KEY="geofencing";pq.prototype.request=function(a,b,c,d){return this.K(a,b,c,d)};pq.prototype.request=pq.prototype.request;pq.prototype.od=function(a){return Error(a.issues&&a.issues.length?a.issues.map(function(b){return b.message}).join(". "):a.message||a.response_code)};
pq.prototype.K=function(a,b,c,d){if(!a)throw new D(this.request,0,a);if(!ab(c))throw new TypeError("onResult must be a function");if(!ab(d))throw new TypeError("onError must be a function");a=this.j().clone().A(a+".json").B(b);return this.s(a,c,d)};pq.EntryPoint={SEARCH_PROXIMITY:"search/proximity"};W.prototype.Gz=function(a){return this.Ua(pq,a)};W.prototype.getGeofencingService=W.prototype.Gz;function qq(a){var b=rq;if(!a||!jb(a.layerId)||db(a.rowFilter)&&!ab(a.rowFilter)||db(a.rowFilterContext)&&!ya(a.rowFilterContext))throw new D(b,1,db("invalid layer config")?"invalid layer config":a);}function sq(a){return jb(a)&&/^[A-Z][A-Z0-9_]*$/.test(a)}function tq(a){for(var b=a&&a.length,c=2<=b&&"WKT"===a[--b]&&"GEOMETRY_ID"===a[--b];c&&b--;)c=sq(a[b]);return c}
function uq(a,b){var c="",d=[];if(b){var e=a.geometries;if(e&&e.length){var f=Object.keys(e[0].attributes);c=c+("Meta:\t"+b+"\n")+f.join("\t");c+="\tWKT\n";for(a=0;a<e.length;a++){var g=e[a].attributes;var h=e[a].geometry;for(b=0;b<f.length;b++)d.push(g[f[b]]);c+=d.join("\t");c+="\t"+h+"\n";d=[]}}}else{h={};d=[];if(a.geometries)for(e=0;e<a.geometries.length;e++)b=a.geometries[e],h[b.layerId]||(h[b.layerId]=[]),h[b.layerId].push(b);for(f in h)d.push({layerId:f,geometries:h[f]});for(a=0;a<d.length;a++)c+=
uq(d[a],d[a].layerId)}return c};function rq(a,b,c){var d=this,e=b&&b.rowFilter,f;rq.g.constructor.call(this,c);C(a,vq,rq,0);var g=c.resultType;qq(b);if(e){var h=Ra(b);h.rowFilter=e.toString()}else h=b;(new aj).registerProcessor("cle","H.service.extension.worker.processor");var k=b.layerId;a.request(wq,xq,{detail_level:"all",layer_id:k},function(l){l=l.layers;var n;for(n=0;n<l.length;n++)if(l[n].layerId===k){h.level=l[n].level;break}f=a.j().clone().A(yq+"."+xq).B({meta:1});(new cj("cle",{message:[d.uid,0,{tileSize:d.tileSize,
projected:!0,onlyOutline:4===g,serverUrl:f.toString(),layerConfigs:[h],batchTiles:!1,horizontalMargin:1}]})).then(function(){d.mq=!0;d.kb()},d.Dc)},function(l){d.Dc(l.message)})}u(rq,Qp);t("H.service.extension.customLocation.TileProvider",rq);rq.prototype.lu=function(a,b,c){return new eq(a,b,c)};
rq.prototype.s=function(a,b,c,d,e){var f=this,g=this.getTileKey(a,b,c),h;g=this.Rb().get(g);var k={cancel:Xe},l=!0,n=this.resultType;g&&(4===n||8===n?g.Eh()||(d(ro.pop(this.tileSize),null),l=!1):(d(z),l=!1));if(l){var p=po.setTimeout(function(){h=new cj("cle",{message:[f.uid,1,[a,b,c]]});h.then(d,e)},500);k.cancel=function(){h?h.cancel():po.clearTimeout(p)}}return k};rq.prototype.requestInternal=rq.prototype.s;rq.prototype.i=function(){rq.g.i.call(this);new cj("cle",{message:[this.uid,3]})};t("H.service.extension.customLocation.Permission",{READ:"read",WRITE:"write",EXPORT:"export"});t("H.service.extension.customLocation.Storage",{READONLY:"readonly",UPDATABLE:"updatable"});function zq(){if(Aq)throw new Ab(zq);}t("H.service.extension.customLocation.Table",zq);var Aq=!0;function Bq(a,b){var c;Aq=!1;var d=new zq;Aq=!0;d.Rm=Za(x.JSON.parse(x.JSON.stringify(a)));a=a.columnNames;var e=Wa();for(c=a.length;c--;)e[a[c]]=c;d.No=e;d.Cc=a.length;if(b){if(b.length%a.length)throw new D(Bq,1,"Invalid number of cells");}else b=[];d.ub=b;return d}zq.prototype.uh=function(){return this.Rm};zq.prototype.getMeta=zq.prototype.uh;zq.prototype.yh=function(){return this.ub.length/this.Cc};
zq.prototype.getRowCount=zq.prototype.yh;zq.prototype.Rd=function(a){return a<this.ub.length/this.Cc?new Cq(this,a):B};zq.prototype.getRow=zq.prototype.Rd;zq.prototype.pA=function(){var a=this.ub.length/this.Cc,b,c=new x.Array(a);for(b=0;b<a;b++)c[b]=new Cq(this,b);return c};zq.prototype.getRows=zq.prototype.pA;zq.prototype.uo=function(a){var b=this.Cc,c=this.ub,d=c.length/this.Cc;if(!a||a.length%b)throw new D(this.uo,0,"Invalid number of cells");this.ub=c.concat(a);return d};
zq.prototype.addCells=zq.prototype.uo;zq.prototype.Zx=function(){for(var a=this.Cc,b=this.ub,c=this.ub.length/this.Cc;a--;)b.push(z);return this.Rd(c)};zq.prototype.addRow=zq.prototype.Zx;zq.prototype.bb=function(){return this.Rm.columnNames};zq.prototype.getColumnNames=zq.prototype.bb;zq.prototype.yj=function(a){return this.No[a]===B?B:new Dq(this,a)};zq.prototype.getColumn=zq.prototype.yj;zq.prototype.va=function(a,b){return this.ub[a*this.Cc+this.No[b]]};zq.prototype.getCell=zq.prototype.va;
zq.prototype.pe=function(a,b,c){b=this.No[b];if(a>=this.ub.length/this.Cc)throw new D(this.pe,0,"Row index out of bounds");if(b===B)throw new D(this.pe,0,"Column unknown");this.ub[a*this.Cc+b]=c};zq.prototype.setCell=zq.prototype.pe;
zq.prototype.concat=function(a){var b=arguments.length,c,d=""+this.bb(),e=this.ub?this.ub.slice():[];for(c=0;c<b;c++){var f=arguments[c];if(!(f instanceof zq))throw new D(this.concat,c);if(""+f.bb()!==d)throw new D(this.concat,c,"Incompatible columns!");f.ub&&(e=e.concat(f.ub))}return Bq(this.Rm,e)};zq.prototype.concat=zq.prototype.concat;var Eq=/(\n|\t|\r|")/;
zq.prototype.ks=function(a,b){var c,d=this.Cc,e=this.bb(),f=[],g=[],h=this.ub,k=-1;for(c=0;c<d;c++)if(!a||a.test(e[c]))"WKT"===e[c]&&(k=f.length),f.push(c);if(!(a=f.length))throw new D(this.ks,1,"No columns filtered");Fq(this,g,e,0,d,f,a,k);if(b){var l=b.length;for(c=0;c<l;c++)g.push("\n"),e=b[c],Fq(this,g,h,e,d,f,a,k)}else for(l=this.yh(),e=0;e<l;e++)g.push("\n"),Fq(this,g,h,e,d,f,a,k);return g.join("")};
function Fq(a,b,c,d,e,f,g,h){var k;for(k=0;k<g;k++){k&&b.push("\t");var l=c[d*e+f[k]];if(k!==h){if(l!==z){l=String(l);if(Eq.test(l))throw new D(a.ks,0,'Invalid character (\\n, \\r, \\t, or ") in row '+d+" column "+a.Rm.columnNames[f[k]]);b.push(l)}}else b.push(l)}}function Dq(a,b){this.$b=a;this.Fl=b}zq.Column=Dq;Dq.prototype.va=function(a){return this.$b.va(a,this.Fl)};Dq.prototype.getCell=Dq.prototype.va;Dq.prototype.pe=function(a,b){this.$b.pe(a,this.Fl,b)};Dq.prototype.setCell=Dq.prototype.pe;
function Cq(a,b){this.$b=a;this.Ak=b}zq.Row=Cq;Cq.prototype.bb=function(){return this.$b.bb()};Cq.prototype.getColumnNames=Cq.prototype.bb;Cq.prototype.va=function(a){return this.$b.va(this.Ak,a)};Cq.prototype.getCell=Cq.prototype.va;Cq.prototype.pe=function(a,b){this.$b.pe(this.Ak,a,b)};Cq.prototype.setCell=Cq.prototype.pe;Cq.prototype.Kf=function(){return this.$b};Cq.prototype.getTable=Cq.prototype.Kf;function Gq(a){if(a===B)a="\t";else if(!/^[^"\r\n]$/.test(a))throw new D(Gq,0);this.Nx=String(a).charCodeAt(0);this.ud=A(this.ud,this);this.o=Hq}var Hq=0;m=Gq.prototype;m.getState=function(){return this.o};function Iq(a,b,c){var d=a.o;if(d!==b)throw 1===d&&(a.o=Hq),new Ab(c,"Requires state: "+["READY","PARSE","PAUSE"][b]+" but found "+["READY","PARSE","PAUSE"][d]);}m.abort=function(){Iq(this,2,Gq.prototype.abort);this.o=Hq};
m.ud=function(a){this.o=Hq;throw new D(Gq.prototype.parse,0,"Malformed DSV at row "+this.ad.Br+" column "+this.ad.aj+": "+a);};function Jq(a,b){var c=[];a.parse(b,function(d,e,f){1>d&&(c[e]=f);return 0<d});a.o=Hq;return c}m.parse=function(a,b,c){Iq(this,Hq,Gq.prototype.parse);a=a.trim();this.ad=new Kq(a,this.Nx,this.ud);this.LB=b;this.Bv=c||We;this.o=2;this.resume()};m.Bv=We;
m.resume=function(){var a=this.ad,b=[];Iq(this,2,Gq.prototype.resume);this.o=1;do{if(!a.Yp){this.o=Hq;break}if(e>a.aj){if(void 0!==c&&c!==e){this.ad.ud("The number of columns must be the same for all rows");return}var c=e}var d=a.Br;var e=a.aj;var f=a.Gl;var g=this.Bv(d,e,a);if(a.Gl>f)for(;-1!==a.next(););else{for(;-1!==(f=a.next());)b.push(f);g=String.fromCharCode.apply(z,b);b.length=0}Lq(a);this.LB(d,e,g)&&(this.o=a.Yp?2:Hq)}while(1===this.o);2!=this.o&&void 0!==c&&0<e&&c!==e&&this.ad.ud("The number of columns must be the same for all rows")};
function Kq(a,b,c){this.ad=new Oa(a);this.Es=b;this.Yp=!0;this.Gl=this.Br=this.aj=0;Lq(this);this.ud=c;this.Ac=[];this.Rf=!1}m=Kq.prototype;m.Gl=0;function Lq(a){var b=a.ad.fb();a.Ut=!1;(a.UA=34===b)&&a.ad.next()}function Mq(a,b){var c=a.ad;a.Ut=!0;switch(b){case a.Es:a.aj++;break;case 13:c.next(),10!==c.fb()&&a.ud("CR without LF");case 10:a.aj=0;a.Br++;break;case -1:a.Yp=!1;break;default:a.ud("End of field expected")}c.next();return-1}
m.fb=function(){if(this.Ut)var a=-1;else{var b=this.ad;a=b.fb();if(this.UA)switch(a){case 34:b.next();a=b.fb();34!==a&&(a=Mq(this,a));break;case -1:this.ud("Closing quotation mark expected")}else switch(a){case 34:this.ud("Unexpected quotation mark");case this.Es:case 13:case 10:case -1:a=Mq(this,a)}}return a};m.ui=function(){this.Rf=!0;this.Ac=[]};m.ih=function(){var a=this.Ac.slice();this.Rf=!1;this.Ac=[];return a};
m.next=function(){var a=this.fb();-1!==a&&this.ad.next();this.Rf&&this.Ac.push(a);this.Gl++;return a};function Nq(a,b,c,d){d=d||{};if(!b)throw new D(Nq,1,"has to be a function");if(!c)throw new D(Nq,2,"has to be a function");this.gn=b;this.Ym=c;this.Yg=[];this.Lc={};this.sq=[];this.hh={};this.$r={};this.gs={};this.dx={};this.mj=d.duration||100;this.zm=A(this.zm,this);a=a.split("Meta:\t").slice(1);for(b=0;b<a.length;b++){d=a[b].split("\n");c=d[0].split("\t")[0];d=d.slice(1).join("\n");this.hh[c]=new Gq;this.Lc[c]=Jq(this.hh[c],d);var e={layerId:c,columnNames:this.Lc[c]};this.sq.push(c);this.dx[c]=
Bq(e);this.$r[c]=Gj();Oq(this,d,c);this.zm(c)}}function Oq(a,b,c){var d=[],e=a.Lc[c].length-1,f=a.dx[c];try{a.hh[c].parse(b,function(g,h,k){var l=!1;0<g&&(d[h]=k,h===e&&(a.Yg.push(f.Rd(f.uo(d))),Gj()-a.$r[c]>a.mj&&(l=!0)));return l},function(g,h,k){if(0<g&&h===e)return Of(k)})}catch(g){a.Ym(g)}}Nq.prototype.cancel=function(){for(var a in this.gs)x.clearTimeout(this.gs[a])};Nq.prototype.cancel=Nq.prototype.cancel;
Nq.prototype.zm=function(a){var b=this,c,d;this.gs[a]=x.setTimeout(function(){if(2===b.hh[a].getState())b.$r[a]=Gj(),b.gn(b.Yg,!1),b.Yg=[],b.hh[a].resume(),b.zm(a);else{c=!0;for(d=0;d<b.sq.length;d++)if(b.hh[b.sq[d]].getState()!==Hq){c=!1;break}c&&(0<b.Yg.length&&b.gn(b.Yg,!0),b.Yg=[])}},0)};function vq(a){vq.g.constructor.call(this,vq,a);lo(vq)}u(vq,Co);t("H.service.extension.customLocation.Service",vq);vq.prototype.Da=function(){return{subDomain:"fleet.ls",path:"2"}};vq.CONFIG_KEY="customLocation";vq.prototype.Md=function(a,b){var c=b&&b.resultType;a=new rq(this,a,b);return 1===c||2===c?new Dh(a):new ej(a)};vq.prototype.createTileLayer=vq.prototype.Md;
function Pq(a,b,c,d){a=a===Qq?"changes":"file";var e=b[a];var f=jb(e),g=!f&&C(e,Blob);if(!f&&!g)throw new D(d,0,"Invalid "+a+" parameter");if(Rq)e=g?e:ef(e,"text/plain"),d=new x.FormData,d.append(a,e,e.name||a+".wkt"),c.method="POST",c.data=d,delete b[a];else if(g)throw new D(d,0,"Sending Blob data is not supported by the browser");}var Rq=x.FormData&&!!x.FormData.prototype.append;vq.prototype.request=function(a,b,c,d,e){return this.K(a,b,c,d,e)};vq.prototype.request=vq.prototype.request;
vq.prototype.K=function(a,b,c,d,e){var f="text/plain",g=a===Sq.LAYERS_UPLOAD||a===Sq.LAYERS_MODIFY||a===Sq.LAYERS_IMPORT,h=c,k={data:B,method:"GET",headers:this.Lc};if(!a)throw new D(this.request,0,a);if(!b)throw new D(this.request,1,b);Hp(this.request,3,d,e);g&&(C(c,Object,this.request,2,"Invalid request parameters"),h=Ra(c),Pq(a,h,k,this.request));var l=this.j().clone().A(a+"."+b).B(h);b===Tq.JSON&&(f="application/json");a=new Tg(f,l.toString(),Ud,k);a.then(function(n){var p=n.issues;p&&n.error_id&&
n.response_code?e(Error(p[0].message)):d(n)},function(n){"error"===n.type||404===n.status?e(Error(n.statusText||"Unable to load data")):n.json().then(function(p){e(Error("["+p.issues[0].message+"] "+l+" request failed"))},function(){e(Error("["+n.statusText+"] "+l+" request failed"))})});return a};
var wq="layers/list",Qq="layers/modify",yq="tiled/tile",Sq={LAYERS_DELETE:"layers/delete",LAYERS_GRANT:"layers/access/grant",LAYERS_LIST:wq,LAYERS_MODIFY:Qq,LAYERS_UPLOAD:"layers/upload",LAYERS_IMPORT:"layers/import",SEARCH_ALL:"search/all",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SEARCH_TILE:yq};vq.EntryPoint=Sq;var xq="json",Tq={TXT:"txt",JSON:xq};vq.EntryPointType=Tq;
vq.prototype.Sb=function(a,b,c){var d=this;return this.request("search/all","txt",{filter:'WKT==""',layer_id:a},function(e){var f=String(e).replace(/[\r\n]+$/g,"").split("\t");d.request(wq,xq,{layer_id:a,detail_level:"all"},function(g){g=g.layers[0];g.columnNames=f;b(Bq(g))},c)},c)};vq.prototype.getLayer=vq.prototype.Sb;
vq.prototype.uu=function(a,b,c,d){function e(){return++g<f?h.request("layers/access/grant",xq,{layer_id:a,granted_app_id:b[g].grantedAppId,permissions:b[g].permissions.join(",")},e,d):h.Sb(a,c,d)}var f=b&&b.length,g=-1,h=this;return e()};vq.prototype.grantAccess=vq.prototype.uu;vq.prototype.zt=function(a,b,c){return this.request("layers/delete",xq,{layer_ids:a},b,c)};vq.prototype.deleteLayer=vq.prototype.zt;
vq.prototype.kd=function(a,b,c){function d(){setTimeout(function(){k.Sb(g,function(q){setTimeout(e.bind(null,q),n)},function(){64E3>l?(l+=n,d()):c(x.Error("Timeout"))})},n);n*=2}function e(q){var r=JSON.stringify(q.bb()),v=a.grants;if(r!==JSON.stringify(h)){var w="Results into different column names on the backend: "+r;setTimeout(function(){k.zt(g,function(){c(x.Error(w))},function(y){c(x.Error(w+". "+y.message))})},n)}else v&&v.length?k.uu(g,v,b,c):b(q)}var f,g,h,k=this,l=0,n=1E3;var p=!a||!sq(g=
a.layerId)&&(f="layerId")||!tq(h=a.columnNames)&&(f="columnNames")?0:ab(b)?ab(c)?-1:2:1;if(0<=p)throw new D(k.kd,p,f||arguments[p]);return k.Sb(g,function(){c(x.Error("Layer exists already"))},function(){var q={layer_id:g,file:h.join("\t")},r=a.level,v=a.storage;r!==B&&(q.level=r);v!==B&&(q.storage=v);k.request("layers/upload",xq,q,d,c)})};vq.prototype.createLayer=vq.prototype.kd;
vq.prototype.wg=function(a,b,c,d){var e=[],f;a=this.request(a,xq,b,function(g){g.geometries.length?(g=uq(g,b.layer_id),f=new Nq(g,c,d),e.push(f)):c(Ye,!0)},d);e.push(a);return new lq(e)};vq.prototype.Vc=function(a,b,c,d,e,f){if(!ib(a))throw new D(this.Vc,0,"has invalid type");C(b,pc,this.Vc,1,"has invalid type");if(!ob(c))throw new D(this.Vc,2,"has invalid type");Hp(this.Vc,3,d,e);a={layer_ids:a.join(","),proximity:b.lat+","+b.lng+","+c};f&&Ta(a,f);return this.wg("search/proximity",a,d,e)};
vq.prototype.searchByProximity=vq.prototype.Vc;vq.prototype.Uc=function(a,b,c,d,e,f){var g="";if(!ib(a))throw new D(this.Uc,0,"has invalid type");if(!jb(b)&&!C(b,K))throw new D(this.Uc,1,"has invalid type");if(!ob(c))throw new D(this.Uc,2,"has invalid type");Hp(this.Uc,3,d,e);a={layer_ids:a.join(","),radius:c};if(jb(b))a.route_id=b;else{var h=b.T;b=0;for(c=h.length;b<c;b+=3)g+=h[b]+","+h[b+1],b<c-3&&(g+=",");a.corridor=g}f&&Ta(a,f);return this.wg("search/corridor",a,d,e)};
vq.prototype.searchByCorridor=vq.prototype.Uc;vq.prototype.ne=function(a,b,c,d,e){function f(k,l){l&&h--;c(k,!h)}var g=[],h;if(!ib(a))throw new D(this.ne,0,"has invalid type");C(b,F,this.ne,1,"has invalid type");Hp(this.ne,2,c,d);b={bbox:b.ga+","+b.X+";"+b.ha+","+b.da};e&&Ta(b,e);a=b.layer_id?[b.layer_id]:a;e=0;for(h=a.length;e<h;e++)b.layer_id=a[e],g.push(this.wg("search/bbox",b,f,d));return new lq(g)};vq.prototype.searchByBoundingBox=vq.prototype.ne;
vq.prototype.Gr=function(a,b,c,d){var e,f=[];if(!jb(a))throw new D(this.Gr,0,"has invalid type");Hp(this.Gr,1,b,c);var g={layer_id:a};d&&Ta(g,d);d=this.request("search/all",xq,g,function(h){h.geometries.length?(h=uq(h,a),e=new Nq(h,b,c),f.push(e)):b(Ye,!0)},c);f.push(d);return new lq(f)};vq.prototype.searchAll=vq.prototype.Gr;var Uq={"delete":/^GEOMETRY_ID$/,append:/^(?!GEOMETRY_ID$)/};
function Vq(a,b,c,d,e,f){function g(){v++;d(this,v===q)}function h(S){v++;e(S,this,v===q)}var k="append"!==b,l,n={},p=Wa(),q=0,r=[],v=0;if(!ib(c))throw new D(f,0,c);Hp(f,1,d,e);for(l=c.length;l--;){var w=c[l];if(C(w,Cq)){var y=w.Kf().uh().layerId;var I=w.va("GEOMETRY_ID");if(k){if(I===z||""===String(I))var G='GEOMETRY_ID must not be null or ""';n[I=y+"_"+I]&&(G="same GEOMETRY_ID for multiple rows");n[I]=w}else I!==z&&""!==String(I)&&(G='GEOMETRY_ID must be null or ""')}else G="Invalid type";if(G)throw new D(f,
0,"- Invalid row at index "+l+", "+G);I=p[y];I||(I=p[y]=[],q++);I.push(w)}for(y in p){I=p[y];c=[];for(l=I.length;l--;)c.push(I[l].Ak);r.push(a.request(Qq,xq,{layer_id:y,action:b,changes:I[0].Kf().ks(Uq[b]||null,c)},A(g,I),A(h,I)))}return new lq(r)}vq.prototype.$s=function(a,b,c){return Vq(this,"append",a,b,c,this.$s)};vq.prototype.appendRows=vq.prototype.$s;vq.prototype.vx=function(a,b,c){return Vq(this,"update",a,b,c,this.vx)};vq.prototype.updateRows=vq.prototype.vx;
vq.prototype.At=function(a,b,c){return Vq(this,"delete",a,b,c,this.At)};vq.prototype.deleteRows=vq.prototype.At;W.prototype.sz=function(a){return this.Ua(vq,a)};W.prototype.getCustomLocationService=W.prototype.sz;t("H.service.buildInfo",function(){return cn("H-service","1.54.1","17144d2",{region:"row"})});

function Wq(a,b){this.Za=a;this.Ke=b}
Wq.prototype.create=function(a,b){var c=a.coordinates;switch(a.type){case "Point":var d=new ci(Xq(c));break;case "LineString":d=new xi(Yq(c));break;case "Polygon":d=new Bi(Zq(c));break;case "MultiPoint":var e=0;var f=c.length;d=[];if(this.Ke){for(;e<f;e++)d.push(Xq(c[e]));c=new ci(new Lf(d))}else{for(;e<f;e++)d.push(new ci(Xq(c[e])));c=new Q;c.fd(d)}d=c;f="multiPoint";break;case "MultiLineString":e=0;f=c.length;d=[];if(this.Ke){for(;e<f;e++)d.push(Yq(c[e]));c=new xi(new Mf(d))}else{for(;e<f;e++)d.push(new xi(Yq(c[e])));
c=new Q;c.fd(d)}d=c;f="multiLineString";break;case "MultiPolygon":d=[];e=0;f=c.length;if(this.Ke){for(;e<f;e++)d.push(Zq(c[e]));c=new Bi(new Kf(d))}else{for(;e<f;e++)d.push(new Bi(Zq(c[e])));c=new Q;c.fd(d)}d=c;f="multiPolygon";break;case "GeometryCollection":c=d=new Q;e=a.geometries;f=0;for(var g=e.length;f<g;f++)this.create(e[f],c);f="geometryCollection"}d&&(c=d,e=a.properties,a=a.id,g={},e&&(this.Ke?g=e:g.properties=e),f&&!this.Ke&&(g[f]=!0),a&&c.Ur(a),c.setData(g),this.Za(d));b&&d&&b.$(d);return d};
Wq.prototype.create=Wq.prototype.create;function Xq(a){return new pc(a[1],a[0])}function Zq(a){for(var b=Yq(a[0]),c=[],d,e=1,f=a.length;e<f;e++)d=Yq(a[e]),c.push(d);return new M(b,c)}function Yq(a){for(var b=0,c=a.length,d=new K;b<c;b++)d.ng(Xq(a[b]));return d};function $q(a){eb(this,$q);this.url=a;this.bj=[];this.Zd=z;this.gj=A(this.gj,this);J.call(this)}u($q,J);t("H.data.AbstractReader",$q);var ar={ERROR:-1,LOADING:0,VISIT:1,READY:2};$q.State=ar;$q.prototype.state=ar.READY;$q.prototype.l={Ux:"statechange"};$q.prototype.Sb=function(){if(!this.Zd){this.Zd=new P;var a=this.Zd.pd();a.fd(this.bj)}return new Pj(this.Zd)};$q.prototype.getLayer=$q.prototype.Sb;$q.prototype.bA=function(){return this.bj.concat([])};$q.prototype.getParsedObjects=$q.prototype.bA;
$q.prototype.j=function(){return this.url};$q.prototype.getUrl=$q.prototype.j;$q.prototype.TC=function(a){if(this.state===ar.LOADING||this.state===ar.VISIT)throw Error("InvalidState: state "+this.state);this.bj=[];this.Zd=z;this.url=a;return this};$q.prototype.setUrl=$q.prototype.TC;$q.prototype.getState=function(){return this.state};$q.prototype.getState=$q.prototype.getState;$q.prototype.G=function(a,b,c){this.state=a;this.dispatchEvent(new br(b||this,this.l.Ux,a,c||""))};
$q.prototype.parse=function(){var a=this;db(this.url)?(this.G(ar.LOADING),(new Tg("text/plain",this.url)).then(function(b){try{a.gj(b)}catch(c){a.G(ar.ERROR,z,c.message)}},function(){a.G(ar.ERROR,z,"Error loading file")})):a.G(ar.ERROR,z,"File url was not set")};$q.prototype.parse=$q.prototype.parse;function br(a,b,c,d){br.g.constructor.call(this,b,a);this.state=c;this.message=d}u(br,ie);$q.Event=br;function cr(a,b){b=b||{};this.Za=b.style||this.bh;(this.Ke=!!b.disableLegacyMode)||window.console.warn("H.data.geojson.Reader: Legacy parser is enabled in GeoJSON Reader. Features like Multi-Geometries, Polygon interiors and GeoJSON feature properties might not work as expected. To maximise compatibility with the remote services it is recommended to set the `disableLegacyMode` flag to true.");$q.call(this,a)}u(cr,$q);t("H.data.geojson.Reader",cr);
cr.prototype.gj=function(a){var b,c;try{var d="string"===typeof a?JSON.parse(a):a;if("object"===typeof d){var e=new Wq(this.Za,this.Ke);switch(d.type){case "FeatureCollection":if(b=d.features){var f=new Q;this.Mg(f);for(c=0;c<b.length;c++){var g=dr(b[c]);(g=e.create(g))&&f.$(g)}}break;case "Feature":g=dr(d);(g=e.create(g))&&this.Mg(g);break;default:(g=e.create(d))&&this.Mg(g)}this.G(ar.READY)}else this.G(ar.ERROR,z,"Invalid syntax")}catch(h){this.G(ar.ERROR,z,"Parse error. "+h.message)}};
cr.prototype.eC=function(a){this.G(ar.LOADING);this.gj(a)};cr.prototype.parseData=cr.prototype.eC;cr.prototype.bh=function(){};function dr(a){var b={};if(a.geometry){var c=a.geometry;b.type=c.type;b.properties=a.properties;c.coordinates&&(b.coordinates=c.coordinates);c.geometries&&(b.geometries=c.geometries);a.id&&(b.id=a.id)}return b}cr.prototype.Mg=function(a){this.Zd&&this.Zd.pd().$(a);this.bj.push(a);this.G(ar.VISIT,a)};function er(a,b,c){this.Ye=a=ec(a,0,30);this.Qa=b;this.jj=c;this.bs=[];this.$h=[];do this.$h[a]=[],this.bs[a]=new fr;while(a--);b===gr?(this.Ps=hr,this.normalize=ir):(this.Ps=jr,this.normalize=kr);this.Xj=1/0;this.Qm=-1/0}var lr=Math.log(.5);function ir(a){return this.cp?Math.round((a-this.Xj)/this.cp*255):127}function kr(a){return void 0===this.Yt?127:Math.round(255*Math.pow(a,this.Yt))}
er.prototype.vc=function(a){var b,c;var d=a.value;void 0===d&&(d=1);d>this.Qm&&(this.Qm=d,this.cp=this.Qm-this.Xj);d<this.Xj&&(this.Xj=d,this.cp=this.Qm-this.Xj);var e=uh.Ne(a).scale(1073741823).floor();d=this.Ye;var f=e.x>>30-d;e=e.y>>30-d;for(c=this.Ps;-1<d;){this.$h[d][e]||(this.$h[d][e]=[]);(b=this.$h[d][e][f])||(b=this.$h[d][e][f]=new c(f,e,d));b.vc(a,d);var g=this.bs[d];g.tv>b.bd&&(g.tv=b.bd);g.Mh<b.bd&&(g.Mh=b.bd);g.sv>b.yc&&(g.sv=b.yc);g.Dq<b.yc&&(g.Dq=b.yc);d--;f>>=1;e>>=1}};
function mr(a,b,c,d,e){var f=1<<b,g,h;d=dc(d,f);f=0<=c&&c<f&&(g=a.$h[b])&&(h=g[c])&&(f=h[d])||null;!f&&e&&0<=b&&(f=mr(a,b-1,c>>1,d>>1,e));return f}function nr(a,b,c,d,e,f){for(var g,h=[];c<=d;c++)for(g=e;g<=f;g++)h.push(mr(a,b,c,g,!1));return h}function or(a,b){var c=0,d=0,e=mr(a,0,0,0,!1),f;if(b.Yl)return b.vj;b.z===a.Ye?b.vj=b.yc:(pr(a,b,function(g){var h=qr(a,g),k=4-h.length;if(g.z!==a.Ye){for(f=0;f<h.length;f++)c+=h[f].yc,d++;c+=k*e.yc;d+=k}}),b.vj=c/d);b.Yl=!0;return b.vj}
function pr(a,b,c){b=[b];for(var d,e;0<b.length;)e=b.shift(),d=qr(a,e),c(e),b.push.apply(b,d)}function qr(a,b){var c=[],d,e,f;for(e=0;1>=e;e++)for(f=0;1>=f;f++)(d=mr(a,b.z+1,2*b.x+e,2*b.y+f,!1))&&c.push(d);return c}er.prototype.clear=function(){er.call(this,this.Ye,this.Qa,this.jj)};function jr(a,b,c){this.x=a;this.y=b;this.z=c;this.yc=this.bd=this.count=0;this.Yl=!1;this.vj=0}jr.prototype.vc=function(a,b){this.count++;this.bd+=a.value||1;this.yc=this.bd/Math.pow(2,2*(30-b))};
function hr(a,b,c){this.x=a;this.y=b;this.z=c;this.yc=this.bd=this.count=0;this.Yl=!1;this.vj=0}hr.prototype.vc=function(a){a=a.value;this.bd+=void 0!==a?a:1;this.yc=this.bd/++this.count;this.Yl=!1};function fr(){this.tv=this.sv=1/0;this.Mh=this.Dq=-1/0};function rr(a,b){var c,d=0;if(!ya(a)||Qa(a))throw new D(rr,0,a);for(c in a){var e=+c;d++;if(!(ob(e)&&0<=e&&1>=e&&jb(a[c])))throw new D(rr,0,a);}if(2>d)throw new D(rr,0,"Specify at least 2 stops");this.cD=a;this.Ju=!!b}t("H.data.heatmap.Colors",rr);var sr=new rr({0:"#008","0.2":"#0b0","0.5":"#ff0","0.7":"#f00"},!0);rr.DEFAULT=sr;function tr(a,b,c,d,e){e&1&&ur(a,a,b,c,d,0);e&2&&ur(a,a,b,c,d,1);e&4&&ur(a,a,b,c,d,2);e&8&&ur(a,a,b,c,d,3)}
function ur(a,b,c,d,e,f){var g=(c+1)*(c+1),h,k=4*d,l=c+1,n,p=[{r:0,az:0,b:0,a:0,next:null}];var q=1;var r=["r","g","b","a"][f];var v=2*c+1;for(var w,y;q<v;q++)p[q]={r:0,az:0,b:0,a:0,next:null},p[q-1].next=p[q];p[2*c].next=p[0];var I=4*(d-1);for(h=0;h<e;h++){var G=h*k;var S=a[G+f];var X=S*l*(c+2)/2;v=S*l;for(q=0;q<=c;q++)p[q][r]=S;var Ga=0;for(q=1;q<=c;q++){var ha=q<d?G+4*q:G+I;ha=a[ha+f];X+=ha*(l-q);Ga+=ha;p[c+q][r]=ha}ha=p[0];w=p[l];q=G;y=4*l;var mb=G+I;for(S=0;S<d;S++){b[q+f]=X/g;X-=v;var ta=S+
l<d?q+y:mb;ta=a[ta+f];Ga+=ta;X+=Ga;v-=ha[r];v+=w[r];Ga-=w[r];ha[r]=ta;ha=ha.next;w=w.next;q+=4;if(!X)for(;(n=4*(S+l))<k&&0===a[G+f+n];)S++,q+=4}}G=(e-1)*k;for(S=0;S<d;S++){a=4*S;h=b[a+f];X=h*l*(c+2)/2;v=h*l;for(q=0;q<=c;q++)p[q][r]=h;Ga=0;for(q=1;q<=c;q++)ha=q<e?a+q*k:a+G,ha=b[ha+f],X+=ha*(c-q+1),Ga+=ha,p[c+q][r]=ha;ha=p[0];w=p[l];q=a;mb=l*k;I=a+G;for(h=0;h<e;h++)if(b[q+f]=X/g,X-=v,ta=h+l<e?q+mb:I,ta=b[ta+f],Ga+=ta,X+=Ga,v-=ha[r],v+=w[r],Ga-=w[r],ha[r]=ta,ha=ha.next,w=w.next,q+=k,!X)for(;(n=h+l)<
e&&0===b[n*k+f+a];)h++,q+=k}};function vr(a,b,c){this.MA=b=a>>b;this.oB=Math.log(b)*Math.LOG2E;this.Ac=a=document.createElement("CANVAS");this.jy=a.getContext("2d");this.ky=a.width=a.height=3*b;var d=document.createElement("canvas");a=c.Ju;var e=c.cD;b=[];var f;d.width=256;d.height=1;d=d.getContext("2d");for(g in e)e.hasOwnProperty(g)&&b.push({stop:parseFloat(g),value:e[g]});e=b.length;b.sort(this.bD);0<b[0].stop&&b.unshift({stop:0,value:b[0].value});1>b[e-1].stop&&b.push({stop:1,value:b[e-1].value});e=b.length;var g=d.createLinearGradient(0,
0,256,0);for(f=0;f<e;f++){if(!a&&k){var h=k.stop+(b[f].stop-k.stop)/2;g.addColorStop(h,k.value);g.addColorStop(h,b[f].value)}g.addColorStop(b[f].stop,b[f].value);var k=b[f]}d.fillStyle=g;d.fillRect(0,0,256,1);this.ry=d.getImageData(0,0,256,1).data;this.NA=c.Ju}vr.prototype.bD=function(a,b){return a.stop-b.stop};vr.prototype.Gx="#000";vr.prototype.Vx="#080";function wr(a,b){this.canvas=a;this.size=b};function xr(a){var b=a||{},c=+b.sampleDepth,d=b.pointSize;a=+b.coarseness;var e=b.colors,f={min:b.min,max:b.max,engineType:b.engineType},g=b.tileSize,h=+b.dataMax;b.tileSize&&(f.tileSize=g);R.call(this,f);this.zg(b.opacity);this.Qa="value"===b.type?gr:yr;this.sampleDepth_=ob(c)?ec(Math.round(c),1,8):4;this.Cw=this.Qa===yr?ob(d)?ec(Math.round(7-d),0,6):2:1;this.at=!!b.assumeValues;b=this.max;this.jj=ob(h)?ec(Math.round(h),this.min,b+this.sampleDepth_):b;a=ob(a)?ec(Math.round(a),0,3):1;if(e&&!C(e,rr))throw new D(xr,
0,"colors");this.xi=new er(b+this.sampleDepth_+this.Cw,this.Qa,this.jj);this.iD=new vr(this.tileSize,a,e||sr);this.mg=A(this.mg,this);this.fg=A(this.fg,this);this.In=new Mj(20,this.mg)}u(xr,R);t("H.data.heatmap.Provider",xr);xr.prototype.Cd=function(a){this.zg(a)};xr.prototype.setOpacity=xr.prototype.Cd;xr.prototype.Qe=function(){return this.Oc};xr.prototype.getOpacity=xr.prototype.Qe;xr.prototype.nk=Ve;xr.prototype.providesRasters=xr.prototype.nk;
xr.prototype.s=function(a,b,c,d,e){var f=this.at,g,h;if(mr(this.xi,0,0,0,!1)){if(!f){var k=nr(this.xi,c,b-1,b+1,a-1,a+1);for(g=k.length;g--&&!f;)if(null!==k[g]){f=!0;break}}f&&(h=this.In.push([a,b,c,d,e],this.fg))}f||d(null);return h||yl};xr.prototype.requestInternal=xr.prototype.s;
xr.prototype.mg=function(a,b){var c=a.done,d=b[0],e=b[1],f=b[2];b=document.createElement("canvas");var g=this.tileSize,h=b.getContext("2d");b.width=b.height=g;var k=this.iD;var l=this.xi,n=this.at,p=this.Qa,q=this.Cw;var r=k.MA;var v=k.jy,w,y,I=p===yr?void 0===q?2:q:1;q=I;I=Math.min(this.sampleDepth_+I,k.oB);var G=k.ky,S=l.Ye;if(n&&p===gr){for(y=-1;1>=y;y++)for(n=-1;1>=n;n++){var X=(X=mr(l,f,e+y,d+n,!0))?l.normalize(or(l,X)):128;v.fillStyle="rgba("+X+",128,0,1)";v.fillRect((n+1)*r,(y+1)*r,r,r)}n=
r-Math.floor(r/10);y=3;X=v.getImageData(0,0,G,G);tr(X.data,n,G,G,y);v.putImageData(X,0,0)}else v.fillStyle=n?k.Vx:k.Gx,v.fillRect(0,0,G,G);for(;q<=I&&f+q<=S;q++){n=r>>q;y=r-n;var Ga=p===yr?127+Math.floor(128/(1<<I-q)):255;X=(1<<q)+2;var ha=1<<q;var mb=d<<q;var ta=e<<q;ha=nr(l,f+q,ta-1,ta+ha,mb-1,mb+ha);for(mb=ha.length;mb--;){ta=mb%X;var nb=mb/X<<0;if(w=ha[mb])w=l.normalize(w.yc),v.fillStyle="rgba("+w+","+Ga+",0,1)",v.fillRect(ta*n+y,nb*n+y,n,n)}X=v;Ga=n;ha=y;mb=r+2*n;n=r+2*n;ta=ta=3;nb=v.getImageData(ha,
y,mb,n);tr(nb.data,Ga,mb,n,ta);X.putImageData(nb,ha,y)}d=v.getImageData(0,0,G,G);e=k.ry;f=k.NA;l=d.data;I=0;for(G=l.length;I<G;I+=4)p=l[I],q=l[I+1],4===e.length&&(p=0),l[I]=e[4*p],l[I+1]=e[4*p+1],l[I+2]=e[4*p+2],l[I+3]=e[4*p+3]*(f?q/255:10>q?0:1);v.putImageData(d,0,0);k=new wr(k.Ac,r);r=k.size;h.drawImage(k.canvas,r,r,r,r,0,0,g,g);c.call(a,b)};xr.prototype.fg=function(a,b,c){var d=a.data;a=d[3];d=d[4];c?d():a(b)};
xr.prototype.Vs=function(a,b){var c;if(!ib(a))throw new D(this.Vs,0,a);if(c=a.length){for(;c--;)this.xi.vc(a[c]);a=this.xi;var d;c=a.bs;var e=a.Ye,f=0;if(a.Qa===yr){var g=c[a.Ye].Mh;for(d=a.Ye;0<=d;d--)if(c[d].Mh===g)f=d;else break;g=c[0].Mh;for(d=0;d<=f;d++)if(g===c[d].Mh)e=d;else break;f>a.jj&&(f=a.jj);g=Math.round(e+(f-e)/2);a.Yt=lr/Math.log(c[g].Dq)}this.reload(!!b)}};xr.prototype.addData=xr.prototype.Vs;xr.prototype.clear=function(){this.xi.clear();this.reload(!0)};xr.prototype.clear=xr.prototype.clear;var yr=0,gr=1;function zr(){}t("H.data.utils.Dom",zr);zr.prototype.nh=function(a){return!!a&&/^\s*(1|true)\s*$/i.test(this.Va(a))};zr.prototype.getBoolean=zr.prototype.nh;zr.prototype.Va=function(a){var b;try{if(a.nodeType===Node.ATTRIBUTE_NODE)return a.value;var c="";var d=0;var e=a.childNodes;for(b=e.length;d<b;d++)e[d].nodeType!==Node.COMMENT_NODE&&(c+=e[d].nodeValue.replace(/^\s+|\s+$/g,""))}catch(f){}return c||""};zr.prototype.getString=zr.prototype.Va;
zr.prototype.fm=function(a){return parseFloat(this.Va(a))||0};zr.prototype.getFloat=zr.prototype.fm;zr.prototype.Tv=function(a){var b=a.split(/\s+/),c=b.length,d=!(b&&1==c),e=d?1:3,f=[],g;d||(b=a.split(","),c=b.length);for(g=0;g<c;g+=e)if(a=this.ar(d?b[g]:g+3>b.length?null:b.slice(g,g+3)))f.push(a);else return[];return f};zr.prototype.parseCoords=zr.prototype.Tv;
zr.prototype.ar=function(a){if(!a)return null;var b=a instanceof Array&&0<a.length&&4>a.length?a:a.split(",");a=parseFloat(b[0]);var c=parseFloat(b[1]);b=parseFloat(b[2]);return isNaN(c)||isNaN(a)?null:new pc(c,a,isNaN(b)?void 0:b)};zr.prototype.parseCoord=zr.prototype.ar;zr.prototype.dm=function(a){a=this.Va(a);return/^[0-9a-fA-F]{8}$/.test(a)?"#"+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2):"#000000ff"};zr.prototype.getColor=zr.prototype.dm;function Ar(a){a=a.attributes;for(var b,c=a.length;c--;)switch(b=a[c],b.name){case "x":this.x=parseFloat(b.value);break;case "y":this.y=parseFloat(b.value);break;case "xunits":this.Ue="fraction"===zr.prototype.Va(b);break;case "yunits":this.Xd="fraction"===zr.prototype.Va(b)}}t("H.data.kml.HotSpot",Ar);function Br(a){var b=a.childNodes,c=new zr;this.offsetX=this.offsetY=0;for(a=b.length;a--;){var d=b[a];switch(d.nodeName){case "href":this.href=c.Va(d)}}}t("H.data.kml.Icon",Br);function Cr(a){var b;if(a){a=a.childNodes;var c=a.length;for(b=new zr;c--;){var d=a[c];switch(d.nodeName){case "scale":this.scale=b.fm(d);break;case "Icon":this.icon=d=new Br(d);break;case "hotSpot":this.Au=d=new Ar(d)}}}}t("H.data.kml.IconStyle",Cr);function Dr(a){a=a.childNodes;for(var b,c=a.length,d=new zr;c--;)switch(b=a[c],b.nodeName){case "bgColor":this.bgColor=d.dm(b);break;case "textColor":this.textColor=d.dm(b);break;case "text":this.text=d.Va(b);break;case "displayMode":this.displayMode=d.Va(b)}}t("H.data.kml.BalloonStyle",Dr);function Er(){this.LA={4:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),"ff"].join("")},5:function(a){return["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3),a.charAt(4),a.charAt(4)].join("")},7:function(a){return a+"ff"},9:function(a){return a}};this.HC={4:function(a){return[Fr(a.charAt(1)),Fr(a.charAt(2)),Fr(a.charAt(3)),255]},5:function(a){return[Fr(a.charAt(1)),Fr(a.charAt(2)),Fr(a.charAt(3)),Fr(a.charAt(4))]},7:function(a){a=
parseInt(a.substring(1),16);return[a>>16&255,a>>8&255,a&255,255]},9:function(a){a=parseInt(a.substring(1),16);return[a>>24&255,a>>16&255,a>>8&255,a&255]}}}t("H.data.utils.ColorHelper",Er);function Fr(a){a=parseInt(a,16);return(a<<4)+a}function Gr(a){return 16>a?"0"+Math.round(a).toString(16):Math.round(a).toString(16)}
function Hr(a,b,c){if(!/^(#|rgb).*/.test(b))return[0,0,0,255];c||(c="","#"===b.charAt(0)?c=a.LA[b.length]?b:"":"rgb"===b.substr(0,3)&&(b=b.match(/\d+(\.\d+)?/g),c=b.length,c=2<c&&5>c?["#",Gr(+b[0]),Gr(+b[1]),Gr(+b[2]),3<c?Gr(255*+b[3]):"ff"].join(""):""),b=c);a=a.HC[b.length](b);a[3]=Math.round(a[3]/255*100)/100;return a}
Er.prototype.mx=function(a,b){var c="";if(!/^(#|rgb).*/.test(a)){c="";for(a=0;6>a;a++)c+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return c+"ff"}a=Hr(this,a,b);for(b=0;4>b;b++)c+=""+Gr(3>b?Math.floor(Math.random()*(a[b]-0+1))+0:255*a[b]);return c};Er.prototype.toRandomRGBA=Er.prototype.mx;function Ir(a){a=a.childNodes;for(var b,c=a.length,d=new zr,e=new Er;c--;)switch(b=a[c],b.nodeName){case "color":this.color=d.dm(b);break;case "colorMode":this.qy=d.Va(b)}"random"===this.qy&&(this.color="#"+e.mx(this.color,!1))}t("H.data.kml.ColorStyle",Ir);function Jr(a){var b=a.childNodes,c=b.length,d=new zr;for(this.El=new Ir(a);c--;)a=b[c],"width"===a.nodeName&&(this.width=d.fm(a))}t("H.data.kml.LineStyle",Jr);function Kr(a){var b=a.childNodes,c=b.length,d=new zr;this.outline=this.fill=!0;for(this.El=new Ir(a);c--;)switch(a=b[c],a.nodeName){case "fill":this.fill=d.nh(a);break;case "outline":this.outline=d.nh(a)}}t("H.data.kml.PolyStyle",Kr);function Lr(a){var b=a.childNodes,c=b.length;for(this.id=a.getAttribute("id");c--;)switch(a=b[c],a.nodeName){case "IconStyle":this.Bu=a=new Cr(a);break;case "LineStyle":this.Jh=a=new Jr(a);break;case "PolyStyle":this.$v=a=new Kr(a);break;case "BalloonStyle":this.tl=a=new Dr(a)}}t("H.data.kml.Style",Lr);function Mr(a,b){a=a.childNodes;var c=a.length,d=new zr;for(this.eD=b;c--;)switch(b=a[c],b.nodeName){case "key":this.key=d.Va(b);break;case "styleUrl":this.Sk=d.Va(b)}}t("H.data.kml.Pair",Mr);Mr.prototype.L=function(){if(this.Sk){var a="highlight"===this.key?!0:!1;a=this.eD.Np(this.Sk.substr(1),a)}return a};Mr.prototype.getStyle=Mr.prototype.L;function Nr(a,b){var c=a.childNodes,d=c.length;this.cs=b;this.id=a.getAttribute("id");for(this.qn=[];d--;)a=c[d],"Pair"===a.nodeName&&(a=new Mr(a,this.cs),this.qn.push(a))}t("H.data.kml.StyleMap",Nr);Nr.prototype.L=function(a){var b=null;a=a?"highlight":"normal";for(var c=this.qn.length;c--;)this.qn[c].key===a&&(b=this.qn[c].L());return b};Nr.prototype.getStyle=Nr.prototype.L;function Or(a){a=a.childNodes;for(var b,c=a.length,d=null,e=new zr;c--;)b=a[c],"coordinates"===b.nodeName&&(d=e.Va(b));this.cv=null;d&&(this.cv=e.ar(d)||null)}t("H.data.kml.Point",Or);Or.prototype.qh=function(){return this.cv};function Pr(){}Pr.prototype.elevation=0;Pr.prototype.Qt=0;function Qr(a){a=a.childNodes;for(var b,c=a.length,d=new zr;c--;)if(b=a[c],"coordinates"===b.nodeName){b=d.Va(b);var e=[],f=new zr;try{e=f.Tv(b)}catch(g){e=[]}this.Ll=2>e.length?[]:e}}t("H.data.kml.Line",Qr);Qr.prototype.qh=function(){for(var a=new K,b=this.Ll?this.Ll.length:0;b--;)a.ng(this.Ll[b]);return a};function Rr(a){var b=a.childNodes,c=b.length;this.Pt=new K;for(this.Iu=[];c--;){var d=b[c];var e=d.nodeName;if("outerBoundaryIs"===e||"innerBoundaryIs"===e){var f=d.childNodes;for(d=f.length;d--;){var g=f[d];if("LinearRing"===g.nodeName){var h=new Qr(g);if("outerBoundaryIs"===e){this.Pt=h.qh();var k=void 0,l=a,n=h.Ll;h=new zr;var p=l.querySelector("altitudeMode");if(p&&p.parentNode===l&&!/^\s*clampTo/.test(h.Va(p))&&n){p=n.length;for(var q=0;q<p&&0!==k;q++){var r=n[q].alt;r?k?r!==k&&(k=0):k=r:k=0}(n=
l.querySelector("*|altitudeOffset"))&&n.parentNode===g&&"http://www.google.com/kml/ext/2.2"===n.namespaceURI&&(g=h.fm(n))&&(k+=g);k&&(k=Cb(2047,k),(g=l.querySelector("extrude"))&&g.parentNode===l&&h.nh(g)?this.Qt=k:this.elevation=k)}}else this.Iu.push(h.qh())}}}}}u(Rr,Pr);t("H.data.kml.Polygon",Rr);function Sr(a,b){var c=a&&a.childNodes||[],d=new zr;if(!a||!b)throw Error("Node or stylesContainer is not defined");this.visibility=!0;this.hC=a;for(a=c.length;a--;){var e=c[a];switch(e.nodeName){case "name":this.name=d.Va(e);break;case "description":this.description=d.Va(e);break;case "visibility":this.visibility=d.nh(e);break;case "open":this.open=d.nh(e);break;case "styleUrl":if(this.Sk=d.Va(e))e=this.Sk.substr(1),this.Vy=b.Np(e,!1);break;case "Style":this.fv=e=new Lr(e)}}}
t("H.data.kml.Feature",Sr);function Tr(a,b){var c=document.createElement("CANVAS");c.width=1;c.height=1;this.cs=a;this.Zp={};this.cr={};this.Py=new Sh(c);this.hd=b||""}Tr.prototype.create=function(a){this.kh=new Sr(a,this.cs);return Ur(this,a)};
function Ur(a,b,c){b=b.childNodes;for(var d=b.length,e,f={},g;d--;){var h=b[d];switch(h.nodeName){case "Point":h=new Or(h);g=Vr(a,"Marker");if(h=h.qh())e=new ci(h,g),g.br&&re(g.br,"statechange",A(a.UB,a,g.br,e,g),!1);break;case "LineString":h=new Qr(h);g=Vr(a,"Polyline");e=new xi(h.qh(),g);break;case "LinearRing":h=new Qr(h);g=Vr(a,"Polyline");e=new xi(h.qh(),g);break;case "Polygon":h=new Rr(h);g=Vr(a,"Polygon");g.elevation=h.elevation;g.extrusion=h.Qt;e=new Bi(new M(h.Pt,h.Iu),g);break;case "MultiGeometry":e=
Ur(a,h,new Q)}e&&(a.kh.name&&(f.name=a.kh.name),a.kh.description&&(f.description=a.kh.description),g&&g.tl&&(f.balloonStyle=g.tl),f.kmlNode=a.kh.hC,e.setData(f),c&&c.$(e))}return c||e}
Tr.prototype.UB=function(a,b,c){var d=c.anchor,e=c.scale;c=e+"_"+d.x+d.y+d.Ue+d.Xd+"_"+c.href;var f={};if(1===a.getState()){var g=this.Zp[c];if(!g){var h=d.x;var k=d.y;if(g=a.lc())g={w:g.w*e,h:g.h*e},f.size=g;h=d.Ue&&g?g.w*h:h*e;k=d.Xd&&g?g.h*(1-k):!d.Xd&&g?g.h-k*e:k*e;f.anchor={x:h,y:k};g=new Sh(a.Oe(),f);this.Zp[c]=g}b.re(g)}delete this.cr[c]};
function Vr(a,b){var c=a.kh,d={visibility:c.visibility};var e=new Er;var f=1;var g={x:0,y:0,Ue:!1,Xd:!1};var h=Wr(a,c.Vy);c.fv&&(h=Wr(a,c.fv,h));switch(b){case "Marker":if(h&&h.Bu){e=h.Bu;e.scale&&(f=e.scale);if(e.Au){var k=e.Au;g={x:k.x,y:k.y,Ue:k.Ue,Xd:k.Xd}}e.icon&&e.icon.href?(b=e.icon.href,Xr.test(b)||(b=a.hd+b),e=f+"_"+g.x+g.y+g.Ue+g.Xd+"_"+b,k=a.Zp[e]||a.cr[e],k||(k=new Sh(b),a.cr[e]=k),0===k.getState()?(d.icon=a.Py,d.br=k,d.href=b,d.anchor=g,d.scale=f):1===k.getState()&&(d.icon=k)):1!==f&&
(k||(g={x:14,y:4,Ue:!1,Xd:!1}),e=Sh,a=a.zp(),k={w:28*f,h:36*f},f={size:new Jh(k.w,k.h),anchor:new L(g.Ue?k.w*g.x:g.x*f,g.Xd?k.h*(1-g.y):k.h-g.y*f),hitArea:new Ph(Qh.POLYGON,[0*f,16*f,0*f,7*f,8*f,0*f,18*f,0*f,26*f,7*f,26*f,16*f,18*f,34*f,8*f,34*f])},d.icon=new e(a,f))}break;case "Polyline":d.style={};h&&h.Jh&&(f=h.Jh,d.style.strokeColor="rgba("+Hr(e,f.El.color,!0)+")",0<=f.width&&(d.style.lineWidth=f.width));break;case "Polygon":d.style={},h&&(h.Jh&&(f=h.Jh,d.style.strokeColor="rgba("+Hr(e,f.El.color,
!0)+")",0<=f.width&&(d.style.lineWidth=f.width)),h.$v&&(f=h.$v,d.style.fillColor=f.fill?"rgba("+Hr(e,f.El.color,!0)+")":"rgba(0,0,0,0)",f.outline||(d.style.lineWidth=0)))}d.tl=h.tl;return d}function Wr(a,b,c){c=c||{};for(var d in b)b.hasOwnProperty(d)&&(c[d]="object"===typeof b[d]?Wr(a,b[d],c[d]):b[d]);return c}var Xr=/^[^:\/]+:/;Tr.prototype.zp=function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>'};function Yr(){this.bx={}}t("H.data.kml.StyleContainer",Yr);Yr.prototype.vo=function(a){a&&a.id&&(this.bx["style_"+a.id]=a)};Yr.prototype.addStyle=Yr.prototype.vo;Yr.prototype.Np=function(a,b){a=this.bx["style_"+a];a instanceof Nr&&(a=a.L(b));return a};Yr.prototype.getStyleById=Yr.prototype.Np;function Zr(a){var b=a?a.lastIndexOf("/"):-1;this.pk=[];$q.call(this,a);0<=b&&(this.XA=a.substr(0,b)+"/")}u(Zr,$q);t("H.data.kml.Reader",Zr);
Zr.prototype.gj=function(a){var b,c=null;if(jb(a)&&""!=a.trim()){try{var d=(new DOMParser).parseFromString(a,"text/xml")}catch(h){this.G(ar.ERROR,z,"Error parsing KML document");return}if(d.getElementsByTagName("parsererror").length)this.G(ar.ERROR,z,"Error parsing KML document");else if((a=d.childNodes&&"kml"===d.childNodes[0].nodeName?d.childNodes[0]:void 0)&&(b=$r(a.childNodes,"Document")[0]),b=b||a){d=new Yr;for(var e=$r(b.childNodes,"Style"),f=$r(b.childNodes,"StyleMap"),g=e.length;g--;)a=new Lr(e[g]),
d.vo(a);for(g=f.length;g--;)a=new Nr(f[g],d),d.vo(a);this.DB=new Tr(d,this.XA);a=b.childNodes;for(b=a.length;b--;)if(e=a[b],d=c,"Placemark"===e.nodeName?(e=this.DB.create(e))&&this.Mg(e,d):"Folder"===e.nodeName&&(e={group:new Q,node:e},this.Mg(e.group,d),this.pk.push(e)),!b&&(d=this.pk.shift()))a=d.node.childNodes,c=d.group,b=a.length;this.G(ar.READY)}else this.G(ar.ERROR,z,"Invalid KML document")}else this.G(ar.ERROR,z,"Unable to create objects from the empty data")};
Zr.prototype.Mg=function(a,b){b?b.$(a):(this.Zd&&this.Zd.pd().$(a),this.bj.push(a),this.G(ar.VISIT,a))};function $r(a,b){for(var c=a.length,d,e=[];c--;)d=a[c],d.nodeName===b&&e.push(d);return e};t("H.data.buildInfo",function(){return cn("H-data","1.54.1","17144d2",{region:"row"})});

tc.prototype.ve=ca(1,function(a,b){this.root.ve(a,ob(b)?b:this.Lh)});xc.prototype.ve=ca(0,function(a,b){var c=0,d;if(!a(this)&&b--)for(;3>=c;c++)(d=this[c])&&d.ve(a,b)});function as(a,b,c,d,e,f){this.xo=b;a&&(this.parent=a,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}m=as.prototype;m.ib=0;m.oh=function(a){return this[a]||(++this.ib,this[a]=new as(this,a))};m.removeChild=function(a){var b=a.xo;this[b]===a&&(delete this[b],delete a.parent,--this.ib)};m.ve=function(a,b){for(var c=0,d=this;d=d.parent;)++c;bs(this,a,b,c)};
function bs(a,b,c,d){var e,f;if(!b(a,d)&&c--)for(++d,e=0;4>e;e++)(f=a[e])&&bs(f,b,c,d)}m.Lg=function(a){(this.entries||(this.entries=[])).push(a)};m.Zi=0;m.$i=0;m.Bc=0;function cs(a){this.Lh=a||10;this.rk=this.qk=this.Vi=this.Ui=2147483648;this.xm()}m=cs.prototype;m.xm=function(){this.head=this.root=new as(null,NaN,this.Ui-this.qk,this.Vi-this.rk,this.Ui+this.qk,this.Vi+this.rk)};m.Bl=function(){ds(this,this.root);this.xm()};function ds(a,b){var c,d;for(c=0;4>c;c++)if(d=b[c])ds(a,d),delete b[c];delete b.parent;delete b.entries}
m.gd=function(a){var b=this.head,c;if(a){var d=a;if(d!==b)for(b=d;d=d.parent;)if(d.entries||1<d.ib)b=d}else for(;!b.entries&&2>(c=b.ib);)if(c)b=d;else break;this.head=b};m.Wd=function(a,b,c,d){var e=this.root;if(!(a>=e[7]&&b>=e[4]&&a<=e[5]&&b<=e[6]))throw Error("Coordinates out of bounds");return this.Ub(this.root,a,b,c,this.Lh,d)};
m.Ub=function(a,b,c,d,e,f){var g=a.entries;e?a.ib?g=this.Kj(a,b,c,d,e,f):g?(g=g[0],g=a.oh(+(g[1]>=a[8])|+(g[0]>=a[9])<<1),g.entries=a.entries,g.Zi=a.Zi,g.$i=a.$i,g.Bc=a.Bc,g.Zg=a.Zg,g.Yi=a.Yi,g.Wi=a.Wi,g.Xi=a.Xi,delete a.entries,this.gd(g),g=this.Kj(a,b,c,d,e,f)):(a.Lg(g=new es(b,c,d,f)),this.gd(a)):(g||this.gd(a),a.Lg(g=new es(b,c,d,f)));a.Zi+=b*d;a.$i+=c*d;a.Bc+=d;a.Zg===B?(a.Zg=a.Wi=b,a.Yi=a.Xi=c):(b<a.Zg?a.Zg=b:b>a.Wi&&(a.Wi=b),c<a.Yi?a.Yi=c:c>a.Xi&&(a.Xi=c));return g};
m.Kj=function(a,b,c,d,e,f){return this.Ub(a.oh(+(b>=a[8])|+(c>=a[9])<<1),b,c,d,e-1,f)};m.ve=function(a,b){bs(this.root,a,b===+b?b:this.Lh,0)};function es(a,b,c,d){this[0]=b;this[1]=a;this.weight=c;this.data=d};function fs(a,b,c){this.ra=a;this.Wl=b;this.ae=c}t("H.clustering.fastgrid.NoisePoint",fs);fs.prototype.ya=function(){this.Qc||(this.Qc=this.ra.$a(this.Wl[1],this.Wl[0],1));return this.Qc};fs.prototype.getPosition=fs.prototype.ya;fs.prototype.Ud=function(){return this.Wl.weight};fs.prototype.getWeight=fs.prototype.Ud;fs.prototype.Sf=We;fs.prototype.isCluster=fs.prototype.Sf;fs.prototype.Qd=function(){return this.ae-this.ra.dh};fs.prototype.getMinZoom=fs.prototype.Qd;fs.prototype.getData=function(){return this.Wl.data};
fs.prototype.getData=fs.prototype.getData;function gs(a,b,c,d){this.ra=a;this.rc=b;this.ae=c;this.Eq=d;this.rp=Ia(this.rp,this);this.pp=Ia(this.pp,this)}t("H.clustering.fastgrid.Cluster",gs);gs.prototype.ya=function(){this.Qc||(this.Qc=this.ra.$a(this.rc.Zi,this.rc.$i,this.rc.Bc));return this.Qc};gs.prototype.getPosition=gs.prototype.ya;gs.prototype.Ud=function(){return this.rc.Bc};gs.prototype.getWeight=gs.prototype.Ud;gs.prototype.Sf=Ve;gs.prototype.isCluster=gs.prototype.Sf;
gs.prototype.Qd=function(){return this.ae?this.ae-this.ra.dh:-1/0};gs.prototype.getMinZoom=gs.prototype.Qd;gs.prototype.hm=function(){return this.Eq-this.ra.dh};gs.prototype.getMaxZoom=gs.prototype.hm;gs.prototype.C=function(){this.I||(this.I=Ic(this.ra.$a(this.rc.Zg,this.rc.Yi,1),this.ra.$a(this.rc.Wi,this.rc.Xi,1),!0));return this.I};gs.prototype.getBoundingBox=gs.prototype.C;gs.prototype.qp=function(a){this.Wt=a;this.rc.ve(this.rp,$b)};gs.prototype.forEachEntry=gs.prototype.qp;
gs.prototype.rp=function(a,b){var c=!1,d,e;a.Bc>=this.ra.uv&&a!==this.rc&&a.Bc!==this.rc.Bc&&(this.Wt(new gs(this.ra,a,0,b)),c=!0);if(!c&&(d=a.entries))for(a=d.length,e=0;e<a;e++)this.Wt(new fs(this.ra,d[e],b));return c};gs.prototype.uj=function(a){this.Yy=a;this.rc.ve(this.pp,$b)};gs.prototype.forEachDataPoint=gs.prototype.uj;gs.prototype.pp=function(a,b){var c;if(a=a.entries){var d=a.length;for(c=0;c<d;c++)this.Yy(new fs(this.ra,a[c],b))}return!1};function hs(a){Zd.call(this);this.fc=[];var b;a?Ta(b={},is,a):b=is;this.options=b;Zd.call(this)}u(hs,Zd);var js={clusters:[],noisePoints:[]},is={projection:uh,min:0,max:22,eps:32,minWeight:2};m=hs.prototype;m.qe=function(a){this.fc=a;this.md=!0};m.vc=function(a){this.fc.push(a);this.md=!0};m.ql=function(a){this.fc=this.fc.concat(a);this.md=!0};m.sk=function(a){this.fc=this.fc.filter(function(b){return b!==a});this.md=!0};m.i=function(){hs.g.i.call(this);delete this.fc};
hs.prototype.disposeInternal=hs.prototype.i;hs.prototype.Hw=Xe;function ks(a){hs.call(this,a);a=this.options;this.he=a.projection;this.Yj=a.min;this.Zf=a.max;this.uv=a.minWeight;this.dh=7-Eb(Ib(Db(1,a.eps))/Sb);this.qr=new cs(Db(this.Yj,this.Zf+this.dh))}u(ks,hs);m=ks.prototype;m.qe=function(a){var b=0,c=a.length,d,e=new L(0,0),f=this.he,g=this.qr;ks.g.qe.call(this,a);for(g.Bl();b<c;b++)f.Ne(d=a[b],e).scale(4294967296).floor(),g.Wd(e.x,e.y,d.wt,d.data);this.md=!0};m.vc=function(a){ks.g.vc.call(this,a);this.qe(this.fc)};
m.ql=function(a){for(var b=a.length,c=ks.g.vc;b--;)c.call(this,a[b]);this.qe(this.fc)};m.sk=function(a){ks.g.sk.call(this,a);this.qe(this.fc)};m.$a=function(a,b,c,d){return this.he.$a(a/c/4294967296,b/c/4294967296,d)};m.Zr=function(a){if(this.md){var b={clusters:[],noisePoints:[]};ls(this,this.qr.root,0,this.Zf+this.dh,-1/0,b,null);this.md=!1;a(b)}};
function ls(a,b,c,d,e,f,g){var h=b.Bc,k;g&&(g.node.Bc!==h?(f.clusters.push(new gs(a,g.node,g.depth,c-1)),g=null):e++);g||(h>=a.uv?(g={node:b,depth:c},e=c):ms(a,b,e+1,f));if(b.ib&&d--)for(c++,h=0;4>h;h++)if(k=b[h])ls(a,k,c,d,e,f,g),g=null;g&&f.clusters.push(new gs(a,g.node,g.depth,a.Zf+a.dh))}function ms(a,b,c,d){b=b.entries;var e;if(b){var f=b.length;d=d.noisePoints;for(e=0;e<f;e++)d.push(new fs(a,b[e],c))}else for(e=0;4>e;e++)(f=a[e])&&ms(a,f,c,d)}m.i=function(){ks.g.i.call(this);this.qr=null};
ks.prototype.disposeInternal=ks.prototype.i;function ns(a,b){this.dr=a;this.ae=b}t("H.clustering.grid.NoisePoint",ns);ns.prototype.ya=function(){return sc(this.dr)};ns.prototype.getPosition=ns.prototype.ya;ns.prototype.Ud=function(){return this.dr.wt};ns.prototype.getWeight=ns.prototype.Ud;ns.prototype.Sf=We;ns.prototype.isCluster=ns.prototype.Sf;ns.prototype.Qd=function(){return this.ae};ns.prototype.getMinZoom=ns.prototype.Qd;ns.prototype.getData=function(){return this.dr.data};ns.prototype.getData=ns.prototype.getData;function os(a,b,c){this.Eq=this.ae=c;this.er=[];this.qs=0;this.I=Ic(a,b,!0)}t("H.clustering.grid.Cluster",os);os.prototype.Li=function(a){this.Qc||(this.Qc=sc(a));this.qs+=a.wt||1;this.er.push(a)};os.prototype.ya=function(){return this.Qc};os.prototype.getPosition=os.prototype.ya;os.prototype.Ud=function(){return this.qs};os.prototype.getWeight=os.prototype.Ud;os.prototype.Sf=Ve;os.prototype.isCluster=os.prototype.Sf;os.prototype.Qd=function(){return this.ae};os.prototype.getMinZoom=os.prototype.Qd;
os.prototype.hm=function(){return this.Eq};os.prototype.getMaxZoom=os.prototype.hm;os.prototype.C=function(){return this.I};os.prototype.getBoundingBox=os.prototype.C;os.prototype.qp=function(a){this.uj(a)};os.prototype.forEachEntry=os.prototype.qp;os.prototype.uj=function(a){var b=this;if(!ab(a))throw new D(this.uj,0,a);this.er.forEach(function(c){a(new ns(c,b.ae+1))})};os.prototype.forEachDataPoint=os.prototype.uj;function ps(a){hs.call(this,a)}u(ps,hs);
ps.prototype.Zr=function(a){var b=this.options,c=b.min,d=b.max,e=[],f=[],g;if(this.md){for(g=this.fc;c<=d;c++){for(var h,k=void 0,l,n,p,q,r,v,w,y=c,I=g,G=e,S=f,X=b.eps,Ga=b.projection,ha=b.minWeight,mb=I.length,ta=Math.pow(2,y+8),nb=[];w=I[--mb];)if(!w.xs){n=Ga.Ne(w).scale(ta).floor();v=ta;r=n.x;q=n.y;for(l=nb.length;l--;)h=nb[l],p=h.ya(),h.vs||(h.vs=Ga.Ne(p).scale(ta).floor()),p=h.vs,p=p.lb(n),p<v&&(v=p,k=h);k&&k.C().zf(w)||(k=new os(Ga.sn({x:(r-X)/ta,y:(q-X)/ta}),Ga.sn({x:(r+X)/ta,y:(q+X)/ta}),
y),nb.push(k));k.Li(w);k=null}for(mb=nb.length;mb--;)if(h=nb[mb],l=h.Ud(),l<ha)for(h=h.er,l=h.length;w=h[--l];)S.push(new ns(w,y)),w.xs=!0;else G.push(h)}c=0;for(d=g.length;c<d;c++)delete g[c].xs;this.md=!1;a({clusters:e,noisePoints:f})}};function qs(a){hs.call(this,a);a=this.options;if(a.projection!==uh)throw new D(qs,0,"Other projection than mercator not supported yet");this.he=a.projection;this.gp=a.eps;this.wB=a.minWeight;this.Xv=new vh(this.he);(new aj).registerProcessor("cluster","H.clustering.dynamicgrid.worker");this.bg=A(this.bg,this);this.Kq=A(this.Kq,this)}u(qs,hs);qs.prototype.Hw=function(a,b){this.zy=a;this.Ay=Fb(b)};
qs.prototype.Zr=function(a,b){var c=this.Gg;var d=this.zy,e=this.Ay||0;var f=!c||!(c.zoom===e&&c.Oi.ea(d));if(d&&(this.md||f)){c&&3>c.state&&c.cancel();this.md=!1;c=this.gp;if(c>=128*Kb(2,e))var g=rs;else{f=this.Xv;f.Wa(e);var h=f.Gb(d.Kc());g=f.Gb(d.Gc());h.y-=c;g.y+=c;h=f.gk(h);var k=f.gk(g);g=new F(h.lat,h.lng,k.lat,k.lng);c=f.$a(c,0).lng+180;g=g.$d(h.lat,h.lng-c,k.lat,h.lng).$d(h.lat,k.lng,k.lat,k.lng+c)}c=g;h=this.fc;g=[];for(f=h.length;f--;)c.zf(h[f])&&g.push(h[f]);0<g.length?(this.Gg=new ss(d,
e,g,this.gp,this.wB,this.he!==uh,a,b),this.Gg.then(this.bg,this.Kq)):a(js)}};
qs.prototype.bg=function(a){Ba(a)||(a=new x.Uint32Array(a));for(var b=this.Gg,c=b.VB,d=0,e=a[d++],f=Array(e),g=0,h=[],k=a.length,l=this.Gg.Cy,n=this.Gg.zoom;e--;)f[g++]=new ns(l[a[d++]],n);for(;d<k;){e=a[d++];g=l[a[d]];var p=this.Xv;var q=this.gp;p.Wa(this.Gg.zoom);var r=p.Gb(g);g=p.$a(r.x-q,r.y-q);p=p.$a(r.x+q,r.y+q);g=new F(g.lat,g.lng,p.lat,p.lng);for(g=new os(g.Kc(),g.Gc(),n);e--;)g.Li(l[a[d++]]);h.push(g)}c.call(b,{clusters:h,noisePoints:f})};qs.prototype.Kq=function(a){jb(a)&&this.Gg.KB(a)};
var rs=new F(90,-180,-90,180);qs.prototype.i=function(){qs.g.i.call(this)};qs.prototype.disposeInternal=qs.prototype.i;function ss(a,b,c,d,e,f,g,h){this.Oi=a;this.zoom=b;this.Cy=c;this.VB=g;this.KB=h;a=c.length;g=3*a;h=new (x.Float64Array||Array)(g);for(var k;a--;)k=c[a],h[--g]=k.lat,h[--g]=k.lng,h[--g]=k.wt;Td.call(this,"cluster",{message:[h,d,e,b,f]},void 0)}u(ss,cj);function ts(a){this.oa=a;this.fy=11;a=document.createElement("canvas");var b=a.getContext("2d"),c=this.oa,d=14*c;a.width=d;a.height=d;b.scale(c,c);b.beginPath();b.strokeStyle="#FFFFFF";b.fillStyle="#1080DD";b.arc(7,7,6,0,2*Math.PI,!1);b.fill();b.lineWidth=1;b.stroke();this.BB=new Sh(a,{size:{w:14,h:14},anchor:{x:7,y:7}});this.kt={};this.lt={}}t("H.clustering.theme.Circular",ts);
function us(a,b,c){var d,e=document.createElement("canvas"),f=e.getContext("2d");var g=a.oa;var h=b*g;e.width=h;e.height=h;f.scale(g,g);g=b+":"+c;(d=a.kt[g])?f.putImageData(d,0,0):(b/=2,f.beginPath(),f.strokeStyle="rgba("+c+",0.2)",f.fillStyle="rgba("+c+",1)",f.arc(b,b,b/5*3,0,2*Math.PI,!1),f.fill(),f.lineWidth=b/5*4,f.stroke(),a.kt[g]=f.getImageData(0,0,h,h));return e}
ts.prototype.mz=function(a){var b=a.Ud();var c=this.lt[b];if(!c){if(10>b){c=us(this,28,"118,209,0");var d={x:11,y:18}}else 25>b?(c=us(this,38,"255,105,0"),d={x:13,y:23}):50>b?(c=us(this,38,"240,60,0"),d={x:13,y:23}):100>b?(c=us(this,38,"181,0,21"),d={x:13,y:23}):1E3>b?(c=us(this,48,"181,0,21"),d={x:15,y:28}):(c=us(this,66,"181,0,21"),d={x:20,y:38});var e=c.getContext("2d");e.fillStyle="#FFFFFF";e.font="bold "+this.fy+"px Arial";e.fillText(String(b),d.x,d.y);d=c.width/this.oa;c=new Sh(c,{size:{w:d,
h:d},anchor:{x:d/2,y:d/2}});this.lt[b]=c}b=new ci(a.ya(),{icon:c,min:a.Qd(),max:a.hm()});b.setData(a);return b};ts.prototype.getClusterPresentation=ts.prototype.mz;ts.prototype.Zz=function(a){var b=new ci(a.ya(),{icon:this.BB,min:a.Qd()});b.setData(a);return b};ts.prototype.getNoisePresentation=ts.prototype.Zz;t("H.clustering.DataPoint",function(a,b,c,d){this.lat=a;this.lng=b;this.wt=c===+c?c:1;this.data=d});function vs(a,b){b=b||{};var c={},d=b.min||0,e=Db(d,b.max||22);d={min:d,max:e};vs.g.constructor.call(this,d);this.oa=b.pixelRatio||Ie();Ta(c,is,d,b.clusteringOptions||{});c.minWeight=Db(is.minWeight,c.minWeight);switch(c.strategy){case ws.DYNAMICGRID:if(c.projection!==uh)throw new D(vs,1,"Unsupported projection");this.ra=new qs(c);break;case ws.GRID:this.ra=new ps(c);break;default:this.ra=new ks(c)}this.ra.qe(a);this.Wk=b.theme||new ts(this.oa);this.Io=A(this.Io,this);this.bg=A(this.bg,this);xs(this)}
u(vs,P);t("H.clustering.Provider",vs);vs.prototype.i=function(){vs.g.i.call(this);this.vg.ja();this.ra.u();delete this.ra;delete this.Im;delete this.Wk;x.clearTimeout(this.bp)};var ws={FASTGRID:0,GRID:1,DYNAMICGRID:2};vs.Strategy=ws;vs.prototype.Tx=150;vs.prototype.Io=function(){this.dispatchEvent("start");this.ra.Zr(this.bg,Xe)};function xs(a,b,c){a.bp&&x.clearTimeout(a.bp);b&&a.ra.Hw(b,c);a.bp=x.setTimeout(a.Io,a.Tx)}vs.prototype.bg=function(a){this.Im=a;ys(this);this.dispatchEvent("end")};
vs.prototype.qe=function(a){this.ra.qe(a);xs(this)};vs.prototype.setDataPoints=vs.prototype.qe;vs.prototype.vc=function(a){this.ra.vc(a);xs(this)};vs.prototype.addDataPoint=vs.prototype.vc;vs.prototype.ql=function(a){this.ra.ql(a);xs(this)};vs.prototype.addDataPoints=vs.prototype.ql;vs.prototype.sk=function(a){this.ra.sk(a);xs(this)};vs.prototype.removeDataPoint=vs.prototype.sk;vs.prototype.uA=function(){return this.Wk};vs.prototype.getTheme=vs.prototype.uA;
vs.prototype.QC=function(a){this.Wk=a;this.Im&&(this.vg.ja(),ys(this))};vs.prototype.setTheme=vs.prototype.QC;function ys(a){var b=a.Im.clusters,c=a.Im.noisePoints,d=b.length,e=c.length,f=0<d+e;for(a.vg.ja();e--;){var g=c[e];a.vg.$(a.Wk.getNoisePresentation(g))}for(;d--;)c=b[d],a.vg.$(a.Wk.getClusterPresentation(c));f&&a.kb()}vs.prototype.Rc=function(){return!0};vs.prototype.providesDomMarkers=vs.prototype.Rc;vs.prototype.Sc=function(){return!0};vs.prototype.providesMarkers=vs.prototype.Sc;
vs.prototype.ie=function(){return!0};vs.prototype.providesSpatials=vs.prototype.ie;vs.prototype.lk=function(a,b){xs(this,a,b)};vs.prototype.preprocessData=vs.prototype.lk;t("H.clustering.buildInfo",function(){return cn("H-clustering","1.54.1","17144d2",{region:"row"})});

function zs(a,b){a:{for(var c=a.length,d="string"===typeof a?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"===typeof a?a.charAt(b):a[b]}var As={};function Bs(a){var b=a.ownerDocument,c=b.documentElement;b=b.defaultView;var d=a.getBoundingClientRect();a=d.left;d=d.top;isNaN(b.pageXOffset)?(a+=c.scrollLeft,d+=c.scrollTop):(a+=b.pageXOffset,d+=b.pageYOffset);return new L(a,d)}
function Cs(a,b,c){b=ob(b)?b+"px":b;c=ob(c)?c+"px":c;a.style[um("transform")]="translate("+b+","+c+")"}var Ds,Es=navigator.userAgent,Fs=-1<Es.indexOf("Android")&&-1<Es.indexOf("Mozilla/5.0")&&-1<Es.indexOf("AppleWebKit"),Gs=/AppleWebKit\/([\d.]+)/,Hs=null===Gs.exec(Es)?null:parseFloat(Gs.exec(Es)[1]);Ds=Fs&&null!==Hs&&537>Hs;var Is=globalThis,Js=document.createElement("T");function Ks(){this.Sw=this.Ct()}Ks.prototype.Ct=function(){var a=navigator,b=[];a&&(a.msPointerEnabled?b.push(Ls):a.pointerEnabled&&b.push(Ms));1>b.length&&("TouchEvent"in Is&&b.push(Ns),b.push(Os));return b};Ks.prototype.detectEventSets=Ks.prototype.Ct;Ks.prototype.addEventListener=function(a,b,c,d){for(var e=this.Sw,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.addEventListener(f,c,d||!1);h||a.addEventListener(b,c,d||!1)};
Ks.prototype.removeEventListener=function(a,b,c,d){for(var e=this.Sw,f,g=e.length,h=!1;g--;)if(f=e[g][b])h=!0,a.removeEventListener(f,c,d||!1);h||a.removeEventListener(b,c,d||!1)};
var Ms={start:"pointerdown",end:"pointerup",move:"pointermove",cancel:"pointercancel",over:"pointerover",out:"pointerout",hover:"pointerhover"},Ls={start:"MSPointerDown",end:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel",over:"MSPointerOver",out:"MSPointerOut",hover:"MSPointerHover"},Ns={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Os={start:"mousedown",end:"mouseup",move:"mousemove",over:"mouseover",out:"mouseout",hover:"mousehover"};function Ps(a,b,c,d){a=a.createElement(b);c&&(a.className=c);d&&(a.innerHTML=d);return a}function Qs(a,b){for(var c=1,d=arguments.length;c<d;c++)a.appendChild(arguments[c])}var Rs=new Ks;function Ss(a,b,c){Rs.addEventListener(a,b,c,void 0)}function Ts(a,b,c){Rs.removeEventListener(a,b,c,void 0)};function Y(a,b){J.call(this);this.Qa=a||"div";this.He=b?b.split(" "):[];this.Db=!1;this.He.push("H_el")}u(Y,J);t("H.ui.base.Element",Y);Y.prototype.N=function(a){if(!a)throw Error("Wrong document object");this.J=Ps(a,this.Qa,this.He.join(" "));this.renderInternal(this.J,a);this.wa(this.Db,!0);this.Dd(this.px);this.Zb(this.Id);return this.J};Y.prototype.subscribe=function(){};Y.prototype.unsubscribe=function(){};Y.prototype.O=function(){};Y.prototype.renderInternal=Y.prototype.O;
Y.prototype.hq=function(){return this.Db};Y.prototype.isDisabled=Y.prototype.hq;Y.prototype.wa=function(a,b){a=!!a;if(a!==this.Db||b)(this.Db=a)?this.Sa("H_disabled"):this.Mb("H_disabled");return this};Y.prototype.setDisabled=Y.prototype.wa;Y.prototype.Zo=null;Y.prototype.getData=function(){return this.Zo};Y.prototype.getData=Y.prototype.getData;Y.prototype.setData=function(a){this.Zo=a};Y.prototype.setData=Y.prototype.setData;
Y.prototype.Dd=function(a){var b=this.F();this.px=a;b&&(a?b.setAttribute("title",a):b.removeAttribute("title"))};Y.prototype.setTooltip=Y.prototype.Dd;Y.prototype.J=null;Y.prototype.F=function(){return this.J};Y.prototype.getElement=Y.prototype.F;Y.prototype.Id=!0;Y.prototype.Zb=function(a){var b=this.F();this.Id=a;b&&(b.style.display=a?"":"none")};Y.prototype.setVisibility=Y.prototype.Zb;Y.prototype.Td=function(){return this.Id};Y.prototype.getVisibility=Y.prototype.Td;
Y.prototype.Sa=function(a){var b=this.F();0>this.He.indexOf(a)&&this.He.push(a);b&&(b.className=this.He.join(" "));return this};Y.prototype.addClass=Y.prototype.Sa;Y.prototype.Mb=function(a){a=this.He.indexOf(a);var b=this.F();-1<a&&this.He.splice(a,1);b&&(b.className=this.He.join(" "));return this};Y.prototype.removeClass=Y.prototype.Mb;function Us(a){(a=a.F())&&a.parentNode&&a.parentNode.removeChild(a)}Y.prototype.i=function(){Y.g.i.call(this);Us(this);this.Zo=this.J=null;delete this.px};function Vs(a,b){b=b||{};var c=this;Y.call(this,"div","H_ib H_ib_top");this.Kv=A(function(d){c.Db||(c.close(),d.preventDefault())},this);this.update=A(this.update,this);this.Tl=A(this.Tl,this);this.setPosition(a);this.Fk(b.content);b.onStateChange&&this.addEventListener("statechange",b.onStateChange);this.G(Ws.OPEN)}u(Vs,Y);t("H.ui.InfoBubble",Vs);Vs.prototype.v=null;Vs.prototype.ya=function(){return this.Qc};Vs.prototype.setPosition=function(a){this.Qc=sc(a);this.update()};
Vs.prototype.setPosition=Vs.prototype.setPosition;Vs.prototype.Pa=function(a){this.v=a};
Vs.prototype.O=function(a,b){this.Eo=Ps(b,"div","H_ib_body");this.tailEl_=Ps(b,"div","H_ib_tail");this.Cl=Ps(b,"div","H_ib_close H_btn",'<svg version="1.1" class="H_icon" viewBox="0 0 12 12"><path d="m8.12 6 3.66-3.66c.29-.29.29-.76 0-1.05l-1.06-1.06c-.29-.29-.76-.29-1.05 0l-3.66 3.66-3.66-3.66c-.29-.29-.76-.29-1.05 0l-1.06 1.06c-.29.29-.3.76 0 1.05l3.66 3.66-3.66 3.66c-.29.29-.29.76 0 1.05l1.06 1.06c.29.29.76.29 1.05 0l3.66-3.66 3.66 3.66c.29.29.76.29 1.05 0l1.06-1.06c.29-.29.3-.76 0-1.05z"></path></svg>');this.ah=
Ps(b,"div","H_ib_content","&nbsp;");this.Eo.appendChild(this.Cl);this.Eo.appendChild(this.ah);Ss(this.Cl,"start",this.Kv);this.v.xa.addEventListener("sync",this.update);this.v.pa.addEventListener("sync",this.update);a.appendChild(this.Eo);a.appendChild(this.tailEl_);this.Fk(this.Jl)};Vs.prototype.renderInternal=Vs.prototype.O;Vs.prototype.Tl=function(){this.xt||(this.xt=setTimeout(this.update,0))};
Vs.prototype.update=function(){var a=this.F(),b=this.v,c,d="none";this.xt=0;if(b&&a&&this.getState()===Ws.OPEN){if(c=b.Ka(this.Qc)){var e=c.x;c=c.y;b=b.pa.width;if(e>=-b||e<=2*b||c>=-b||c<=2*b)d="",Ds?(a.style.left=e-b+"px",a.style.top=c+"px"):Cs(a,e,c)}a.style.display=d;""===d&&(a.style.visibility="visible")}};var Ws={OPEN:"open",CLOSED:"closed"};Vs.State=Ws;Vs.prototype.o=Ws.OPEN;Vs.prototype.getState=function(){return this.o};Vs.prototype.getState=Vs.prototype.getState;
Vs.prototype.G=function(a){a!==this.o&&(this.o=a,this.dispatchEvent("statechange"));if(a=this.F())this.o===Ws.OPEN?(a.style.display="block",a.style.visibility="hidden",this.Tl()):a.style.display="none"};Vs.prototype.setState=Vs.prototype.G;Vs.prototype.close=function(){this.G(Ws.CLOSED)};Vs.prototype.close=Vs.prototype.close;Vs.prototype.open=function(){this.G(Ws.OPEN)};Vs.prototype.open=Vs.prototype.open;Vs.prototype.oz=function(){return this.ah||null};Vs.prototype.getContentElement=Vs.prototype.oz;
Vs.prototype.Fk=function(a){if(a)if("string"===typeof a||"number"===typeof a.nodeType&&"string"===typeof a.nodeName)this.Jl=a;else throw Error("InfoBubble content must be a string or HTML node.");else this.Jl="";this.F()&&(this.Jl?(this.ah.innerHTML="","string"===typeof this.Jl?this.ah.innerHTML=a:"number"===typeof a.nodeType&&"string"===typeof a.nodeName&&this.ah.appendChild(a)):this.ah.innerHTML="&nbsp;",this.Tl())};Vs.prototype.setContent=Vs.prototype.Fk;
Vs.prototype.i=function(){this.close();this.Fk("");this.Cl&&Ts(this.Cl,"end",this.Kv);this.v&&(this.v.xa.removeEventListener("sync",this.update),this.v.pa.removeEventListener("sync",this.update));Y.prototype.i.call(this)};function Xs(a,b,c){Y.call(this,a,b);this.dc=c?[].concat(c):[]}u(Xs,Y);t("H.ui.base.Container",Xs);Xs.prototype.wa=function(a,b){var c=this.dc?this.dc.length:0;for(Y.prototype.wa.call(this,a,b);c--;)this.dc[c].wa(a,b);return this};Xs.prototype.setDisabled=Xs.prototype.wa;Xs.prototype.Ra=function(a){var b=this.F();this.dc.push(a);b&&(a.N(b.ownerDocument),b.appendChild(a.F()));return this};Xs.prototype.addChild=Xs.prototype.Ra;Xs.prototype.xp=function(){return[].concat(this.dc)};
Xs.prototype.getChildren=Xs.prototype.xp;Xs.prototype.removeChild=function(a){var b=this.dc.indexOf(a),c=this.F();0<=b&&(this.dc.splice(b,1),c&&c.removeChild(a.F()))};Xs.prototype.removeChild=Xs.prototype.removeChild;Xs.prototype.ja=function(){var a=this.F();a&&this.dc.forEach(function(b){a.removeChild(b.F())});this.dc=[]};Xs.prototype.O=function(a,b){for(var c=0,d=this.dc.length;c<d;c++)a.appendChild(this.dc[c].N(b))};Xs.prototype.renderInternal=Xs.prototype.O;
Xs.prototype.i=function(){this.ja();this.dc.forEach(this.Ny,this);Y.prototype.i.call(this)};Xs.prototype.Ny=function(a){a.u()};function Ys(){this.o=Zs.CLOSED;Xs.call(this,"div","H_overlay")}u(Ys,Xs);t("H.ui.base.OverlayPanel",Ys);Ys.prototype.G=function(a,b){if(a!==this.o||b)this.o=a,a===Zs.OPEN?this.Sa("H_open"):this.Mb("H_open");return this};Ys.prototype.setState=Ys.prototype.G;Ys.prototype.getState=function(){return this.o};Ys.prototype.getState=Ys.prototype.getState;
Ys.prototype.Zv=function(a){var b=a.Ae;a=a.F();var c=this.F(),d=c.style;this.Mb("H_top");this.Mb("H_middle");this.Mb("H_bottom");this.Mb("H_left");this.Mb("H_center");this.Mb("H_right");d.bottom=d.top=d.left=d.right=d.margin="";if(/top/g.test(b)){this.Sa("H_top");d.top="0";d.margin="0 12px";var e=-1}else/bottom/g.test(b)?(this.Sa("H_bottom"),d.bottom="0",d.margin="0 12px",e=1):(this.Sa("H_middle"),d.top="50%",d.margin="0 12px",d.marginTop=-Math.round(.5*
c.offsetHeight)+"px",e=0);/left/g.test(b)?(this.Sa("H_left"),d.left=a.offsetWidth+"px",d.marginLeft="12px"):/right/g.test(b)?(this.Sa("H_right"),d.right=a.offsetWidth+"px",d.marginRight="12px"):(this.Sa("H_center"),d.left="50%",0>e?(d.top=a.offsetHeight+"px",d.marginTop="12px"):0<e&&(d.bottom=a.offsetHeight+"px",d.marginBottom="12px"),d.marginLeft=-Math.round(.5*c.offsetWidth)+"px",a.appendChild(c))};Ys.prototype.pointToControl=Ys.prototype.Zv;var Zs={OPEN:"open",CLOSED:"closed"};
Ys.State=Zs;function $s(a){a=a||{};Y.call(this,"div","H_btn");this.se(a.label||" ");this.Dd(a.tooltip||"");this.setData(a.data);this.wa(!!a.disabled);this.G(at.UP,!0);a.onStateChange&&this.addEventListener("statechange",a.onStateChange);this.Xm=A(this.Xm,this);this.Sh=A(this.Sh,this)}u($s,Y);t("H.ui.base.Button",$s);$s.prototype.wa=function(a,b){a&&this.Mb("H_active");return $s.g.wa.call(this,a,b)};$s.prototype.setDisabled=$s.prototype.wa;
$s.prototype.O=function(a){Ss(a,"start",this.Xm);Ss(a,"end",this.Sh);Ss(a,"out",this.Sh);this.se(this.Vb,!0)};$s.prototype.renderInternal=$s.prototype.O;$s.prototype.getState=function(){return this.o};$s.prototype.getState=$s.prototype.getState;$s.prototype.G=function(a,b){a!==this.o&&(this.o=a,a===at.DOWN?this.Sa("H_active"):this.Mb("H_active"),b||this.dispatchEvent("statechange"));return this};$s.prototype.setState=$s.prototype.G;$s.prototype.Cp=function(){return this.Vb};
$s.prototype.getLabel=$s.prototype.Cp;$s.prototype.se=function(a,b){if(b||a!==this.Vb)if(this.Vb=a,b=this.F())b.innerHTML=a;return this};$s.prototype.setLabel=$s.prototype.se;$s.prototype.Xm=function(a){this.Db||this.G(at.DOWN);a.preventDefault()};$s.prototype.Sh=function(a){this.Db||this.G(at.UP);a.preventDefault()};$s.prototype.i=function(){var a=this.F();a&&(Ts(a,"start",this.Xm),Ts(a,"end",this.Sh),Ts(a,"out",this.Sh));Y.prototype.i.call(this)};var at={UP:"up",DOWN:"down"};$s.State=at;function bt(a){$s.call(this,a);this.JB=function(b){b.preventDefault()};this.hn=A(function(b){this.Db||this.toggleState();b.preventDefault()},this)}u(bt,$s);t("H.ui.base.PushButton",bt);bt.prototype.O=function(a){Ss(a,"start",this.hn);Ss(a,"end",this.JB);this.se(this.Vb,!0)};bt.prototype.renderInternal=bt.prototype.O;bt.prototype.oD=function(){var a=at.DOWN;this.G(this.getState()===a?at.UP:a);return this};bt.prototype.toggleState=bt.prototype.oD;
bt.prototype.i=function(){var a=this.F();a&&Ts(a,"start",this.hn);$s.prototype.i.call(this)};function ct(a){a=a||{};Xs.call(this,"div","H_rdo");this.hs=new Y("div","H_rdo_title");this.Pi=new Xs("div","H_rdo_buttons");this.Ra(this.hs);this.Ra(this.Pi);this.Cv=A(function(b){b.target.getState()===at.DOWN?(this.Fw(b.target,!0),this.dispatchEvent(dt)):b.target.G(at.DOWN,!0)},this);this.addEventListener("statechange",this.Cv);this.Wr(a.title||"");a.onActiveButtonChange&&this.addEventListener(dt,a.onActiveButtonChange);a.buttonsOptions&&a.buttonsOptions.forEach(function(b){this.to(new bt(b))},
this)}u(ct,Xs);t("H.ui.base.RadioGroup",ct);var dt="activebuttonchange";ct.prototype.O=function(a,b){Xs.prototype.renderInternal.call(this,a,b);this.Wr(this.bo,!0)};ct.prototype.renderInternal=ct.prototype.O;ct.prototype.ja=function(){this.Pi.ja()};ct.prototype.Wr=function(a,b){if(a!==this.bo||b)this.bo=a,this.hs.F()&&(this.hs.F().innerHTML=this.bo);return this};ct.prototype.setTitle=ct.prototype.Wr;ct.prototype.wA=function(){return this.bo};ct.prototype.getTitle=ct.prototype.wA;
ct.prototype.to=function(a){if(!(a instanceof bt))throw Error("PushButton expected");a.fa(this);this.Pi.Ra(a);return this};ct.prototype.addButton=ct.prototype.to;ct.prototype.oC=function(a){this.Pi.removeChild(a);a.fa(null);return this};ct.prototype.removeButton=ct.prototype.oC;ct.prototype.cm=function(){return this.Pi.xp()};ct.prototype.getButtons=ct.prototype.cm;ct.prototype.Fw=function(a,b){for(var c=this.cm(),d=c.length;d--;)c[d].G(c[d]===a?at.DOWN:at.UP,b)};ct.prototype.setActiveButton=ct.prototype.Fw;
ct.prototype.i=function(){this.removeEventListener("statechange",this.Cv);this.ja();Xs.prototype.i.call(this)};var et={btn:'<svg class="H_icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><g transform="translate(3 2)"><path d="m18 13v7h-18v-7h2v5h2v-2h2v2h2v-3h2v3h2v-2h2v2h2v-5z"></path><path d="m2.3.3c.7 0 1.3.1 1.8.4s.9.6 1.1 1 .4.9.4 1.4c0 .5-.1 1-.3 1.4s-.57 1-1 1.6-1.3 1.3-2.3 2.2h3.9l-.2 1.7h-6.16v-1.6c1.1-1.1 2-2 2.5-2.6s.9-1 1-1.4.3-.8.3-1.2c0-.4-.1-.7-.3-.9s-.5-.3-.9-.3c-.3 0-.6 0-.9.2s-.5.4-.8.7l-1.3-1c.4-.5.9-.9 1.4-1.2s1.2-.4 1.8-.4zm14.4 9.7h-2.3l-.2-3.8c 0-.9-.1-1.7-.1-2.4 0-.5 0-1 0-1.5l-1.5 6.7h-2.2l-1.6-6.7c.1.8.1 1.6.1 2.3 0 .5 0 1.1 0 1.7l-.2 3.8h-2.2l.7-9.7h2.9l1.5 6.6 1.4-6.6h2.9z"></path></g></g></svg>',
point:'<svg height="22" viewBox="0 0 12 12" width="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m6 12c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z" fill="#fff"></path><path d="m6 10c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4z" fill="#2ed5c9" stroke="#272c36" stroke-width="2"></path></g></svg>'};function ft(a,b,c){Ti.call(this,a,{icon:gt,visibility:c});ht(this,b)}u(ft,Ti);function ht(a,b){a.ZA=b;a.J&&(a.J.textContent=b)}var gt=new Ri(Ps(Is.document,"span","H_dm_label"),{onAttach:function(a,b,c){c.J=a;ht(c,c.ZA)},onDetach:function(a,b,c){delete c.J}});function it(a,b){J.call(this);this.Ie=a;this.Vb=new ft(this.mD,"");b.push(this.Vb);this.rd=new Q({objects:b,data:this});this.Wn=this.Wn.bind(this)}u(it,J);m=it.prototype;m.Ve=!1;m.mD={lat:0,lng:0};m.se=function(a,b){ht(this.Vb,a);this.Vb.Y(b)};m.Ik=function(a){(this.Id=a)?this.Wn():(this.$k&&x.clearTimeout(this.$k),this.$k=x.setTimeout(this.Wn,100))};m.$k=0;m.Wn=function(){this.Vb.Zb(this.Id)};function jt(a,b){b&&(a.nextSibling=b,b.previousSibling=a)};function kt(a,b,c){c=b.Cj(c||0);this.Yf=new ci(a,{icon:c,zIndex:0});this.Yf.draggable=!0;it.call(this,b,[this.Yf]);a=this.rd;a.addEventListener("dragstart",this.zd,!0,this);a.addEventListener("drag",this.cg,!0,this);a.addEventListener("dragend",this.$e,!0,this)}u(kt,it);m=kt.prototype;m.gh=0;m.l={uf:"change"};m.Bj=function(){return this.gh};m.ya=function(){return this.Yf.W()};
function lt(a){var b=0;a.nextSibling&&a.previousSibling&&(a.nextSibling.Ve||a.previousSibling.Ve?a.nextSibling.Ve&&!a.previousSibling.Ve&&(b=2):b=1);b=a.Ie.Cj(b);a.Yf.re(b)}m.cg=function(a){var b=a.currentPointer;a=b.viewportX;b=b.viewportY;if(this.$A!==a||this.aB!==b)this.$A=a,this.aB=b,this.Yf.Y(this.Ie.map.Xa(a-this.ov.x,b-this.ov.y)),this.dispatchEvent(new ie(this.l.uf,this))};
m.zd=function(a){var b=a.currentPointer,c=b.viewportX;b=b.viewportY;var d=this.Ie.map.Ka(this.ya());this.Yf.pi(1);this.ov={x:c-d.x,y:b-d.y};a.stopPropagation()};m.$e=function(){this.Yf.pi(0)};m.Ir=function(a){this.gh=a;this.se(this.Ie.Ft(a),this.ya())};var mt={IMPERIAL:"imperial",METRIC:"metric"};t("H.ui.UnitSystem",mt);function nt(a,b,c,d){var e=new K,f=[];jt(a,this);jt(this,b);e.ng(a.ya());e.ng(b.ya());this.Kh=new xi(e,{style:c.Jh});this.tu=new xi(e,{style:{strokeColor:"transparent",lineWidth:Math.min(100,this.Kh.L().lineWidth+2*(d||5))}});c.outlineStyle&&(this.Yq=new xi(e,{style:c.outlineStyle}),f.push(this.Yq));f.push(this.Kh,this.tu);it.call(this,c,f);this.Yu=this.Xu=-1;a=this.rd;a.addEventListener("pointermove",this.ee,!0,this);a.addEventListener("pointerleave",this.Rq,!0,this)}u(nt,it);
nt.prototype.Bj=function(){var a=this.Kh.W();return a.rj(0).lb(a.rj(1))};function ot(a,b,c){var d=a.Kh.W();d.Ok(3*+c,3,[b.lat,b.lng,0]);a.Yq&&a.Yq.Y(d);a.tu.Y(d);a.Kh.Y(d)}nt.prototype.ee=function(a){var b=a.currentPointer;a=this.previousSibling.ya();var c=this.nextSibling.ya(),d=this.Ie.Yw,e=b.viewportX;b=b.viewportY;if(this.Xu!==e||this.Yu!==b)this.Xu=e,this.Yu=b,d.Y(this.Ie.Yz(a,c,{x:e,y:b})),d.Zb(!0)};nt.prototype.Rq=function(){this.Ie.Yw.Zb()};
nt.prototype.Ir=function(){this.se(this.Ie.Ft(this.Bj()),this.Kh.C().wb())};function pt(a,b){this.Ia=b;this.sc=a;this.ob={Ve:!0};qt(this,this.ob);this.bn=A(this.bn,this)}t("H.ui.distanceMeasurement.Model",pt);m=pt.prototype;m.Bm=function(){return this.ob.nextSibling===this.ob};m.Ik=function(a){for(var b=this.ob,c=b.nextSibling;c!==b;)c.Ik(c.previousSibling===b?!1:a),c=c.nextSibling};
function rt(a,b){var c=b||a.ob.nextSibling,d=0,e=0;if(b&&!st(a,b))throw new D(a.tk,0,b);c instanceof kt?d=c.Bj():c instanceof nt&&(d=c.previousSibling.Bj());for(b=c;b&&b!==a.ob;b=b.nextSibling,e++)b.Ir(d),1===e%2&&(d+=b.Bj())}m.Li=function(a){var b=this.ob.previousSibling,c=this.Bm();a=new kt(a,this.Ia,c?0:2);this.sc.$(a.rd);jt(a,this.ob);a.addEventListener(a.l.uf,this.bn);c?qt(this,a):(tt(this,b,a),lt(b),rt(this,b));return a};
m.insertBefore=function(a,b){var c;var d=1;if(b){if(!st(this,b))throw new D(this.insertBefore,1,b);if(c=b.previousSibling.Ve)d=0;a=new kt(a,this.Ia,d);a.addEventListener(a.l.uf,this.bn);this.sc.$(a.rd);c?(c=this.ob.nextSibling,tt(this,a,c),qt(this,a),b=a,lt(c)):(c=b.previousSibling,b=c.previousSibling,d=c.nextSibling,this.sc.Na(c.rd),tt(this,b,a),tt(this,a,d));rt(this,b)}else a=this.Li(a);return a};m.ja=function(){qt(this,this.ob);this.sc.ja()};
m.tk=function(a){var b=this.ob,c=a.previousSibling,d=a.nextSibling;if(!st(this,a))throw new D(this.tk,0,a);this.sc.Na(a.rd);if(c===b){var e=d;e!==b?(a=e.nextSibling,qt(this,a),a.Ir(0),lt(a),rt(this,a)):qt(this,this.ob)}else d===b?(e=c,a=e.previousSibling,jt(a,b),lt(a)):c&&d&&(tt(this,c.previousSibling,d.nextSibling),this.sc.pg([d.rd,c.rd]),rt(this,c.previousSibling));e&&e!==b&&this.sc.Na(e.rd)};
function st(a,b){for(var c=a.ob.nextSibling,d=!1;c!==a.ob;){if(c===b){d=!0;break}c=c.nextSibling}return d}function tt(a,b,c){b=new nt(b,c,a.Ia);a.sc.$(b.rd)}function qt(a,b){a.ob.nextSibling=b;b.previousSibling=a.ob}m.bn=function(a){a=a.target;var b=a.previousSibling,c=a.nextSibling,d=a.ya();if(!c.Ve){ot(c,d,!1);var e=a}b.Ve||(ot(b,d,!0),e=b.previousSibling);rt(this,e)};var ut={TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right",LEFT_TOP:"left-top",LEFT_MIDDLE:"left-middle",LEFT_BOTTOM:"left-bottom",RIGHT_TOP:"right-top",RIGHT_MIDDLE:"right-middle",RIGHT_BOTTOM:"right-bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right"};t("H.ui.LayoutAlignment",ut);function vt(){Xs.call(this,"div","H_ctl");this.map=null;this.Ae="top-left"}u(vt,Xs);t("H.ui.Control",vt);vt.prototype.Pa=function(a){this.map=a};vt.prototype.N=function(a){return Xs.prototype.N.call(this,a)};vt.prototype.O=function(a,b){Xs.prototype.renderInternal.call(this,a,b);this.Wc(this.Ae)};vt.prototype.renderInternal=vt.prototype.O;vt.prototype.ek=function(){};vt.prototype.onUnitSystemChange=vt.prototype.ek;vt.prototype.Ic=function(){return this.map};vt.prototype.getMap=vt.prototype.Ic;
vt.prototype.ma=function(){return this.kB};vt.prototype.getLocalization=vt.prototype.ma;vt.prototype.fz=function(){return this.Ae};vt.prototype.getAlignment=vt.prototype.fz;vt.prototype.Wc=function(a){"string"===typeof a&&ut[a.replace("-","_").toUpperCase()]===a&&(this.Ae=a,this.dispatchEvent("alignmentchange"));return this};vt.prototype.setAlignment=vt.prototype.Wc;function wt(a){a=a||{};var b,c=a.lineStyle;vt.call(this);this.Go=new bt({label:et.btn,onStateChange:A(this.bf,this)});this.Ra(this.Go);if(b=a.distanceFormatter)this.Gt=b;c&&(this.ev=c,this.Ov=B);this.Wc(a.alignment||"right-bottom");this.sd={};this.sd[0]=a.startIcon;this.sd[2]=a.endIcon;this.sd[1]=a.stopoverIcon;this.sd[3]=a.splitIcon}u(wt,vt);t("H.ui.DistanceMeasurement",wt);m=wt.prototype;m.Pb=mt.METRIC;m.Ix=22;m.ev={strokeColor:"rgb(39,44,54)",lineWidth:5};m.Ov={strokeColor:"white",lineWidth:7};
m.Mk=function(){var a=this.map,b,c={};this.Oj||(this.qc=new P,this.rb=new Pj(this.qc,{pixelRatio:this.map.mb()}),this.sc=b=this.qc.pd(),this.sc.Rw(!0),b.addEventListener("dragstart",this.zd,!0,this),b.addEventListener("dragend",this.Nk,!0,this),b.addEventListener("pointerenter",this.Nk,!0,this),b.addEventListener("pointerleave",this.Rq,!0,this),b.addEventListener("tap",this.WB,!0,this),this.Pk=xt(this),c.Ft=A(this.Gt,this),c.Cj=A(this.Cj,this),c.Yz=A(this.ku,this),c.map=this.map,c.Yw=this.Pk,c.Jh=
this.ev,c.outlineStyle=this.Ov,this.Wb=new pt(this.sc,c),this.Oj=!0);this.Pk&&this.sc.$(this.Pk);a.addEventListener("tap",this.Hv,!0,this);a.P.add(this.rb)};m.wi=function(){var a=this.map;this.Oj&&(a.removeEventListener("tap",this.Hv,!0,this),a.ei(this.rb),this.Wb.ja())};
function xt(a){function b(){var h=c.lc();h={anchor:c.Cb.clone().scale(f).floor(),size:new Jh(Fb(h.w*f),Fb(h.h*f)),hitArea:d};return new Sh(c.Oe(),h)}var c=a.Cj(3),d=new Ph(Qh.NONE,[]),e,f=c===a.Ds?.5:1;if(1===c.getState())var g=b();else g=new Sh("<svg/>",{hitArea:d}),c.addEventListener("statechange",function(){1===c.getState()&&e.re(b())});return e=new ci(a.map.wb(),{visibility:!1,icon:g})}
m.Gt=function(a){var b="m",c=0;"metric"===this.Pb?1E3<=a&&(a/=1E3,b="km",c=1):(a/=.3048,b="ft",5280<=a&&(a/=5280,b="mi",c=1));return a.toFixed(c)+" "+this.ma().translate("scale."+b)};m.ku=function(a,b,c){var d=this.map.Ka(a);b=this.map.Ka(b);c=(new L(c.x,c.y)).ju(d,b);return this.map.Xa(c.x,c.y)||sc(a)};
m.O=function(a,b){var c=this.map.Ca.type===ph.P2D?this.map.mb():1;c*=this.Ix;var d=c/2;vt.prototype.renderInternal.call(this,a,b);this.Pb=mt.METRIC;this.Ds=new Sh(et.point,{anchor:{x:d,y:d},size:{w:c,h:c},hitArea:new Ph(Qh.CIRCLE,[d,d,d])});this.Go.Dd(this.ma().translate("distance.measurement"))};wt.prototype.renderInternal=wt.prototype.O;m=wt.prototype;m.Cj=function(a){return this.sd[a]||this.Ds};m.Nk=function(){this.Wb.Ik(!0)};m.zd=function(){this.Wb.Ik()};
m.Rq=function(a){"touch"!==a.currentPointer.type&&this.Wb.Ik()};m.WB=function(a){var b=a.currentPointer;var c=a.target.Ma;var d;c&&(c=c.getData())instanceof it&&(d=c);c=d;a=a.originalEvent;a=a.metaKey||a.altKey;c&&(a&&c instanceof kt?this.Wb.tk(c):c instanceof nt&&(a=c.previousSibling.ya(),d=c.nextSibling.ya(),b={x:b.viewportX,y:b.viewportY},this.Wb.insertBefore(this.ku(a,d,b),c.nextSibling),this.Pk.Zb()),this.Nk())};
m.Hv=function(a){var b=a.currentPointer;a=a.target;a!==this.map&&a.getProvider&&a.getProvider()===this.qc||(this.Wb.Li(this.map.Xa(b.viewportX,b.viewportY)),this.Pk.Zb(),this.Nk())};m.bf=function(a){"down"===a.target.getState()?this.Mk():this.wi()};m.ek=function(a){this.Pb=a;this.Oj&&(rt(this.Wb),this.Nk())};wt.prototype.onUnitSystemChange=wt.prototype.ek;wt.prototype.i=function(){this.wi();this.Oj&&(this.qc.u(),this.rb.u());wt.g.i.call(this)};
wt.prototype.Pa=function(a){a?this.Go.getState()===at.DOWN&&(this.map=a,this.Mk()):(this.wi(),this.Oj=!1);vt.prototype.Pa.apply(this,arguments)};wt.prototype.setMap=wt.prototype.Pa;function yt(a){a=a||{};vt.call(this);this.Nh=new bt({label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><g transform="translate(1 3)"><path fill-rule="nonzero" d="M5,0 L5,2 L2,2 L2,16 L5,16 L5,18 L2,18 C0.9,18 0,17 0,15.75 L0,2.25 C0,1 0.9,0 2,0 L5,0 Z M17,0 L20,0 C21.1,0 22,1 22,2.25 L22,15.75 C22,17 21.1,18 20,18 L17,18 L17,16 L20,16 L20,2 L17,2 L17,0 Z"></path><rect width="10" height="2" x="6" y="8"></rect><rect width="2" height="10" x="10" y="4"></rect></g></svg>',
onStateChange:A(this.bf,this)});this.Ra(this.Nh);this.Wc(a.alignment||"right-bottom")}u(yt,vt);t("H.ui.ZoomRectangle",yt);m=yt.prototype;
m.bf=function(a){var b=this.map,c=b.pa.element;a.target.getState()===at.DOWN?(b.addEventListener("dragstart",this.zd,!0,this),b.addEventListener("drag",this.cg,!0,this),b.addEventListener("dragend",this.$e,!0,this),a=c.ownerDocument.createElement("div"),a.className="H_zoom_lasso",c.appendChild(a),this.Gm=a):(b.removeEventListener("dragstart",this.zd,!0,this),b.removeEventListener("drag",this.cg,!0,this),b.removeEventListener("dragend",this.$e,!0,this),c.removeChild(this.Gm))};
m.zd=function(a){var b=this.Gm.style,c=a.currentPointer,d=c.viewportX;c=c.viewportY;a.target===this.map&&(a.stopPropagation(),b.width="0px",b.height="0px",b.top=c+"px",b.left=d+"px",b.display="block",this.$w=c,this.Zw=d)};m.cg=function(a){var b=a.currentPointer,c=b.viewportX,d=b.viewportY;b=this.Zw;var e=this.$w,f=this.Gm.style;a.target===this.map&&(a.stopPropagation(),a=c-b,c=d-e,f.left=b+(0>a?a:0)+"px",f.top=e+(0>c?c:0)+"px",f.width=Math.abs(a)+"px",f.height=Math.abs(c)+"px")};
m.$e=function(a){var b=this.map,c=a.currentPointer;a.target===this.map&&(a.stopPropagation(),this.Gm.style.display="none",b.xa.Xc({bounds:Jc([b.Xa(this.Zw,this.$w),b.Xa(c.viewportX,c.viewportY)])},!0))};m.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);this.Nh.Dd(this.ma().translate("zoom.rectangle"))};yt.prototype.renderInternal=yt.prototype.O;function zt(a){a=a||{};vt.call(this);this.$f=new Ys;this.oe=this.oe.bind(this);this.Dl=this.Dl.bind(this);this.nm=this.nm.bind(this);this.Wc(a.alignment||"bottom-right");At(this,a.baseLayers,a.layers)}u(zt,vt);t("H.ui.MapSettingsControl",zt);function Bt(a,b){var c=[];a.concat(b).forEach(function(d){c=c.concat(d.layer)});return c}function Ct(a,b,c){var d=a.Ic();if(d){a=Bt(a.Ce,a.Uf);var e=Bt(b,c);a.forEach(function(f){e.includes(f)||d.ei(f)})}}
function At(a,b,c){Ct(a,b,c);a.qq=NaN;a.Ce=ib(b)?b:[];a.Uf=ib(c)?c:[];a.Rg&&(a.Rg.ja(),a.Lm.ja(),Dt(a))}zt.prototype.subscribe=function(){var a=this.Ic();a&&(a.addEventListener("tap",this.Dl),a=a.P,a.addEventListener("add",this.oe),a.addEventListener("remove",this.oe),a.addEventListener("set",this.oe))};
zt.prototype.unsubscribe=function(){var a=this.Ic();a&&(a.removeEventListener("tap",this.Dl),a=a.P,a.removeEventListener("add",this.oe),a.removeEventListener("remove",this.oe),a.removeEventListener("set",this.oe))};
zt.prototype.O=function(a,b){var c=this.ma().translate("layers.choose");vt.prototype.renderInternal.call(this,a,b);this.subscribe();this.Nh=new bt({tooltip:c,label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.7,14.6 L4.5,16 L12,20.6 L19.5,16 L17.3,14.6 L19.1,13.5 L23,16 L12,23 L1,16 L4.9,13.5 L6.7,14.6 Z M12,2 L23,9 L12,16 L1,9 L12,2 Z"></path></svg>',onStateChange:A(function(d){d.target.getState()===at.DOWN?(this.$f.G(Zs.OPEN),this.$f.Zv(this)):
this.$f.G(Zs.CLOSED)},this)});zt.prototype.$x=function(d){if(this.map.Ca.type===$m){var e=H.map.render.harp.Style;d=[].concat(d);for(var f=0;!h&&f<d.length;f++){var g=d[f].D;if(g.Tc()&&g.L){g=g.L();var h=g.getConfig()||g.getUrl()}}if(h){var k=function(l){l=l.D;l.Tc()&&l.L&&l.L()instanceof e&&l.Bb(new e(h))};this.Uf.forEach(function(l){l=l.layer;ib(l)?l.forEach(k):l&&k(l)})}}};this.Rg=new ct({title:c,onActiveButtonChange:function(){var d=this.qq;a:{var e=this.Rg.cm();for(var f=e.length;f--;)if(e[f].getState()===
at.DOWN){e=e[f];break a}e=null}e=e.getData();e=this.Ce[e].layer;f=ib(e);this.map.xg(f?e[0]:e);if(d=this.Ce[d])if(d=d.layer,ib(d))for(var g=d.length;1<g--;)this.map.ei(d[g]);if(f)for(d=e.length;1<d--;)this.map.rl(e[d],1);this.$x(e);this.nm()}.bind(this)});this.Lm=new Xs("div","H_grp");this.vu=new Y("div","H_separator");this.Ra(this.Nh);this.Ra(this.$f);this.$f.Ra(this.Rg);this.$f.Ra(this.vu);this.$f.Ra(this.Lm);Dt(this)};zt.prototype.renderInternal=zt.prototype.O;
function Dt(a){var b=a.ma();a.Ce.forEach(function(c,d){var e=c.layer;this.Rg.to(new bt({label:Et(b,c.label),data:d,disabled:!e||ib(e)&&!e.length}))},a);a.Uf.forEach(function(c,d){var e=c.layer;this.Lm.Ra(new bt({label:Et(b,c.label),onStateChange:this.PB.bind(this,c.layer),data:d,disabled:!e||ib(e)&&!e.length}))},a);a.vu.Zb(!(!a.Uf.length||!a.Ce.length));x.setTimeout(function(){this.map&&(this.oe(),this.Nh.wa(!(this.Ce&&this.Ce.length||this.Uf&&this.Uf.length)))}.bind(a))}
zt.prototype.oe=function(){var a=this.map.qa,b=this.map.P;this.qq=NaN;this.Ce.forEach(function(c,d){c=c.layer;c=a===(ib(c)?c[0]:c);this.Rg.cm()[d].G(at[c?"DOWN":"UP"],!0);c&&(this.qq=d)},this);this.Uf.forEach(function(c,d){c=c.layer;var e=ib(c);d=this.Lm.xp()[d];!c||e&&!c.length?d.wa(!0):d.G(at[-1!==b.indexOf(e?c[0]:c)?"DOWN":"UP"],!0)},this)};zt.prototype.PB=function(a,b){a=ib(a)?a:[a];b=b.target.getState()===at.DOWN;for(var c=0;c<a.length;c++)b?this.map.rl(a[c]):this.map.ei(a[c]);this.nm()};
zt.prototype.nm=function(){var a=Ft(this);a&&(a.qo.D.L().Wj(a.D.L().Pd()),this.map.ei(a),a.u(),delete a.qo);Gt(this)&&Ht(this,this.map.qa)};
function Ht(a,b){var c=window.H.service&&window.H.service.omv.Provider,d=b.D;if(c&&b.D instanceof c&&d.L().qj){var e=d.L(),f=function(){var g=It.ground.filter(function(l){return!!e.Kp("layers."+l)}),h=It.water.filter(function(l){return!!e.Kp("layers."+l)});if(g.concat(h).length){var k={};pg(k,e.qj(g));pg(k,e.qj(h,!1,!0));delete k.global;g=new Zg(k,e.Fc());g=d.aa.kd(g);g.qo=b;this.map.rl(g)}e.removeEventListener(ng.CHANGE,f)}.bind(a);e.getState()!==lg.READY?e.addEventListener(ng.CHANGE,f):
f()}}function Ft(a){return zs(a.map.P.Ta(),function(b){return!!b.qo})}function Gt(a){a=a.map.P.Ta();var b=window.H.service&&window.H.service.traffic.flow.Provider;return!!b&&a.some(function(c){return c.D instanceof b})}var It={water:["water.water-labels"],ground:"road_labels continent_label island_label roads.shields roads.directions truck-restriction.signs places landuse.label".split(" ")};function Et(a,b){return/^layers?/.test(b)&&a.qm(b)?a.translate(b):b}zt.prototype.Dl=function(){this.Nh.G(at.UP)};
zt.prototype.i=function(){zt.g.i.call(this);this.unsubscribe()};var Jt={"in":'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><path d="m5 10.6h5.6v-5.6h2.8v5.6h5.6v2.8h-5.6v5.6h-2.8v-5.6h-5.6v-2.8z"></path></g></svg>',out:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><path d="m5 10.6h14v2.8h-14z"/></svg>'};function Kt(a){a=a||{};var b;this.tf=!!a.vertical;this.dB=a.length||this.Jx;this.zb=ob(b=a.min)?b:this.Lx;this.Nc=Db(this.zb,ob(b=a.max)?b:this.Kx);this.ZC=E(b=a.step)?this.Mx:b;this.Ai=Lt(this,ob(b=a.value)?b:(this.zb+this.Nc)/2);this.cn=A(this.cn,this);this.ee=A(this.ee,this);this.en=A(this.en,this);this.dn=A(this.dn,this);this.hk=a.pointerArea;Y.call(this,"div","H_slider"+(this.tf?"":" H_l_horizontal"))}u(Kt,Y);t("H.ui.base.Slider",Kt);m=Kt.prototype;m.Is=1;m.Lx=0;m.Kx=100;
m.Mx=1;m.Jx="16em";m.Yn=function(a,b){var c=this.tf,d=c?"top":"left";if(!this.Ja||b)a=ec(a,this.zb,this.Nc),this.Hh&&(b=100*(a-this.zb)/(this.Nc-this.zb),c=(c?-1:1)*b,this.Hh.style[d]=c+"%",this.pD.style[d]=100+c+"%"),this.Ai=Lt(this,a);return this.Ai};Kt.prototype.setValue=Kt.prototype.Yn;Kt.prototype.AA=function(){return this.Ai};Kt.prototype.getValue=Kt.prototype.AA;m=Kt.prototype;
m.Mk=function(){if(!this.eq){Ss(this.F(),"start",this.cn);var a=this.hk;Ss(a,"move",this.ee);Ss(a,"end",this.en);Ss(a,"out",this.dn);this.eq=!0}};m.wi=function(){if(this.eq){Ts(this.F(),"start",this.cn);var a=this.hk;Ts(a,"move",this.ee);Ts(a,"end",this.en);Ts(a,"out",this.dn);this.eq=!1}};function Lt(a,b){var c=a.ZC;b=ec(b,a.zb,a.Nc);return c?a.zb+Eb((b-a.zb)/c)*c:b}
function Mt(a,b){var c=a.tx,d=a.tf;a.sx||(a.sx=c["offset"+(d?"Height":"Width")]);b-=Bs(c)[d?"y":"x"];0>b&&(b=0);b=(a.Nc-a.zb)*b/a.sx;b=Lt(a,d?a.Nc-b:a.zb+b);a.Ai!==b&&(a.Yn(b,!0),a.dispatchEvent(new nh(a.l.uf,b,a.Ai)))}function Nt(a,b){return(b.touches?b.targetTouches[0]:b)["page"+(a.tf?"Y":"X")]}function Ot(a,b){var c=!1,d=a.type;-1!==d.indexOf("pointer")||-1!==d.indexOf("touch")?c=!0:C(a,MouseEvent)&&(c=a.which===b||a.buttons===b);return c}
function Pt(a){var b=a.touches;return b&&1===b.length||C(a,MouseEvent)}m.cn=function(a){var b=this.tf;if(Ot(a,this.Is)&&Pt(a)){var c=Nt(this,a);var d=a.target;d===this.Hh||d.parentElement===this.Hh?(this.YA=c-Bs(this.Hh)[b?"y":"x"]-this.Hh.offsetWidth/2,this.F().className="H_slider H_slider_active"+(this.tf?"":" H_l_horizontal"),this.Ja=!0):Mt(this,c);a.preventDefault()}};m.en=function(){this.Ja&&(this.F().className="H_slider "+(this.tf?"":" H_l_horizontal"),this.Ja=!1)};
m.dn=function(a){this.Ja&&a.target===this.hk&&(this.Ja=!1)};m.ee=function(a){this.Ja&&Pt(a)&&(Ot(a,this.Is)?(Mt(this,Nt(this,a)-this.YA),a.preventDefault()):this.Ja=!1)};m.l={uf:"change"};
m.O=function(a,b){var c=Ps(b,"div","H_slider_cont"),d=Ps(b,"div","H_slider_knob_cont"),e=Ps(b,"div","H_slider_knob"),f=Ps(b,"div","H_slider_knob_halo"),g=Ps(b,"div","H_slider_track");b=Ps(b,"div","H_slider_track H_slider_track_active");a.appendChild(c);c.appendChild(g);g.appendChild(b);c.appendChild(d);d.appendChild(e);d.appendChild(f);this.tx=g;this.pD=b;this.Hh=d;this.hk||(this.hk=a.ownerDocument.body);c.style[this.tf?"height":"width"]=this.dB;this.Yn(this.Ai);
this.Mk()};Kt.prototype.renderInternal=Kt.prototype.O;Kt.prototype.i=function(){this.wi()};Kt.prototype.wa=function(a,b){a?this.wi():this.tx&&this.Mk();return Y.prototype.wa.call(this,a,b)};Kt.prototype.setDisabled=Kt.prototype.wa;function Qt(a){a=a||{};var b=a.slider;vt.call(this);this.kn=A(this.kn,this);this.fl=A(this.fl,this);this.Hd=A(this.Hd,this);b&&(this.Sq=A(this.Sq,this),this.yu=b,this.YC=a.sliderSnaps,this.Sa("H_zoom_slider"));this.jl=new $s({label:Jt["in"],onStateChange:this.kn});this.no=new $s({label:Jt.out,onStateChange:this.kn});this.Sa("H_zoom");this.Sa("H_grp");this.$y=!1!==a.fractionalZoom;this.setZoomSpeed(a.zoomSpeed||4);this.Wc(a.alignment||"right-middle")}u(Qt,vt);
t("H.ui.ZoomControl",Qt);Qt.prototype.FA=function(){return this.Dx};Qt.prototype.getZoomSpeed=Qt.prototype.FA;Qt.prototype.UC=function(a){this.Dx=a};Qt.prototype.setZoomSpeed=Qt.prototype.UC;Qt.prototype.Pa=function(a){this.map!==a&&(this.map&&this.map.removeEventListener("mapviewchange",this.fl),Rt(this));vt.prototype.Pa.apply(this,arguments);this.map&&(this.Hd(),a.addEventListener("mapviewchange",this.fl),a.addEventListener("baselayerchange",this.Hd))};Qt.prototype.setMap=Qt.prototype.Pa;
Qt.prototype.i=function(){vt.prototype.i.apply(this,arguments);this.map.removeEventListener("baselayerchange",this.Hd);Rt(this)};Qt.prototype.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);this.jl.Dd(this.ma().translate("zoom.in"));this.no.Dd(this.ma().translate("zoom.out"))};Qt.prototype.renderInternal=Qt.prototype.O;Qt.prototype.Wc=function(a){var b=this.Ae;vt.prototype.Wc.call(this,a);b!==a&&this.Hd();return this};Qt.prototype.setAlignment=Qt.prototype.Wc;
Qt.prototype.fl=function(){var a=this.map,b=a.Tb(),c=a.mb()-1;a=a.qa||a.Ca.getCapabilities().lookAt.zoom;this.yu&&this.ri.Yn(b);this.Db||(this.jl.wa(b+c>=a.max),this.no.wa(b<=a.min))};Qt.prototype.wa=function(a,b){Qt.g.wa.call(this,a,b);this.fl();return this};Qt.prototype.setDisabled=Qt.prototype.wa;function Rt(a){a.removeChild(a.ri);a.ri=null;a.qa&&(a.qa.removeEventListener("minchange",a.Hd),a.qa.removeEventListener("maxchange",a.Hd),a.qa=null)}
Qt.prototype.kn=function(a){a=a.target;var b=a===this.jl?1:-1,c=0<b?Math.ceil:Math.floor,d=this.map,e,f=this;d&&("down"===a.getState()?(d.xa.startControl(),d.xa.control(0,0,b*this.Dx,0,0,0)):d.xa.endControl(!0,function(g){e=f.$y?g.zoom:c(g.zoom);g.zoom=e}))};Qt.prototype.Sq=function(a){this.map&&this.map.Lk(a.newValue)};
Qt.prototype.Hd=function(){var a=this.Ae,b=this.Ic();if(/^top/g.test(a)||/^bottom/g.test(a)){var c=this.no;a=this.jl;var d=!1}else c=this.jl,a=this.no,d=!0;this.removeChild(c);this.removeChild(a);this.Ra(c);if(this.yu&&b){Rt(this);b=d;var e=(d=(c=this.map)&&c.qa)||c.Ca.getCapabilities().lookAt.zoom;if(this.qa=d)d.addEventListener("minchange",this.Hd),d.addEventListener("maxchange",this.Hd);this.ri=new Kt({step:this.YC?1:0,vertical:b,min:e.min,max:e.max,value:c.Tb(),pointerArea:c.F()});this.ri.addEventListener(this.ri.l.uf,
this.Sq);this.Ra(this.ri)}this.Ra(a)};function St(a){C(a,Ce,St,1);Y.call(this,"div","H_context_menu_item");this.Wb=a;this.Vm=A(this.Vm,this);this.ye=A(this.ye,this);this.Wb.addEventListener("update",this.ye)}u(St,Y);t("H.ui.context.Item",St);St.prototype.Vm=function(a){var b=this.Wb,c=b.callback;c&&!b.isDisabled()&&(this.dispatchEvent("click"),c(a))};St.prototype.O=function(){var a=this,b=this.F();qe(b,"click",this.Vm);b.addEventListener("keyup",function(c){13==c.keyCode&&a.Vm(c)});this.ye()};St.prototype.renderInternal=St.prototype.O;
St.prototype.ye=function(){var a=this.F(),b=this.Wb;b.callback?(this.Sa("clickable"),a.setAttribute("tabindex","0")):(this.Mb("clickable"),a.removeAttribute("tabindex"));b.isDisabled()?this.Sa("disabled"):this.Mb("disabled");b=b.getLabel();Js.textContent=b;a.innerHTML=Js.innerHTML.split("\n").join("<br/>")};St.prototype.i=function(){Y.prototype.i.call(this);this.Wb.removeEventListener("update",this.ye)};function Tt(a){C(a,Array,Tt,1);Xs.call(this,"div","H_context_menu");this.rB=a;this.v=null}u(Tt,Xs);t("H.ui.context.Menu",Tt);Tt.prototype.O=function(){Xs.prototype.O.apply(this,arguments);this.rB.forEach(function(a){a===De?a=new Y("div","H_context_menu_item_separator"):(a=new St(a),a.addEventListener("click",this.OB.bind(this)));this.Ra(a)},this);qe(this.F(),["mousedown","touchstart","pointerdown","wheel"],function(a){a.stopPropagation()})};Tt.prototype.renderInternal=Tt.prototype.O;
Tt.prototype.setPosition=function(a,b){if(this.v){var c=this.F();var d=c.offsetWidth;var e=c.offsetHeight;var f=this.v;var g=f.pa.width;f=f.pa.height;a+d>g&&a>g/2&&(a-=d);b+e>f&&b>f/2&&(b-=e);Cs(c,a,b)}};Tt.prototype.setPosition=Tt.prototype.setPosition;Tt.prototype.OB=function(){this.v&&this.v.dispatchEvent(new ie("contextmenuclose",this.v))};Tt.prototype.Pa=function(a){this.v=a};Tt.prototype.setMap=Tt.prototype.Pa;function Ut(a){a=a||{};vt.call(this);this.Sa("H_scalebar");this.Wc(a.alignment||"right-bottom");this.maxWidth=150;this.update=A(this.update,this);this.Uu=this.Dr=this.Ck=this.Uk=null}u(Ut,vt);t("H.ui.ScaleBar",Ut);
Ut.prototype.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);a.innerHTML='<svg height="12" version="1.1" xmlns="http://www.w3.org/2000/svg"><polyline style="fill:none; stroke:white; stroke-width:4" points="2,2 2,10 98,10 98,2"/><polyline style="fill:none; stroke:black; stroke-width:2" points="2,2 2,10 98,10 98,2"/></svg><div style="padding: 0 0 0 10px"></div>';a.style.direction="ltr";this.Uk=a.firstChild;b=this.Uk.childNodes;this.Ck=b[0];this.Dr=b[1];this.Uu=a.lastChild;this.Pb=mt.METRIC;
this.My=A(function(c){this.Db||(this.dispatchEvent("toggleunitsystem"),c.preventDefault())},this);this.hn=A(function(c){c.preventDefault()},this);Ss(a,"start",this.hn);Ss(a,"end",this.My);this.Dd(this.ma().translate("scale.switchToImperial"));this.update()};Ut.prototype.renderInternal=Ut.prototype.O;Ut.prototype.Pa=function(a){this.map&&this.map.removeEventListener("mapviewchange",this.update);a&&a.addEventListener("mapviewchange",this.update);vt.prototype.Pa.apply(this,arguments)};
Ut.prototype.setMap=Ut.prototype.Pa;
Ut.prototype.capture=function(a,b,c){var d=this.F();var e=d.ownerDocument,f=e.createElement("canvas"),g=f.getContext("2d"),h=e.createElementNS("http://www.w3.org/2000/svg","svg"),k=e.createElementNS("http://www.w3.org/2000/svg","foreignObject"),l=af(d,e,!1);e=parseFloat(d.offsetWidth)+1;var n=parseFloat(d.offsetHeight),p=e*a;a*=n;f.width=p;f.height=a;h.setAttribute("xmlns","http://www.w3.org/2000/svg");h.setAttribute("width",p);h.setAttribute("height",a);h.setAttribute("viewBox","0 0 "+e+" "+n);k.setAttribute("width",
"100%");k.setAttribute("height","100%");h.appendChild(k);l.setAttribute("width","100%");l.setAttribute("height","100%");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var q=window.getComputedStyle(d);"box-shadow display align-items font font-family font-size height text-shadow direction".split(" ").forEach(function(r){l.style.setProperty(r,q.getPropertyValue(r))});k.appendChild(l);d=Re(h.outerHTML);(new Tg("image",d)).then(function(r){g.drawImage(r,0,0);b(f)},c)};Ut.prototype.capture=Ut.prototype.capture;
Ut.prototype.ek=function(a){this.Pb=a;this.Dd("imperial"===a?this.ma().translate("scale.switchToMetric"):this.ma().translate("scale.switchToImperial"));this.update()};Ut.prototype.onUnitSystemChange=Ut.prototype.ek;
Ut.prototype.update=function(){var a;if(this.F()){this.Uk=this.Uk;this.Ck=this.Ck;var b=this.maxWidth;var c=0;var d=this.map;if(d){var e=Math.round(.5*d.pa.width);var f=Math.round(.5*d.pa.height);(a=d.Xa(e,f))&&(d=d.Xa(e+1,f))&&(c=100*a.lb(d))}c&&(this.Pb===mt.IMPERIAL?1609.344>c?(d=c/.3048006,a=this.ma().translate("scale.ft")):(d=c/1609.344,a=this.ma().translate("scale.mi")):1E3>c?(d=c,a=this.ma().translate("scale.m")):(d=c/1E3,a=this.ma().translate("scale.km")),c=Math.pow(10,Math.floor(Math.log(d)/
Math.LN10)),d=c/d*100,d<b/5?(c*=5,d*=5):d<b/2?(c*=2,d*=2):d>b&&(c/=2,d/=2),d=Math.round(d),this.Uk.setAttribute("width",d),this.Uu.textContent=c+" "+a,this.Ck.points.getItem(2).x=this.Dr.points.getItem(2).x=this.Ck.points.getItem(3).x=this.Dr.points.getItem(3).x=d-2)}};var Vt=[];t("H.ui.i18n.defaultLocales",Vt);var Wt={},Xt=[];function Yt(a,b){Wt[a]=b;-1===Vt.indexOf(a)&&Vt.push(a);Xt.length?Zt(a,b):Xt=Object.keys(b)}function Zt(a,b){for(var c=Xt,d=c.length,e;d--;)if(e=c[d],!b[e])throw Error("'"+e+"' key missing in translation map for "+a);};Yt("tr-TR",{"layers.normal":"Harita g\u00f6r\u00fcn\u00fcm\u00fc","layers.satellite":"Uydu","layers.terrain":"Arazi","layer.transit":"Toplu ula\u015f\u0131m","layer.traffic":"Trafik durumlar\u0131","layer.incidents":"Trafik olaylar\u0131n\u0131 g\u00f6ster","layers.choose":"G\u00f6r\u00fcn\u00fcm se\u00e7",minimap:"Minimap","scale.switchToImperial":"Mile d\u00f6n\u00fc\u015ft\u00fcr","scale.switchToMetric":"Kilometreye d\u00f6n\u00fc\u015ft\u00fcr","scale.km":"km","scale.m":"m","scale.mi":"mil","scale.ft":"ft",
"zoom.out":"Uzakla\u015ft\u0131r","zoom.in":"Yak\u0131nla\u015ft\u0131r","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Toplu ula\u015f\u0131m","traffic.MISCELLANEOUS":"\u00c7e\u015fitli","traffic.ACCIDENT":"Kaza","traffic.OTHER_NEWS":"Di\u011fer haberler","traffic.OTHER":"Di\u011fer haberler","traffic.PLANNED_EVENT":"Planl\u0131 etkinlik","traffic.ROAD_HAZARD":"Yol tehlikesi","traffic.ROAD_CLOSURE":"Yol kapal\u0131","traffic.WEATHER":"Hava durumu","traffic.CONGESTION":"Yo\u011funluk",
"traffic.CONSTRUCTION":"Yol \u00e7al\u0131\u015fmas\u0131","traffic.DISABLED_VEHICLE":"Ara\u00e7 ar\u0131zas\u0131","traffic.LANE_RESTRICTION":"\u015eerit k\u0131s\u0131tlamas\u0131","traffic.from":"Ba\u015flang\u0131\u00e7 zaman\u0131:","traffic.until":"Tahmini biti\u015f zaman\u0131:","distance.measurement":"Measure distance"});Yt("fr-FR",{"layers.normal":"Carte","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Transports publics","layer.traffic":"Conditions de circulation","layer.incidents":"Afficher les incidents de circulation","layers.choose":"Choisir la vue",minimap:"Minimap","scale.switchToImperial":"Passer en miles","scale.switchToMetric":"Passer en km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom arri\u00e8re","zoom.in":"Zoom avant","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transports publics","traffic.MISCELLANEOUS":"Divers","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Autre","traffic.OTHER":"Autre","traffic.PLANNED_EVENT":"\u00c9v\u00e9nement pr\u00e9vu","traffic.ROAD_HAZARD":"Danger routier","traffic.ROAD_CLOSURE":"Chauss\u00e9e ferm\u00e9e","traffic.WEATHER":"M\u00e9t\u00e9o","traffic.CONGESTION":"Embouteillage","traffic.CONSTRUCTION":"Travaux","traffic.DISABLED_VEHICLE":"V\u00e9hicule en panne","traffic.LANE_RESTRICTION":"Restriction de voie",
"traffic.from":"Date ou heure de d\u00e9but:","traffic.until":"Date et heure de fin estim\u00e9es:","distance.measurement":"Measure distance"});Yt("it-IT",{"layers.normal":"Vista mappa","layers.satellite":"Satellite","layers.terrain":"Terreno","layer.transit":"Mezzi pubblici","layer.traffic":"Condizioni del traffico","layer.incidents":"Mostra incidenti stradali","layers.choose":"Scegli vista",minimap:"Minimap","scale.switchToImperial":"Passa a miglia","scale.switchToMetric":"Passa a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom indietro","zoom.in":"Zoom avanti","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Mezzi pubblici",
"traffic.MISCELLANEOUS":"Varie","traffic.ACCIDENT":"Incidente","traffic.OTHER_NEWS":"Altre notizie","traffic.OTHER":"Altre notizie","traffic.PLANNED_EVENT":"Evento pianificato","traffic.ROAD_HAZARD":"Strada dissestata","traffic.ROAD_CLOSURE":"Strada chiusa","traffic.WEATHER":"Maltempo","traffic.CONGESTION":"Ingorgo","traffic.CONSTRUCTION":"Lavori in corso","traffic.DISABLED_VEHICLE":"Veicolo in panne","traffic.LANE_RESTRICTION":"Restrizione di corsia","traffic.from":"Ora di inizio:","traffic.until":"Ora di fine stimata:",
"distance.measurement":"Measure distance"});Yt("ru-RU",{"layers.normal":"\u0420\u0435\u0436\u0438\u043c \u043a\u0430\u0440\u0442\u044b","layers.satellite":"\u0421\u043f\u0443\u0442\u043d\u0438\u043a\u043e\u0432\u0430\u044f","layers.terrain":"\u041c\u0435\u0441\u0442\u043d\u043e\u0441\u0442\u044c","layer.transit":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","layer.traffic":"\u0414\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f",
"layer.incidents":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0434\u043e\u0440\u043e\u0436\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f","layers.choose":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0438\u0434",minimap:"Minimap","scale.switchToImperial":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u043b\u0438","scale.switchToMetric":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0438\u043b\u043e\u043c\u0435\u0442\u0440\u044b",
"scale.km":"\u043a\u043c","scale.m":"\u043c","scale.mi":"\u043c\u0438\u043b\u044c","scale.ft":"\u0444\u0443\u0442","zoom.out":"\u041e\u0442\u0434\u0430\u043b\u0438\u0442\u044c","zoom.in":"\u041f\u0440\u0438\u0431\u043b\u0438\u0437\u0438\u0442\u044c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u041e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442","traffic.MISCELLANEOUS":"\u041f\u0440\u043e\u0447\u0435\u0435 \u0414\u0422\u041f",
"traffic.ACCIDENT":"\u0414\u0422\u041f","traffic.OTHER_NEWS":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.OTHER":"\u0414\u0440\u0443\u0433\u0438\u0435 \u043d\u043e\u0432\u043e\u0441\u0442\u0438","traffic.PLANNED_EVENT":"\u041f\u043b\u0430\u043d\u043e\u0432\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435","traffic.ROAD_HAZARD":"\u0414\u043e\u0440\u043e\u0436\u043d\u0430\u044f \u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c",
"traffic.ROAD_CLOSURE":"\u0414\u043e\u0440\u043e\u0433\u0430 \u0437\u0430\u043a\u0440\u044b\u0442\u0430","traffic.WEATHER":"\u041f\u043e\u0433\u043e\u0434\u0430","traffic.CONGESTION":"\u041f\u0440\u043e\u0431\u043a\u0430","traffic.CONSTRUCTION":"\u0420\u0435\u043c\u043e\u043d\u0442","traffic.DISABLED_VEHICLE":"\u041d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u044b\u0439 \u0430\u0432\u0442\u043e\u043c\u043e\u0431\u0438\u043b\u044c","traffic.LANE_RESTRICTION":"\u041e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u043e\u0441\u044b \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",
"traffic.from":"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430:","traffic.until":"\u041e\u0436\u0438\u0434\u0430\u0435\u043c\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f:","distance.measurement":"\u0418\u0437\u043c\u0435\u0440\u0438\u0442\u044c \u0440\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435"});Yt("pt-BR",{"layers.normal":"Exibi\u00e7\u00e3o do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Condi\u00e7\u00f5es do tr\u00e2nsito","layer.incidents":"Mostrar incidentes no tr\u00e2nsito","layers.choose":"Escolher exibi\u00e7\u00e3o",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"milhas","scale.ft":"p\u00e9s","zoom.out":"Menos zoom",
"zoom.in":"Mais zoom","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Miscel\u00e2nea","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.OTHER":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planejado","traffic.ROAD_HAZARD":"Risco na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Clima","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo incapacitado",
"traffic.LANE_RESTRICTION":"Restri\u00e7\u00e3o de pista","traffic.from":"Hora de in\u00edcio:","traffic.until":"Tempo final estimado:","distance.measurement":"Measure distance"});Yt("es-ES",{"layers.normal":"Mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transporte p\u00fablico","layer.traffic":"Estado del tr\u00e1fico","layer.incidents":"Mostrar incidentes de tr\u00e1fico","layers.choose":"Elija una vista",minimap:"Minimap","scale.switchToImperial":"Cambiar a millas","scale.switchToMetric":"Cambiar a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Alejar","zoom.in":"Acercar","zoom.rectangle":"Zoom rectangle",
"traffic.MASS_TRANSIT":"Transporte p\u00fablico","traffic.MISCELLANEOUS":"Varios","traffic.ACCIDENT":"Accidente","traffic.OTHER_NEWS":"M\u00e1s noticias","traffic.OTHER":"M\u00e1s noticias","traffic.PLANNED_EVENT":"Acto programado","traffic.ROAD_HAZARD":"Riesgo en carretera","traffic.ROAD_CLOSURE":"Carretera cerrada","traffic.WEATHER":"Tiempo","traffic.CONGESTION":"Atasco","traffic.CONSTRUCTION":"Construcci\u00f3n","traffic.DISABLED_VEHICLE":"Veh\u00edculo averiado","traffic.LANE_RESTRICTION":"Restricci\u00f3n de carril",
"traffic.from":"Inicio:","traffic.until":"Finalizaci\u00f3n estimada:","distance.measurement":"Measure distance"});Yt("pl-PL",{"layers.normal":"Widok mapy","layers.satellite":"Satelita","layers.terrain":"Teren","layer.transit":"Transport publiczny","layer.traffic":"Warunki drogowe","layer.incidents":"Poka\u017c zdarzenia drogowe","layers.choose":"Wybierz widok",minimap:"Minimap","scale.switchToImperial":"Zmie\u0144 na mile","scale.switchToMetric":"Zmie\u0144 na km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Oddal","zoom.in":"Przybli\u017c","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transport publiczny",
"traffic.MISCELLANEOUS":"Inne zdarzenie","traffic.ACCIDENT":"Wypadek","traffic.OTHER_NEWS":"Inne wiadomo\u015bci","traffic.OTHER":"Inne wiadomo\u015bci","traffic.PLANNED_EVENT":"Zdarzenie planowane","traffic.ROAD_HAZARD":"Niebezpiecze\u0144stwo na drodze","traffic.ROAD_CLOSURE":"Jezdnia zamkni\u0119ta","traffic.WEATHER":"Pogoda","traffic.CONGESTION":"Korek","traffic.CONSTRUCTION":"Budowa","traffic.DISABLED_VEHICLE":"Uszkodzony pojazd","traffic.LANE_RESTRICTION":"Ograniczenie pasa ruchu","traffic.from":"Data rozpocz\u0119cia:",
"traffic.until":"Przybli\u017cona data zako\u0144czenia:","distance.measurement":"Measure distance"});Yt("en-US",{"layers.normal":"Map view","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Public transport","layer.traffic":"Traffic conditions","layer.incidents":"Show traffic incidents","layers.choose":"Choose view",minimap:"Minimap","scale.switchToImperial":"Change to miles","scale.switchToMetric":"Change to km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom out","zoom.in":"Zoom in","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Public transport",
"traffic.MISCELLANEOUS":"Miscellaneous","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Other news","traffic.OTHER":"Other news","traffic.PLANNED_EVENT":"Planned event","traffic.ROAD_HAZARD":"Road hazard","traffic.ROAD_CLOSURE":"Roadway closed","traffic.WEATHER":"Weather","traffic.CONGESTION":"Congestion","traffic.CONSTRUCTION":"Construction","traffic.DISABLED_VEHICLE":"Disabled vehicle","traffic.LANE_RESTRICTION":"Lane restriction","traffic.from":"Start time:","traffic.until":"Estimated end time:",
"distance.measurement":"Measure distance"});Yt("de-DE",{"layers.normal":"Kartenansicht","layers.satellite":"Satellit","layers.terrain":"Gel\u00e4nde","layer.transit":"\u00d6ffentliche Verkehrsmittel","layer.traffic":"Verkehrslage","layer.incidents":"Verkehrsst\u00f6rungen anzeigen","layers.choose":"Ansicht ausw\u00e4hlen",minimap:"Minimap","scale.switchToImperial":"Umrechnung in Meilen","scale.switchToMetric":"Umrechnung in Kilometer","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Verkleinern","zoom.in":"Vergr\u00f6\u00dfern",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u00d6ffentliche Verkehrsmittel","traffic.MISCELLANEOUS":"Diverse","traffic.ACCIDENT":"Unfall","traffic.OTHER_NEWS":"Anderes Ereignis","traffic.OTHER":"Anderes Ereignis","traffic.PLANNED_EVENT":"Geplantes Ereignis","traffic.ROAD_HAZARD":"Verkehrshindernis","traffic.ROAD_CLOSURE":"Fahrbahn gesperrt","traffic.WEATHER":"Wetter","traffic.CONGESTION":"Verkehrsstau","traffic.CONSTRUCTION":"Baustelle","traffic.DISABLED_VEHICLE":"Liegengebliebenes Fahrzeug",
"traffic.LANE_RESTRICTION":"Fahrstreifensperrung","traffic.from":"Beginn:","traffic.until":"Voraussichtliches Ende:","distance.measurement":"Measure distance"});Yt("fi-FI",{"layers.normal":"Karttan\u00e4kym\u00e4","layers.satellite":"Satelliitti","layers.terrain":"Maasto","layer.transit":"Julkinen liikenne","layer.traffic":"Liikenneolosuhteet","layer.incidents":"N\u00e4yt\u00e4 liikennetapahtumat","layers.choose":"Valitse n\u00e4kym\u00e4",minimap:"Minimap","scale.switchToImperial":"Vaihda maileihin","scale.switchToMetric":"Vaihda kilometreihin","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Loitonna","zoom.in":"L\u00e4henn\u00e4",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Julkinen liikenne","traffic.MISCELLANEOUS":"Erittelem\u00e4t\u00f6n syy","traffic.ACCIDENT":"Onnettomuus","traffic.OTHER_NEWS":"Muu tapahtuma","traffic.OTHER":"Muu tapahtuma","traffic.PLANNED_EVENT":"Suunniteltu tapahtuma","traffic.ROAD_HAZARD":"Vaara tiell\u00e4","traffic.ROAD_CLOSURE":"Tie suljettu","traffic.WEATHER":"S\u00e4\u00e4","traffic.CONGESTION":"Ruuhka","traffic.CONSTRUCTION":"Rakennusty\u00f6","traffic.DISABLED_VEHICLE":"Pys\u00e4htynyt ajoneuvo",
"traffic.LANE_RESTRICTION":"Kaista rajoitus","traffic.from":"Alkamisaika:","traffic.until":"Arvioitu p\u00e4\u00e4ttymisaika:","distance.measurement":"Measure distance"});Yt("nl-NL",{"layers.normal":"Kaartweergave","layers.satellite":"Satelliet","layers.terrain":"Terrein","layer.transit":"Openbaar vervoer","layer.traffic":"Verkeerssituatie","layer.incidents":"Toon verkeersincidenten","layers.choose":"Weergave kiezen",minimap:"Minimap","scale.switchToImperial":"Overgaan naar mijlen","scale.switchToMetric":"Wijzigen naar km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Uitzoomen","zoom.in":"Inzoomen","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Openbaar vervoer",
"traffic.MISCELLANEOUS":"Diversen","traffic.ACCIDENT":"Ongeval","traffic.OTHER_NEWS":"Meer informatie","traffic.OTHER":"Meer informatie","traffic.PLANNED_EVENT":"Geplande afzetting","traffic.ROAD_HAZARD":"Gevaar op de weg","traffic.ROAD_CLOSURE":"Rijbaan afgesloten","traffic.WEATHER":"Weer","traffic.CONGESTION":"Verkeersopstopping","traffic.CONSTRUCTION":"Wegwerkzaamheden","traffic.DISABLED_VEHICLE":"Voertuig met pech","traffic.LANE_RESTRICTION":"Rijstrookbeperking","traffic.from":"Begintijd:","traffic.until":"Geschatte eindtijd:",
"distance.measurement":"Measure distance"});Yt("pt-PT",{"layers.normal":"Vista do mapa","layers.satellite":"Sat\u00e9lite","layers.terrain":"Terreno","layer.transit":"Transportes p\u00fablicos","layer.traffic":"Condi\u00e7\u00f5es de tr\u00e2nsito","layer.incidents":"Mostrar incidentes de tr\u00e2nsito","layers.choose":"Escolher vista",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Diminuir","zoom.in":"Aumentar",
"zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transportes p\u00fablicos","traffic.MISCELLANEOUS":"Diversos","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras not\u00edcias","traffic.OTHER":"Outras not\u00edcias","traffic.PLANNED_EVENT":"Evento planeado","traffic.ROAD_HAZARD":"Perigo na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Meteorologia","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Constru\u00e7\u00e3o","traffic.DISABLED_VEHICLE":"Ve\u00edculo avariado",
"traffic.LANE_RESTRICTION":"Limita\u00e7\u00e3o da faixa de rodagem","traffic.from":"Hora de in\u00edcio:","traffic.until":"Hora de fim prevista:","distance.measurement":"Measure distance"});Yt("zh-CN",{"layers.normal":"\u5730\u56fe\u89c6\u56fe","layers.satellite":"\u536b\u661f","layers.terrain":"\u5730\u5f62","layer.transit":"\u516c\u5171\u4ea4\u901a","layer.traffic":"\u4ea4\u901a\u60c5\u51b5","layer.incidents":"\u663e\u793a\u4ea4\u901a\u4e8b\u4ef6","layers.choose":"\u9009\u62e9\u89c6\u56fe",minimap:"Minimap","scale.switchToImperial":"\u5207\u6362\u4e3a\u300c\u82f1\u91cc\u300d","scale.switchToMetric":"\u5207\u6362\u4e3a\u300c\u516c\u91cc\u300d","scale.km":"\u516c\u91cc","scale.m":"\u7c73",
"scale.mi":"\u82f1\u91cc","scale.ft":"\u82f1\u5c3a","zoom.out":"\u7f29\u5c0f","zoom.in":"\u653e\u5927","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"\u516c\u5171\u4ea4\u901a","traffic.MISCELLANEOUS":"\u7efc\u5408\u4e8b\u4ef6","traffic.ACCIDENT":"\u4ea4\u901a\u610f\u5916","traffic.OTHER_NEWS":"\u5176\u4ed6\u65b0\u95fb","traffic.OTHER":"\u5176\u4ed6\u65b0\u95fb","traffic.PLANNED_EVENT":"\u9884\u5b9a\u4e8b\u4ef6","traffic.ROAD_HAZARD":"\u9053\u8def\u5371\u9669","traffic.ROAD_CLOSURE":"\u9053\u8def\u5df2\u5173\u95ed",
"traffic.WEATHER":"\u5929\u6c14","traffic.CONGESTION":"\u5835\u585e","traffic.CONSTRUCTION":"\u65bd\u5de5","traffic.DISABLED_VEHICLE":"\u8f66\u8f86\u629b\u951a","traffic.LANE_RESTRICTION":"\u8f66\u9053\u9650\u5236","traffic.from":"\u5f00\u59cb\u65f6\u95f4\uff1a","traffic.until":"\u9884\u8ba1\u7ed3\u675f\u65f6\u95f4\uff1a","distance.measurement":"Measure distance"});function $t(a,b){if(!jb(a))throw new TypeError("string locale code required");if(ya(b))Zt(a,b);else{if(-1===Vt.indexOf(a))throw Error("Default locale '"+a+"' does nto exist.");b=Wt[a]}this.v=b||{};this.Mm=a}t("H.ui.i18n.Localization",$t);$t.prototype.Uz=function(){return this.Mm};$t.prototype.getLocale=$t.prototype.Uz;$t.prototype.Nz=function(){return Object.keys(this.v)};$t.prototype.getKeys=$t.prototype.Nz;$t.prototype.qm=function(a){return!(!this.v||!this.v[a])};$t.prototype.hasKey=$t.prototype.qm;
$t.prototype.translate=function(a){var b=this.v[a];if(!jb(b))throw Error("Translation missing for key '"+a+"'.");return b};$t.prototype.translate=$t.prototype.translate;function au(a,b){this.tc=a;this.zc=null;this.Yj=0;this.Zf=22;this.qD=b;this.Zm=A(this.Zm,this);this.Uo=A(this.Uo,this);a=this.tc.Ic();a.addEventListener("mapviewchange",this.TB,!1,this);this.vb=a.Ca.type;a=a.P;a.addEventListener("add",this.dg,!1,this);a.addEventListener("remove",this.eg,!1,this)}function bu(a,b,c){var d=b.D;d&&(void 0===c?0:c)&&d.removeEventListener("tap",a.Zm);b?(d.addEventListener("tap",a.Zm),a.Yj=d.min,a.Zf=d.max):(a.Yj=0,a.Zf=22)}m=au.prototype;
m.TB=function(a){var b=a.newValue.zoom;this.zc&&a.modifiers&a.ZOOM&&(b<this.Yj||b>this.Zf)&&this.zc.close()};m.dg=function(a){a=a.added;cu(a)&&bu(this,a)};m.eg=function(a){a=a.removed;cu(a)&&(this.zc&&this.zc.close(),bu(this,a,!0))};function cu(a){return window.H.service&&(a.D instanceof window.H.service.traffic.incidents.Provider||a.D instanceof window.H.service.trafficVectorTile.Provider&&"incident"===a.D.aa.vq)}
m.Zm=function(a){var b,c=this.vb===ph.HARP;a.target&&(b=a.target.getData())&&0===a.currentPointer.button&&(c?(b=this.tc.Ic().Xa(a.currentPointer.viewportX,a.currentPointer.viewportY),(c=a.target.getData()?a.target.getData().properties.id:null)&&this.qD.requestIncidentById(c,{locationReferencing:"none",lang:this.tc.ma().Mm,units:this.tc.Pb===mt.METRIC?"metric":"imperial"},this.ux.bind(this,b),console.error)):(c=a.target.W(),this.ux(c,b)),a.stopPropagation())};
m.ux=function(a,b){if(this.vb===ph.HARP){b=b.incidentDetails;var c=this.tc.ma().Mm,d=b.type,e=d.split(/(?=[A-Z])/).join("_").toUpperCase();this.tc.ma().qm("traffic."+e)&&(d=this.tc.ma().translate("traffic."+e));a={position:a,title:d,description:b.description.value,startTime:(new Date(b.startTime)).toLocaleString(c).split(",").join(" "),endTime:(new Date(b.endTime)).toLocaleString(c).split(",").join(" ")}}else c=b.TRAFFIC_ITEM_TYPE_DESC.replace(" ","_"),c=this.tc.ma().qm("traffic."+c)?this.tc.ma().translate("traffic."+
c):b.TRAFFIC_ITEM_DESCRIPTION[b.TRAFFIC_ITEM_DESCRIPTION.length-1].value,a={position:a,title:c,description:b.TRAFFIC_ITEM_DESCRIPTION[0].value,startTime:b.START_TIME,endTime:b.END_TIME};this.Uo(a)};
m.Uo=function(a){var b=a.position,c=a.title,d=a.description,e=a.startTime;a=a.endTime;this.zc||(this.zc=new Vs(b),this.zc.Sa("H_tib"),this.tc.Us(this.zc));this.zc.setPosition(b);this.zc.Fk('<div class="H_tib_content"><div class="H_rdo_title" dir="auto">{{title}}</div><div class="H_tib_desc" dir="auto"><span>{{desc}}</span><div class="H_tib_time"><span class="H_tib_left">{{traffic.from}}</span><span class="H_tib_right">{{from}}</span><br/><span class="H_tib_left">{{traffic.until}}</span><span class="H_tib_right">{{until}}</span></div></div>'.replace("{{title}}",c).replace("{{desc}}",
d).replace("{{traffic.from}}",this.tc.ma().translate("traffic.from")).replace("{{traffic.until}}",this.tc.ma().translate("traffic.until")).replace("{{from}}",e).replace("{{until}}",a));this.zc.open()};function du(a,b){var c={},d={};c["top-left"]=Ps(b,"div",[eu,fu].join(" "));c["top-center"]=Ps(b,"div",[eu,gu,hu,fu].join(" "));c["top-right"]=Ps(b,"div",[eu,fu].join(" "));c["left-top"]=Ps(b,"div",[eu,iu].join(" "));c["left-middle"]=Ps(b,"div",[eu,ju,ku,iu].join(" "));c["left-bottom"]=Ps(b,"div",[eu,iu].join(" "));c["right-top"]=Ps(b,"div",[eu,iu].join(" "));c["right-middle"]=Ps(b,"div",[eu,lu,ku,iu].join(" "));c["right-bottom"]=Ps(b,"div",[eu,iu].join(" "));c["bottom-left"]=Ps(b,"div",[eu,fu].join(" "));
c["bottom-center"]=Ps(b,"div",[eu,mu,hu,fu].join(" "));c["bottom-right"]=Ps(b,"div",[eu,fu].join(" "));d["top-left"]=Ps(b,"div",[gu,ju].join(" "));d["top-right"]=Ps(b,"div",[gu,lu].join(" "));d["bottom-left"]=Ps(b,"div",[mu,ju].join(" "));d["bottom-right"]=Ps(b,"div",[mu,lu].join(" "));Qs(d["top-left"],c["top-left"],c["left-top"]);Qs(d["top-right"],c["top-right"],c["right-top"]);Qs(d["bottom-left"],c["left-bottom"],c["bottom-left"]);Qs(d["bottom-right"],c["right-bottom"],c["bottom-right"]);Qs(a,d["top-left"],
d["top-right"],d["bottom-left"],d["bottom-right"],c["top-center"],c["left-middle"],c["right-middle"],c["bottom-center"]);this.Xs=c}var gu="H_l_top",mu="H_l_bottom",ju="H_l_left",lu="H_l_right",hu="H_l_center",ku="H_l_middle",fu="H_l_horizontal",iu="H_l_vertical",eu="H_l_anchor";du.prototype.update=function(){var a=this.Xs;nu(a["top-center"],!0);nu(a["bottom-center"],!0);nu(a["left-middle"],!1);nu(a["right-middle"],!1)};
function nu(a,b){b?(b=a.offsetWidth,a.style.marginLeft=-Math.round(.5*b)+"px"):(b=a.offsetHeight,a.style.marginTop=-Math.round(.5*b)+"px")}du.prototype.put=function(a,b){a=a?a.F():null;var c=b?this.Xs[b]:null;a&&c&&(a.parentElement&&a.parentElement.removeChild(a),c.insertBefore(a,/(bottom|right)$/.test(b)||/(center|middle)/.test(b)&&c.childNodes.length%2?c.firstChild:null));this.update()};function ou(a,b){try{return a.Am=!0,new a(b)}finally{a.Am=!1}}
function pu(a,b){var c=a.F(),d=this;J.call(this);this.v=a;this.lj=c.ownerDocument;this.Af={};this.Ee=[];this.J=Ps(this.lj,"div","H_ui");this.setDirection();this.GB=A(function(e){this.dv.put(e.target,e.target.Ae)},this);this.addEventListener("alignmentchange",this.GB);this.XB=A(function(){this.nx()},this);this.addEventListener("toggleunitsystem",this.XB);this.J.addEventListener("contextmenu",this.dw,!1);this.J.addEventListener("MSHoldVisual",this.dw,!1);this.v.addEventListener("contextmenu",this.Wm,
!1,this);this.v.addEventListener("contextmenuclose",this.Dv,!1,this);this.v.bc(this.u.bind(this));this.Ld=null;this.nt=-1;this.dv=new du(this.J,this.lj);this.Pb=mt.METRIC;qu(this,"en-US");b&&ru(this,b);c.appendChild(this.J);x.setTimeout(function(){d.dv.update()},1)}u(pu,J);t("H.ui.UI",pu);pu.prototype.dw=function(a){for(var b=a.target;b&&!/\bH_ib_content\b/.test(b.className);)b=b.parentNode;b||a.preventDefault()};pu.prototype.F=function(){return this.J};pu.prototype.getElement=pu.prototype.F;
pu.prototype.Ic=function(){return this.v};pu.prototype.getMap=pu.prototype.Ic;pu.prototype.zA=function(){return this.Pb};pu.prototype.getUnitSystem=pu.prototype.zA;pu.prototype.Xn=function(a){var b=this.Af,c;if(a!==this.Pb)for(c in this.Pb=a,b)if(b[c]instanceof vt)b[c].onUnitSystemChange(this.Pb)};pu.prototype.setUnitSystem=pu.prototype.Xn;pu.prototype.setDirection=function(a){this.J.setAttribute("dir",a||getComputedStyle(this.Ic().F()).direction)};pu.prototype.setDirection=pu.prototype.setDirection;
function qu(a,b){if(jb(b))var c=b;else if(b instanceof $t){c=b.Mm;var d=b}else throw Error("The locale parameter must be a string or a H.ui.i18n.Localization object.");if(c)if(d)a.wq=d;else if(0<=Vt.indexOf(c))a.wq=new $t(c);else throw Error("Locale ["+c+"] is not supported.");else throw Error("No locale was defined.");}pu.prototype.ma=function(){return this.wq};pu.prototype.nx=function(){this.Pb===mt.METRIC?this.Xn(mt.IMPERIAL):this.Xn(mt.METRIC)};pu.prototype.toggleUnitSystem=pu.prototype.nx;
pu.prototype.Us=function(a){var b=this.Ee.length,c=this.J;if(0>this.Ee.indexOf(a)){a.fa(this);a.Pa(this.v);var d=a.N(this.lj);b=0<b?this.Ee[b-1].F().nextSibling:this.J.firstChild;c.insertBefore(d,b);this.Ee.push(a)}};pu.prototype.addBubble=pu.prototype.Us;
pu.prototype.Wm=function(a){var b=a.items;this.Ld&&this.Dv();clearTimeout(this.nt);this.nt=x.setTimeout(function(){b.length&&(this.Ld=new Tt(b),this.J.insertBefore(this.Ld.N(this.lj),this.J.firstChild),this.Ld.fa(this),this.Ld.Pa(this.v),this.Ld.setPosition(a.viewportX,a.viewportY))}.bind(this),0)};pu.prototype.Dv=function(){this.Ld&&(this.Ld.u(),this.Ld=null)};pu.prototype.nC=function(a){var b=this.Ee.indexOf(a);-1<b&&(a.fa(null),a.Pa(null),this.Ee.splice(b,1),this.J.removeChild(a.F()))};
pu.prototype.removeBubble=pu.prototype.nC;pu.prototype.kz=function(){return this.Ee};pu.prototype.getBubbles=pu.prototype.kz;pu.prototype.Kg=function(a,b){if(this.zj(a))throw Error("A control with name ["+a+"] is already registered.");b.fa(this);b.Pa(this.v);b.kB=this.wq;b.N(this.lj);b.onUnitSystemChange(this.Pb);this.Af[a]=b};pu.prototype.addControl=pu.prototype.Kg;
pu.prototype.pC=function(a){var b=this.zj(a);if(b)b.unsubscribe(),b.fa(null),b.Pa(null),Us(b),delete this.Af[a];else throw Error("Control ["+a+"] not found in this UI's controls.");return b};pu.prototype.removeControl=pu.prototype.pC;pu.prototype.zj=function(a){return this.Af[a]};pu.prototype.getControl=pu.prototype.zj;
pu.prototype.i=function(){for(var a in this.Af)As.hasOwnProperty.call(this.Af,a)&&this.Af[a].u();this.Ee.forEach(function(b){b.u()});(a=this.J.parentNode)&&a.removeChild(this.J);J.prototype.i.call(this);delete this.J};
function ru(a,b){var c,d;b.unitSystem&&a.Xn(b.unitSystem);(d=b.locale)&&qu(a,d);(c=b.zoom)&&a.Kg("zoom",new Qt(ya(c)?c:null));(c=b.zoomrectangle)&&a.Kg("zoomrectangle",new yt(ya(c)?c:null));(c=b.mapsettings)&&a.Kg("mapsettings",new zt(ya(c)?c:null));(c=b.scalebar)&&a.Kg("scalebar",new Ut(ya(c)?c:null));(c=b.distancemeasurement)&&a.Kg("distancemeasurement",new wt(ya(c)?c:null))}
pu.prototype.capture=function(a,b,c,d){var e=this.zj("scalebar"),f=a.getContext("2d"),g=a.width,h=a.height,k=this.v.Vd,l=5+(k?k.F().childNodes[1].offsetHeight:0);e&&e.Td()?e.capture(b,function(n){f.drawImage(n,g-n.width-5*b,h-n.height-l*b);c(a)},d):c(a)};pu.prototype.capture=pu.prototype.capture;
pu.createDefault=function(a,b,c){var d=a.Ca.type;c=new pu(a,{unitSystem:mt.METRIC,zoom:{alignment:"right-bottom"},mapsettings:su(d,b,a.qa),scalebar:{alignment:"bottom-right"},locale:c||"en-US"});if(d===ph.P2D){var e=c.zj("mapsettings");var f=function(){if(e.Ic()){var l=su(d,b,a.qa);At(e,l.baseLayers,l.layers)}};a.addEventListener(a.l.nl,f);c.bc(function(){a.removeEventListener(a.l.nl,f)});e.bc(function(){a.removeEventListener(a.l.nl,f)})}if(d===ph.HARP){if(window.H.service){var g=b.vector.traffic.map.D.aa.j(),
h=new window.H.service.Url(g.ki,g.Ij.split(".").slice(-2).join("."));h=ou(window.H.service.traffic.Service7,{platformBaseUrl:h});var k=h.j().getQuery();k.apikey=g.getQuery().apikey;h.j().Jk(k);new au(c,h)}}else new au(c);return c};pu.prototype.SC=function(){};pu.prototype.setTrafficIncidentsHandle=pu.prototype.SC;function tu(a,b,c,d){for(var e=a,f=0;e&&f<b.length;f++)e=e[b[f]];if(e&&e!==a)return a={label:c,layer:e},d.push(a),a}
function su(a,b,c){var d=[],e=[],f=b.raster;if(a===ph.P2D&&f){tu(b,["raster","normal","map"],"layers.normal",d);tu(b,["raster","satellite","map"],"layers.satellite",d);tu(b,["raster","terrain","map"],"layers.terrain",d);if(c)for(var g in f)if(f[g]&&f[g].map===c){var h=g;break}tu(b,["raster","normal","trafficincidents"],"layer.incidents",e);tu(b,["raster",h,"transit"],"layer.transit",e)}else tu(b,["vector","normal","map"],"layers.normal",d),a===ph.WEBGL?(tu(b,["raster","satellite","map"],"layers.satellite",
d),tu(b,["vector","normal","traffic"],"layer.traffic",e),tu(b,["vector","normal","trafficincidents"],"layer.incidents",e)):(c=tu(b,["hybrid","day","vector"],"",[]),f=tu(b,["hybrid","day","raster"],"layers.satellite",d),f.layer=[f.layer,c.layer],window.H.service&&(c=b.vector.traffic.map.D.aa.j(),b=ou(window.H.service.trafficVectorTile.Service,{baseUrl:c,layer:"flow"}),c=ou(window.H.service.trafficVectorTile.Service,{baseUrl:c,layer:"incident"}),h=mn()+"/harp/oslo/normal.day.json",f=
new H.map.render.harp.Style(h),h=new H.map.render.harp.Style(h),b=b.createLayer(f,{engineType:a}),a=c.createLayer(h,{engineType:a}),e.push({label:"layer.traffic",layer:b},{label:"layer.incidents",layer:a})));return{alignment:"bottom-right",baseLayers:d,layers:e}};function uu(a,b){b=b||{};if(!(a&&a instanceof ej))throw Error("Base layer is mandatory for overview UI element");vt.call(this);this.Zq=new bt({label:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="H_icon"><g fill-rule="evenodd" transform="translate(2 2)"><rect width="9" height="9" x="10" y="10"/><rect class="H_icon_stroke" width="18" height="18" x="1" y="1" fill="none" stroke="#000" stroke-width="2" rx="2"/></g></svg>',onStateChange:A(this.bf,this)});this.Ra(this.Zq);
this.Xh=new vu(a,b.zoomDelta,b.scaleX,b.scaleY);this.Wc(b.alignment||"right-bottom");this.Ra(this.Xh)}u(uu,vt);t("H.ui.Overview",uu);uu.prototype.xg=function(a){this.Xh.xg(a);return this};uu.prototype.setBaseLayer=uu.prototype.xg;uu.prototype.bf=function(a){a.target.getState()===at.DOWN?(a=this.Xh,wu(a,!0),a.ds(),a.Sa(a.Ts),a.v.addEventListener("mapviewchange",a.ds,!1,a)):xu(this.Xh)};
uu.prototype.O=function(a,b){vt.prototype.renderInternal.call(this,a,b);this.Zq.F().style["float"]=this.Ae.match("right")?"right":"left";this.Xh.Pa(this.map);this.Zq.Dd(this.ma().translate("minimap"))};uu.prototype.renderInternal=uu.prototype.O;uu.prototype.i=function(){this.Xh.u();Y.prototype.i.call(this)};
function vu(a,b,c,d){this.qa=a;this.Ts="H_overview_active";"number"===typeof b&&(this.Cx=b);"number"===typeof c&&(this.Rv=c);"number"===typeof d&&(this.Sv=d);Xs.call(this,"div","H_overview")}u(vu,vt);vu.prototype.xg=function(a){this.Yh.xg(a)};vu.prototype.O=function(a,b){b=Ps(b,"div","H_overview_map");Qs(a,b);this.zq=b};vu.prototype.renderInternal=vu.prototype.O;vu.prototype.renderInternal=vu.prototype.O;m=vu.prototype;m.Cx=3;m.Rv=5;m.Sv=5;
m.Pa=function(a){this.v=a;this.Yh=new U(this.zq,this.qa,{pixelRatio:this.v.mb(),engineType:this.v.Ca.type});this.Yh.Vd.F().style.display="none";this.Qv=this.Yh.xa;this.kv=this.v.xa};function xu(a){!a.fh&&wu(a);a.Mb(a.Ts);a.v.removeEventListener("mapviewchange",a.ds,!1,a)}m.ds=function(a){a&&a.modifiers&a.SIZE&&wu(this,!0);a=this.kv.Ib();a.zoom-=this.Cx;this.Qv.Xc(a)};
function wu(a,b){var c=a.v.pa.element,d=a.F().style,e=c.offsetWidth/a.Rv/10;c=c.offsetHeight/a.Sv/10;var f=a.zq.style;b?(d.width=e+"em",d.height=c+"em",f.width=e+"em",f.height=c+"em"):d.width=d.height="0em";a.Yh.pa.resize()}m.i=function(){vu.g.i.call(this);xu(this);this.Yh.u();this.Yh=this.Qv=this.kv=this.v=this.qa=this.zq=null};t("H.ui.buildInfo",function(){return cn("H-ui","1.54.1","17144d2",{region:"row"})});

var yu={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:0},incline:{min:0,max:0},heading:{min:180,max:180}},interaction:{ZOOM:xk.ZOOM,COORD:xk.COORD},capture:!0};t("H.map.render.p2d.capabilities",yu);function zu(a,b){if(!a)throw new D(zu,0,a);zu.g.constructor.call(this,a);this.Yv={};this.oj=!(!b||!b.Nd);this.Jj=Au++}u(zu,zl);var Au=0;
zu.prototype.N=function(a,b,c,d,e,f){var g=Eb(d),h=this.yb,k=g+(c.exp-h.pixelProjection.exp),l=h.min,n=h.max;d=h.tileSize;var p=h.D.Oc,q=this.Ob,r=q.Qe();var v=q.lc().w;var w=c.w,y=c.x,I=c.y,G={};if(g<l||g>n)return Ni.DONE;e=h.requestTiles(a,k,e,f,this.Jj);a=e.total;e=e.tiles;f=e.length;this.he=c;this.JC=b;this.ss=k;r!==p&&q.Cd(p);c=d=d*w/(Kb(2,k)*d);this.oj||(d%1&&(d=Fb(d),w=c/d,y/=w,I/=w,w=Kb(2,k)*d),y=Fb(y),I=Fb(I));this.uC=c;k=-d;g=v+d;for(h=0;h<f;h++){v=e[h];if((l=v.data)&&l.tagName){c=b.x-(y-
v.x*d);p=b.y-(I-v.y*d);q.Me(l,c,p,d,d);for(r=c;(r-=w)>k;)q.Me(l,r,p,d,d);for(r=c;(r+=w)<g;)q.Me(l,r,p,d,d)}G[this.ss+"_"+v.x+"_"+v.y]=v}this.Yv=G;return f===a?Ni.DONE:Ni.PENDING};zu.prototype.La=function(a,b,c){var d=this.uC,e=d/this.yb.tileSize,f=this.he,g=this.JC,h;if(db(this.ss)&&f){a=f.x+(a-g.x);b=f.y+(b-g.y);var k=Fb(f.w/d);var l=f=Fb(a/d);g=Fb(b/d);Hb(l)>=k&&(l%=k);0>l&&(l=k+l);(k=this.Yv[this.ss+"_"+l+"_"+g])&&k.La&&(h=k.La((a-d*f)/e,(b-d*g)/e,c))}return h||Ye};zu.prototype.Ah=function(){return"2d"};function Bu(a,b){b=b||{};C(a,Pj,Bu,0);Bu.g.constructor.call(this,a);this.Nd=!!b.Nd;this.gC=b.Ab||0;this.pn=[];this.Pv={}}u(Bu,zl);
Bu.prototype.N=function(a,b,c,d,e,f){var g,h=this.yb,k;d-=this.gC;this.pn.length=0;var l=this.Pv;this.Pv=g={};if(d>=h.min&&d<=h.max){var n=h.rg(a,d,e,f);var p=n.overlays;if(a=p.length)for(p.sort(Yh),d=this.Ob,e=this.Nd,f=0;f<a;f++){h=p[f];var q=h.C();var r=c.Gb(q.Kc());var v=c.Gb(q.Gc());q=c.w;r.x>=v.x&&(r.x-=q);q*=-((r.x+v.x)/q>>1);r.x+=q;r.add(b);v.x+=q;v.add(b);e||(r.round(),v.round());(q=l[k=h.xb()])?delete l[k]:q={cC:h};g[k]=q;var w=r.x;r=r.y;var y=v.x;v=v.y;var I=y-w;var G=v-r;d.Cd(h.Qe());
d.Me(h.Oe(),w,r,I,G);q.details?q.details.set(w,r,y,v):q.details=new fg(w,r,y,v);this.pn.push(q)}}return!n||n.requested&&n.requested===n.total||!n.requested&&p.length===n.total?Ni.DONE:Ni.PENDING};Bu.prototype.La=function(a,b,c){for(var d=this.pn,e=d.length,f,g,h;e--;)if(f=d[e],g=f.details,g.Il(a,b))if(f=f.cC,h)h.push(f);else if(h=[f],c)break;return h||Ye};Bu.prototype.Ah=function(){return"2d"};Bu.prototype.i=function(){delete this.pn;Bu.g.i.call(this)};Bu.prototype.disposeInternal=Bu.prototype.i;function Cu(a,b){this.Pm=[];Cu.g.constructor.apply(this,arguments)}u(Cu,Al);m=Cu.prototype;m.Tt=function(){return this.yb.le.apply(this.yb,arguments)};m.N=function(a,b,c,d,e,f,g){this.Pm=[];return Cu.g.N.apply(this,arguments)};m.oa=1;m.ww=function(a,b,c,d,e,f){var g=this.oa=d.mb();e*=g;f*=g;var h=c.lc();b=h.w*g;h=h.h*g;var k=c.Cb;this.Nd?(e-=k.x*g,f-=k.y*g):(e=Eb(e-k.x*g),f=Eb(f-k.y*g));d.Me(c.Oe(),e,f,b,h);a.detail?a.detail.set(e,f,e+b,f+h):a.detail=new fg(e,f,e+b,f+h);this.Pm.push(a)};
m.La=function(a,b,c){for(var d=this.Pm,e=d.length,f,g,h,k=Ye,l=this.oa;e--&&!(f=d[e],g=f.detail,g.Il(a,b)&&(f=f.nv,(!(h=f.kc().tm)||h.um((a-g.left)/l,(b-g.top)/l,0))&&0>k.indexOf(f)&&(k===Ye&&(k=[]),k.push(f),c))););return k};m.Ah=function(){return"2d"};m.i=function(){this.Pm=[];Cu.g.i.call(this)};Cu.prototype.disposeInternal=Cu.prototype.i;function Z(a,b,c,d){Z.g.constructor.call(this,a,b,c,d);this.Xb=new L(0,0);if(c=d.renderBaseBackground)this.vw=c.lower,this.uw=c.higher;this.oj=!!d.enableSubpixelRendering;this.Fg=Du;this.bv=0;this.ts=this.Vu=!1;this.na=new gm;this.U=d=new om;this.ag=A(this.ag,this);d.addEventListener(d.l.ro,this.ag);this.Ka=A(this.Ka,this);d=a.element;this.pc=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);this.Tk=
new Am(this.pc,this.ka);this.Be=[];this.aq();this.qg=A(Z.prototype.qg,this);this.o=Eu;this.Mn();this.zoom=Fu(this,this.ze.Tb()+this.Ab);this.wc();Gu(this,b.Ib().position,this.zoom);this.sb();this.gg()}u(Z,uk);t("H.map.render.p2d.RenderEngine",Z);Z.prototype.type=Dk.P2D;var Eu=2;Z.prototype.getState=function(){return this.o};Z.prototype.getState=Z.prototype.getState;Z.prototype.xj=function(a,b){a=b-a;return Hb(a)<this.pixelProjection.w/2?a:a-this.pixelProjection.w*b/Hb(b)};
Z.prototype.Wq=function(a){var b=this,c=a.animate,d=a.newValue,e=a.modifiers;a=d.position;var f=d.bounds,g,h=this.zoom,k=this.vd,l=0;e&Zj.POSITION&&(g=b.pixelProjection.Gb(a));if(e&Zj.BOUNDS)d=Hu(this,f.C(),e&Zj.ZOOM?d.zoom:B,e&Zj.POSITION?a:B),this.ze.Xc(d,c);else{e&Zj.POSITION||(g=b.pixelProjection.Gb(d.position));var n=g.x;var p=g.y;this.Eg();this.Xb.set(0,0);d=this.yo(d);var q=d.zoom;var r=d.position;if(c){var v=q-h;var w={x:k.x,y:k.y};c=this.pixelProjection.Zh(w).x;var y=this.pixelProjection.projection.Ne(a);
if(y.x!==this.vd.x||y.y!==this.vd.y||q!==this.zoom)n=this.xj(c,n),this.Zc(function(I){var G=I-l;if(q!==h){g=b.pixelProjection.Zh(y);var S=b.pixelProjection.Zh(w);n=b.xj(S.x,g.x);p=g.y-S.y}l=I;b.Ng(n*G,p*G);h+=v*G;b.tb(h);b.sb();b.ca()},this.ll,function(){Gu(b,r,q);b.tb(q);b.sb(r);b.ca()},this.ml)}else this.$c(),Gu(this,r,q),this.tb(q),this.sb(r);this.ca()}};Z.prototype.ll=300;Z.prototype.Sn=function(a){var b=ob(a);if(!b||b&&0>a)throw new D(this.Sn,1,"positive number required");this.ll=a};
Z.prototype.setAnimationDuration=Z.prototype.Sn;Z.prototype.up=function(){return this.ll};Z.prototype.getAnimationDuration=Z.prototype.up;Z.prototype.ml=Xl;Z.prototype.Tn=function(a){if(!ab(a))throw new D(this.Tn,1,"function required");this.ml=a};Z.prototype.setAnimationEase=Z.prototype.Tn;Z.prototype.vp=function(){return this.ml};Z.prototype.getAnimationEase=Z.prototype.vp;Z.prototype.Mn=function(){this.ml=Xl;this.ll=300};Z.prototype.resetAnimationDefaults=Z.prototype.Mn;m=Z.prototype;
m.Pq=function(a,b,c){var d;this.Rj=Gj();(d=this.Wh.la.splice(a,1)[0])&&d.u&&d.u();(d=this.Ff.la.splice(a,1)[0])&&d.u&&d.u();(d=this.mi.la.splice(a,1)[0])&&d.u&&d.u();(d=this.li.la.splice(a,1)[0])&&d.u&&d.u();this.Xe=this.jb.Ta();0===a&&(yk(this,b,!1),this.wc());this.Be=Bm(this.Tk,this.Mf(),this.Jf());this.hi();c||this.ca()};
m.aq=function(){var a=this.jb.Ta(),b=0,c=a.length;[this.Wh={},this.Ff={},this.mi={},this.li={}].forEach(function(d){d.Le=[];d.la=[]});for(this.Xe=this.jb.Ta();b<c;b++)this.dk(b,a[b]);this.wc()};m.Qq=function(){this.wc();this.ca()};
m.bq=function(a,b,c){var d,e,f,g;if(b){var h={Nd:this.oj,Ab:this.Ab};b.N?C(b,Oi)?e=new tm(b):C(b,Qi)&&(g=new tm(b)):(b.requestOverlays&&(d=new Bu(b,h)),b.requestTiles&&(e=new zu(b,h)),b.requestMarkers&&(f=new Cu(b,h)),b.requestDomMarkers&&(g=new Dl(b,h)))}c=c||0;this.Wh.la.splice(a,c,d);this.Ff.la.splice(a,c,e);this.mi.la.splice(a,c,f);this.li.la.splice(a,c,g);this.Xe=this.jb.Ta();this.Be=Bm(this.Tk,this.Mf(),this.Jf())};
m.Jf=function(){var a=[];a=a.concat(this.Ff.la);a=a.concat(this.Wh.la);a=a.concat(this.mi.la);a=a.concat(this.li.la);return a=a.filter(db)};m.Ko=function(){return this.o===Eu};m.yo=function(a){var b=zk(this,zk(this,a.zoom)+this.Ab);a=Ak(this,a);a.zoom=b;return a};function Gu(a,b,c){var d=a.pixelProjection;d.Wa(c);a.vd=d.projection.Ne(b);d.x=d.w*a.vd.x;d.y=d.h*a.vd.y}m.Xa=function(a,b){var c=this.za.center,d=this.ka;return this.pixelProjection.$a((a-c.x)*d,(b-c.y)*d)};Z.prototype.screenToGeo=Z.prototype.Xa;
Z.prototype.Qn=function(a,b){a=this.Xa(a,b);b=this.ze.Ib();b.position=a;return b};Z.prototype.Ka=function(a){var b=this.ka,c=this.za.center,d=c.x*b;c=c.y*b;a=this.pixelProjection.Gb(a);var e=this.pixelProjection.w;return new L(Eb((a.x-Eb(a.x/e)*e+d)/b),Eb((a.y+c)/b))};Z.prototype.geoToScreen=Z.prototype.Ka;Z.prototype.C=function(a,b){var c=this.hl[a||4];a=this.pixelProjection;var d=c.left-b,e=a.$a(d,c.top-b),f=c.right+b;b=a.$a(f,c.bottom+b);f-d>=a.w&&(e.lng=-(b.lng=180));return Ic(e,b)};
Z.prototype.La=function(a,b,c,d){var e=[],f=this.ka,g;a*=f;b*=f;f=[this.Wh,this.Ff,this.mi,this.li];for(g=f.length;g--&&(!c||!e.length);)e=this.Ip(e,f[g].la,a,b,c);d(e)};Z.prototype.getObjectsAt=Z.prototype.La;m=Z.prototype;m.Ip=function(a,b,c,d,e){for(var f=b.length,g;f--&&!((g=b[f])&&g.La&&(a=a.concat(g.La(c,d,e)),a.length&&e)););return a};m.te=z;m.Mf=function(){var a=this.hl[2];return{w:a.right-a.left,h:a.bottom-a.top}};
m.gg=function(){var a=this.Be.length,b;Z.g.gg.call(this);var c=this.Mf();this.Xb.set(0,0);var d=c.w;for(b=c.h;a--;){c=this.Be[a];var e=c.lc();e.w===d&&e.h===b||c.Kk(d,b)}this.te=new Jh(d,b);this.ca()};m.getCapabilities=function(){return yu};Z.prototype.getCapabilities=Z.prototype.getCapabilities;m=Z.prototype;m.Bk=function(){this.ta&&this.ta.S||Gj()-this.Rj<this.Fg&&!this.je?this.mh=Ej(this.qg):(this.je&&(this.hi(),this.kj()),this.o=Eu)};
m.hi=function(){this.Wh.Le.length=0;this.Ff.Le.length=0;this.mi.Le.length=0;this.li.Le.length=0};
m.qg=function(){var a;this.af&&this.af.before();var b=this.Ff.la;var c=this.za.center.clone().scale(this.ka).round();var d=this.C(1,0);var e=this.C(1,Iu);var f=this.zoom;var g=f-this.Ab;var h=this.pixelProjection;var k=this.vw;var l=this.uw;var n=b[0];b=this.Xb;var p=this.Be.length;var q=this.Xe;for(a=q.length;p--;){var r=this.Be[p];C(r,sm)&&r.clear()}if(n){if(k)for(;k;)p=f-k,n.N(d,c,h,p,!0,b),--k;if(l&&this.ts)for(r=1;r<=l&&(p=f+r,h.Wa(p),k=this.C(2,0),h.Wa(f),!n.N(k,c,h,p,!0,b));r++);}for(this.Fg=
Du;a--;)h=q[a],C(h,yh)&&h.D&&h.D.lk(e,g);d=this.Hn(d,c,f,!1,b,Ju,this.Ff,this.Wh);c=this.Hn(e,c,g,!1,b,Ku,this.mi,this.li);this.je=d&&c;this.ta&&this.ta.S&&this.Ao();this.pf||(this.pf=this.ze.Ib());this.pf.bounds=this.C(4,0);this.ze.sb(this.pf);this.pf=null;this.te&&(this.za.sb(this.te),this.te=z);f<this.bv?this.ts=!0:this.Vu&&(this.ts=!1);this.bv=f;this.Vu=d;this.af&&this.af.after();this.Bk()};
m.Hn=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments,6),k=h.length,l=h[0].la.length,n=k*l,p=!!n,q;for(q=0;q<n;q++){if(f===Ju){var r=q%k;var v=Math.floor(q/k)}else r=Math.floor(q/l),v=q%l;var w=h[r].la[v];r=h[r].Le;w&&(w=w.N(a,b,this.pixelProjection,c,d,e,this.Ka),w===Ni.ACTIVE&&(this.Fg=Infinity),w!==Ni.DONE||r[v]||(this.kj(this.Xe[v]),r[v]=!0),r[v]||(p=!1))}return p};m.kj=function(a){this.dispatchEvent({type:this.l.Qs,target:a||this})};
m.i=function(){var a=this.jb.Ta()[0],b=this.za;Fj(this.mh);this.$c(!0);a&&yk(this,a,!1);this.Jf().forEach(function(c){c.u()});b.element&&b.element.removeChild(this.pc);this.pc=null;this.o=3;Z.g.i.call(this)};m.ca=function(){this.Rj=Gj();this.Ko()&&(this.je=!1,this.o=1,this.Bk())};m.xc=function(a,b){this.Ng(a*this.ka,b*this.ka);this.Xb.set(0,0);this.sb();this.ca()};m.Ng=function(a,b){var c=this.pixelProjection,d=this.vd;c.x=cc(c.x+a,c.w);c.y=Db(0,Cb(c.w,c.y+b));d.x=c.x/c.w;d.y=c.y/c.h};
m.Ig=function(a,b,c){a=zk(this,zk(this,a)+this.Ab);this.tb(a,b,c)};Z.prototype.zoomAt=Z.prototype.Ig;Z.prototype.tb=function(a,b,c){var d=this.ka,e=this.za.center;b===+b&&c===+c?(b=(b-e.x)*d,c=(c-e.y)*d,this.Xb.set(b,c),this.Ng(b,c),this.pixelProjection.Wa(a),this.Ng(-b,-c)):(this.Xb.set(0,0),this.pixelProjection.Wa(a));this.zoom=a;this.sb();this.ca()};
function Hu(a,b,c,d){var e=a.getCapabilities().lookAt.zoom.max,f=b.wb(),g=d||f;if(b.Bm()||c&&d)c=c===B?e:c;else{var h=new vh(a.pixelProjection.projection);h.Wa(e);var k=h.Gb(b.Kc()).round();var l=h.Gb(b.Gc()).round();e=h.w;b.oc()&&(k.x-=e);d?(f=h.Gb(g),b=2*Db(f.x-k.x,l.x-f.x),k=2*Db(f.y-k.y,l.y-f.y)):(b=l.x-k.x,k=l.y-k.y,g=f);c===B&&(f=a.hl[4],c=f.right-f.left,f=f.bottom-f.top,c=-8+Cb(Ib(c/b*e)/Sb,Ib(f/k*e)/Sb)-a.Ab,c=zk(a,c))}return{zoom:Fb(c),position:g}}
Z.prototype.Eg=function(){this.$c(!0);this.U.S&&this.hc(!0);this.na.S&&this.ic(!0);this.$c(!0)};Z.prototype.Gd=function(a,b){this.Eg();this.Hk(b);this.na.start(a,!!b)};Z.prototype.startInteraction=Z.prototype.Gd;Z.prototype.Hk=function(a){if(a){var b={};b.kk=a.power;b.nj=a.ease;b.duration=a.duration;this.ua=b}};function Fu(a,b){return zk(a,zk(a,b-a.Ab)+a.Ab)}
Z.prototype.td=function(a,b,c,d,e){var f=!1;this.na.S&&(b=this.na.store(a,b,c,d,e),this.na.Yd(xk.COORD)&&(a=this.na.vh(),0<fm(a)&&(this.xc(-a.x,-a.y),f=!0)),b&&this.na.Yd(xk.ZOOM)&&(a=this.na.am(),b=this.na.bm(),b=Ib(Kb(2,this.zoom)*b)/Sb,b!==this.zoom&&(b=Fu(this,b),this.tb(b,a.x,a.y),f=!0)),f&&this.ca())};Z.prototype.interaction=Z.prototype.td;
Z.prototype.ic=function(a){var b=this;if(this.na.S&&!a){if(this.ua){a=this.na.mc();var c=this.na.Gf();var d=this.ua.duration;var e=(this.ua.kk||1)*a;var f=new Vl(-e/(0<d?d:1),e);!E(c.x)&&!E(c.y)&&0<e&&b.na.Yd(xk.COORD)&&this.Zc(function(g){e=f.Aj(g*d);E(e)||b.xc(Eb(-c.x*e),Eb(-c.y*e))},d,void 0,this.ua.nj)}this.ua=null;this.na.clear()}};Z.prototype.endInteraction=Z.prototype.ic;Z.prototype.Fd=function(a,b,c){this.Eg();this.U.start(b,c);this.Hk(a)};Z.prototype.startControl=Z.prototype.Fd;
Z.prototype.control=function(a,b,c){if(E(+c))throw new D(this.control,2,c);if(E(a))throw new D(this.control,0,a);if(E(b))throw new D(this.control,1,b);this.U.S&&this.U.set(a,b,c,0,0,0)};Z.prototype.control=Z.prototype.control;
Z.prototype.hc=function(a,b){var c=this,d;if(this.U.S){this.$c(!0);var e=Gj();var f=e-this.ej;if(1<=f){var g=rm(this.U);this.Mi(g,f)}if(!this.ua||a||b)"function"===typeof b&&(a=this.Ib(),a.zoom=this.zoom-this.Ab,b(a),a.zoom+=this.Ab,this.Bo(a));else{b=this.U.mc();var h=this.U.Gf();var k=this.ua.duration;var l=(this.ua.kk||1)*b;var n=new Vl(-l/(0<k?k:1),l);!E(h.Jb)&&!E(h.Kb)&&0<l&&this.Zc(function(p,q,r,v){e&&(r=v-e,e=0);l=n.Aj(p*k)*r;E(l)||((d=h.Lb*l)&&c.tb(Fu(c,c.zoom+d),c.U.Pg,c.U.Qg),c.xc(Eb(h.Jb*
l),Eb(h.Kb*l)))},k,void 0,this.ua.nj)}this.U.reset()}};Z.prototype.endControl=Z.prototype.hc;m=Z.prototype;
m.Bo=function(a){var b=this,c=this.vd,d=this.pixelProjection.projection.Ne(a.position),e=this.pixelProjection.Zh(d),f=e.y;e=e.x;var g=a.zoom;c=this.pixelProjection.Zh(c);a=c.y;var h=c.x;c=this.zoom;var k=this.U.mc(),l=this.U.Pg,n=this.U.Qg,p=0;e=this.xj(h,e);e-=h;f-=a;c=g-c;a=Jb(e*e+f*f+c*c);if(0!==k&&0!==a){var q=e/a;var r=f/a;var v=c/a;var w=k*k/(2*a);this.Zc(function(y,I){var G;if(1!==y){y=k*I-w*I*I/2;I=y-p;if(G=v*I)G=Fu(b,b.zoom+G),b.tb(Fu(b,G),l,n);b.xc(Eb(q*I),Eb(r*I));p=y}else b.vd=d,b.tb(Fu(b,
g),l,n),b.sb(),b.ca()},2*a/k)}};m.ag=function(a){var b=this,c=a.it;this.Xb.set(0,0);c.Jb||c.Kb||c.Lb?(this.ej=Gj(),this.Zc(function(d,e,f,g){b.ej=g;b.Mi(c,f)},Number.POSITIVE_INFINITY),this.ca()):this.$c(!0)};m.Mi=function(a,b){b=b||0;a.Lb&&this.tb(Fu(this,this.zoom+a.Lb*b),this.U.atX,this.U.atY);this.xc(a.Jb*b,a.Kb*b)};m.Zc=function(a,b,c,d){this.ta&&this.ta.S&&this.ta.stop(!0);this.ta=new Cm(this,a,b,c,d);this.ta.start()};m.$c=function(a){this.ta&&this.ta.S&&this.ta.stop(a)};m.fp=function(){};
Z.prototype.enter=Z.prototype.fp;Z.prototype.kp=function(a){wk(this.pc,a)};Z.prototype.exit=Z.prototype.kp;Z.prototype.capture=function(a,b,c,d){var e=this.pc.ownerDocument.createElement("canvas"),f=e.getContext("2d"),g=this.ka;e.width=(c-a)*g;e.height=(d-b)*g;for(c=0;c<this.Be.length;c++)d=this.Be[c],C(d,sm)&&f.drawImage(d.F(),-a*g,-b*g);return Dd(e)};var Ku=0,Ju=1,Du=1E3,Iu=256;

function Lu(a){var b;if(a)for(Mu={},b=a.length;b--;)Mu[a[b]]=!0;this.ax={}}var Nu,Mu={};Lu.prototype.parse=function(a,b,c){var d,e,f,g,h;Nu=!1;try{c=JSON.parse(c)}catch(n){Nu=!0}if(c&&(d=c.metadata)){var k={spatials:[]};for(e in d){if(c=!Mu[e]&&(f=Ou[e]))(g=d[e])||(Nu=!0,g=void 0),c=g;if(c)for(c=g.length;c--;){var l;(l=g[c])||(Nu=!0,l=void 0);(h=l)&&f(b,a,this,e,h,k)}}}else Nu=!0;return Nu?void 0:k};Lu.prototype.parse=Lu.prototype.parse;
var Ou={"street labels":function(a,b,c,d,e,f){var g;(g=e.vertices)||(Nu=!0,g=void 0);if(g){var h,k=g.length,l;(l=0<k)||(Nu=!0,l=void 0);if(l)for(h=Array(k/2);k;){var n=g[--k];l=g[--k];h[k/2]=new L(l,n)}h=h?{Pc:[h]}:B;k=+e["font size"]/a.mb();g=c.ax[k];g||(Pu.lineWidth=k,g=c.ax[k]=c.bh.bu(Pu));Qu(a,b,h,!1,g,e,d,f)}delete e.vertices},"city center labels":function(a,b,c,d,e,f){Qu(a,b,Ru(e,new ni([])),!0,c.bh,e,d,f)},labels:function(a,b,c,d,e,f){var g;(g=e["bounding boxes"])||(Nu=!0,g=void 0);if(g){for(var h=
g.length,k=new ni([]),l;h--;){var n;(n=g[h])||(Nu=!0,n=void 0);(l=n)&&Ru(l,k)}Qu(a,b,k,!0,c.bh,e,d,f)}delete e["bounding boxes"]},buildings:function(a,b,c,d,e,f){var g=e.id,h=b.Fn[g],k,l,n,p=[],q=[];(k=e)||(Nu=!0,k=void 0);if(k&&((l=k.vertices)||(Nu=!0,l=void 0),l)){var r;(r=k.polygons)||(Nu=!0,r=void 0);(n=r)&&p.push.apply(p,Su(l,n));(k=k.outlines)||(Nu=!0,k=void 0);(n=k)&&q.push.apply(q,Su(l,n))}n=p.length;p.push.apply(p,q);q=new ni(p,$b,n);(p=p.length)||(Nu=!0,p=void 0);p&&(h?(dq(h,a,[q]),f.spatials.push(h)):
(h=Qu(a,b,q,!0,c.bh,e,d,f,g),b.$(h)))}};Ou["transit stops"]=Ou.POIs=Ou.labels;var Tu=["box 2","box 1","annotation box","icon box"];function Ru(a,b){for(var c=Tu.length,d,e;c--;)if(d=Tu[c],e=a[d]){var f=e[0],g=e[1],h=e[2];e=e[3];b.Pc.push([new L(f,g),new L(f+h,g),new L(f+h,g+e),new L(f,g+e)]);delete a[d]}return b}
function Su(a,b){var c=b.length,d,e,f;if(0<c)for(e=Array(c);c--;)if((d=b[c])||(Nu=!0,d=void 0),d){var g=d.length;if(0<g)for(e[c]=f=Array(g);g--;){var h=2*d[g];f[g]=new L(a[h],a[h+1])}}return e||[]}var Uu={};function Qu(a,b,c,d,e,f,g,h,k){Uu.style=e;d=new $p(b,d,k,Uu);c&&dq(d,a,[c]);Vu(f);f.category=g;d.setData(f);h.spatials.push(d);d.fa(b);return d}Lu.prototype.bh=new di({strokeColor:"transparent",fillColor:"transparent",lineWidth:0});var Pu={};
function Vu(a){var b,c=!1;switch(typeof a){case "object":if(a instanceof Array)for(b=a.length;b--;)Vu(a[b])?c=!0:delete a[b];else if(a)for(b in a)Vu(a[b])?c=!0:delete a[b];break;case "number":c=!0;break;default:c=!!a}return c};function Wu(a,b,c){c=c||{};b=b||{};var d=c.tileType||"maptile",e=c.scheme||"normal.day";R.call(this,{min:0,max:20});!0===b.pois&&(b.pois="!F");this.Ga=b;if(!(a&&a instanceof Xu))throw Error("InvalidArgument: service required");this.aa=a;this.xe=A(this.xe,this);this.aa.addEventListener("versionupdate",this.xe);this.hd=a.j().clone().A(d+"/"+a.gb+"/"+e).B(Yu).B(b);this.Yc=a.Yc||null;this.oa=c.pixelRatio||c.pixelratio||Ie();this.tileSize=c.tileSize||256;this.tileType=d;this.scheme=e;this.rs=0;this.yd=
new Mp(new Lu(c.categoryFilter));this.yd.fa(this);this.de=A(this.de,this);this.yd.addEventListener("update",this.de);this.Te=!1;R.call(this,{min:0,max:20});this.Un(new ij(c.tileCacheSize||256,A(this.fe,this)))}u(Wu,R);t("H.service.metaInfo.TileProvider",Wu);Wu.prototype.fe=function(a,b){a=b.cb();for(var c=a.length,d;c--;)d=a[c],delete d.uk[b.key],d.release();b.data&&(ro.push(b.Dn(),this.tileSize),b.En())};Wu.prototype.de=function(){this.dispatchEvent("update")};
Wu.prototype.s=function(a,b,c,d,e){var f=this.hd.clone(),g=this.Yc,h=this.tileSize,k=this.getTileKey(a,b,c);k=this.Rb().get(k);var l;if(k&&!k.Eh()){d(ro.pop(this.tileSize),null);var n={cancel:function(){}}}else{g&&f.Ha(g[(c+b+a)%g.length]);f.A(c+"/"+a+"/"+b+"/"+h+"/png8");var p=po.setTimeout(function(){l=new Tg("text/plain",f.toString());l.then(function(q){d(null,q)},e)},500)}this.Te||(lo(Wu,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Te=!0);return n||{cancel:function(){l?l.cancel():
po.clearTimeout(p)}}};Wu.prototype.requestInternal=Wu.prototype.s;Wu.prototype.ld=function(a,b,c,d,e){var f=this.yd;var g=d||ro.pop(this.tileSize);if(d)a=this.Rb().get(this.getTileKey(a,b,c)),a.N(d);else if(d=a=new rj(this.Sd(a,b,c),a,b,c,this.tileSize,this.oa,c+this.rs,f),delete d.Fi,d.kl=e,a.N(g))for(e=a.cb(),g=e.length;g--;)e[g].On();else ro.push(g,this.tileSize);return a};Wu.prototype.createTileInternal=Wu.prototype.ld;
Wu.prototype.u=function(){this.yd.u();this.aa.removeEventListener("versionupdate",this.xe);R.prototype.u.call(this)};Wu.prototype.dispose=Wu.prototype.u;Wu.prototype.xe=function(){var a=this.aa;this.hd=a.j().clone().A(this.tileType+"/"+a.gb+"/"+this.scheme).B(Yu).B(this.Ga);this.reload(!1)};var Yu={metadata:"metaonly",mgen:"2"};function Xu(a){Xu.g.constructor.call(this,Xu,a);a=Do(this,a);this.Yc=a.shards;(this.Qa=a.ignoreTypes?null:a.type)&&this.j().Ha(this.Qa);this.gb=a.version;this.jr={};this.ec=new no;"newest"===this.gb&&this.mp()}u(Xu,Co);t("H.service.metaInfo.Service",Xu);Xu.prototype.Da=function(){return{type:"base",version:"newest",subDomain:"maps.ls",path:"maptile/2.1",shards:["1","2","3","4"]}};Xu.CONFIG_KEY="metaInfo";function Zu(a,b){for(var c={},d=a[b+"s"][b],e=d.length;e--;)c[d[e].id]=d[e];a[b+"s"]=c}
Xu.prototype.qu=function(){return this.Qa};Xu.prototype.Rp=function(){return this.gb};Xu.prototype.getVersion=Xu.prototype.Rp;Xu.prototype.Xr=function(a){this.gb=a};Xu.prototype.V=function(){return this.ec};Xu.prototype.getCopyrights=Xu.prototype.V;
Xu.prototype.os=function(a){a=a.response;var b;Zu(a,"map");Zu(a,"scheme");Zu(a,"tiletype");Zu(a,"format");Zu(a,"resolution");Zu(a,"language");if("newest"===this.gb&&"traffic"!==this.Qa)for(b in a.maps)a.maps[b].hash&&a.maps[b].newest&&(this.Xr(a.maps[b].hash),this.dispatchEvent("versionupdate"));this.$p=a;this.dispatchEvent("infoupdate")};
Xu.prototype.mp=function(){var a=this;var b=this.j().clone().A("info").B({output:"json"});this.Yc&&b.Ha(this.Yc[0]);this.s(b,function(c){a.os(c)},function(c){throw c;})};Xu.prototype.Dj=function(){return this.$p};Xu.prototype.getInfo=Xu.prototype.Dj;Xu.prototype.ij=function(a,b,c,d,e,f){return new Wu(this,d,{tileSize:a,pixelRatio:b,categoryFilter:c,tileType:e,scheme:f})};Xu.prototype.createTileProvider=Xu.prototype.ij;Xu.prototype.Md=function(a,b,c,d,e,f){return new ej(this.ij(a,b,c,d,e,f))};
Xu.prototype.createTileLayer=Xu.prototype.Md;W.prototype.hu=function(a){return this.Ua(Xu,a)};W.prototype.getMetaInfoService=W.prototype.hu;(function(){var a=W.prototype.createDefaultLayers;W.prototype.createDefaultLayers=function(b,c,d,e,f,g){var h=a.call(this,b,c,d,e,f,g),k={},l=this.hu();"object"===typeof b&&(g=b,b=g.tileSize,c=g.ppi,d=g.lg,e=g.lg2,f=g.style,g=g.pois);b=b||256;var n=320===c?2:1;if(0>[72,250,320,500].indexOf(+c)){if(c!==B)throw new D(this.Pl,1,c);}else k.ppi=+c;d&&(k.lg=d);e&&(k.lg2=e);f&&(k.style=f);g&&(k.pois=g);h.raster.normal.metaInfo=l.Md(b,n,["buildings"],k);return h}})();

H.__bootstrap__="/*\n\n Copyright The Closure Library Authors.\n SPDX-License-Identifier: Apache-2.0\n*/\nvar l;function ba(a){a=[\"object\"==typeof globalThis&&globalThis,a,\"object\"==typeof window&&window,\"object\"==typeof self&&self,\"object\"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error(\"Cannot find global object\");}var ca=ba(this);function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}\nvar ea=\"function\"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function fa(a,b){if(b)a:{var c=ca;a=a.split(\".\");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ea(c,a,{configurable:!0,writable:!0,value:b})}}\nfa(\"Symbol\",function(a){function b(f){if(this instanceof b)throw new TypeError(\"Symbol is not a constructor\");return new c(d+(f||\"\")+\"_\"+e++,f)}function c(f,g){this.fc=f;ea(this,\"description\",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.fc};var d=\"jscomp_symbol_\"+(1E9*Math.random()>>>0)+\"_\",e=0;return b});\nfa(\"Symbol.iterator\",function(a){if(a)return a;a=Symbol(\"Symbol.iterator\");for(var b=\"Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array\".split(\" \"),c=0;c<b.length;c++){var d=ca[b[c]];\"function\"===typeof d&&\"function\"!=typeof d.prototype[a]&&ea(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ha(da(this))}})}return a});function ha(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}\nfunction ka(a,b){a instanceof String&&(a+=\"\");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}fa(\"Array.prototype.keys\",function(a){return a?a:function(){return ka(this,function(b){return b})}});var la;\nif(\"function\"==typeof Object.setPrototypeOf)la=Object.setPrototypeOf;else{var ma;a:{var na={a:!0},oa={};try{oa.__proto__=na;ma=oa.a;break a}catch(a){}ma=!1}la=ma?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+\" is not extensible\");return a}:null}var pa=la;fa(\"Object.setPrototypeOf\",function(a){return a||pa});var p=this||self;\nfunction qa(a,b,c,d){a=a.split(\".\");d=d||p;a[0]in d||\"undefined\"==typeof d.execScript||d.execScript(\"var \"+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ra(b)&&ra(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function sa(){}function ta(a){var b=typeof a;return\"object\"!=b?b:a?Array.isArray(a)?\"array\":b:\"null\"}function ra(a){var b=typeof a;return\"object\"==b&&null!=a||\"function\"==b}\nfunction ua(a){return Object.prototype.hasOwnProperty.call(a,ya)&&a[ya]||(a[ya]=++za)}var ya=\"closure_uid_\"+(1E9*Math.random()>>>0),za=0;function Aa(a,b,c){return a.call.apply(a.bind,arguments)}function Ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}\nfunction Ca(a,b,c){Ca=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?Aa:Ba;return Ca.apply(null,arguments)}function Da(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function r(a,b){qa(a,b,!0,void 0)}\nfunction Fa(a,b){function c(){}c.prototype=b.prototype;a.Z=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Cd=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};function t(){}r(\"H.util.ICache\",t);t.prototype.add=function(){};t.prototype.add=t.prototype.add;t.prototype.get=function(){};t.prototype.get=t.prototype.get;t.prototype.fb=function(){};t.prototype.drop=t.prototype.fb;t.prototype.forEach=function(){};t.prototype.forEach=t.prototype.forEach;t.prototype.ia=function(){};t.prototype.removeAll=t.prototype.ia;t.prototype.ya=function(){};t.prototype.registerOnDrop=t.prototype.ya;t.prototype.bb=function(){};t.prototype.deRegisterOnDrop=t.prototype.bb;function Ga(){var a=Ha,b;for(b in a)return!1;return!0}function Ia(a){var b={},c;for(c in a)b[c]=a[c];return b}var Ja=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Ka(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ja.length;f++)c=Ja[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function La(a){if(Error.captureStackTrace)Error.captureStackTrace(this,La);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}Fa(La,Error);La.prototype.name=\"CustomError\";var Ma=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(\"string\"===typeof a)return\"string\"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Na=this;var Oa=Ca,Pa=String,Qa=Na.Object.freeze||function(a){return a},x=[].pop(),Ra=/x/.exec(\"\");function Sa(a){return Pa(a).split(\",\"!==x?\",\":\" \")}var Ta=\"prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Ua(a,b,c,d){if(!(b=a instanceof b)&&c)throw new y(c,d,void 0!==x?void 0:a);return b}function Va(a){return\"function\"==ta(a)}function Wa(a,b,c,d){var e;if(!(e=\"Array\"===Xa(a))&&b)throw new y(b,c,d!==x?d:a);return e}\nr(\"H.lang.isArray\",function(a,b,c,d){return Wa(a,b,c,d)});function Ya(a){return\"string\"===typeof a}r(\"H.lang.isString\",Ya);var $a=isNaN;function ab(a){return a===+a}r(\"H.lang.isNumber\",ab);r(\"H.lang.isInteger\",Number.isInteger?Number.isInteger:function(a){return\"number\"===typeof a&&0===a%1});function Xa(a){var b=Object[Ta[0]][Ta[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var bb=[];0>bb.indexOf(bb)&&bb.push(bb);\nfunction cb(a,b,c,d){var e=\"\",f=2>arguments.length,g;f&&(b={H:Na.H},c=\"\",d=bb.slice());db(b,!0,function(h,k){try{if(g=h[k],k=eb(h,g),!(ra(g)&&g.window===g&&g.self===g||ra(g)&&0<g.nodeType&&Va(g.cloneNode))&&ra(g)){if(g===a)return e=c+\".\"+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=cb(a,g,c+\".\"+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace(\".\"+Ta[0]+\".\",\"#\"):\"~\"+(Va(a)?fb(a)+\"()\":Xa(a)));return e}\nfunction eb(a,b){var c=[];db(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(gb)[0]}function gb(a,b){return b.length-a.length}var hb=Object[Ta[0]][Ta[2]];function db(a,b,c){var d;if(a){for(e in a)if((!b||hb.call(a,e))&&c(a,e,!0))return;for(d=Ta.length;d--;){var e=Ta[d];if((!b||hb.call(a,e))&&c(a,e,!1))break}}}function fb(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:\"anonymous\"}function ib(a,b,c){c[b]=\"#\"+b}\nfunction y(a,b,c){var d=arguments.length;b=b!==x?+b:b;if(b!==x){var e=(e=/^.*?\\(([^\\)]+)/.exec((\"\"+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,\"\")))?Sa(e[1].replace(/\\s+/g,\"\")):[];e.forEach(ib);e=e[b]||\"#\"+b}var f=a?cb(a):\"\";d=2<d?Pa(c):\"\";if(e||d)f+=\" (Argument \"+(e||\"\")+(d?\" \"+d:\"\")+\")\";d=Error(f);Object.setPrototypeOf(d,y.prototype);return d}Fa(y,Error);r(\"H.lang.InvalidArgumentError\",y);y.prototype.name=\"InvalidArgumentError\";\nfunction jb(a,b){var c=[];a&&c.push(cb(a));1<arguments.length&&c.push(\"\"+b);c=Error(c.join(\" \"));Object.setPrototypeOf(c,jb.prototype);return c}Fa(jb,Error);r(\"H.lang.IllegalOperationError\",jb);jb.prototype.name=\"IllegalOperationError\";function z(a,b,c){this.ta=[];b&&this.ya(b);if(c&&!Va(c))throw new y(z,2,c);this.J=0;this.filter=c;this.s={};this.qa=this.ea=null;this.zb(a)}r(\"H.util.Cache\",z);z.prototype.add=function(a,b,c){var d,e;c=+c;if(!ab(c)||0>c)throw new y(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.s[a])?(d.data!==b&&kb(this,d),this.J+=c-d.size,d.size=c,d.data=b,lb(this,d)):this.s[a]=mb(this,{id:a,data:b,size:c,v:null,N:null},this.ea),nb(this);return e};z.prototype.add=z.prototype.add;\nz.prototype.ya=function(a){if(!Va(a))throw new y(this.ya,0,a);this.ta.push(a)};z.prototype.registerOnDrop=z.prototype.ya;z.prototype.bb=function(a){this.ta=this.ta.filter(function(b){return b!==a})};z.prototype.deRegisterOnDrop=z.prototype.bb;z.prototype.get=function(a,b){return(a=b?this.s[a]:lb(this,this.s[a]))&&a.data};z.prototype.get=z.prototype.get;z.prototype.fb=function(a){var b;(b=this.s[a])&&ob(this,b,!0)};z.prototype.drop=z.prototype.fb;\nz.prototype.forEach=function(a,b,c){var d;for(d in this.s){var e=this.s[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};z.prototype.forEach=z.prototype.forEach;z.prototype.ia=function(a){var b;for(b in this.s){var c=this.s[b];(a?a(b,c.data,c.size):1)&&ob(this,this.s[b],!0)}};z.prototype.removeAll=z.prototype.ia;z.prototype.zb=function(a){if(!(0<+a))throw new y(z.prototype.zb,0,a);this.Tb=+a;nb(this);return this};z.prototype.setMaxSize=z.prototype.zb;z.prototype.Jc=function(){return this.Tb};\nz.prototype.getMaxSize=z.prototype.Jc;z.prototype.Ec=function(){return this.J};z.prototype.getCurrentSize=z.prototype.Ec;function lb(a,b){b&&(a.ea=mb(a,b,a.ea));return b}function nb(a){for(;a.J>a.Tb&&a.qa;)ob(a,a.qa,!0)}function mb(a,b,c){if(c!==b){(b.v||b.N)&&ob(a,b,!1);if(b.v=c)b.N=c.N,c.N=b;b.N||(a.ea=b);b.v||(a.qa=b);a.J+=b.size}return b}function ob(a,b,c){var d=b.N,e=b.v;if(d||e||b==a.ea&&b==a.qa)d?d.v=e:a.ea=e,e?e.N=d:a.qa=d,a.J-=b.size,c&&(delete a.s[b.id],kb(a,b));b.v=b.N=null}\nfunction kb(a,b){for(var c=a.ta.length;c--;)a.ta[c].call(a,b.id,b.data,b.size)};function pb(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,0+Math.floor(a/b)]}var qb=1/Math.pow(10,10);function rb(a,b){var c=[],d=a.Nb();a=a.Mb();var e;180==a.lng&&(a.lng-=qb);d=pb(d,b);a=pb(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function sb(){}r(\"H.service.extension.dataView.IColumn\",sb);sb.prototype.o=function(){};sb.prototype.getCell=sb.prototype.o;function tb(a,b){this.Ca=a;this.qc=b}r(\"H.service.extension.dataView.ObjColumn\",tb);tb.prototype.o=function(a){return this.Ca.o(a,this.qc)};tb.prototype.getCell=tb.prototype.o;function ub(){}r(\"H.service.extension.dataView.IRow\",ub);ub.prototype.L=function(){};ub.prototype.getColumnNames=ub.prototype.L;ub.prototype.o=function(){};ub.prototype.getCell=ub.prototype.o;ub.prototype.pb=function(){};ub.prototype.getTable=ub.prototype.pb;function vb(a,b){this.Ca=a;this.nd=b}r(\"H.service.extension.dataView.ObjRow\",vb);vb.prototype.L=function(){return this.Ca.L()};vb.prototype.getColumnNames=vb.prototype.L;vb.prototype.o=function(a){return this.Ca.o(this.nd,a)};vb.prototype.getCell=vb.prototype.o;vb.prototype.pb=function(){return this.Ca};vb.prototype.getTable=vb.prototype.pb;function A(){}r(\"H.service.extension.dataView.ITable\",A);A.prototype.nb=function(){};A.prototype.getMeta=A.prototype.nb;A.prototype.ob=function(){};A.prototype.getRowCount=A.prototype.ob;A.prototype.Ja=function(){};A.prototype.getRow=A.prototype.Ja;A.prototype.L=function(){};A.prototype.getColumnNames=A.prototype.L;A.prototype.lb=function(){};A.prototype.getColumn=A.prototype.lb;A.prototype.o=function(){};A.prototype.getCell=A.prototype.o;A.prototype.concat=function(){};A.prototype.concat=A.prototype.concat;function B(){0!=wb&&(xb[ua(this)]=this);this.na=this.na;this.G=this.G}var wb=0,xb={};B.prototype.na=!1;B.prototype.C=function(){if(!this.na&&(this.na=!0,this.K(),0!=wb)){var a=ua(this);if(0!=wb&&this.G&&0<this.G.length)throw Error(this+\" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.\");delete xb[a]}};\nB.prototype.aa=function(a,b){this.na?void 0!==b?a.call(b):a():(this.G||(this.G=[]),this.G.push(void 0!==b?Ca(a,b):a))};B.prototype.K=function(){if(this.G)for(;this.G.length;)this.G.shift()()};function yb(a,b){return-1!=a.indexOf(b)};var C;a:{var zb=p.navigator;if(zb){var Ab=zb.userAgent;if(Ab){C=Ab;break a}}C=\"\"};function Cb(a){Cb[\" \"](a);return a}Cb[\" \"]=sa;var Db=yb(C,\"Gecko\")&&!(yb(C.toLowerCase(),\"webkit\")&&!yb(C,\"Edge\"))&&!(yb(C,\"Trident\")||yb(C,\"MSIE\"))&&!yb(C,\"Edge\"),Eb=yb(C.toLowerCase(),\"webkit\")&&!yb(C,\"Edge\");var Fb=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},\"passive\",{get:function(){a=!0}});try{p.addEventListener(\"test\",sa,b),p.removeEventListener(\"test\",sa,b)}catch(c){}return a}();function D(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.xa=!1}D.prototype.stopPropagation=function(){this.xa=!0};D.prototype.preventDefault=function(){this.defaultPrevented=!0};function Gb(a,b){D.call(this,a?a.type:\"\");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key=\"\";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType=\"\";this.oa=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=\nb;if(b=a.relatedTarget){if(Db){a:{try{Cb(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else\"mouseover\"==c?b=a.fromElement:\"mouseout\"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.offsetX=Eb||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Eb||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,\nthis.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||\"\";this.charCode=a.charCode||(\"keypress\"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=\"string\"===typeof a.pointerType?a.pointerType:Hb[a.pointerType]||\"\";this.state=a.state;this.oa=a;a.defaultPrevented&&Gb.Z.preventDefault.call(this)}}\nFa(Gb,D);var Hb={2:\"touch\",3:\"pen\",4:\"mouse\"};Gb.prototype.stopPropagation=function(){Gb.Z.stopPropagation.call(this);this.oa.stopPropagation?this.oa.stopPropagation():this.oa.cancelBubble=!0};Gb.prototype.preventDefault=function(){Gb.Z.preventDefault.call(this);var a=this.oa;a.preventDefault?a.preventDefault():a.returnValue=!1};var Ib=\"closure_listenable_\"+(1E6*Math.random()|0);var Jb=0;function Kb(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.La=e;this.key=++Jb;this.za=this.Ga=!1}function Lb(a){a.za=!0;a.listener=null;a.proxy=null;a.src=null;a.La=null};function Mb(a){this.src=a;this.m={};this.Ea=0}Mb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.m[f];a||(a=this.m[f]=[],this.Ea++);var g=Nb(a,b,d,e);-1<g?(b=a[g],c||(b.Ga=!1)):(b=new Kb(b,this.src,f,!!d,e),b.Ga=c,a.push(b));return b};Mb.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.m))return!1;var e=this.m[a];b=Nb(e,b,c,d);return-1<b?(Lb(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.m[a],this.Ea--),!0):!1};\nfunction Ob(a,b){var c=b.type;if(c in a.m){var d=a.m[c],e=Ma(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Lb(b),0==a.m[c].length&&(delete a.m[c],a.Ea--))}}Mb.prototype.ia=function(a){a=a&&a.toString();var b=0,c;for(c in this.m)if(!a||c==a){for(var d=this.m[c],e=0;e<d.length;e++)++b,Lb(d[e]);delete this.m[c];this.Ea--}return b};Mb.prototype.mb=function(a,b,c,d){a=this.m[a.toString()];var e=-1;a&&(e=Nb(a,b,c,d));return-1<e?a[e]:null};\nfunction Nb(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.za&&f.listener==b&&f.capture==!!c&&f.La==d)return e}return-1};var Pb=\"closure_lm_\"+(1E6*Math.random()|0),Qb={},Rb=0;function Sb(a,b,c,d,e){if(d&&d.once)Tb(a,b,c,d,e);else if(Array.isArray(b))for(var f=0;f<b.length;f++)Sb(a,b[f],c,d,e);else c=Ub(c),a&&a[Ib]?a.D.add(String(b),c,!1,ra(d)?!!d.capture:!!d,e):Vb(a,b,c,!1,d,e)}\nfunction Vb(a,b,c,d,e,f){if(!b)throw Error(\"Invalid event type\");var g=ra(e)?!!e.capture:!!e,h=Wb(a);h||(a[Pb]=h=new Mb(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=Xb();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Fb||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Yb(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error(\"addEventListener and attachEvent are unavailable.\");Rb++}}\nfunction Xb(){function a(c){return b.call(a.src,a.listener,c)}var b=Zb;return a}function Tb(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)Tb(a,b[f],c,d,e);else c=Ub(c),a&&a[Ib]?a.D.add(String(b),c,!0,ra(d)?!!d.capture:!!d,e):Vb(a,b,c,!0,d,e)}function $b(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)$b(a,b[f],c,d,e);else d=ra(d)?!!d.capture:!!d,c=Ub(c),a&&a[Ib]?a.D.remove(String(b),c,d,e):a&&(a=Wb(a))&&(b=a.mb(b,c,d,e))&&ac(b)}\nfunction ac(a){if(\"number\"!==typeof a&&a&&!a.za){var b=a.src;if(b&&b[Ib])Ob(b.D,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Yb(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Rb--;(c=Wb(b))?(Ob(c,a),0==c.Ea&&(c.src=null,b[Pb]=null)):Lb(a)}}}function Yb(a){return a in Qb?Qb[a]:Qb[a]=\"on\"+a}function Zb(a,b){if(a.za)a=!0;else{b=new Gb(b,this);var c=a.listener,d=a.La||a.src;a.Ga&&ac(a);a=c.call(d,b)}return a}\nfunction Wb(a){a=a[Pb];return a instanceof Mb?a:null}var bc=\"__closure_events_fn_\"+(1E9*Math.random()>>>0);function Ub(a){if(\"function\"===typeof a)return a;a[bc]||(a[bc]=function(b){return a.handleEvent(b)});return a[bc]};r(\"H.util.Event\",D);D.prototype.stopPropagation=D.prototype.stopPropagation;D.prototype.stopPropagation=D.prototype.stopPropagation;D.prototype.CAPTURING_PHASE=1;D.prototype.CAPTURING_PHASE=D.prototype.CAPTURING_PHASE;D.prototype.AT_TARGET=2;D.prototype.AT_TARGET=D.prototype.AT_TARGET;D.prototype.BUBBLING_PHASE=3;D.prototype.BUBBLING_PHASE=D.prototype.BUBBLING_PHASE;D.prototype.eventPhase=0;D.prototype.eventPhase=D.prototype.eventPhase;function cc(a,b,c){cc.Z.constructor.call(this,a,c);this.message=b}Fa(cc,D);r(\"H.util.ErrorEvent\",cc);function dc(){}r(\"H.util.ICancelable\",dc);dc.prototype.cancel=function(){};dc.prototype.cancel=dc.prototype.cancel;function ec(a){p.setTimeout(function(){throw a;},0)};function fc(a,b){this.$c=100;this.rc=a;this.md=b;this.Qa=0;this.Ma=null}fc.prototype.get=function(){if(0<this.Qa){this.Qa--;var a=this.Ma;this.Ma=a.next;a.next=null}else a=this.rc();return a};fc.prototype.put=function(a){this.md(a);this.Qa<this.$c&&(this.Qa++,a.next=this.Ma,this.Ma=a)};function gc(){this.Ya=this.ja=null}gc.prototype.add=function(a,b){var c=hc.get();c.set(a,b);this.Ya?this.Ya.next=c:this.ja=c;this.Ya=c};gc.prototype.remove=function(){var a=null;this.ja&&(a=this.ja,this.ja=this.ja.next,this.ja||(this.Ya=null),a.next=null);return a};var hc=new fc(function(){return new ic},function(a){return a.reset()});function ic(){this.next=this.scope=this.hb=null}ic.prototype.set=function(a,b){this.hb=a;this.scope=b;this.next=null};\nic.prototype.reset=function(){this.next=this.scope=this.hb=null};function jc(){var a=document;var b=\"IFRAME\";\"application/xhtml+xml\"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var mc;\nfunction nc(){var a=p.MessageChannel;\"undefined\"===typeof a&&\"undefined\"!==typeof window&&window.postMessage&&window.addEventListener&&!yb(C,\"Presto\")&&(a=function(){var e=jc();e.style.display=\"none\";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g=\"callImmediate\"+Math.random(),h=\"file:\"==f.location.protocol?\"*\":f.location.protocol+\"//\"+f.location.host;e=Ca(function(k){if((\"*\"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener(\"message\",e,\n!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if(\"undefined\"!==typeof a&&!yb(C,\"Trident\")&&!yb(C,\"MSIE\")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Jb;c.Jb=null;e()}};return function(e){d.next={Jb:e};d=d.next;b.port2.postMessage(0)}}return function(e){p.setTimeout(e,0)}};function oc(a,b){pc||qc();rc||(pc(),rc=!0);sc.add(a,b)}var pc;function qc(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);pc=function(){a.then(tc)}}else pc=function(){var b=tc;\"function\"!==typeof p.setImmediate||p.Window&&p.Window.prototype&&!yb(C,\"Edge\")&&p.Window.prototype.setImmediate==p.setImmediate?(mc||(mc=nc()),mc(b)):p.setImmediate(b)}}var rc=!1,sc=new gc;function tc(){for(var a;a=sc.remove();){try{a.hb.call(a.scope)}catch(b){ec(b)}hc.put(a)}rc=!1};function uc(a){this.u=vc;this.Zb=void 0;this.ba=this.I=this.W=null;this.Ka=this.gb=!1;if(a!=sa)try{var b=this;a.call(void 0,function(c){wc(b,xc,c)},function(c){wc(b,yc,c)})}catch(c){wc(this,yc,c)}}var vc=0,xc=2,yc=3;function zc(){this.next=this.context=this.ha=this.ua=this.R=null;this.Fa=!1}zc.prototype.reset=function(){this.context=this.ha=this.ua=this.R=null;this.Fa=!1};var Ac=new fc(function(){return new zc},function(a){a.reset()});\nfunction Bc(a,b,c){var d=Ac.get();d.ua=a;d.ha=b;d.context=c;return d}function Cc(a,b,c){Dc(a,b,c,null)||oc(Da(b,a))}function Ec(a){return new uc(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],Cc(k,Da(f,h),g);else b(e)})}function Fc(){var a,b,c=new uc(function(d,e){a=d;b=e});return new Gc(c,a,b)}uc.prototype.then=function(a,b,c){return Hc(this,\"function\"===typeof a?a:null,\"function\"===typeof b?b:null,c)};\nuc.prototype.$goog_Thenable=!0;uc.prototype.cancel=function(a){if(this.u==vc){var b=new Ic(a);oc(function(){Jc(this,b)},this)}};function Jc(a,b){if(a.u==vc)if(a.W){var c=a.W;if(c.I){for(var d=0,e=null,f=null,g=c.I;g&&(g.Fa||(d++,g.R==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.u==vc&&1==d?Jc(c,b):(f?(d=f,d.next==c.ba&&(c.ba=d),d.next=d.next.next):Kc(c),Lc(c,e,yc,b)))}a.W=null}else wc(a,yc,b)}function Mc(a,b){a.I||a.u!=xc&&a.u!=yc||Nc(a);a.ba?a.ba.next=b:a.I=b;a.ba=b}\nfunction Hc(a,b,c,d){var e=Bc(null,null,null);e.R=new uc(function(f,g){e.ua=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.ha=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Ic?g(h):f(k)}catch(m){g(m)}}:g});e.R.W=a;Mc(a,e);return e.R}uc.prototype.td=function(a){this.u=vc;wc(this,xc,a)};uc.prototype.ud=function(a){this.u=vc;wc(this,yc,a)};\nfunction wc(a,b,c){a.u==vc&&(a===c&&(b=yc,c=new TypeError(\"Promise cannot resolve to itself\")),a.u=1,Dc(c,a.td,a.ud,a)||(a.Zb=c,a.u=b,a.W=null,Nc(a),b!=yc||c instanceof Ic||Oc(a,c)))}function Dc(a,b,c,d){if(a instanceof uc)return Mc(a,Bc(b||sa,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(ra(a))try{var f=a.then;if(\"function\"===typeof f)return Pc(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Pc(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Nc(a){a.gb||(a.gb=!0,oc(a.uc,a))}function Kc(a){var b=null;a.I&&(b=a.I,a.I=b.next,b.next=null);a.I||(a.ba=null);return b}uc.prototype.uc=function(){for(var a;a=Kc(this);)Lc(this,a,this.u,this.Zb);this.gb=!1};\nfunction Lc(a,b,c,d){if(c==yc&&b.ha&&!b.Fa)for(;a&&a.Ka;a=a.W)a.Ka=!1;if(b.R)b.R.W=null,Qc(b,c,d);else try{b.Fa?b.ua.call(b.context):Qc(b,c,d)}catch(e){Rc.call(null,e)}Ac.put(b)}function Qc(a,b,c){b==xc?a.ua.call(a.context,c):a.ha&&a.ha.call(a.context,c)}function Oc(a,b){a.Ka=!0;oc(function(){a.Ka&&Rc.call(null,b)})}var Rc=ec;function Ic(a){La.call(this,a)}Fa(Ic,La);Ic.prototype.name=\"cancel\";function Gc(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Sc(a,b,c){this.type=a;this.data=b;this.O=Fc();this.resolve=Oa(this.resolve,this);this.reject=Oa(this.reject,this);this.priority=Tc;c!==x&&(this.priority=c);this.Gc().add(this)}var Tc=1,Uc={zd:0,Ad:Tc,yd:2};l=Sc.prototype;l.then=function(a,b,c){return this.O.promise.then(a,b,c)};l.resolve=function(a){this.state=3;this.O.resolve(a)};l.reject=function(a){this.state=5;this.O.reject(a)};l.state=0;l.cancel=function(){3>this.state&&(this.Dd(),this.Gc().remove(this),this.state=4)};\nSc.prototype.cancel=Sc.prototype.cancel;function Vc(a){var b;this.Y={};for(b in Uc)this.Y[Uc[b]]=[];this.Ba=a;this.Ba.addEventListener(\"allocatable\",Oa(this.Lb,this))}r(\"H.util.JobManager\",Vc);var Wc=Object.keys(Uc).map(function(a){return Uc[a]}).sort().reverse();Vc.prototype.add=function(a){Ua(a,Sc,this.add,0);this.Y[a.priority].push(a);this.Lb()};Vc.prototype.contains=function(a){return-1<this.Y[a.priority].indexOf(a)};\nVc.prototype.remove=function(a){var b=a.priority,c=this.Y[b].indexOf(a);if(-1<c)return this.Y[b].splice(c,1),!0;a.Fb&&this.Ba.sc(a.Fb);return!1};Vc.prototype.Lb=function(){Wc.forEach(function(a){this.Y[a]=this.Y[a].filter(function(b){var c;if((c=this.Ba.Bd(b))!==Ra){var d=Oa(this.Ba.sc,this.Ba,c,b);b.Fb=c;b.then(d,d);b.state=b.Ed(c)?1:5}else return!0},this)},this)};var E=Math,Xc=E.min,Yc=E.max,Zc=E.round,$c=E.floor,ad=E.ceil,bd=E.abs,cd=E.log,dd=E.sqrt,F=E.pow,ed=E.exp,fd=E.sin,gd=E.asin,hd=E.cos,id=E.tan,jd=E.atan,kd=E.atan2,ld=E.LN2,K=E.PI,md=K/2,nd=K/4,od=2*K,pd=3*K,qd=K/180,rd=180/K,sd=1/0;function td(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}r(\"H.math.normalize\",function(a,b,c){b-=c=c||0;a-=c;return a-$c(a/b)*b+c});function ud(a,b,c){return(a-=0)>c?c:a<b?b:a}r(\"H.math.clamp\",ud);\nfunction vd(a,b,c){var d=0;(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var wd={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};r(\"H.math.CoverType\",wd);\nfunction xd(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){e-=0;g=c[--e];f=c[--e];k=c[e?e-0-1:(d+(e-0-1))%d];h=c[e?e-0-2:(d+(e-0-2))%d];if(f>=a-0&&f<=a+0&&g>=b-0&&g<=b+0||h>=a-0&&h<=a+0&&k>=b-0&&k<=b+0)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=vd(b,g,k)&&0>=dd(F((a-h)*(g-k)-(b-k)*(f-h),2)/(F(f-h,2)+F(g-k,2)))?2:0;else if(!n&&vd(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=vd(b,g,k)&&0>=dd(F((a-h)*(g-k)-\n(b-k)*(f-h),2)/(F(f-h,2)+F(g-k,2)))?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}function yd(a,b){return xd(a.x,a.y,b)!==wd.NONE}r(\"H.math.isPointInsidePolygon\",yd);function zd(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==x;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}r(\"H.math.flatten\",zd);function Ad(a,b,c){Ad.Z.constructor.call(this,a,c);this.data=b}Fa(Ad,D);r(\"H.util.DataEvent\",Ad);function Bd(a,b,c){var d=[],e=arguments.length;a&&d.push(cb(a));1<e&&(e=2<e&&Wa(c,void 0,void 0,void 0)?\" out of [\"+c[0]+\"...\"+c[1]+\"]\":\"\",d.push(\"(\"+b+e+\")\"));d=Error(d.join(\" \"));Object.setPrototypeOf(d,Bd.prototype);return d}Fa(Bd,Error);r(\"H.lang.OutOfRangeError\",Bd);Bd.prototype.name=\"OutOfRangeError\";function L(){B.call(this);this.D=new Mb(this);this.hc=this;this.wb=null}Fa(L,B);L.prototype[Ib]=!0;l=L.prototype;l.M=function(){return this.wb};l.Sa=function(a){this.wb=a};l.addEventListener=function(a,b,c,d){Sb(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){$b(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.M();if(c)for(b=[];c;c=c.M())b.push(c);c=this.hc;var d=a.type||a;if(\"string\"===typeof a)a=new D(a,c);else if(a instanceof D)a.target=a.target||c;else{var e=a;a=new D(d,c);Ka(a,e)}e=!0;if(b)for(var f=b.length-1;!a.xa&&0<=f;f--){var g=a.currentTarget=b[f];e=g.da(d,!0,a)&&e}a.xa||(g=a.currentTarget=c,e=g.da(d,!0,a)&&e,a.xa||(e=g.da(d,!1,a)&&e));if(b)for(f=0;!a.xa&&f<b.length;f++)g=a.currentTarget=b[f],e=g.da(d,!1,a)&&e;return e};\nl.K=function(){L.Z.K.call(this);this.D&&this.D.ia(void 0);this.wb=null};l.da=function(a,b,c){a=this.D.m[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.za&&f.capture==b){var g=f.listener,h=f.La||f.src;f.Ga&&Ob(this.D,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};l.mb=function(a,b,c,d){return this.D.mb(String(a),b,c,d)};r(\"H.util.EventTarget\",L);L.prototype.Sa=L.prototype.Sa;L.prototype.setParentEventTarget=L.prototype.Sa;L.prototype.M=L.prototype.M;L.prototype.getParentEventTarget=L.prototype.M;L.prototype.addEventListener=L.prototype.addEventListener;L.prototype.addEventListener=L.prototype.addEventListener;L.prototype.removeEventListener=L.prototype.removeEventListener;L.prototype.removeEventListener=L.prototype.removeEventListener;L.prototype.dispatchEvent=L.prototype.dispatchEvent;\nL.prototype.dispatchEvent=L.prototype.dispatchEvent;L.prototype.C=L.prototype.C;L.prototype.dispose=L.prototype.C;L.prototype.aa=L.prototype.aa;L.prototype.addOnDisposeCallback=L.prototype.aa;L.prototype.yc=L.prototype.da;\nL.prototype.da=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?\"AT_TARGET\":b?\"CAPTURING_PHASE\":(d=!0,\"BUBBLING_PHASE\")];if(!d||\"pointerenter\"!==(e=c.type)&&\"pointerleave\"!==e)c.eventPhase=g,f=L.prototype.yc.apply(this,arguments),d&&this.M&&null===this.M()&&delete c.eventPhase;return f};L.prototype.qd=function(a){for(var b,c=this;c&&(b=c.M())&&b!==a;)c=b;b||c.Sa(a)};L.prototype.setRootParentEventTarget=L.prototype.qd;function O(a){a=a||{};var b=a.callback;this.rb=a.label;Va(b)&&(this.callback=b);this.cb=!!a.disabled;O.Z.constructor.call(this)}Fa(O,L);r(\"H.util.ContextItem\",O);O.prototype.Hc=function(){return this.rb};O.prototype.getLabel=O.prototype.Hc;O.prototype.pd=function(a){this.rb!==a&&(this.rb=a,this.dispatchEvent(\"update\"));return this};O.prototype.setLabel=O.prototype.pd;O.prototype.Xc=function(){return this.cb};O.prototype.isDisabled=O.prototype.Xc;\nO.prototype.od=function(a){a!==this.cb&&(this.cb=a,this.dispatchEvent(\"update\"));return this};O.prototype.setDisabled=O.prototype.od;var Cd=new O;O.SEPARATOR=Cd;function Dd(a){if(Na.document){var b=document.createElement(\"canvas\");b.width=b.height=1;b.getContext(\"2d\",{Fd:a})}}r(\"H.util.getPixelRatio\",function(){return window.devicePixelRatio||1});Object.create(Ra,void 0);r(\"H.util.eval\",function(a){return eval(a)});r(\"H.util.provide\",function(a){var b=p.$jscomp;if(b&&(\"function\"!=typeof b.Dc?0:b.Dc()))throw Error(\"goog.provide cannot be used within a module.\");qa(a,void 0,void 0)});function Ed(){this.v=0}\nEd.prototype.next=function(a){if(9007199254740992===this.v)throw new Bd(a,this.v,[0,9007199254740991]);return this.v++};var Fd=new Ed;Oa(Fd.next,Fd);var Gd=Qa([]);Qa({});Dd(!0);Dd(!1);function Q(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):x);this.P=a;if(b)for(this.ca=b,this.ab=a=Object.create(Ra,void 0),d=b.length;d--;)a[b[d]]=!0;c!==x&&(this.ub=c)}r(\"H.service.extension.dataView.ObjTable\",Q);l=Q.prototype;l.ub=x;l.P=x;l.ca=x;l.ab=x;l.nb=function(){return this.ub};Q.prototype.getMeta=Q.prototype.nb;Q.prototype.ob=function(){return this.P?this.P.length:0};Q.prototype.getRowCount=Q.prototype.ob;Q.prototype.Ja=function(a){var b=this.P;return b&&b[a]?new vb(this,a):x};\nQ.prototype.getRow=Q.prototype.Ja;Q.prototype.L=function(){return this.ca||Gd};Q.prototype.getColumnNames=Q.prototype.L;Q.prototype.lb=function(a){return this.ab[a]?new tb(this,a):x};Q.prototype.getColumn=Q.prototype.lb;Q.prototype.o=function(a,b){var c=this.P;return(a=c&&this.ab[b]&&c[a])&&a[b]};Q.prototype.getCell=Q.prototype.o;\nQ.prototype.concat=function(){var a=arguments.length,b,c=this.ca,d=\"\"+this.ca,e=(this.P||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof Q))throw new y(this.concat,b);if(f.P){if(c&&\"\"+f.ca!==d)throw new y(this.concat,b,\"Incompatible columns!\");e=e.concat(f.P)}}return new Q(e,this.ca,this.ub)};Q.prototype.concat=Q.prototype.concat;function Hd(a,b,c,d){if(!a||!b||!c)throw new y(Hd,x,\"Must specify name, version and revision parameter\");this.name=a;this.version=b;this.revision=c;d&&Ka(this,d)}r(\"H.util.BuildInfo\",Hd);Hd.prototype.toString=function(){var a,b=[];for(a in this)Ya(this[a])&&b.push(this[a]);return b.join(\";\")};var Id={};function Jd(a,b,c,d){if(!a)throw new y(Jd,1,\"Must specify a name parameter\");return Id[a]||(Id[a]=new Hd(a,b,c,d))}Hd.get=Jd;function S(a,b,c,d,e,f){if(a&&b)this.Cb(a),this.Ra(b),this.Ab(c),this.Bb(e),this.ac(f),this.Ta(d);else throw new y(S,x,'Parameters \"scheme\" and \"host\" must be specified');}r(\"H.service.Url\",S);\nfunction Kd(a,b){var c=Na.document,d;var e=\"\";if(c){e=c.createElement(\"a\");if(b){var f=(d=c.getElementsByTagName(\"base\")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement(\"base\"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\\w]+:\\/\\//.test(a)&&(e=a);f=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split(\"@\")[1]);f=S;h=h&&0<h.length?h.substr(1):\n\"\";e={};var k,m;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;m=k.exec(c);)e[decodeURIComponent(m[2])]=m[4]?decodeURIComponent(m[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):\"\")}S.parse=Kd;S.prototype.clone=function(){var a={},b;for(b in this.A)a[b]=this.A[b];return new S(this.yb,this.Na,this.X,a,this.wa,this.la)};S.prototype.clone=S.prototype.clone;\nS.prototype.Cb=function(a){if(!a||\"string\"!==typeof a)throw new y(this.Cb,0,'The \"scheme\" parameter must be a non-empty string.');this.yb=a;return this};S.prototype.setScheme=S.prototype.Cb;S.prototype.Oc=function(){return this.yb};S.prototype.getScheme=S.prototype.Oc;S.prototype.Ra=function(a){if(!a||\"string\"!==typeof a||\"-\"===a.charAt(0)||\".\"===a.charAt(0)||\".\"===a.charAt(a.length-1))throw new y(this.Ra,0,'The \"host\" parameter is not a valid host name.');this.Na=a;return this};\nS.prototype.setHost=S.prototype.Ra;S.prototype.Fc=function(){return this.Na};S.prototype.getHost=S.prototype.Fc;S.prototype.Ab=function(a){this.X=a||void 0;return this};S.prototype.setPath=S.prototype.Ab;S.prototype.Lc=function(){return this.X};S.prototype.getPath=S.prototype.Lc;S.prototype.Ta=function(a){if(a)if(\"object\"==typeof a)this.A=a;else throw new y(this.Ta,0,'Parameter \"params\" must be an object.');else this.A={};return this};S.prototype.setQuery=S.prototype.Ta;S.prototype.Sc=function(){return!Ld(this)};\nS.prototype.hasQuery=S.prototype.Sc;S.prototype.getQuery=function(){return this.A};S.prototype.getQuery=S.prototype.getQuery;S.prototype.Bb=function(a){if(void 0===a)this.wa=a;else{var b=ud(+a<<0,0,65535);if(b!=a)throw new y(this.Bb,0,'Parameter \"port\" must be an integer in range [0...65535]');this.wa=b}return this};S.prototype.setPort=S.prototype.Bb;S.prototype.Mc=function(){return this.wa};S.prototype.getPort=S.prototype.Mc;S.prototype.ac=function(a){this.la=a||void 0;return this};\nS.prototype.setAnchor=S.prototype.ac;S.prototype.Bc=function(){return this.la};S.prototype.getAnchor=S.prototype.Bc;S.prototype.ga=function(a){if(\"object\"!==typeof a)throw new y(this.ga,0,'Parameter \"other\" must be an object.');var b=this.A,c;for(c in a)a.hasOwnProperty(c)&&\"function\"!==typeof a[c]&&(b[c]=a[c]);return this};S.prototype.mergeQuery=S.prototype.ga;\nS.prototype.Gb=function(a){if(!a||\"string\"!==typeof a)throw new y(this.Gb,0,'Parameter \"subDomain\" must be a non-empty string');\".\"===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ra(a+\".\"+this.Na)};S.prototype.addSubDomain=S.prototype.Gb;S.prototype.Hb=function(a){if(!a||\"string\"!==typeof a)throw new y(this.Hb,0,'Parameter \"subPath\" must be a non-empty string');return this.Ab((this.X?this.X+\"/\":\"\")+a)};S.prototype.addSubPath=S.prototype.Hb;\nS.prototype.toString=function(){return[this.yb+\"://\",this.Na,this.wa?\":\"+this.wa:\"\",this.X||!Ld(this)||this.la?\"/\":\"\",this.X?encodeURI(this.X):\"\",Md(this),this.la?\"#\"+encodeURIComponent(this.la):\"\"].join(\"\")};S.prototype.toString=S.prototype.toString;function Nd(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return\"%\"+b.charCodeAt(0).toString(16)})}\nfunction Md(a){var b=[],c=a.A,d={},e;for(e in c){if(c.hasOwnProperty(e)&&\"function\"!==typeof c[e]){var f=a.A[e];d.$=Nd(e);Ua(f,Od)?f.Va.forEach(function(g){return function(h){b.push(g.$+\"=\"+Nd(h))}}(d)):Ua(f,Pd)?b.push(d.$+\"=\"+f.Va.map(function(g){return Nd(g)}).join(f.tc)):b.push(void 0===f?d.$:d.$+\"=\"+Nd(f))}d={$:d.$}}return 0<b.length?\"?\"+b.join(\"&\"):\"\"}function Ld(a){var b,c=0;for(b in a.A)if(a.A.hasOwnProperty(b)&&\"function\"!==typeof a.A[b]&&(c++,0<c))break;return!c}\nfunction Qd(a,b){if(Wa(a,void 0,void 0,void 0))for(var c=0;c<a.length;c++){var d=a[c];if(!Ya(d)&&!ab(d)){var e=\"The Array does not contain only strings and numbers\";break}}else e=\"Not an Array\";if(e)throw new y(b,0,a);return a}function Od(a){this.Va=Qd(a,Od)}S.MultiValueQueryParameter=Od;Od.prototype.Qc=function(){return this.Va};Od.prototype.getValues=Od.prototype.Qc;function Pd(a,b){this.Va=Qd(a,Pd);if(!/^[!\\$\\(\\)\\*\\+,;]$/.test(b))throw new y(Pd,1,'Invalid delimiter \"'+b+'\"');this.tc=b}\nS.DelimitedQuerySubValues=Pd;var Rd={};function Sd(a){try{importScripts.apply(self,arguments)}catch(b){this.postError(\"invalid_script\")}}function Td(a){delete Rd[a];this.postMessage(a)}function Ud(a,b,c){if(Va(b))var d=b;else try{d=self.eval(\"(\"+b+\")\"),Va(d)||(d=null)}catch(e){}d?(Rd[a]=d,c||this.postMessage(a)):this.postError(\"invalid_processor\")}function Vd(a){this.Wb=a&&a[0];this.Ua=a&&a[1];this.kc=a&&a[2]||[]}Vd.prototype.postError=function(a){this.postMessage(a,x,0)};\nVd.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.Wb,taskId:this.Ua,type:c===x?1:c,data:a},b||x)};function Xd(a,b,c){if(!Ya(a))throw new y(Xd,0,\"InvalidArgument\");if(!Va(b))throw new y(Xd,1,\"InvalidArgument\");var d=Yd++;Zd[d]={mimeType:c||$d,nc:b};(new Vd([\"3\",d,[]])).postMessage(a,[],2)}var Zd={},Yd=0;\nfunction ae(a,b){var c=a;if(Zd[this.Ua]){var d=Zd[this.Ua];var e=d.nc;delete Zd[this.Ua];if(b)e(null,b);else{if(d.mimeType===be){a=new Uint8Array(a);b=a.byteLength;d=\"\";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var $d=0,be=1;r(\"H.util.Disposable\",B);B.prototype.aa=B.prototype.aa;B.prototype.addOnDisposeCallback=B.prototype.aa;r(\"H.util.dispose\",function(a){a&&\"function\"==typeof a.C&&a.C()});B.prototype.C=B.prototype.C;B.prototype.dispose=B.prototype.C;B.prototype.K=B.prototype.K;B.prototype.disposeInternal=B.prototype.K;function ce(a,b,c){var d=ud(+a,-90,90);if(b&&$a(d))throw new y(b,c,a);return d}function de(a,b,c){var d=+a;if(-180>d||180<d)d=td(d+180,360)-180;if(b&&$a(d))throw new y(b,c,a);return d}function ee(a,b,c){var d;if(a!==x&&$a(d=+a)&&b)throw new y(b,c,a);return d}r(\"H.geo.isDBC\",function(a,b){return 0>a!==0>b&&180<bd(b-a)});function T(){var a=T;if(!0===(Ua(this,a)&&this.constructor===a))throw new TypeError(\"Illegal constructor \"+cb(a));}r(\"H.geo.AbstractGeometry\",T);T.prototype.getBoundingBox=T.prototype.pa;T.prototype.equals=T.prototype.S;T.prototype.Xa=\"\";T.prototype.kb=\"\";T.prototype.toString=function(){return this.dc([this.Xa.toUpperCase(),\" \"]).join(\"\")};T.prototype.toString=T.prototype.toString;T.prototype.sd=function(){return{type:this.kb,coordinates:this.cc()}};T.prototype.toGeoJSON=T.prototype.sd;\nT.prototype.ib=function(){return{type:this.Xa,coordinates:this.jb(),boundingBox:this.pa().ib()}};T.prototype.forWorkerMessage=T.prototype.ib;function U(a,b,c){this.lat=ce(a,U,0);this.lng=de(b,U,1);c!==x&&(this.alt=ee(c,U,2))}Fa(U,T);r(\"H.geo.Point\",U);U.prototype.S=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};U.prototype.equals=U.prototype.S;U.prototype.eb=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*qd;var c=a.lat*qd;a=1.274200158E7*gd(Xc(1,dd(F(fd((b-c)/2),2)+hd(b)*hd(c)*F(fd((this.lng*qd-a.lng*qd)/2),2))))}return a};\nU.prototype.distance=U.prototype.eb;\nU.prototype.vd=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*qd;a=qd*this.lat;var e=fd(a);c=fd(d);var f=hd(d);d=qd*this.lng;var g=hd(a);a=gd(g*hd(b)*c+e*f);b=kd(fd(b)*g*c,f-e*fd(a));b=(d+b+K)%(2*K)-K;b*=rd;e=new U(a*rd,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*od*hd(this.lat*qd))*(270===a?-360:360),new U(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=qd,e=this.lat*qd,c=this.lng*qd,d=e+b*hd(a),f=d-e,g=cd(id(d/2+nd)/id(e/2+nd)),g=$a(f/g)?\nhd(e):f/g,a=b*fd(a)/g,bd(d)>md&&(d=0<d?K-d:-(K+d)),d=new U(d*rd,((c+a+pd+(bd(e+f)>md?K:0))%od-K)*rd);return d||this};U.prototype.walk=U.prototype.vd;U.prototype.pa=function(){return new X(this.lat,this.lng,this.lat,this.lng)};U.prototype.getBoundingBox=U.prototype.pa;function fe(a,b,c){var d=ra(a)&&!($a(a.lat=ce(a.lat))||$a(a.lng=de(a.lng))||a.alt!==x&&$a(a.alt=ee(a.alt)));if(!d&&b)throw new y(b,c,a);return d}U.validate=fe;function ge(a){if(!a)throw new y(ge,0,a);return new U(a.lat,a.lng,a.alt)}\nU.fromIPoint=ge;l=U.prototype;l.Xa=\"Point\";l.dc=function(a){a.push(\"(\",this.lng,\" \",this.lat,\")\");return a};l.kb=\"Point\";l.cc=function(){return[this.lng,this.lat,this.alt||0]};l.jb=function(){return[this.lat,this.lng,this.alt||0]};function X(a,b,c,d){he(this,ce(a,X,0),de(b,X,1),ce(c,X,2),de(d,X,3))}Fa(X,T);r(\"H.geo.Rect\",X);X.prototype.Xa=\"Polygon\";X.prototype.dc=function(a){var b=this.l,c=this.g,d=this.j,e=this.i;a.push(\"(\",\"(\",c,\" \",b,\",\",e,\" \",b,\",\",e,\" \",d,\",\",c,\" \",d,\",\",c,\" \",b,\")\",\")\");return a};X.prototype.S=function(a){var b=this===a;!b&&Ua(a,X)&&(b=this.l===a.l&&this.g===a.g&&this.j===a.j&&this.i===a.i);return b};X.prototype.equals=X.prototype.S;\nX.prototype.clone=function(){return new X(this.l,this.g,this.j,this.i)};X.prototype.clone=X.prototype.clone;function he(a,b,c,d,e){a.g=c;a.i=e;b<d&&(c=b,b=d,d=c);a.l=b;a.j=d;a.Db=a.Za=a.$a=null;return a}X.prototype.Nb=function(){this.Db||(this.Db=new U(this.l,this.g));return this.Db};X.prototype.getTopLeft=X.prototype.Nb;X.prototype.Mb=function(){this.Za||(this.Za=new U(this.j,this.i));return this.Za};X.prototype.getBottomRight=X.prototype.Mb;X.prototype.Pc=function(){return this.l};\nX.prototype.getTop=X.prototype.Pc;X.prototype.Cc=function(){return this.j};X.prototype.getBottom=X.prototype.Cc;X.prototype.Ic=function(){return this.g};X.prototype.getLeft=X.prototype.Ic;X.prototype.Nc=function(){return this.i};X.prototype.getRight=X.prototype.Nc;X.prototype.T=function(){this.$a||(this.$a=new U(this.j+(this.l-this.j)/2,ie(this.g,this.U())));return this.$a};X.prototype.getCenter=X.prototype.T;X.prototype.U=function(){return je(this.g,this.i)};X.prototype.getWidth=X.prototype.U;\nX.prototype.fa=function(){return this.l-this.j};X.prototype.getHeight=X.prototype.fa;X.prototype.Wc=function(){return this.g>this.i};X.prototype.isCDB=X.prototype.Wc;X.prototype.Yc=function(){return!this.U()&&!this.fa()};X.prototype.isEmpty=X.prototype.Yc;X.prototype.pa=function(){return new X(this.l,this.g,this.j,this.i)};X.prototype.getBoundingBox=X.prototype.pa;\nX.prototype.Ha=function(a,b,c){var d=this.T();c||(a=ce(a,this.Ha,0),b=de(b,this.Ha,1));b=this.V(a,b,c);a=b.T();return a.lat===d.lat&&a.lng===d.lng&&this.fa()===b.fa()&&this.U()===b.U()};X.prototype.containsLatLng=X.prototype.Ha;X.prototype.Ia=function(a,b){b||fe(a,this.Ia,0);return this.Ha(a.lat,a.lng,b)};X.prototype.containsPoint=X.prototype.Ia;\nX.prototype.Kb=function(a,b){var c=this.T();if(!b&&!Ua(a,X))throw new y(this.Kb,0,a);b=this.Pa(a,b);a=b.T();return a.lat===c.lat&&a.lng===c.lng&&this.fa()===b.fa()&&this.U()===b.U()};X.prototype.containsRect=X.prototype.Kb;X.prototype.V=function(a,b,c,d){if(!c){if($a(a=ce(a)))throw new y(this.V,0,a);if($a(b=de(b)))throw new y(this.V,1,b);}return ke(this.l,this.g,this.j,this.i,a,b,a,b,d)};X.prototype.mergeLatLng=X.prototype.V;\nX.prototype.Ub=function(a,b,c){b||fe(a,this.Ub,0);return this.V(a.lat,a.lng,b,c)};X.prototype.mergePoint=X.prototype.Ub;X.prototype.Pa=function(a,b,c){if(!b&&!Ua(a,X))throw new y(this.Pa,0,a);return ke(this.l,this.g,this.j,this.i,a.l,a.g,a.j,a.i,c)};X.prototype.mergeRect=X.prototype.Pa;X.prototype.sa=function(a,b,c,d,e,f){e||(a=ce(a,this.sa,0),b=de(b,this.sa,1),c=ce(c,this.sa,2),d=de(d,this.sa,3));return ke(this.l,this.g,this.j,this.i,a,b,c,d,f)};X.prototype.mergeTopLeftBottomRight=X.prototype.sa;\nX.prototype.Qb=function(a,b){var c=this.g<=this.i,d=a.g<=a.i,e=this.g<a.i,f=a.g<this.i;if(!b&&!Ua(a,X))throw new y(this.Qb,0,a);return this.j<=a.l&&a.j<=this.l&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};X.prototype.intersects=X.prototype.Qb;function je(a,b){a=b-a;return a+(0>a?360:0)}function ie(a,b){a+=b/2;return a-(180<a?360:0)}\nfunction ke(a,b,c,d,e,f,g,h,k){c=Xc(c,g);a=Yc(a,e);e=je(b,d);var m=ie(b,e);g=je(f,h);var n=ie(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?he(k,a,m,c,q):new X(a,m,c,q)}X.merge=ke;function le(a,b,c){c||(fe(a,le,0),fe(b,le,1));return new X(a.lat,a.lng,b.lat,b.lng)}X.fromPoints=le;\nfunction me(a,b){var c=1,d=a.length,e=null;var f=ta(a);if(\"array\"!=f&&(\"object\"!=f||\"number\"!=typeof a.length))throw new y(me,0,a);if(0<d)for(f=a[0],e=le(f,f,b);c<d;c++)f=a[c],e.V(f.lat,f.lng,b,e);return e}X.coverPoints=me;function ne(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new y(ne,0,a);if(0<d)for(e=new X(a[0],a[1],a[0],a[1]);c<d;c+=3)e.V(a[c],a[c+1],b,e);return e}X.coverLatLngAlts=ne;\nfunction oe(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new y(oe,0,a);if(0<d)for(e=new X(a[0].l,a[0].g,a[0].j,a[0].i);c<d;c++)e.Pa(a[c],b,e);return e}X.coverRects=oe;\nX.prototype.Yb=function(a,b){var c=this.g,d=this.l,e=this.i,f=this.j,g=this.T().lng;fe(a,this.Yb,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?he(b,d,a,f,e):new X(d,a,f,e)};X.prototype.resizeToCenter=X.prototype.Yb;X.prototype.kb=\"Polygon\";\nX.prototype.cc=function(){return[[this.g,this.l,0],[this.i,this.l,0],[this.i,this.j,0],[this.g,this.j,0],[this.g,this.l,0]]};X.prototype.ib=function(){return this.jb()};X.prototype.jb=function(){return[this.l,this.g,this.j,this.i]};function Y(a,b){this.x=+a;this.y=+b}r(\"H.math.Point\",Y);Y.prototype.set=Y;Y.prototype.set=Y.prototype.set;Y.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new Y(this.x,this.y);return a};Y.prototype.clone=Y.prototype.clone;Y.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};Y.prototype.add=Y.prototype.add;Y.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};Y.prototype.sub=Y.prototype.sub;Y.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nY.prototype.scale=Y.prototype.scale;Y.prototype.round=function(){this.x=Zc(this.x);this.y=Zc(this.y);return this};Y.prototype.round=Y.prototype.round;Y.prototype.floor=function(){this.x=$c(this.x);this.y=$c(this.y);return this};Y.prototype.floor=Y.prototype.floor;Y.prototype.ceil=function(){this.x=ad(this.x);this.y=ad(this.y);return this};Y.prototype.ceil=Y.prototype.ceil;Y.prototype.S=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};Y.prototype.equals=Y.prototype.S;\nY.prototype.Kc=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new Y(a.x+e*c,a.y+e*d);return e};Y.prototype.getNearest=Y.prototype.Kc;Y.prototype.eb=function(a){return dd(F(this.x-a.x,2)+F(this.y-a.y,2))};Y.prototype.distance=Y.prototype.eb;Y.fromIPoint=function(a){if(!a)throw Error(\"invalid argument\");return a instanceof Y?a:new Y(a.x,a.y)};function pe(){}function qe(a){return Xc(1,Yc(0,.5-cd(id(nd+md*a/180))/K/2))}pe.prototype.Oa=function(a,b,c){c?(c.x=b/360+.5,c.y=qe(a)):c=new Y(b/360+.5,qe(a));return c};pe.prototype.latLngToPoint=pe.prototype.Oa;pe.prototype.Ac=function(a,b){return this.Oa(a.lat,a.lng,b)};pe.prototype.geoToPoint=pe.prototype.Ac;function re(a){return 0>=a?90:1<=a?-90:rd*(2*jd(ed(K*(1-2*a)))-md)}\npe.prototype.ka=function(a,b,c){c?(c.lat=re(b),c.lng=360*(1===a?1:td(a,1))-180):c=new U(re(b),360*(1===a?1:td(a,1))-180);return c};pe.prototype.xyToGeo=pe.prototype.ka;pe.prototype.ed=function(a,b){return this.ka(a.x,a.y,b)};pe.prototype.pointToGeo=pe.prototype.ed;var se=new pe;r(\"H.geo.mercator\",se);r(\"H.util.constants.DEFAULT_MIN_ZOOM_LEVEL\",0);r(\"H.util.constants.DEFAULT_MAX_ZOOM_LEVEL\",22);function Z(a,b){this.projection=a||se;this.ec=0;this.Da=this.exp=cd(b||256)/ld;te(this);this.y=this.x=0}r(\"H.geo.PixelProjection\",Z);var ue=bd(24)+bd(-8);Z.prototype.hd=se;Z.prototype.projection=Z.prototype.hd;Z.prototype.x=0;Z.prototype.x=Z.prototype.x;Z.prototype.y=0;Z.prototype.y=Z.prototype.y;Z.prototype.w=F(2,ue);Z.prototype.w=Z.prototype.w;Z.prototype.Rc=F(2,ue);Z.prototype.h=Z.prototype.Rc;\nZ.prototype.Aa=function(a){if($a(a))throw new y(this.Aa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.ec=a;this.Da=this.exp+a;te(this);this.x=b*this.w;this.y=c*this.h};Z.prototype.rescale=Z.prototype.Aa;function te(a){a.Da>ue&&(a.Da=ue);a.w=F(2,a.Da);a.h=F(2,a.Da)}Z.prototype.Ob=function(){return this.ec||0};Z.prototype.getZoomScale=Z.prototype.Ob;Z.prototype.zc=function(a,b){a=this.projection.Oa(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Z.prototype.geoToPixel=Z.prototype.zc;\nZ.prototype.xb=function(a,b){return this.projection.ka((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};Z.prototype.pixelToGeo=Z.prototype.xb;Z.prototype.ka=function(a,b,c){return this.projection.ka((a+this.x)/this.w,(b+this.y)/this.h,c)};Z.prototype.xyToGeo=Z.prototype.ka;Z.prototype.sb=function(a,b,c){a=this.projection.Oa(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Z.prototype.latLngToPixel=Z.prototype.sb;Z.prototype.fd=function(a){return new Y(a.x*this.w-this.x,a.y*this.h-this.y)};\nZ.prototype.pointToPixel=Z.prototype.fd;function ve(a,b,c,d){this.key=\"\";this.x=a;this.y=b;this.Sb=c;this.ra=d;this.O=Fc()}ve.prototype.then=function(a,b,c){return this.O.promise.then(a,b,c)};ve.prototype.resolve=function(a){this.O.resolve(a)};ve.prototype.reject=function(a){this.O.reject(a)};ve.prototype.cancel=function(){this.O.promise.cancel()};ve.prototype.cancel=ve.prototype.cancel;function we(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var I=0;for(m=1;m<u;m++)if(n=xe(q[m-1],q[m],c,b,d,e)){var M=n[0];var w=n[1];I&&I.S(M)?h.push(w):g.push(h=n);I=w;f&&(m=u,k=0)}}else g=a;return g}r(\"H.math.clipping.clipStrips\",we);\nfunction xe(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new Y(h,-b),new Y(g,-a)]:[new Y(g,-a),new Y(h,-b)]}\nfunction ye(a,b,c){a=ze(a,!0);b=ze(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.ma=new Ae(b.x,b.y,null,Be(b));a.ma=new Ae(a.x,a.y,null,Be(a));for(g=b;g.next;g=g.next)if(!g.F)for(d=a;d.next;d=d.next)if(!d.F){var k=Ce(g.next);var m=Ce(d.next);if(e=De(g,k,d,m,f)){e=f.ic;var n=f.jc;var q=f.wd;var u=f.xd;e=new Ae(q,u,null,null,null,null,!0,0,0,e);Ee(e,g,k);k=new Ae(q,u,null,null,null,null,!0,0,0,n);Ee(k,d,m);e.vb=k;\nk.vb=e}}f=yd(b,Fe(a));c&&(f=!f);for(g=b;g;g=g.next)g.F&&(g.qb=f,f=!f);f=yd(a,Fe(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.F&&(d.qb=f,f=!f);Ge(b);for(Ge(a);(a=He(b))!=b;){for(c=null;!a.Wa;a=a.vb){for(f=a.qb;;){c=new Ae(a.x,a.y,c);c.artificial=a.F||a.Rb;a.Wa=1;a=f?a.next:a.B;if(!a)break;if(a.F){a.Wa=1;break}}if(!a)break}c.Vb=I||null;var I=c}return I}}r(\"H.math.clipping.clipPolygon\",ye);\nfunction Ae(a,b,c,d,e,f,g,h,k,m){this.x=a;this.y=b;this.next=c||null;this.B=d||null;this.Vb=e||null;this.vb=f||null;this.F=!!g;this.qb=!!h;this.Wa=k||0;this.alpha=m||0;d&&(d.next=this);c&&(c.B=this);this.Rb=!1;this.ma=null}function Ce(a){for(;a&&a.F;)a=a.next;return a}function Be(a){if(a)for(;a.next;)a=a.next;return a}function He(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.F||b.F&&b.Wa))}return b}function Ge(a){var b=Be(a);b.B.next=a;a.B=b.B}\nfunction De(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.ma&&(f.ma.x=f.x,f.ma.y=f.y),De(a,b,c,d,e);e.wd=a.x+k*g;e.xd=a.y+k*h;e.ic=k;e.jc=n;return 1}function Fe(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}\nfunction Ee(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.B=b.B;a.next.B=a;a.B.next=a}function ze(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new Ae(a[e].x,a[e].y,d);c.Rb=b;if(c.next=d)d.B=c;d=c}return d};function Ie(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var I=Na.Float32Array;var M,w=[];if(b){b=Sa(b);a=Sa(a);e&&(f=Sa(c));c=b.length;d=d?1E-7:1E-5;for(M=new I(3*c);g<c;){I=b[g];var G=+I;var W=+a[g];e&&(q=+f[g]);Je.test(I)?0<=u&&(0<g-u&&w.push(u,g+1),u=-1):0>u&&(u=g);g++;m=M[h++]=m+W*d;k=M[h++]=k+G*d;e&&(n=M[h]=n+q);h++}0<=u&&1<c-u&&w.push(u,c)}else M=new I(0);return{path:M,outlineIndices:w}}var Je=/^-?0\\d/;\nfunction Ke(a,b){for(var c=0,d=a.length/3,e=new Na.Array(d),f=0;c<d;)e[c++]=b.sb(a[f],a[++f]),f+=2;return e};function Le(a,b){var c=a.tileSize||256;this.va={};this.$b=Kd(a.serverUrl);this.Ib=b;this.Zc=a.layerConfigs||[];this.Xb=a.projected;this.bc=c;this.lc=!1!==a.batchTiles;this.Tc=a.horizontalMargin||0;this.ad=a.onlyOutline;this.jd=new Z(x,c);this.tb=new Z(x,c);this.tb.Aa(22-Math.log(c)/Math.LN2+8)}Fa(Le,B);\nLe.prototype.ld=function(a,b,c){var d=this.bc,e=this.Tc,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.jd;e.Aa(c);f=e.xb(f);d=e.xb(d);return Me(this,new X(f.lat,f.lng,d.lat,d.lng),this.Zc,{x:a,y:b,z:c})};Le.prototype.kd=function(a,b,c,d,e){return Me(this,new X(a,b,c,d),e)};\nfunction Me(a,b,c,d){var e=Ne(c),f=e.length,g={},h,k=a.va,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var I=q.level;g[u]=q.columns;q=rb(b,I);var M=q.length-1;for(h=0;h<M;h+=2){var w=[u,q[h+1],q[h],I].join(\"_\");var G=k[w]||a.Ib.get(w);G||(G=new ve(q[h+1],q[h],I,u),G.key=w,k[w]=G,n.push(G));m.push(G)}}n.length&&(a.lc?Oe(a,n):Pe(a,n));return Ec(m.map(function(W){var ia=Oa(this.xc,this,g[W.ra]),N=Oa(this.gd,this,W,d||Qe),Ea=W.then,va=this.wc,wa=W.ra,xa={},v,R=e.length;for(v=0;v<R;v++){var J=\ne[v];if(J.rowFilter){var V=J.layerId;V=V!==x?V:J.layer;xa[V]=Oa(J.rowFilter,J.rowFilterContext)}}return Ea.call(W,Oa(va,this,wa,xa)).then(N).then(ia)},a))}var Qe={x:0,y:0,z:0};Le.prototype.wc=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new Q(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.Ja(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};\nfunction Pe(a,b){function c(k,m,n){n?(delete a.va[k.key],k.reject(n)):Re(a,k,m)}var d,e=b.length,f=a.$b;for(d=0;d<e;d++){var g=b[d];var h=f.clone().ga({tilex:g.x}).ga({tiley:g.y}).ga({level:g.Sb}).ga({layer:g.ra});new Xd(h.toString(),Oa(c,null,g),be)}}function Oe(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);Se(a,e)}}\nfunction Se(a,b){var c=a.$b.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.Sb);f.push(h.ra)}),g.tilexy=d.join(\",\"),g.layers=f.join(\",\"),g.levels=e.join(\",\"),c.Ta(g),new Xd(c.toString(),function(h,k){k?b.forEach(function(m){delete a.va[m.key];m.reject(\"error\")}):Re(a,b,h)},be))}\nfunction Re(a,b,c){var d=b.length,e;if(Wa(b,void 0,void 0,void 0)){var f=c.indexOf(\"[\")+1;for(e=0;e<d;e++){var g=c.indexOf(\"]},{\",f+3)+2;g<f&&(g=c.lastIndexOf(\"]}\"));var h=c.substr(f,g-f);f=g+1;Te(a,b[e],h)}}else Te(a,b,c)}function Te(a,b,c){try{var d=c.length;var e=b.key;delete a.va[e];a.Ib.add(e,b,2*d);b.resolve(JSON.parse(c))}catch(f){b.reject(f.message)}}function Ue(a,b,c,d,e){return e?[new Y(a,b),new Y(c,b),new Y(c,d),new Y(a,d),new Y(a,b)]:[a,b,c,b,c,d,a,d]}\nLe.prototype.gd=function(a,b,c){var d=this.tb.Ob()-b.z,e=this.bc<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,I=c.Rows,M=I.length,w,G=/^ADAS/.test(a.ra),W=this.tb,ia=this.ad,N,Ea=[],va=[],wa=[],xa=[];for(a=0;a<M;a++){var v=w=I[a];var R=(N=G)?\"HPY\":\"LAT\";var J=N?\"HPX\":\"LON\";var V=N?\"HPZ\":\"ZLEVEL\";if(v[R]){var P=Ie(v[R],v[J],v[V],N);v.geometry=P;delete v[R];delete v[J];delete v[V];if(v.INNER_LAT)for(R=v.INNER_LAT.split(\";\"),P=v.INNER_LON.split(\";\"),delete v.INNER_LAT,\ndelete v.INNER_LON,v.interiors=V=[],J=R.length,v=0;v<J;v++)V.push(Ie(R[v],P[v],\"\",N))}if(this.Xb){J=w;v=W;P=J.$$projected$$;R=0;if(!P){var aa=J.geometry;N=Ke(aa.path,v);w=[N];J.$$projected$$=P={dd:w};J=(V=J.interiors)?V.length:0;w.length+=J;R|=+Ve(w,N,aa.outlineIndices);if(J)for(P.Uc=1,q=0;q<J;q++)aa=V[q],N=Ke(aa.path,v),w[1+q]=N,R|=+Ve(w,N,aa.outlineIndices);R&&(P.bd=1+J)}v=P;N=v.dd;w=v.Uc;var kc=v.bd;P=[];R=J=sd;var Za=V=x;v=N[0];if(1===v.length){var lc=lc||(lc=Ue(g,b,h,e,!1));w=v[0];xd(w.x,w.y,\nlc)&&P.push(We(v,g,b,d))}else{var Wd=N.length;for(aa=ia?kc:0;aa<Wd&&(ia||!aa||P.length);aa++)if(v=N[aa],aa>=kc){aa===kc&&(R=P.length);var ja=we([v],k,m,n,f,!1);Xe(ja,g,b,d,P)}else{var Bb=Bb||(Bb=Ue(k,m,n,f,!0));if(aa>=w)if(aa===w&&(J=P.length),Za)for(q=Za.length;q--;){if(ja=Ye(Za[q],v),u=ja.length){for(V=V||[];u--;)V.push(q);Xe(ja,g,b,d,P)}}else ja=Ye(Bb,v),Xe(ja,g,b,d,P);else if(ja=Ye(Bb,v),Xe(ja,g,b,d,P),1<ja.length&&w<Wd)for(Za=[],q=ja.length;q--;)Za[q]=ja[q]}}P.length&&(Ea[a]=P,va[a]=J,wa[a]=\nV,xa[a]=R)}}return{rd:c,pc:Ea,Vc:va,vc:wa,cd:xa}};function Ve(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function Ye(a,b){var c,d=[];if(c=ye(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Vb)}else yd(b[0],zd(a))?d.push(b):yd(a[0],zd(b))&&d.push(a);return d}function Xe(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(We(a[f],b,c,d))}\nfunction We(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nLe.prototype.xc=function(a,b){var c=b.rd,d=b.pc,e=b.Vc,f=b.cd;b=b.vc;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,I=c.Rows,M=I.length,w;q<M;q+=1)if(d[q]||!this.Xb){h={};u=I[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(w in u)\"$$projected$$\"!==w&&(h[w]=u[w]);u.geometry&&(h.geometry=u.geometry);m=void 0;var G,W=h,ia=d[q],N=e[q],Ea=b[q],va=f[q],wa=g;if(ia){var xa=ia.length;if(Ea)for(G=N;G--;){if(G){var v={};for(m in W)v[m]=W[m]}else v=W;u=[ia[G]];var R=Xc(xa,va)-N;for(h=\n0;h<R;h++)Ea[h]===G&&u.push(ia[N+h]);R=u.length;if(!G)for(h=va;h<xa;h++)u.push(ia[h]);v.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:R};wa.push(v)}else W.$HProjGeometry={paths:ia,interiorsIndex:N,outlinesIndex:va},wa.push(W)}else wa.push(W)}c.Meta&&(k.Meta=c.Meta);return k};Le.prototype.K=function(){var a,b=this.va;for(a in b)b.hasOwnProperty(a)&&(b[a].reject(\"disposed\"),delete b[a])};Le.prototype.disposeInternal=Le.prototype.K;\nfunction Ne(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=Ia(a[e]);if(c.rowFilter&&(c.rowFilter=eval(\"(\"+c.rowFilter+\")\"),!Va(c.rowFilter)))throw Error(\"Invalid row filter for layer \"+c.layerId);b.push(c)}return b};r(\"H.service.extension.worker.processor\",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=Ha[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(Ha[a]=new Le(c,Ze)),this.postMessage(void 0);else if(f)switch(b){case 1:try{f.ld.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.kd.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.C();delete Ha[a];Ga()&&Ze.ia();break;default:e.postError(\"Unsupported command\")}});\nvar Ze=new z(26214400),Ha=Object.create(Ra,void 0);function $e(a,b,c){var d=a[b];a=a[b+1];this.Pb=[];this.Eb=0;this.oc=b;this.mc=[a-c,d-c,a+c,d+c]}$e.prototype.Ia=function(a,b){var c=a[b];a=a[b+1];b=this.mc;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};$e.prototype.T=function(){return this.oc};var af=new Y(0,0);function bf(a,b,c,d,e){d[e]=b;d[e+1]=a}var cf=new Z;function df(a,b,c,d,e){cf.sb(a,b,af);d[e]=af.x;d[e+1]=af.y}\nr(\"H.clustering.dynamicgrid.worker\",function(a,b,c,d,e){var f=e?bf:df,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(cf.Aa(d);g<h.length;){var I=h[g++];var M=h[g++];var w=h[g++];f(w,M,d,q,u);for(w=a.length;w--;)if(M=a[w],M.Ia(q,u)){var G=M;break}G||(G=new $e(q,u,b),a.push(G));w=u/2;G.Eb+=I||1;G.Pb.push(w);G=null;u+=2}for(w=a.length;w--;)M=a[w],b=M.Eb>=c,f=M.Pb,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,n=n.concat(f));c=[k].concat(n).concat(m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener(\"message\",function(a){a=new Vd(a.data);var b=Rd[a.Wb];if(b)try{b.apply(a,a.kc)}catch(c){a.postError(c.message)}else a.postError(\"processor_not_found\")});(function(){var a=new Vd;var b=function(c,d){Ud.apply(a,[c,d,!0])};b(\"0\",Sd);b(\"1\",Ud);b(\"2\",Td);b(\"3\",ae)})();\n";
(function(){var f=function(){var target=("undefined"==typeof self||!("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope))&&("undefined"!=typeof module&&module.exports||"undefined"!=typeof window);if(target)var __worker_src__=f.toString(),__worker_src_map__="",__worker_src_origin__="undefined"!=typeof document&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:"";(function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})})),r}var toString$2={}.toString,classofRaw$1=function(e){return toString$2.call(e).slice(8,-1)},shared$1={exports:{}},O="object",check=function(e){return e&&e.Math==Math&&e},global$c=check(typeof globalThis==O&&globalThis)||check(typeof window==O&&window)||check(typeof self==O&&self)||check(typeof commonjsGlobal==O&&commonjsGlobal)||Function("return this")(),objectDefineProperty={},fails$3=function(e){try{return!!e()}catch(e){return!0}},descriptors=!fails$3((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),isObject$9=function(e){return"object"==typeof e?null!==e:"function"==typeof e},isObject$8=isObject$9,document$3=global$c.document,exist=isObject$8(document$3)&&isObject$8(document$3.createElement),documentCreateElement$1=function(e){return exist?document$3.createElement(e):{}},ie8DomDefine=!descriptors&&!fails$3((function(){return 7!=Object.defineProperty(documentCreateElement$1("div"),"a",{get:function(){return 7}}).a})),isObject$7=isObject$9,anObject$9=function(e){if(!isObject$7(e))throw TypeError(String(e)+" is not an object");return e},isObject$6=isObject$9,toPrimitive$2=function(e,t){if(!isObject$6(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!isObject$6(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!isObject$6(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!isObject$6(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},DESCRIPTORS$2=descriptors,IE8_DOM_DEFINE$1=ie8DomDefine,anObject$8=anObject$9,toPrimitive$1=toPrimitive$2,nativeDefineProperty=Object.defineProperty;objectDefineProperty.f=DESCRIPTORS$2?nativeDefineProperty:function(e,t,r){if(anObject$8(e),t=toPrimitive$1(t,!0),anObject$8(r),IE8_DOM_DEFINE$1)try{return nativeDefineProperty(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var createPropertyDescriptor$3=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},definePropertyModule$2=objectDefineProperty,createPropertyDescriptor$2=createPropertyDescriptor$3,hide$7=descriptors?function(e,t,r){return definePropertyModule$2.f(e,t,createPropertyDescriptor$2(1,r))}:function(e,t,r){return e[t]=r,e},global$b=global$c,hide$6=hide$7,setGlobal$2=function(e,t){try{hide$6(global$b,e,t)}catch(r){global$b[e]=t}return t},isPure=!1,global$a=global$c,setGlobal$1=setGlobal$2,SHARED="__core-js_shared__",store$2=global$a[SHARED]||setGlobal$1(SHARED,{});(shared$1.exports=function(e,t){return store$2[e]||(store$2[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.1.0",mode:"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"});var sharedExports=shared$1.exports,id$2=0,postfix=Math.random(),uid$2=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++id$2+postfix).toString(36))},nativeSymbol=!fails$3((function(){return!String(Symbol())})),store$1=sharedExports("wks"),uid$1=uid$2,Symbol$1=global$c.Symbol,NATIVE_SYMBOL=nativeSymbol,wellKnownSymbol$1=function(e){return store$1[e]||(store$1[e]=NATIVE_SYMBOL&&Symbol$1[e]||(NATIVE_SYMBOL?Symbol$1:uid$1)("Symbol."+e))},classofRaw=classofRaw$1,TO_STRING_TAG$2=wellKnownSymbol$1("toStringTag"),CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}},classof$6=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet(t=Object(e),TO_STRING_TAG$2))?r:CORRECT_ARGUMENTS?classofRaw(t):"Object"==(i=classofRaw(t))&&"function"==typeof t.callee?"Arguments":i},classof$5=classof$6,TO_STRING_TAG$1=wellKnownSymbol$1("toStringTag"),test={};test[TO_STRING_TAG$1]="z";var objectToString$1="[object z]"!==String(test)?function(){return"[object "+classof$5(this)+"]"}:test.toString,redefine$2={exports:{}},hasOwnProperty$1={}.hasOwnProperty,has$6=function(e,t){return hasOwnProperty$1.call(e,t)},functionToString,hasRequiredFunctionToString;function requireFunctionToString(){return hasRequiredFunctionToString?functionToString:(hasRequiredFunctionToString=1,functionToString=sharedExports("native-function-to-string",Function.toString))}var nativeFunctionToString=requireFunctionToString(),WeakMap$1=global$c.WeakMap,nativeWeakMap="function"==typeof WeakMap$1&&/native code/.test(nativeFunctionToString.call(WeakMap$1)),shared=sharedExports("keys"),uid=uid$2,sharedKey$1=function(e){return shared[e]||(shared[e]=uid(e))},hiddenKeys$3={},NATIVE_WEAK_MAP=nativeWeakMap,isObject$5=isObject$9,hide$5=hide$7,objectHas=has$6,sharedKey=sharedKey$1,hiddenKeys$2=hiddenKeys$3,WeakMap=global$c.WeakMap,set$2,get,has$5,enforce=function(e){return has$5(e)?get(e):set$2(e,{})},getterFor=function(e){return function(t){var r;if(!isObject$5(t)||(r=get(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}};if(NATIVE_WEAK_MAP){var store=new WeakMap,wmget=store.get,wmhas=store.has,wmset=store.set;set$2=function(e,t){return wmset.call(store,e,t),t},get=function(e){return wmget.call(store,e)||{}},has$5=function(e){return wmhas.call(store,e)}}else{var STATE=sharedKey("state");hiddenKeys$2[STATE]=!0,set$2=function(e,t){return hide$5(e,STATE,t),t},get=function(e){return objectHas(e,STATE)?e[STATE]:{}},has$5=function(e){return objectHas(e,STATE)}}var internalState={set:set$2,get:get,has:has$5,enforce:enforce,getterFor:getterFor},hasRequiredRedefine;function requireRedefine(){if(hasRequiredRedefine)return redefine$2.exports;hasRequiredRedefine=1;var e=global$c,t=hide$7,r=has$6,i=setGlobal$2,n=requireFunctionToString(),o=internalState,a=o.get,s=o.enforce,l=String(n).split("toString");return sharedExports("inspectSource",(function(e){return n.call(e)})),(redefine$2.exports=function(n,o,a,u){var c=!!u&&!!u.unsafe,h=!!u&&!!u.enumerable,f=!!u&&!!u.noTargetGet;"function"==typeof a&&("string"!=typeof o||r(a,"name")||t(a,"name",o),s(a).source=l.join("string"==typeof o?o:"")),n!==e?(c?!f&&n[o]&&(h=!0):delete n[o],h?n[o]=a:t(n,o,a)):h?n[o]=a:i(o,a)})(Function.prototype,"toString",(function(){return"function"==typeof this&&a(this).source||n.call(this)})),redefine$2.exports}var toString$1=objectToString$1,ObjectPrototype$1=Object.prototype;toString$1!==ObjectPrototype$1.toString&&requireRedefine()(ObjectPrototype$1,"toString",toString$1,{unsafe:!0});var ceil=Math.ceil,floor=Math.floor,toInteger$3=function(e){return isNaN(e=+e)?0:(e>0?floor:ceil)(e)},requireObjectCoercible$3=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},toInteger$2=toInteger$3,requireObjectCoercible$2=requireObjectCoercible$3,stringAt=function(e,t,r){var i,n,o=String(requireObjectCoercible$2(e)),a=toInteger$2(t),s=o.length;return a<0||a>=s?r?"":void 0:(i=o.charCodeAt(a))<55296||i>56319||a+1===s||(n=o.charCodeAt(a+1))<56320||n>57343?r?o.charAt(a):i:r?o.slice(a,a+2):n-56320+(i-55296<<10)+65536},objectGetOwnPropertyDescriptor={},objectPropertyIsEnumerable={},nativePropertyIsEnumerable={}.propertyIsEnumerable,nativeGetOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,NASHORN_BUG=nativeGetOwnPropertyDescriptor$1&&!nativePropertyIsEnumerable.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(e){var t=nativeGetOwnPropertyDescriptor$1(this,e);return!!t&&t.enumerable}:nativePropertyIsEnumerable;var fails$2=fails$3,classof$4=classofRaw$1,split="".split,indexedObject=fails$2((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==classof$4(e)?split.call(e,""):Object(e)}:Object,IndexedObject=indexedObject,requireObjectCoercible$1=requireObjectCoercible$3,toIndexedObject$4=function(e){return IndexedObject(requireObjectCoercible$1(e))},DESCRIPTORS$1=descriptors,propertyIsEnumerableModule=objectPropertyIsEnumerable,createPropertyDescriptor$1=createPropertyDescriptor$3,toIndexedObject$3=toIndexedObject$4,toPrimitive=toPrimitive$2,has$4=has$6,IE8_DOM_DEFINE=ie8DomDefine,nativeGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$1?nativeGetOwnPropertyDescriptor:function(e,t){if(e=toIndexedObject$3(e),t=toPrimitive(t,!0),IE8_DOM_DEFINE)try{return nativeGetOwnPropertyDescriptor(e,t)}catch(e){}if(has$4(e,t))return createPropertyDescriptor$1(!propertyIsEnumerableModule.f.call(e,t),e[t])};var objectGetOwnPropertyNames={},toInteger$1=toInteger$3,min$1=Math.min,toLength$2=function(e){return e>0?min$1(toInteger$1(e),9007199254740991):0},toInteger=toInteger$3,max=Math.max,min=Math.min,toAbsoluteIndex$1=function(e,t){var r=toInteger(e);return r<0?max(r+t,0):min(r,t)},toIndexedObject$2=toIndexedObject$4,toLength$1=toLength$2,toAbsoluteIndex=toAbsoluteIndex$1,arrayIncludes=function(e){return function(t,r,i){var n,o=toIndexedObject$2(t),a=toLength$1(o.length),s=toAbsoluteIndex(i,a);if(e&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},has$3=has$6,toIndexedObject$1=toIndexedObject$4,arrayIndexOf$1=arrayIncludes(!1),hiddenKeys$1=hiddenKeys$3,objectKeysInternal=function(e,t){var r,i=toIndexedObject$1(e),n=0,o=[];for(r in i)!has$3(hiddenKeys$1,r)&&has$3(i,r)&&o.push(r);for(;t.length>n;)has$3(i,r=t[n++])&&(~arrayIndexOf$1(o,r)||o.push(r));return o},enumBugKeys$2=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$1=objectKeysInternal,hiddenKeys=enumBugKeys$2.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys$1(e,hiddenKeys)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,anObject$7=anObject$9,Reflect$1=global$c.Reflect,ownKeys$1=Reflect$1&&Reflect$1.ownKeys||function(e){var t=getOwnPropertyNamesModule.f(anObject$7(e)),r=getOwnPropertySymbolsModule.f;return r?t.concat(r(e)):t},has$2=has$6,ownKeys=ownKeys$1,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,definePropertyModule$1=objectDefineProperty,copyConstructorProperties$1=function(e,t){for(var r=ownKeys(t),i=definePropertyModule$1.f,n=getOwnPropertyDescriptorModule.f,o=0;o<r.length;o++){var a=r[o];has$2(e,a)||i(e,a,n(t,a))}},fails$1=fails$3,replacement=/#|\.prototype\./,isForced$2=function(e,t){var r=data[normalize$1(e)];return r==POLYFILL||r!=NATIVE&&("function"==typeof t?fails$1(t):!!t)},normalize$1=isForced$2.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced$2.data={},NATIVE=isForced$2.NATIVE="N",POLYFILL=isForced$2.POLYFILL="P",isForced_1=isForced$2,global$9=global$c,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,hide$4=hide$7,redefine$1=requireRedefine(),setGlobal=setGlobal$2,copyConstructorProperties=copyConstructorProperties$1,isForced$1=isForced_1,_export=function(e,t){var r,i,n,o,a,s=e.target,l=e.global,u=e.stat;if(r=l?global$9:u?global$9[s]||setGlobal(s,{}):(global$9[s]||{}).prototype)for(i in t){if(o=t[i],n=e.noTargetGet?(a=getOwnPropertyDescriptor$1(r,i))&&a.value:r[i],!isForced$1(l?i:s+(u?".":"#")+i,e.forced)&&void 0!==n){if(typeof o==typeof n)continue;copyConstructorProperties(o,n)}(e.sham||n&&n.sham)&&hide$4(o,"sham",!0),redefine$1(r,i,o,e)}},requireObjectCoercible=requireObjectCoercible$3,toObject$1=function(e){return Object(requireObjectCoercible(e))},correctPrototypeGetter=!fails$3((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),has$1=has$6,toObject=toObject$1,IE_PROTO$1=sharedKey$1("IE_PROTO"),CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter,ObjectPrototype=Object.prototype,objectGetPrototypeOf=CORRECT_PROTOTYPE_GETTER?Object.getPrototypeOf:function(e){return e=toObject(e),has$1(e,IE_PROTO$1)?e[IE_PROTO$1]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ObjectPrototype:null},getPrototypeOf$1=objectGetPrototypeOf,hide$3=hide$7,has=has$6,ITERATOR$5=wellKnownSymbol$1("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,returnThis$2=function(){return this},IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf$1(getPrototypeOf$1(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0),null==IteratorPrototype$2&&(IteratorPrototype$2={}),has(IteratorPrototype$2,ITERATOR$5)||hide$3(IteratorPrototype$2,ITERATOR$5,returnThis$2);var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},internalObjectKeys=objectKeysInternal,enumBugKeys$1=enumBugKeys$2,objectKeys$2=Object.keys||function(e){return internalObjectKeys(e,enumBugKeys$1)},DESCRIPTORS=descriptors,definePropertyModule=objectDefineProperty,anObject$6=anObject$9,objectKeys$1=objectKeys$2,objectDefineProperties=DESCRIPTORS?Object.defineProperties:function(e,t){anObject$6(e);for(var r,i=objectKeys$1(t),n=i.length,o=0;n>o;)definePropertyModule.f(e,r=i[o++],t[r]);return e},document$2=global$c.document,html$2=document$2&&document$2.documentElement,anObject$5=anObject$9,defineProperties=objectDefineProperties,enumBugKeys=enumBugKeys$2,html$1=html$2,documentCreateElement=documentCreateElement$1,IE_PROTO=sharedKey$1("IE_PROTO"),PROTOTYPE="prototype",Empty=function(){},createDict=function(){var e,t=documentCreateElement("iframe"),r=enumBugKeys.length,i="script",n="java"+i+":";for(t.style.display="none",html$1.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write("<"+i+">document.F=Object</"+i+">"),e.close(),createDict=e.F;r--;)delete createDict[PROTOTYPE][enumBugKeys[r]];return createDict()},objectCreate=Object.create||function(e,t){var r;return null!==e?(Empty[PROTOTYPE]=anObject$5(e),r=new Empty,Empty[PROTOTYPE]=null,r[IE_PROTO]=e):r=createDict(),void 0===t?r:defineProperties(r,t)},setToStringTag$2,hasRequiredSetToStringTag;function requireSetToStringTag(){if(hasRequiredSetToStringTag)return setToStringTag$2;hasRequiredSetToStringTag=1;var e=objectDefineProperty.f,t=has$6,r=wellKnownSymbol$1("toStringTag");return setToStringTag$2=function(i,n,o){i&&!t(i=o?i:i.prototype,r)&&e(i,r,{configurable:!0,value:n})}}hiddenKeys$3[IE_PROTO]=!0;var iterators={},IteratorPrototype$1=iteratorsCore.IteratorPrototype,create$3=objectCreate,createPropertyDescriptor=createPropertyDescriptor$3,setToStringTag$1=requireSetToStringTag(),Iterators$4=iterators,returnThis$1=function(){return this},createIteratorConstructor$1=function(e,t,r){var i=t+" Iterator";return e.prototype=create$3(IteratorPrototype$1,{next:createPropertyDescriptor(1,r)}),setToStringTag$1(e,i,!1,!0),Iterators$4[i]=returnThis$1,e},isObject$4=isObject$9,anObject$4=anObject$9,validateSetPrototypeOfArguments$1=function(e,t){if(anObject$4(e),!isObject$4(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")},validateSetPrototypeOfArguments=validateSetPrototypeOfArguments$1,objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return validateSetPrototypeOfArguments(r,i),t?e.call(r,i):r.__proto__=i,r}}():void 0),$export$1=_export,createIteratorConstructor=createIteratorConstructor$1,getPrototypeOf=objectGetPrototypeOf,setPrototypeOf=objectSetPrototypeOf,setToStringTag=requireSetToStringTag(),hide$2=hide$7,redefine=requireRedefine(),ITERATOR$4=wellKnownSymbol$1("iterator"),Iterators$3=iterators,IteratorsCore=iteratorsCore,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,KEYS="keys",VALUES="values",ENTRIES="entries",returnThis=function(){return this},defineIterator$2=function(e,t,r,i,n,o,a){createIteratorConstructor(r,t,i);var s,l,u,c=function(e){if(e===n&&p)return p;if(!BUGGY_SAFARI_ITERATORS&&e in d)return d[e];switch(e){case KEYS:case VALUES:case ENTRIES:return function(){return new r(this,e)}}return function(){return new r(this)}},h=t+" Iterator",f=!1,d=e.prototype,_=d[ITERATOR$4]||d["@@iterator"]||n&&d[n],p=!BUGGY_SAFARI_ITERATORS&&_||c(n),g="Array"==t&&d.entries||_;if(g&&(s=getPrototypeOf(g.call(new e)),IteratorPrototype!==Object.prototype&&s.next&&(getPrototypeOf(s)!==IteratorPrototype&&(setPrototypeOf?setPrototypeOf(s,IteratorPrototype):"function"!=typeof s[ITERATOR$4]&&hide$2(s,ITERATOR$4,returnThis)),setToStringTag(s,h,!0,!0))),n==VALUES&&_&&_.name!==VALUES&&(f=!0,p=function(){return _.call(this)}),d[ITERATOR$4]!==p&&hide$2(d,ITERATOR$4,p),Iterators$3[t]=p,n)if(l={values:c(VALUES),keys:o?p:c(KEYS),entries:c(ENTRIES)},a)for(u in l)(BUGGY_SAFARI_ITERATORS||f||!(u in d))&&redefine(d,u,l[u]);else $export$1({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS||f},l);return l},codePointAt$1=stringAt,InternalStateModule$2=internalState,defineIterator$1=defineIterator$2,STRING_ITERATOR="String Iterator",setInternalState$2=InternalStateModule$2.set,getInternalState$2=InternalStateModule$2.getterFor(STRING_ITERATOR);defineIterator$1(String,"String",(function(e){setInternalState$2(this,{type:STRING_ITERATOR,string:String(e),index:0})}),(function(){var e,t=getInternalState$2(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=codePointAt$1(r,i,!0),t.index+=e.length,{value:e,done:!1})}));var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},UNSCOPABLES=wellKnownSymbol$1("unscopables"),create$2=objectCreate,hide$1=hide$7,ArrayPrototype$1=Array.prototype;null==ArrayPrototype$1[UNSCOPABLES]&&hide$1(ArrayPrototype$1,UNSCOPABLES,create$2(null));var addToUnscopables$1=function(e){ArrayPrototype$1[UNSCOPABLES][e]=!0},toIndexedObject=toIndexedObject$4,addToUnscopables=addToUnscopables$1,Iterators$2=iterators,InternalStateModule$1=internalState,defineIterator=defineIterator$2,ARRAY_ITERATOR="Array Iterator",setInternalState$1=InternalStateModule$1.set,getInternalState$1=InternalStateModule$1.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator(Array,"Array",(function(e,t){setInternalState$1(this,{type:ARRAY_ITERATOR,target:toIndexedObject(e),index:0,kind:t})}),(function(){var e=getInternalState$1(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}}),"values");Iterators$2.Arguments=Iterators$2.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries");var DOMIterables=domIterables,ArrayIteratorMethods=es_array_iterator,global$8=global$c,hide=hide$7,wellKnownSymbol=wellKnownSymbol$1,ITERATOR$3=wellKnownSymbol("iterator"),TO_STRING_TAG=wellKnownSymbol("toStringTag"),ArrayValues=ArrayIteratorMethods.values;for(var COLLECTION_NAME in DOMIterables){var Collection=global$8[COLLECTION_NAME],CollectionPrototype=Collection&&Collection.prototype;if(CollectionPrototype){if(CollectionPrototype[ITERATOR$3]!==ArrayValues)try{hide(CollectionPrototype,ITERATOR$3,ArrayValues)}catch(e){CollectionPrototype[ITERATOR$3]=ArrayValues}if(CollectionPrototype[TO_STRING_TAG]||hide(CollectionPrototype,TO_STRING_TAG,COLLECTION_NAME),DOMIterables[COLLECTION_NAME])for(var METHOD_NAME in ArrayIteratorMethods)if(CollectionPrototype[METHOD_NAME]!==ArrayIteratorMethods[METHOD_NAME])try{hide(CollectionPrototype,METHOD_NAME,ArrayIteratorMethods[METHOD_NAME])}catch(e){CollectionPrototype[METHOD_NAME]=ArrayIteratorMethods[METHOD_NAME]}}}var aFunction$5=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},anInstance$1=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e},iterate$1={exports:{}},Iterators$1=iterators,ITERATOR$2=wellKnownSymbol$1("iterator"),ArrayPrototype=Array.prototype,isArrayIteratorMethod$1=function(e){return void 0!==e&&(Iterators$1.Array===e||ArrayPrototype[ITERATOR$2]===e)},aFunction$4=aFunction$5,bindContext=function(e,t,r){if(aFunction$4(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},classof$3=classof$6,ITERATOR$1=wellKnownSymbol$1("iterator"),Iterators=iterators,getIteratorMethod$1=function(e){if(null!=e)return e[ITERATOR$1]||e["@@iterator"]||Iterators[classof$3(e)]},anObject$3=anObject$9,callWithSafeIterationClosing$1=function(e,t,r,i){try{return i?t(anObject$3(r)[0],r[1]):t(r)}catch(t){var n=e.return;throw void 0!==n&&anObject$3(n.call(e)),t}},anObject$2=anObject$9,isArrayIteratorMethod=isArrayIteratorMethod$1,toLength=toLength$2,bind$2=bindContext,getIteratorMethod=getIteratorMethod$1,callWithSafeIterationClosing=callWithSafeIterationClosing$1,BREAK={},exports$1=iterate$1.exports=function(e,t,r,i,n){var o,a,s,l,u,c=bind$2(t,r,i?2:1);if(n)o=e;else{if("function"!=typeof(a=getIteratorMethod(e)))throw TypeError("Target is not iterable");if(isArrayIteratorMethod(a)){for(s=0,l=toLength(e.length);l>s;s++)if((i?c(anObject$2(u=e[s])[0],u[1]):c(e[s]))===BREAK)return BREAK;return}o=a.call(e)}for(;!(u=o.next()).done;)if(callWithSafeIterationClosing(o,c,u.value,i)===BREAK)return BREAK};exports$1.BREAK=BREAK;var iterateExports=iterate$1.exports,ITERATOR=wellKnownSymbol$1("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(e){}var checkCorrectnessOfIteration$1=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var r=!1;try{var i={};i[ITERATOR]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(e){}return r},anObject$1=anObject$9,aFunction$3=aFunction$5,SPECIES$1=wellKnownSymbol$1("species"),speciesConstructor$2=function(e,t){var r,i=anObject$1(e).constructor;return void 0===i||null==(r=anObject$1(i)[SPECIES$1])?t:aFunction$3(r)},global$7=global$c,fails=fails$3,classof$2=classofRaw$1,bind$1=bindContext,html=html$2,createElement=documentCreateElement$1,location=global$7.location,set$1=global$7.setImmediate,clear=global$7.clearImmediate,process$2=global$7.process,MessageChannel=global$7.MessageChannel,Dispatch=global$7.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port,run=function(e){if(queue.hasOwnProperty(e)){var t=queue[e];delete queue[e],t()}},runner=function(e){return function(){run(e)}},listener=function(e){run(e.data)},post=function(e){global$7.postMessage(e+"",location.protocol+"//"+location.host)};set$1&&clear||(set$1=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return queue[++counter]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},defer(counter),counter},clear=function(e){delete queue[e]},"process"==classof$2(process$2)?defer=function(e){process$2.nextTick(runner(e))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(runner(e))}:MessageChannel?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=bind$1(port.postMessage,port,1)):!global$7.addEventListener||"function"!=typeof postMessage||global$7.importScripts||fails(post)?defer=ONREADYSTATECHANGE in createElement("script")?function(e){html.appendChild(createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(e)}}:function(e){setTimeout(runner(e),0)}:(defer=post,global$7.addEventListener("message",listener,!1)));var task$1={set:set$1,clear:clear},global$6=global$c,navigator$1=global$6.navigator,userAgent$2=navigator$1&&navigator$1.userAgent||"",global$5=global$c,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,classof$1=classofRaw$1,macrotask=task$1.set,userAgent$1=userAgent$2,MutationObserver=global$5.MutationObserver||global$5.WebKitMutationObserver,process$1=global$5.process,Promise$1=global$5.Promise,IS_NODE$1="process"==classof$1(process$1),queueMicrotaskDescriptor=getOwnPropertyDescriptor(global$5,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify$1,toggle,node,promise;queueMicrotask||(flush=function(){var e,t;for(IS_NODE$1&&(e=process$1.domain)&&e.exit();head;){t=head.fn,head=head.next;try{t()}catch(e){throw head?notify$1():last=void 0,e}}last=void 0,e&&e.enter()},IS_NODE$1?notify$1=function(){process$1.nextTick(flush)}:MutationObserver&&!/(iphone|ipod|ipad).*applewebkit/i.test(userAgent$1)?(toggle=!0,node=document.createTextNode(""),new MutationObserver(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}):Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),notify$1=function(){promise.then(flush)}):notify$1=function(){macrotask.call(global$5,flush)});var microtask$1=queueMicrotask||function(e){var t={fn:e,next:void 0};last&&(last.next=t),head||(head=t,notify$1()),last=t},newPromiseCapability$2={},aFunction$2=aFunction$5,PromiseCapability=function(e){var t,r;this.promise=new e((function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i})),this.resolve=aFunction$2(t),this.reject=aFunction$2(r)};newPromiseCapability$2.f=function(e){return new PromiseCapability(e)};var anObject=anObject$9,isObject$3=isObject$9,newPromiseCapability$1=newPromiseCapability$2,promiseResolve$2=function(e,t){if(anObject(e),isObject$3(t)&&t.constructor===e)return t;var r=newPromiseCapability$1.f(e);return(0,r.resolve)(t),r.promise},global$4=global$c,hostReportErrors$1=function(e,t){var r=global$4.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))},perform$1=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},redefineAll,hasRequiredRedefineAll;function requireRedefineAll(){if(hasRequiredRedefineAll)return redefineAll;hasRequiredRedefineAll=1;var e=requireRedefine();return redefineAll=function(t,r,i){for(var n in r)e(t,n,r[n],i);return t},redefineAll}var path$1=global$c,path=path$1,global$3=global$c,aFunction$1=function(e){return"function"==typeof e?e:void 0},getBuiltIn$1=function(e,t){return arguments.length<2?aFunction$1(path[e])||aFunction$1(global$3[e]):path[e]&&path[e][t]||global$3[e]&&global$3[e][t]},setSpecies,hasRequiredSetSpecies;function requireSetSpecies(){if(hasRequiredSetSpecies)return setSpecies;hasRequiredSetSpecies=1;var e=getBuiltIn$1,t=objectDefineProperty,r=descriptors,i=wellKnownSymbol$1("species");return setSpecies=function(n){var o=e(n),a=t.f;r&&o&&!o[i]&&a(o,i,{configurable:!0,get:function(){return this}})}}var PROMISE="Promise",IS_PURE=isPure,global$2=global$c,$export=_export,isObject$2=isObject$9,aFunction=aFunction$5,anInstance=anInstance$1,classof=classofRaw$1,iterate=iterateExports,checkCorrectnessOfIteration=checkCorrectnessOfIteration$1,speciesConstructor$1=speciesConstructor$2,task=task$1.set,microtask=microtask$1,promiseResolve$1=promiseResolve$2,hostReportErrors=hostReportErrors$1,newPromiseCapabilityModule=newPromiseCapability$2,perform=perform$1,userAgent=userAgent$2,SPECIES=wellKnownSymbol$1("species"),InternalStateModule=internalState,isForced=isForced_1,getInternalState=InternalStateModule.get,setInternalState=InternalStateModule.set,getInternalPromiseState=InternalStateModule.getterFor(PROMISE),PromiseConstructor=global$2[PROMISE],TypeError$1=global$2.TypeError,document$1=global$2.document,process=global$2.process,$fetch=global$2.fetch,versions=process&&process.versions,v8=versions&&versions.v8||"",newPromiseCapability=newPromiseCapabilityModule.f,newGenericPromiseCapability=newPromiseCapability,IS_NODE="process"==classof(process),DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$2.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,FORCED=isForced(PROMISE,(function(){var e=PromiseConstructor.resolve(1),t=function(){},r=(e.constructor={})[SPECIES]=function(e){e(t,t)};return!((IS_NODE||"function"==typeof PromiseRejectionEvent)&&!IS_PURE&&e.then(t)instanceof r&&0!==v8.indexOf("6.6")&&-1===userAgent.indexOf("Chrome/66"))})),INCORRECT_ITERATION=FORCED||!checkCorrectnessOfIteration((function(e){PromiseConstructor.all(e).catch((function(){}))})),isThenable=function(e){var t;return!(!isObject$2(e)||"function"!=typeof(t=e.then))&&t},notify=function(e,t,r){if(!t.notified){t.notified=!0;var i=t.reactions;microtask((function(){for(var n=t.value,o=t.state==FULFILLED,a=0,s=function(r){var i,a,s,l=o?r.ok:r.fail,u=r.resolve,c=r.reject,h=r.domain;try{l?(o||(t.rejection===UNHANDLED&&onHandleUnhandled(e,t),t.rejection=HANDLED),!0===l?i=n:(h&&h.enter(),i=l(n),h&&(h.exit(),s=!0)),i===r.promise?c(TypeError$1("Promise-chain cycle")):(a=isThenable(i))?a.call(i,u,c):u(i)):c(n)}catch(e){h&&!s&&h.exit(),c(e)}};i.length>a;)s(i[a++]);t.reactions=[],t.notified=!1,r&&!t.rejection&&onUnhandled(e,t)}))}},dispatchEvent=function(e,t,r){var i,n;DISPATCH_EVENT?((i=document$1.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),global$2.dispatchEvent(i)):i={promise:t,reason:r},(n=global$2["on"+e])?n(i):e===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",r)},onUnhandled=function(e,t){task.call(global$2,(function(){var r,i=t.value;if(isUnhandled(t)&&(r=perform((function(){IS_NODE?process.emit("unhandledRejection",i,e):dispatchEvent(UNHANDLED_REJECTION,e,i)})),t.rejection=IS_NODE||isUnhandled(t)?UNHANDLED:HANDLED,r.error))throw r.value}))},isUnhandled=function(e){return e.rejection!==HANDLED&&!e.parent},onHandleUnhandled=function(e,t){task.call(global$2,(function(){IS_NODE?process.emit("rejectionHandled",e):dispatchEvent(REJECTION_HANDLED,e,t.value)}))},bind=function(e,t,r,i){return function(n){e(t,r,n,i)}},internalReject=function(e,t,r,i){t.done||(t.done=!0,i&&(t=i),t.value=r,t.state=REJECTED,notify(e,t,!0))},internalResolve=function(e,t,r,i){if(!t.done){t.done=!0,i&&(t=i);try{if(e===r)throw TypeError$1("Promise can't be resolved itself");var n=isThenable(r);n?microtask((function(){var i={done:!1};try{n.call(r,bind(internalResolve,e,i,t),bind(internalReject,e,i,t))}catch(r){internalReject(e,i,r,t)}})):(t.value=r,t.state=FULFILLED,notify(e,t,!1))}catch(r){internalReject(e,{done:!1},r,t)}}};FORCED&&(PromiseConstructor=function(e){anInstance(this,PromiseConstructor,PROMISE),aFunction(e),Internal.call(this);var t=getInternalState(this);try{e(bind(internalResolve,this,t),bind(internalReject,this,t))}catch(e){internalReject(this,t,e)}},Internal=function(e){setInternalState(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:PENDING,value:void 0})},Internal.prototype=requireRedefineAll()(PromiseConstructor.prototype,{then:function(e,t){var r=getInternalPromiseState(this),i=newPromiseCapability(speciesConstructor$1(this,PromiseConstructor));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=IS_NODE?process.domain:void 0,r.parent=!0,r.reactions.push(i),r.state!=PENDING&&notify(this,r,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),OwnPromiseCapability=function(){var e=new Internal,t=getInternalState(e);this.promise=e,this.resolve=bind(internalResolve,e,t),this.reject=bind(internalReject,e,t)},newPromiseCapabilityModule.f=newPromiseCapability=function(e){return e===PromiseConstructor||e===PromiseWrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)},"function"==typeof $fetch&&$export({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return promiseResolve$1(PromiseConstructor,$fetch.apply(global$2,arguments))}})),$export({global:!0,wrap:!0,forced:FORCED},{Promise:PromiseConstructor}),requireSetToStringTag()(PromiseConstructor,PROMISE,!1,!0),requireSetSpecies()(PROMISE),PromiseWrapper=path$1[PROMISE],$export({target:PROMISE,stat:!0,forced:FORCED},{reject:function(e){var t=newPromiseCapability(this);return t.reject.call(void 0,e),t.promise}}),$export({target:PROMISE,stat:!0,forced:FORCED},{resolve:function(e){return promiseResolve$1(this,e)}}),$export({target:PROMISE,stat:!0,forced:INCORRECT_ITERATION},{all:function(e){var t=this,r=newPromiseCapability(t),i=r.resolve,n=r.reject,o=perform((function(){var r=aFunction(t.resolve),o=[],a=0,s=1;iterate(e,(function(e){var l=a++,u=!1;o.push(void 0),s++,r.call(t,e).then((function(e){u||(u=!0,o[l]=e,--s||i(o))}),n)})),--s||i(o)}));return o.error&&n(o.value),r.promise},race:function(e){var t=this,r=newPromiseCapability(t),i=r.reject,n=perform((function(){var n=aFunction(t.resolve);iterate(e,(function(e){n.call(t,e).then(r.resolve,i)}))}));return n.error&&i(n.value),r.promise}});var getBuiltIn=getBuiltIn$1,speciesConstructor=speciesConstructor$2,promiseResolve=promiseResolve$2,perf;if(_export({target:"Promise",proto:!0,real:!0},{finally:function(e){var t=speciesConstructor(this,getBuiltIn("Promise")),r="function"==typeof e;return this.then(r?function(r){return promiseResolve(t,e()).then((function(){return r}))}:e,r?function(r){return promiseResolve(t,e()).then((function(){throw r}))}:e)}}),path$1.Promise,"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t}),"function"!=typeof Object.values&&(Object.values=function(e){return Object.keys(e).map((function(t){return e[t]}))}),Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,r=0;r<t;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;e+=arguments[r]*arguments[r]}return Math.sqrt(e)},Math.log2=Math.log2||function(e){return Math.log(e)*Math.LOG2E},"undefined"!=typeof window?("performance"in window==!1&&(window.performance={}),perf=window.performance):"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&("performance"in self==!1&&(self.performance={}),perf=self.performance),perf&&"function"!=typeof perf.now){var start=+new Date;perf.now=function(){return+new Date-start}}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,r){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&_setPrototypeOf(n,r.prototype),n},_construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)},_wrapNativeSuper(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,i=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,r){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=_superPropBase(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}},_get(e,t,r||e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],i=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}return r}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}var global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},ns={},MathUtils;(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},r="undefined"!=typeof window&&window===this?this:void 0!==global$1&&null!=global$1?global$1:this;if("function"==typeof Object.setPrototypeOf)e=Object.setPrototypeOf;else{var i;e:{var n={};try{n.__proto__={ea:!0},i=n.ea;break e}catch(e){}i=!1}e=i?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var o=e;!function(e,i){if(i){var n=r;e=e.split(".");for(var o=0;o<e.length-1;o++){var a=e[o];a in n||(n[a]={}),n=n[a]}(i=i(o=n[e=e[e.length-1]]))!=o&&null!=i&&t(n,e,{configurable:!0,writable:!0,value:i})}}("Object.setPrototypeOf",(function(e){return e||o}));var a=this||self;function s(e){var t=_typeof(e);if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var r=Object.prototype.toString.call(e);if("[object Window]"==r)return"object";if("[object Array]"==r||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==r||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t}function l(e){return"function"==s(e)}function u(e){var t=_typeof(e);return"object"==t&&null!=e||"function"==t}function c(e,t){e=e.split(".");var r,i=a;e[0]in i||void 0===i.execScript||i.execScript("var "+e[0]);for(;e.length&&(r=e.shift());)e.length||void 0===t?i=i[r]&&i[r]!==Object.prototype[r]?i[r]:i[r]={}:i[r]=t}function h(e,t){function r(){}r.prototype=t.prototype,e.ua=t.prototype,e.prototype=new r,e.prototype.constructor=e}var f=Math,d=f.min,_=f.max,p=f.round,g=f.floor,m=f.ceil,y=f.abs,v=f.log,x=f.sqrt,b=f.pow,T=f.sin,A=f.asin,E=f.cos,w=f.tan,S=f.atan2,k=f.PI,P=k/2,R=k/4,M=2*k,L=3*k,O=k/180,C=180/k;function I(e,t,r){return e>r?r:e<t?t:e}function N(e,t,r){return t<r?e>=t&&e<=r:e>=r&&e<=t}function $(e,t,r,i,n,o){return x(b((e-n)*(i-o)-(t-o)*(r-n),2)/(b(r-n,2)+b(i-o,2)))}c("H.math.normalize",(function(e,t,r){return t-=r=r||0,(e-=r)-g(e/t)*t+r})),c("H.math.clamp",I);var B={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};function F(e,t){var r=e.x;e=e.y;for(var i,n,o,a,s=t.length,l=s,u=t[0],c=0,h=0,f=0;1!=c&&1<l;)n=t[--l],i=t[--l],a=t[l?l-1:(s+(l-1))%s],o=t[l?l-2:(s+(l-2))%s],i>=r&&i<=r&&n>=e&&n<=e||o>=r&&o<=r&&a>=e&&a<=e?c=1:c||i!==r?!c&&N(r,i,o)&&((i<r&&o>r||i>r&&o<r)&&(h+=(u=n+(r-i)/(o-i)*(a-n))>e,f+=u<e),c=N(e,n,a)&&0>=$(r,e,i,n,o,a)?2:0):(o===r&&(n<e&&a>e||n>e&&a<e)||(u<=r&&o>r||u>=r&&o<r)&&(n>=e?++h:++f),c=N(e,n,a)&&0>=$(r,e,i,n,o,a)?2:0),u=i;return!c&&0!==f&&0!=h%2&&(c=3),c!==B.NONE}function H(e,t){this.x=+e,this.y=+t}function z(e,t,r,i,n,o){var a=e.x;e=-e.y;var s=t.x;if(t=-t.y,r=-r,o=-o,a>s){if(s>n||a<i)return;var l=a,u=e;a=s,e=t,s=l,t=u,l=1}else if(a>n||s<i)return;if(e>t){if(t>r||e<o)return;var c=1;e=-e,t=-t,u=o,o=-r,r=-u}else if(e>r||t<o)return;if(a<i){if((e+=(i-a)*(t-e)/(s-a))>r)return;a=i}if(e<o){if((a+=(o-e)*(s-a)/(t-e))>n)return;e=o}return s>n&&(t=e+(n-a)*(t-e)/(s-a),s=n),t>r&&(s=a+(r-e)*(s-a)/(t-e),t=r),c&&(e=-e,t=-t),l?[new H(s,-t),new H(a,-e)]:[new H(a,-e),new H(s,-t)]}function D(e,t,r,i,n,o,a,s,l,u){return e={x:e,y:t,next:r||null,s:i||null,ta:n||null,X:o||null,o:!!a,T:s||0,O:l||0,alpha:u||0},i&&(e.s.next=e),r&&(e.next.s=e),e}function U(e){for(;e&&e.o;)e=e.next;return e}function G(e){if(e)for(;e.next;)e=e.next;return e}function j(e){var t=e;if(t)do{t=t.next}while(t!=e&&(!t.o||t.o&&t.O));return t}function V(e){var t=G(e);t.s.next=e,e.s=t.s}function q(e,t,r,i,n){var o,a=t.x-e.x,s=t.y-e.y,l=i.x-r.x,u=i.y-r.y,c=a*u-s*l;return c?(l=((r.x-e.x)*u-(r.y-e.y)*l)/c,c=(s*(r.x-e.x)-a*(r.y-e.y))/c,0>l||1<l||0>c||1<c?0:(0===l?o=e:1===l?o=t:0===c?o=r:1===c&&(o=i),o?(o.x+=2480549651603763e-20,o.y+=7321997314118067e-20,o.M&&(o.M.x=o.x,o.M.y=o.y),q(e,t,r,i,n)):(n.xa=e.x+l*a,n.ya=e.y+l*s,n.fa=l,n.ga=c,1))):0}function W(e){for(var t=[];e;)t.push(e.x,e.y),e=e.next;return t}function Y(e,t,r){for(t=t.next;t!==r&&t.alpha<=e.alpha;)t=t.next;e.next=t,e.s=t.s,e.next.s=e,e.s.next=e}function X(e,t){for(var r,i=null,n=0,o=e.length;n<o;n++)(r=D(e[n].x,e[n].y,i)).qa=t,(r.next=i)&&(i.s=r),i=r;return i}function K(e,t,r,i){return(e-=r)*e+(t-=i)*t}function Z(e,t,r,i,n){var o=0,a=i,s=e[i].x,l=e[i].y,u=e[n].x,c=e[n].y,h=i+1,f=K(s,l,u,c);if(f)for(;h<n;){var d=e[h++],_=d.x,p=((_-s)*(u-s)+((d=d.y)-l)*(c-l))/f;(_=0>p?K(_,d,s,l):1<p?K(_,d,u,c):K(_,d,s+p*(u-s),l+p*(c-l)))>o&&(o=_,a=h-1)}else for(;h<n;)(_=K(_=(d=e[h++]).x,d=d.y,s,l))>o&&(o=_,a=h-1);return o>=t||0<r&&a-i?(--r,1<a-i?(i=Z(e,t,r,i,a)).splice(i.length-1,1):i=[e[i]],i=1<n-a?i.concat(Z(e,t,r,a,n)):i.concat(e.slice(a,n+1))):i=[e[i],e[n]],i}c("H.math.CoverType",B),c("H.math.isPointInsidePolygon",F),c("H.math.flatten",(function(e){for(var t=e.length,r=new Float64Array(2*t),i=t&&e[0].x!==ee;t--;){var n=e[t],o=t<<1;r[o]=i?n.x:n[0],r[o+1]=i?n.y:n[1]}return r})),c("H.math.Point",H),H.prototype.set=H,H.prototype.set=H.prototype.set,H.prototype.clone=function(e){return e?(e.x=this.x,e.y=this.y):e=new H(this.x,this.y),e},H.prototype.clone=H.prototype.clone,H.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},H.prototype.add=H.prototype.add,H.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},H.prototype.sub=H.prototype.sub,H.prototype.scale=function(e,t){return this.x*=e,this.y*=void 0===t?e:t,this},H.prototype.scale=H.prototype.scale,H.prototype.round=function(){return this.x=p(this.x),this.y=p(this.y),this},H.prototype.round=H.prototype.round,H.prototype.floor=function(){return this.x=g(this.x),this.y=g(this.y),this},H.prototype.floor=H.prototype.floor,H.prototype.ceil=function(){return this.x=m(this.x),this.y=m(this.y),this},H.prototype.ceil=H.prototype.ceil,H.prototype.w=function(e){return!(!e||this.x!==e.x||this.y!==e.y)},H.prototype.equals=H.prototype.w,H.prototype.la=function(e,t){var r=t.x-e.x,i=t.y-e.y,n=e;if(r||i){var o=((this.x-e.x)*r+(this.y-e.y)*i)/(r*r+i*i);n=0>=o?e:1<=o?t:new H(e.x+o*r,e.y+o*i)}return n},H.prototype.getNearest=H.prototype.la,H.prototype.R=function(e){return x(b(this.x-e.x,2)+b(this.y-e.y,2))},H.prototype.distance=H.prototype.R,H.fromIPoint=function(e){if(!e)throw Error("invalid argument");return e instanceof H?e:new H(e.x,e.y)},c("H.math.clipping.clipStrips",(function(e,t,r,i,n,o){var a,s,l,u,c=e.length;if(c)for(a=[];c--;){var h=e[c],f=h.length,d=0;for(l=1;l<f;l++)if(u=z(h[l-1],h[l],r,t,i,n)){var _=u[0],p=u[1];d&&d.w(_)?s.push(p):a.push(s=u),d=p,o&&(l=f,c=0)}}else a=e;return a})),c("H.math.clipping.clipPolygon",(function(e,t,r){var i,n;e=X(e,!0),t=X(t,!1);var o={},a=i=1;switch(~~(r||0)){case 1:a=i=0;break;case 2:i=0,a=1;break;case 3:i=1,a=0}r=i;var s=a;if(t&&e){for(t.M=D(t.x,t.y,null,G(t)),e.M=D(e.x,e.y,null,G(e)),a=t;a.next;a=a.next)if(!a.o)for(i=e;i.next;i=i.next)if(!i.o){var l=U(a.next),u=U(i.next);if(n=q(a,l,i,u,o)){n=o.fa;var c=o.ga,h=o.xa,f=o.ya;Y(n=D(h,f,null,null,null,null,!0,0,0,n),a,l),Y(l=D(h,f,null,null,null,null,!0,0,0,c),i,u),n.X=l,l.X=n}}for(o=F(t,W(e)),r&&(o=!o),a=t;a;a=a.next)a.o&&(a.T=o,o=!o);for(o=F(e,W(t)),s&&(o=!o),i=e;i.next;i=i.next)i.o&&(i.T=o,o=!o);for(V(t),V(e);(e=j(t))!=t;){for(r=null;!e.O;e=e.X){for(o=e.T;(r=D(e.x,e.y,r)).artificial=e.o||e.qa,e.O=1,e=o?e.next:e.s;)if(e.o){e.O=1;break}if(!e)break}r.ta=d;var d=r}return d}})),c("H.math.simplifyDP",(function(e,t,r){return Z(e,t*t,r||0,0,e.length-1)}));var J=this,Q=String,ee=[].pop(),te=/x/.exec(""),re="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(e,t){if(!0==(e instanceof t&&e.constructor===t))throw new TypeError("Illegal constructor "+le(t))}c("H.lang.isArray",(function(e,t,r,i){var n;if(!(n="Array"===ae(e))&&t)throw new de(t,r,i!==ee?i:e);return n})),c("H.lang.isString",(function(e){return"string"==typeof e}));var ne=isNaN;function oe(e){return e===+e}function ae(e){var t=Object[re[0]][re[6]].call(e).match(/^\[object (\w+)\]$/);return t?t[1]:_typeof(e)}c("H.lang.isNumber",oe),c("H.lang.isInteger",Number.isInteger?Number.isInteger:function(e){return"number"==typeof e&&0==e%1});var se=[];function le(e,t,r,i){var n,o="",a=2>arguments.length;return a&&(t={H:J.H},r="",i=se.slice()),he(t,!0,(function(t,a){try{if(a=function(e,t){var r=[];return he(e,!1,(function(e,i){e[i]===t&&r.push(i)})),r.sort(ue)[0]}(t,n=t[a]),!(u(n)&&n.window===n&&n.self===n||u(n)&&0<n.nodeType&&l(n.cloneNode))&&u(n)){if(n===e)return o=r+"."+a,!0;if(0>i.indexOf(n)&&(i.push(n),o=le(e,n,r+"."+a,i)))return!0}}catch(e){}})),a&&(o=o?o.substr(1).replace("."+re[0]+".","#"):"~"+(l(e)?function(e){return(e=/^\s*function ([^\( ]+)/.exec(e))?e[1]:"anonymous"}(e)+"()":ae(e))),o}function ue(e,t){return t.length-e.length}0>se.indexOf(se)&&se.push(se);var ce=Object[re[0]][re[2]];function he(e,t,r){var i;if(e){for(n in e)if((!t||ce.call(e,n))&&r(e,n,!0))return;for(i=re.length;i--;){var n=re[i];if((!t||ce.call(e,n))&&r(e,n,!1))break}}}function fe(e,t,r){r[t]="#"+t}function de(e,t,r){var i=arguments.length;if((t=t!==ee?+t:t)!==ee){var n,o=/^.*?\(([^\)]+)/.exec((""+e).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,""));n=o?Q(o[1].replace(/\s+/g,"")).split(","!==ee?",":" "):[],(o=n).forEach(fe),o=o[t]||"#"+t}return n=e?le(e):"",i=2<i?Q(r):"",(o||i)&&(n+=" (Argument "+(o||"")+(i?" "+i:"")+")"),i=Error(n),Object.setPrototypeOf(i,de.prototype),i}function _e(e,t,r){var i=I(+e,-90,90);if(t&&ne(i))throw new de(t,r,e);return i}function pe(e,t,r){var i,n=+e;(-180>n||180<n)&&(n=(!1==0>(i=(n+180)%360)?i:i+360)-180);if(t&&ne(n))throw new de(t,r,e);return n}function ge(e,t,r){var i;if(e!==ee&&ne(i=+e)&&t)throw new de(t,r,e);return i}function me(){ie(this,me)}function ye(e,t,r){this.lat=_e(e,ye,0),this.lng=pe(t,ye,1),r!==ee&&(this.alt=ge(r,ye,2))}function ve(e,t,r){var i=u(e)&&!(ne(e.lat=_e(e.lat))||ne(e.lng=pe(e.lng))||e.alt!==ee&&ne(e.alt=ge(e.alt)));if(!i&&t)throw new de(t,r,e);return i}function xe(e,t,r,i){be(this,_e(e,xe,0),pe(t,xe,1),_e(r,xe,2),pe(i,xe,3))}function be(e,t,r,i,n){return e.f=r,e.g=n,t<i&&(r=t,t=i,i=r),e.i=t,e.h=i,e.m=e.b=e.c=null,e}function Te(e,t){return(e=t-e)+(0>e?360:0)}function Ae(e,t){return(e+=t/2)-(180<e?360:0)}function Ee(e,t,r,i,n,o,a,s,l){r=d(r,a),e=_(e,n);var u=Ae(t,n=Te(t,i)),c=Ae(o,a=Te(o,s))-u;if(180>(c+=0>c-1e-6?360:0)-1e-6){u=t;var h=s}else c=360-c,u=o,h=i;return 360<=(c=c+n/2+a/2)+5e-7?(u=-180,h=180):c-5e-7<n?(u=t,h=i):c-5e-7<a&&(u=o,h=s),l?be(l,e,u,r,h):new xe(e,u,r,h)}function we(e,t,r){return r||(ve(e,we,0),ve(t,we,1)),new xe(e.lat,e.lng,t.lat,t.lng)}function Se(e,t,r,i,n,o){ie(this,Se),this.sa=e||10,this.c=this.b=null,this.j=i||0,this.l=n||0,this.m=t||1,this.u=r||1,this.I=!!o,this.flush()}function ke(e,t){var r,i,n,o,a=0;for(r=3;0<=r;r--){var s=r+4,l=0<r%3,u=[],c=t[r],h=e[r];for(i=h.length;i--;){var f=h[i];if(n=f.entries)for(o=n.length;o--;){var d=n[o][r];(l?d>c:d<c)&&(c=d)}for(o=4;o--;)(n=f[o])&&(l?n[s]>c:n[s]<c)&&u.push(n)}a+=u.length,t[r]=c,e[r]=u}return a&&(t=ke(e,t)),t}function Pe(e,t,r){var i,n;if(e.I&&(i=e.c))for(n=3;0<=n;n--){var o=t[n];if(n%3?o>=i[n]:o<=i[n]){if(!r){e.c=null;break}i[n]=o}}}function Re(e,t){var r,i=e.a;if(t){var n=t;if(n!==i)for(i=n;n=n.c;)(n.entries||1<n.a)&&(i=n)}else for(;!i.entries&&2>(r=i.a)&&r;)i=n;e.a=i}function Me(e,t,r,i,n,o,a,s,l){var u,c=t.entries,h=t[7],f=t[4],d=t[5],_=t[6],p=t[8],g=t[9];if(c){var m=c.length;if(n>f||i>h||a<_||o<d)for(;m--;){f=(h=c[m])[3],d=h[0],_=h[1],h[2]>=n&&_>=i&&(d<a||s&&d==a)&&(f<o||l&&f==o)&&r.push(h)}else for(;m--;)r.push(c[m])}(o>p||l&&o==p)&&(n<g&&(u=t[1])&&Me(e,u,r,i,n,o,a,s,l),(a>g||s&&a==g)&&(u=t[3])&&Me(e,u,r,i,n,o,a,s,l)),i<p&&(n<g&&(u=t[0])&&Me(e,u,r,i,n,o,a,s,l),(a>g||s&&a==g)&&(u=t[2])&&Me(e,u,r,i,n,o,a,s,l))}h(de,Error),c("H.lang.InvalidArgumentError",de),de.prototype.name="InvalidArgumentError",c("H.geo.isDBC",(function(e,t){return 0!=(0>e^0>t)&&180<y(t-e)})),c("H.geo.AbstractGeometry",me),me.prototype.getBoundingBox=me.prototype.D,me.prototype.equals=me.prototype.w,me.prototype.a="",me.prototype.l="",me.prototype.toString=function(){return this.I([this.a.toUpperCase()," "]).join("")},me.prototype.toString=me.prototype.toString,me.prototype.va=function(){return{type:this.l,coordinates:this.u()}},me.prototype.toGeoJSON=me.prototype.va,me.prototype.U=function(){return{type:this.a,coordinates:this.j(),boundingBox:this.D().U()}},me.prototype.forWorkerMessage=me.prototype.U,h(ye,me),c("H.geo.Point",ye),ye.prototype.w=function(e){return this===e||!!e&&this.lat===e.lat&&this.lng===e.lng&&(this.alt||0)===(e.alt||0)},ye.prototype.equals=ye.prototype.w,ye.prototype.R=function(e){if(this===e||this.lat===e.lat&&this.lng===e.lng)e=0;else{var t=this.lat*O,r=e.lat*O;e=12742001.58*A(d(1,x(b(T((t-r)/2),2)+E(t)*E(r)*b(T((this.lng*O-e.lng*O)/2),2))))}return e},ye.prototype.distance=ye.prototype.R,ye.prototype.wa=function(e,t,r){if(r){if(t/=6371000.79){e*=O;var i=O*this.lat,n=T(i),o=T(t),a=E(t),s=O*this.lng,l=E(i);i=A(l*E(e)*o+n*a),l=(e=(s+(e=S(T(e)*l*o,a-n*T(i)))+k)%(2*k)-k)*C}return t?new ye(i*C,(l+540)%360-180):this}if(0==((e=(e%360+360)%360)+90)%180)return i=this.lng+t/(6371000.79*M*E(this.lat*O))*(270===e?-360:360),new ye(this.lat,(i+540)%360-180);if(t/=6371000.79){e*=O,s=this.lat*O,n=this.lng*O,a=(o=s+t*E(e))-s,i=v(w(o/2+R)/w(s/2+R)),i=ne(a/i)?E(s):a/i;var u=t*T(e)/i;y(o)>P&&(o=0<o?k-o:-(k+o))}return t?new ye(o*C,((n+u+L+(y(s+a)>P?k:0))%M-k)*C):this},ye.prototype.walk=ye.prototype.wa,ye.prototype.D=function(){return new xe(this.lat,this.lng,this.lat,this.lng)},ye.prototype.getBoundingBox=ye.prototype.D,ye.validate=ve,ye.fromIPoint=function e(t){if(!t)throw new de(e,0,t);return new ye(t.lat,t.lng,t.alt)},ye.prototype.a="Point",ye.prototype.I=function(e){return e.push("(",this.lng," ",this.lat,")"),e},ye.prototype.l="Point",ye.prototype.u=function(){return[this.lng,this.lat,this.alt||0]},ye.prototype.j=function(){return[this.lat,this.lng,this.alt||0]},h(xe,me),c("H.geo.Rect",xe),xe.prototype.a="Polygon",xe.prototype.I=function(e){var t=this.i,r=this.f,i=this.h,n=this.g;return e.push("(","(",r," ",t,",",n," ",t,",",n," ",i,",",r," ",i,",",r," ",t,")",")"),e},xe.prototype.w=function(e){return this===e||!!e&&this.i===e.i&&this.f===e.f&&this.h===e.h&&this.g===e.g},xe.prototype.equals=xe.prototype.w,xe.prototype.clone=function(){return new xe(this.i,this.f,this.h,this.g)},xe.prototype.clone=xe.prototype.clone,xe.prototype.W=function(){return this.m||(this.m=new ye(this.i,this.f)),this.m},xe.prototype.getTopLeft=xe.prototype.W,xe.prototype.V=function(){return this.b||(this.b=new ye(this.h,this.g)),this.b},xe.prototype.getBottomRight=xe.prototype.V,xe.prototype.na=function(){return this.i},xe.prototype.getTop=xe.prototype.na,xe.prototype.ha=function(){return this.h},xe.prototype.getBottom=xe.prototype.ha,xe.prototype.ja=function(){return this.f},xe.prototype.getLeft=xe.prototype.ja,xe.prototype.ma=function(){return this.g},xe.prototype.getRight=xe.prototype.ma,xe.prototype.F=function(){return this.c||(this.c=new ye(this.h+(this.i-this.h)/2,Ae(this.f,this.A()))),this.c},xe.prototype.getCenter=xe.prototype.F,xe.prototype.A=function(){return Te(this.f,this.g)},xe.prototype.getWidth=xe.prototype.A,xe.prototype.G=function(){return this.i-this.h},xe.prototype.getHeight=xe.prototype.G,xe.prototype.N=function(){return this.f>this.g},xe.prototype.isCDB=xe.prototype.N,xe.prototype.ra=function(){return!this.A()&&!this.G()},xe.prototype.isEmpty=xe.prototype.ra,xe.prototype.D=function(){return new xe(this.i,this.f,this.h,this.g)},xe.prototype.getBoundingBox=xe.prototype.D,xe.prototype.L=function(e,t,r){var i=this.F();return r||(e=_e(e,this.L,0),t=pe(t,this.L,1)),(e=(t=this.B(e,t,r)).F()).lat===i.lat&&e.lng===i.lng&&this.G()===t.G()&&this.A()===t.A()},xe.prototype.containsLatLng=xe.prototype.L,xe.prototype.$=function(e,t){return t||ve(e,this.$,0),this.L(e.lat,e.lng,t)},xe.prototype.containsPoint=xe.prototype.$,xe.prototype.aa=function(e,t){var r=this.F();if(!(t||e instanceof xe))throw new de(this.aa,0,e);return(e=(t=this.J(e,t)).F()).lat===r.lat&&e.lng===r.lng&&this.G()===t.G()&&this.A()===t.A()},xe.prototype.containsRect=xe.prototype.aa,xe.prototype.B=function(e,t,r,i){if(!r){if(ne(e=_e(e)))throw new de(this.B,0,e);if(ne(t=pe(t)))throw new de(this.B,1,t)}return Ee(this.i,this.f,this.h,this.g,e,t,e,t,i)},xe.prototype.mergeLatLng=xe.prototype.B,xe.prototype.ca=function(e,t,r){return t||ve(e,this.ca,0),this.B(e.lat,e.lng,t,r)},xe.prototype.mergePoint=xe.prototype.ca,xe.prototype.J=function(e,t,r){if(!(t||e instanceof xe))throw new de(this.J,0,e);return Ee(this.i,this.f,this.h,this.g,e.i,e.f,e.h,e.g,r)},xe.prototype.mergeRect=xe.prototype.J,xe.prototype.C=function(e,t,r,i,n,o){return n||(e=_e(e,this.C,0),t=pe(t,this.C,1),r=_e(r,this.C,2),i=pe(i,this.C,3)),Ee(this.i,this.f,this.h,this.g,e,t,r,i,o)},xe.prototype.mergeTopLeftBottomRight=xe.prototype.C,xe.prototype.ba=function(e,t){var r=this.f<=this.g,i=e.f<=e.g,n=this.f<e.g,o=e.f<this.g;if(!(t||e instanceof xe))throw new de(this.ba,0,e);return this.h<=e.i&&e.h<=this.i&&(!r&&(!i||n||o)||!i&&(n||o)||n&&o)},xe.prototype.intersects=xe.prototype.ba,xe.merge=Ee,xe.fromPoints=we,xe.coverPoints=function e(t,r){var i=1,n=t.length,o=null,a=s(t);if("array"!=a&&("object"!=a||"number"!=typeof t.length))throw new de(e,0,t);if(0<n)for(o=we(a=t[0],a,r);i<n;i++)a=t[i],o.B(a.lat,a.lng,r,o);return o},xe.coverLatLngAlts=function e(t,r){var i,n=3,o=t.length;if(!(r||t&&null!=t.length))throw new de(e,0,t);if(0<o)for(i=new xe(t[0],t[1],t[0],t[1]);n<o;n+=3)i.B(t[n],t[n+1],r,i);return i},xe.coverRects=function e(t,r){var i,n=1,o=t.length;if(r&&(!t||null==t.length))throw new de(e,0,t);if(0<o)for(i=new xe(t[0].i,t[0].f,t[0].h,t[0].g);n<o;n++)i.J(t[n],r,i);return i},xe.prototype.da=function(e,t){var r=this.f,i=this.i,n=this.g,o=this.h,a=this.F().lng;ve(e,this.da,0);var s=e.lat-o-(i-o)/2,l=e.lng-a;return e=-180>(e=r+(0>(l=180<l||-180>l?-(a+e.lng):l)?2*l:0))?360+e:e,n=180<(n+=0<l?2*l:0)?n-360:n,90<=(i=0<s?i+2*s:i)&&(i=90),-90>=(o=0>s?o+2*s:o)&&(o=-90),t?be(t,i,e,o,n):new xe(i,e,o,n)},xe.prototype.resizeToCenter=xe.prototype.da,xe.prototype.l="Polygon",xe.prototype.u=function(){return[[this.f,this.i,0],[this.g,this.i,0],[this.g,this.h,0],[this.f,this.h,0],[this.f,this.i,0]]},xe.prototype.U=function(){return this.j()},xe.prototype.j=function(){return[this.i,this.f,this.h,this.g]},Se.prototype.remove=function(e){var t,r,i,n=!1;if(e&&(t=e.a)&&t.b===this&&(r=t.entries)&&0<=(i=r.indexOf(e))){var o,a;for(r.splice(i,1),r=this.a;t;)if((o=t.entries)&&o.length||(o&&delete t.entries,t.a||!(a=t.c)))t=te;else{i=a;var s=(n=t).j;i[s]===n&&(delete i[s],delete n.c,--i.a),r===t&&(r=a),t=a}this.a!==r&&(this.a=r,Re(this)),Pe(this,e,!1),n=!0}return n},Se.prototype.flush=function(){var e=new Oe(null,NaN,this.j-this.m,this.l-this.u,this.j+this.m,this.l+this.u);e.b=this,this.a=this.b=e,this.c=null},Se.prototype.o=function(e,t,r,i,n,o){var a=[],s=this.a,l=this.b;return e<=s[5]&&t<=s[6]&&(n?r>=s[7]:r>s[7])&&(o?i>=s[4]:i>s[4])&&Me(this,s,a,e,t,r,i,o||i>=l[6],n||r>=l[5]),a};var Le=0;function Oe(e,t,r,i,n,o){this.j=t,e&&(this.c=e,this.b=e.b,1&t?(r=e[8],n=e[5]):(r=e[7],n=e[8]),2&t?(i=e[9],o=e[6]):(i=e[4],o=e[9])),this[7]=r,this[5]=n,this[8]=(r+n)/2,this[4]=i,this[6]=o,this[9]=(i+o)/2}function Ce(e,t,r,i,n,o){Ce.ua.constructor.apply(this,arguments)}function Ie(e,t,r,i,n,o,a){var s,l,u=t[8],c=t[9];return a&&(n<u||(s=r>=u))&&(o<c||(l=i>=c))?r=(u=Ie)(e,t=t[s|=l<<1]||(++t.a,t[s]=new Oe(t,s)),r,i,n,o,a-1):(i=r=new Ne(r,i,n,o),(t.entries||(t.entries=[])).push(i),i.a=t,Pe(e,r,!0),Re(e,t)),r}function Ne(e,t,r,i){this.id=Le++,this[0]=t,this[1]=r,this[2]=i,this[3]=e}function $e(e){this.l=new Ce(+e||10,180,90,0,0,!0),this.j=[],this.m=!1,this.a=this.b=this.c=null}function Be(e,t,r,i,n,o){if(o)o=new Ne(n,-t,r+360,-i),e.j.push(o),e.m=!0,e.a&&e.a.C(t,r,i,n,!0,e.a);else{var a=-t,s=-i,l=(o=e.l).b,u=l[5],c=l[6];if(!(l[7]<=r&&l[4]<=a&&(u>n||u===n&&u===l.b.b[5])&&(c>s||c===s&&c===l.b.b[6])))throw Error("Coordinates out of bounds");o=Ie(o,o.b,r,a,n,s,o.sa),e.b&&e.b.C(t,r,i,n,!0,e.b)}return e.c=null,o}function Fe(e,t,r,i,n,o,a){var s,l=(e=e.j).length,u=[];if(l){var c=r+360;for(s=n+360;l--;){var h=e[l];(ze(h,t,r,i,n,o,a)||ze(h,t,c,i,s,o,a))&&u.push(h)}}return u}function ze(e,t,r,i,n,o,a){var s=e[3],l=e[0],u=e[1];return e=e[2],(o?l<=i:l<i)&&(a?s<=n:s<n)&&e>=t&&u>=r}function De(e,t){var r,i,n;if(r=t.length){var o=e.length;for(i={};o--;)i[e[o].id]=1;for(;r--;)(n=t[r]).id in i||e.push(n)}}function Ue(){}function Ge(e,t,r){if(this.l=[],t&&this.K(t),r&&!l(r))throw new de(Ge,2,r);this.b=0,this.m=r,this.a={},this.j=this.c=null,this.Z(e)}function je(e,t){return t&&(e.c=qe(e,t,e.c)),t}function Ve(e){for(;e.b>e.u&&e.j;)He(e,e.j,!0)}function qe(e,t,r){return r!==t&&((t.H||t.v)&&He(e,t,!1),(t.H=r)&&(t.v=r.v,r.v=t),t.v||(e.c=t),t.H||(e.j=t),e.b+=t.size),t}function He(e,t,r){var i=t.v,n=t.H;(i||n||t==e.c&&t==e.j)&&(i?i.H=n:e.c=n,n?n.v=i:e.j=i,e.b-=t.size,r&&(delete e.a[t.id],We(e,t))),t.H=t.v=null}function We(e,t){for(var r=e.l.length;r--;)e.l[r].call(e,t.id,t.data,t.size)}Oe.prototype.a=0,h(Ce,Se),c("H.geo.QuadTree",$e),$e.prototype.N=function(){return this.m},$e.prototype.D=function(){var e;if(!this.c){var t,r,i,n,o=[];if(t=!this.b){var a=this.l,s=a.c;a.I&&!s&&((t=a.a).entries||t[0]||t[1]||t[2]||t[3])&&(s=ke([s=[t],s,s,s],[t[6],t[7],t[4],t[5]]),a.c=s),t=a=s}if(t&&(this.b=new xe(-a[0],a[3],-a[2],a[1])),(e=this.b)&&o.push(e),!this.a&&(n=(i=this.j).length)){for(a=90,t=360,s=-90,r=0;n--;){var l=i[n];a=d(a,l[0]),t=d(t,l[3]),s=_(s,l[2]),r=_(r,l[1])}this.a=new xe(-a,t,-s,r-360)}(e=this.a)&&o.push(e),(e=o[0])&&(o[1]&&(e=e.J(o[1],!0)),this.c=e)}return this.c},$e.prototype.oa=function(e){var t=e.W(),r=e.V();return(e=e.N())?Be(this,t.lat,r.lng,r.lat,t.lng,e):Be(this,t.lat,t.lng,r.lat,r.lng,e)},$e.prototype.insertBoundingBox=$e.prototype.oa,$e.prototype.remove=function(e){var t;if(e.a){var r=this.l.remove(e);this.b=null}else(r=0<=(e=(t=this.j).indexOf(e)))&&(t.splice(e,1),this.m=0<t.length,this.a=null);return r&&(this.c=null),r},$e.prototype.remove=$e.prototype.remove,$e.prototype.pa=function(e,t,r){var i=this.l,n=e.W(),o=e.V(),a=-n.lat;n=n.lng;var s=-o.lat;return o=o.lng,!t&&a===s||!r&&n===o?e=[]:e.N()?(De(e=i.o(-180,a,o,s,r,t),i.o(n,a,180,s,!1,t)),De(e,Fe(this,a,o,s,n+360,t,r))):De(e=i.o(n,a,o,s,r,t),Fe(this,a,n,s,o,t,r)),e},$e.prototype.intersectBoundingBox=$e.prototype.pa,c("H.util.ICache",Ue),Ue.prototype.add=function(){},Ue.prototype.add=Ue.prototype.add,Ue.prototype.get=function(){},Ue.prototype.get=Ue.prototype.get,Ue.prototype.S=function(){},Ue.prototype.drop=Ue.prototype.S,Ue.prototype.forEach=function(){},Ue.prototype.forEach=Ue.prototype.forEach,Ue.prototype.Y=function(){},Ue.prototype.removeAll=Ue.prototype.Y,Ue.prototype.K=function(){},Ue.prototype.registerOnDrop=Ue.prototype.K,Ue.prototype.P=function(){},Ue.prototype.deRegisterOnDrop=Ue.prototype.P,c("H.util.Cache",Ge),Ge.prototype.add=function(e,t,r){var i,n;if(!oe(r=+r)||0>r)throw new de(this.add,2,r);return e=String(e),(n=!this.m||this.m(e,t,r))&&((i=this.a[e])?(i.data!==t&&We(this,i),this.b+=r-i.size,i.size=r,i.data=t,je(this,i)):this.a[e]=qe(this,{id:e,data:t,size:r,H:null,v:null},this.c),Ve(this)),n},Ge.prototype.add=Ge.prototype.add,Ge.prototype.K=function(e){if(!l(e))throw new de(this.K,0,e);this.l.push(e)},Ge.prototype.registerOnDrop=Ge.prototype.K,Ge.prototype.P=function(e){this.l=this.l.filter((function(t){return t!==e}))},Ge.prototype.deRegisterOnDrop=Ge.prototype.P,Ge.prototype.get=function(e,t){return(e=t?this.a[e]:je(this,this.a[e]))&&e.data},Ge.prototype.get=Ge.prototype.get,Ge.prototype.S=function(e){var t;(t=this.a[e])&&He(this,t,!0)},Ge.prototype.drop=Ge.prototype.S,Ge.prototype.forEach=function(e,t,r){var i;for(i in this.a){var n=this.a[i];(!r||r(i,n.data,n.size))&&e.call(t,i,n.data,n.size)}},Ge.prototype.forEach=Ge.prototype.forEach,Ge.prototype.Y=function(e){var t;for(t in this.a){var r=this.a[t];(!e||e(t,r.data,r.size))&&He(this,this.a[t],!0)}},Ge.prototype.removeAll=Ge.prototype.Y,Ge.prototype.Z=function(e){if(!(0<+e))throw new de(Ge.prototype.Z,0,e);return this.u=+e,Ve(this),this},Ge.prototype.setMaxSize=Ge.prototype.Z,Ge.prototype.ka=function(){return this.u},Ge.prototype.getMaxSize=Ge.prototype.ka,Ge.prototype.ia=function(){return this.b},Ge.prototype.getCurrentSize=Ge.prototype.ia}).call(ns);var MathUtils$1=MathUtils={},Geo;function _xyToArr(e){return[e.x,e.y]}function _arrToXy(e){return _construct(ns.H.math.Point,_toConsumableArray(e))}MathUtils.clipPolygon=function(e,t){var r,i,n,o=[];if(r=ns.H.math.clipping.clipPolygon(e.map(_arrToXy),t.map(_arrToXy)))do{i=[],n=r;do{i.push(_xyToArr(n))}while(n=n.next);o.push(i)}while(r=r.nextPoly);else MathUtils.isPointInsidePolygon(t[0],e)?o.push(t):MathUtils.isPointInsidePolygon(e[0],t)&&o.push(e);return o},MathUtils.isPointInsidePolygon=function(e,t){return ns.H.math.isPointInsidePolygon({x:e[0],y:e[1]},ns.H.math.flatten(t))},MathUtils.clamp=function(e,t,r){return(e-=0)>r?r:e<t?t:e},MathUtils.splitLegs=function(e,t){var r=[];e.push(e[0]);for(var i=0;i<e.length-1;i++){var n=e[i],o=e[i+1];if(r.push(n),Math.abs(o[0]-n[0])>=t){var a=[(n[0]+o[0])/2,(n[1]+o[1])/2];r.push(a)}}return r.length!==e.length-1?MathUtils.splitLegs(r,t):r},MathUtils.getBBox=function(e){var t=1/0,r=1/0,i=-1/0,n=-1/0;return e.forEach((function(e){e[0]<t&&(t=e[0]),e[1]<r&&(r=e[1]),e[0]>i&&(i=e[0]),e[1]>n&&(n=e[1])})),[t,r,i,n]},MathUtils.getBBoxCenter=function(e){var t=_slicedToArray(e,4),r=t[0],i=t[1];return[r+(t[2]-r)/2,i+(t[3]-i)/2]},MathUtils.getLineLength=function(e,t,r,i){return Math.sqrt(Math.pow(e-r,2)+Math.pow(t-i,2))},MathUtils.modulo=function(e,t){var r;return(r=e%t)<0==t<0?r:r+t};var Geo$1=Geo={};Geo.default_source_max_zoom=18,Geo.default_view_max_zoom=20,Geo.tile_size=256,Geo.half_circumference_meters=20037508.342789244,Geo.circumference_meters=2*Geo.half_circumference_meters,Geo.min_zoom_meters_per_pixel=Geo.circumference_meters/Geo.tile_size;var meters_per_pixel=[];Geo.metersPerPixel=function(e){return meters_per_pixel[e]=meters_per_pixel[e]||Geo.min_zoom_meters_per_pixel/Math.pow(2,e),meters_per_pixel[e]};var meters_per_tile=[];Geo.metersPerTile=function(e){return meters_per_tile[e]=meters_per_tile[e]||Geo.circumference_meters/Math.pow(2,e),meters_per_tile[e]},Geo.tile_scale=4096,Geo.units_per_pixel=Geo.tile_scale/Geo.tile_size,Geo.height_scale=16;var units_per_meter=[];Geo.unitsPerMeter=function(e){return units_per_meter[e]=units_per_meter[e]||Geo.tile_scale/(Geo.tile_size*Geo.metersPerPixel(e)),units_per_meter[e]},Geo.metersForTile=function(e){return{x:e.x*Geo.circumference_meters/Math.pow(2,e.z)-Geo.half_circumference_meters,y:-(e.y*Geo.circumference_meters/Math.pow(2,e.z)-Geo.half_circumference_meters)}},Geo.tileForMeters=function(e,t){var r=_slicedToArray(e,2),i=r[0],n=r[1];return{x:Math.floor((i+Geo.half_circumference_meters)/(Geo.circumference_meters/Math.pow(2,t))),y:Math.floor((-n+Geo.half_circumference_meters)/(Geo.circumference_meters/Math.pow(2,t))),z:t}},Geo.metersToExactTileCoords=function(e,t){var r=_slicedToArray(e,2),i=r[0],n=r[1];return{x:Math.pow(2,t-1)*(1+i/Geo.half_circumference_meters),y:Math.pow(2,t-1)*(1-n/Geo.half_circumference_meters),z:t}},Geo.wrapTile=function(e){var t=e.x,r=e.y,i=e.z,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:!0,y:!1},o=(1<<i)-1;return n.x&&(t&=o),n.y&&(r&=o),{x:t,y:r,z:i}},Geo.wrapMeters=function(e){var t=e.x,r=e.y;return{x:MathUtils$1.modulo(t+Geo.half_circumference_meters,Geo.circumference_meters)-Geo.half_circumference_meters,y:r}},Geo.metersToLatLng=function(e){var t=_slicedToArray(e,2),r=t[0],i=t[1];return r/=Geo.half_circumference_meters,i/=Geo.half_circumference_meters,i=(2*Math.atan(Math.exp(i*Math.PI))-Math.PI/2)/Math.PI,[r*=180,i*=180]},Geo.latLngToMeters=function(e){var t=_slicedToArray(e,2),r=t[0],i=t[1];return i=Math.log(Math.tan(i*Math.PI/360+Math.PI/4))/Math.PI,i*=Geo.half_circumference_meters,i=Math.min(Math.max(i,-Geo.half_circumference_meters),Geo.half_circumference_meters),[r*=Geo.half_circumference_meters/180,i]},Geo.tileSpaceToMeters=function(e,t,r){var i=_slicedToArray(e,2),n=i[0],o=i[1],a=Geo.unitsPerMeter(t);return[n/a+r.x,o/a+r.y]},Geo.tileSpaceToLatlng=function(e,t,r){var i=Geo.unitsPerMeter(t);return Geo.transformGeometry(e,(function(e){e[0]=e[0]/i+r.x,e[1]=e[1]/i+r.y;var t=_slicedToArray(Geo.metersToLatLng(e),2),n=t[0],o=t[1];e[0]=n,e[1]=o})),e},Geo.copyGeometry=function(e){if(null!=e){var t={type:e.type};return"Point"===e.type?t.coordinates=[e.coordinates[0],e.coordinates[1]]:"LineString"===e.type||"MultiPoint"===e.type?t.coordinates=e.coordinates.map((function(e){return[e[0],e[1]]})):"Polygon"===e.type||"MultiLineString"===e.type?t.coordinates=e.coordinates.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})):"MultiPolygon"===e.type&&(t.coordinates=e.coordinates.map((function(e){return e.map((function(e){return e.map((function(e){return[e[0],e[1]]}))}))}))),t}},Geo.transformGeometry=function(e,t){null!=e&&("Point"===e.type?t(e.coordinates):"LineString"===e.type||"MultiPoint"===e.type?e.coordinates.forEach(t):"Polygon"===e.type||"MultiLineString"===e.type?e.coordinates.forEach((function(e){return e.forEach(t)})):"MultiPolygon"===e.type&&e.coordinates.forEach((function(e){e.forEach((function(e){return e.forEach(t)}))})))},Geo.boxIntersect=function(e,t){return!(t.sw.x>e.ne.x||t.ne.x<e.sw.x||t.sw.y>e.ne.y||t.ne.y<e.sw.y)},Geo.findBoundingBox=function(e){for(var t=1/0,r=-1/0,i=1/0,n=-1/0,o=e[0].length,a=0;a<o;a++){var s=e[0][a];s[0]<t&&(t=s[0]),s[1]<i&&(i=s[1]),s[0]>r&&(r=s[0]),s[1]>n&&(n=s[1])}return[t,i,r,n]},Geo.geometryType=function(e){return"Polygon"===e||"MultiPolygon"===e?"polygon":"LineString"===e||"MultiLineString"===e?"line":"Point"===e||"MultiPoint"===e?"point":void 0},Geo.centroid=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&0!==e.length){var r,i=0,n=0,o=0,a=e[0],s=a.length;t&&(r=a[0],a=a.map((function(e){return[e[0]-r[0],e[1]-r[1]]})));for(var l=0,u=s-1;l<s;u=l,l++){var c=a[l],h=a[u],f=c[1]*h[0]-h[1]*c[0];i+=(c[0]+h[0])*f,n+=(c[1]+h[1])*f,o+=3*f}var d=[i/o,n/o];return t&&(d[0]+=r[0],d[1]+=r[1]),d}},Geo.multiCentroid=function(e){for(var t=e.length,r=[0,0],i=0;i<e.length;i++){var n=Geo.centroid(e[i]);r[0]+=n[0],r[1]+=n[1]}return r[0]/=t,r[1]/=t,r},Geo.signedPolygonRingAreaSum=function(e){for(var t=0,r=e.length,i=0;i<r-1;i++){var n=e[i],o=e[i+1];t+=n[0]*o[1]-o[0]*n[1]}return t+=e[r-1][0]*e[0][1]-e[0][0]*e[r-1][1]},Geo.polygonRingArea=function(e){return Math.abs(Geo.signedPolygonRingAreaSum(e))/2},Geo.polygonArea=function(e){if(e)return Geo.polygonRingArea(e[0])},Geo.multiPolygonArea=function(e){for(var t=0,r=0;r<e.length;r++)t+=Geo.polygonArea(e[r]);return t},Geo.ringWinding=function(e){var t=Geo.signedPolygonRingAreaSum(e);return t>0?"CW":t<0?"CCW":void 0},Geo.getTileBoundingBox=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Geo.wrapTile(e,{x:!0}),n=Geo.metersForTile(i),o=Geo.metersPerPixel(i.z),a=Geo.metersToLatLng([n.x-r*o,n.y+r*o]),s=Geo.metersToLatLng([n.x+(t+r)*o,n.y-(t+r)*o]),l=Geo.isLastTile(i);return new ns.H.geo.Rect(0===e.y?90:MathUtils$1.clamp(a[1],-90,90),MathUtils$1.clamp(a[0],-180,180),l.row?-90:MathUtils$1.clamp(s[1],-90,90),l.column?180:MathUtils$1.clamp(s[0],-180,180))},Geo.isLastTile=function(e){var t=e.x,r=e.y,i=e.z;return{row:r===Math.pow(2,i)-1,column:t===Math.pow(2,i)-1}};var MethodNotImplemented=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var i;return _classCallCheck(this,r),(i=t.call(this)).name="MethodNotImplemented",i.message="Method "+e+" must be implemented in subclass",i}return r}(_wrapNativeSuper(Error)),is_worker=!1,is_main=!1,force_main,force_worker;try{window.document!==HTMLDocument&&(is_main=!0)}catch(e){void 0!==self&&(is_worker=!0,self.window={document:{}},self.document=self.window.document)}var Thread={get is_fake_worker(){return self.is_fake_worker},get is_worker(){return void 0!==force_worker?force_worker:is_worker||self.is_fake_worker},set is_worker(e){force_worker=e},get is_main(){return void 0!==force_main?force_main:is_main&&!self.is_fake_worker},set is_main(e){force_main=e},is_native_worker:is_worker},WorkerBroker={},message_id=0,messages={},targets={},main_worker_targets={};function findTarget(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:targets,i=[];if("string"==typeof e&&(i=e.split("."),e=i.pop()),Thread.is_main&&t&&1===i.length&&"self"===i[0])r=t;else for(var n=0;n<i.length;n++){if(!r[i[n]])return[];r=r[i[n]]}return[e,r]}WorkerBroker.addTarget=function(e,t){Thread.is_fake_worker?main_worker_targets[e]=t:targets[e]=t},WorkerBroker.removeTarget=function(e){delete targets[e],delete main_worker_targets[e]};var ERROR_NO_TARGET=" No object with that name is registered on main thread.",ERROR_NO_METHOD=" Object has no method with that name.",ERROR_NOT_SET="_worker_broker_error_not_set_";function setupMainThread(){WorkerBroker.postMessage=function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];if(Array.isArray(e))return Promise.all(e.map((function(e){return WorkerBroker.postMessage.apply(WorkerBroker,[e,t].concat(_toConsumableArray(i)))})));var o,a={};"object"===_typeof(t)&&(a=t,t=t.method);var s="main_send";"string"==typeof e?(t=e,i=Array.prototype.slice.call(arguments,1),o=!0,s="worker_send"):e.init&&(o=!0);var l,u=[];if(i&&1===i.length&&i[0]instanceof WorkerBroker.withTransferables&&(u=i[0].transferables,i=i[0].value),l={type:s,message_id:++message_id,method:t,message:i},o)return function(e,t){var r=e.type,i=_slicedToArray(findTarget(e.method,t,"main_send"===r?main_worker_targets:targets),2),n=i[0],o=i[1],a="Worker broker could not dispatch message type ".concat(e.method," on target ").concat(e.target,".");if(!o)throw Error(a+ERROR_NO_TARGET);var s="function"==typeof o[n]&&o[n];if(!s)throw Error(a+ERROR_NO_METHOD);return new Promise((function(t,r){var i;try{i=s.apply(o,e.message)}catch(e){return void r(e)}i instanceof Promise?i.then((function(e){e instanceof WorkerBroker.withTransferables&&(e=e.value[0]),t(e)}),(function(e){r(e instanceof Error?"".concat(e.message,": ").concat(e.stack):e)})):(i instanceof WorkerBroker.withTransferables&&(i=i.value[0]),t(i))}))}(l,e&&e.init?e:void 0);var c=new Promise((function(e,r){messages[message_id]={method:t,message:i,resolve:e,reject:r}}));return a.stringify&&(l=JSON.stringify(l)),e.postMessage(l,u.map((function(e){return e.object}))),freeTransferables(u),c},WorkerBroker.addWorker=function(e){if(!(e instanceof Worker))throw Error("Worker broker could not add non-Worker object",e);e.addEventListener("message",(function(t){var r="string"==typeof t.data?JSON.parse(t.data):t.data,i=r.message_id;if("worker_reply"===r.type)messages[i]&&(r.error?messages[i].reject(r.error):messages[i].resolve(r.message),delete messages[i]);else if("worker_send"===r.type&&null!=i){var n=_slicedToArray(findTarget(r.method),2),o=n[0],a=n[1],s="Worker broker could not dispatch message type ".concat(r.method," on target ").concat(r.target,".");if(!a)throw Error(s+ERROR_NO_TARGET);var l="function"==typeof a[o]&&a[o];if(!l)throw Error(s+ERROR_NO_METHOD);var u,c=ERROR_NOT_SET;try{u=l.apply(a,r.message)}catch(e){c=e}var h,f=[];u&&"function"==typeof u.then?u.then((function(t){t instanceof WorkerBroker.withTransferables&&(f=t.transferables,t=t.value[0]),h={type:"main_reply",message_id:i,message:t},e.postMessage(h,f.map((function(e){return e.object}))),freeTransferables(f)}),(function(t){e.postMessage({type:"main_reply",message_id:i,error:t instanceof Error?"".concat(t.message,": ").concat(t.stack):t})})):(u instanceof WorkerBroker.withTransferables&&(f=u.transferables,u=u.value[0]),h={type:"main_reply",message_id:i,message:u,error:c instanceof Error?"".concat(c.message,": ").concat(c.stack):c},e.postMessage(h,f.map((function(e){return e.object}))),freeTransferables(f))}}))},WorkerBroker.getMessages=function(){return messages},WorkerBroker.getMessageId=function(){return message_id}}function setupWorkerThread(){WorkerBroker.postMessage=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var n={};"object"===_typeof(e)&&(n=e,e=e.method);var o,a=new Promise((function(t,i){messages[message_id]={method:e,message:r,resolve:t,reject:i}})),s=[];return r&&1===r.length&&r[0]instanceof WorkerBroker.withTransferables&&(s=r[0].transferables,r=r[0].value),o={type:"worker_send",message_id:message_id,method:e,message:r},n.stringify&&(o=JSON.stringify(o)),self.postMessage(o,s.map((function(e){return e.object}))),freeTransferables(s),message_id++,a},self.addEventListener("message",(function(e){var t="string"==typeof e.data?JSON.parse(e.data):e.data,r=t.message_id;if("main_reply"===t.type)messages[r]&&(t.hasOwnProperty("error")&&t.error!==ERROR_NOT_SET?messages[r].reject(t.error):messages[r].resolve(t.message),delete messages[r]);else if("main_send"===t.type&&null!=r){var i=_slicedToArray(findTarget(t.method),2),n=i[0],o=i[1],a="Worker broker could not dispatch message type ".concat(t.method," on target ").concat(t.target,".");if(!o)throw Error(a+ERROR_NO_TARGET);var s,l,u="function"==typeof o[n]&&o[n];if(!u)throw Error(a+ERROR_NO_METHOD);try{s=u.apply(o,t.message)}catch(e){l=e}var c,h=[];s instanceof Promise?s.then((function(e){e instanceof WorkerBroker.withTransferables&&(h=e.transferables,e=e.value[0]),c={type:"worker_reply",message_id:r,message:e},self.postMessage(c,h.map((function(e){return e.object}))),freeTransferables(h)}),(function(e){self.postMessage({type:"worker_reply",message_id:r,error:e instanceof Error?"".concat(e.message,": ").concat(e.stack):e})})):(s instanceof WorkerBroker.withTransferables&&(h=s.transferables,s=s.value[0]),c={type:"worker_reply",message_id:r,message:s,error:l instanceof Error?"".concat(l.message,": ").concat(l.stack):l},self.postMessage(c,h.map((function(e){return e.object}))),freeTransferables(h))}}))}function findTransferables(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!e)return i;if(Array.isArray(e))e.forEach((function(t,r){return findTransferables(t,e,r,i)}));else if("object"===_typeof(e))if(e instanceof ArrayBuffer)i.push({object:e,parent:t,property:r});else if(e.buffer instanceof ArrayBuffer)i.push({object:e.buffer,parent:t,property:r});else for(var n in e)findTransferables(e[n],e,n,i);return i}function freeTransferables(e){Array.isArray(e)&&e.filter((function(e){return e.parent&&e.property})).forEach((function(e){return delete e.parent[e.property]}))}WorkerBroker.withTransferables=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!(this instanceof WorkerBroker.withTransferables))return _construct(WorkerBroker.withTransferables,t);this.value=t,this.transferables=findTransferables(this.value)},Thread.is_main&&setupMainThread(),Thread.is_worker&&setupWorkerThread();var LEVELS={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},methods={},logged_once={},Utils;function methodForLevel(e){return methods[e]=methods[e]||(console[e]?console[e]:console.log).bind(console),methods[e]}function log(e){var t="object"===_typeof(e)?e.level:e;if(LEVELS[t]<=LEVELS[log.level]){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];if(Thread.is_native_worker)WorkerBroker.postMessage.apply(WorkerBroker,[{method:"_logProxy",stringify:!0},e].concat(i));else{if("object"===_typeof(e)&&!0===e.once){if(logged_once[JSON.stringify(i)])return;logged_once[JSON.stringify(i)]=!0}var o=methodForLevel(t);i.length>1?o.apply(void 0,["Tangram [".concat(t,"]: ").concat(i[0])].concat(_toConsumableArray(i.slice(1)))):o("Tangram [".concat(t,"]: ").concat(i[0]))}}}function debounce(e,t,r){var i,n;return r=r||0,function(){var o=this,a=arguments;function s(){n=0,e.apply(o,a)}clearTimeout(i),n&&r&&Date.now()-n>=r?s():(n||(n=Date.now()),i=setTimeout((function(){s()}),t))}}log.level="info",log.workers=null,log.setLevel=function(e){log.level=e,Thread.is_main&&Array.isArray(log.workers)&&WorkerBroker.postMessage(log.workers,"_logSetLevelProxy",e)},Thread.is_main&&(log.setWorkers=function(e){log.workers=e},log.reset=function(){logged_once={}}),WorkerBroker.addTarget("_logProxy",log),WorkerBroker.addTarget("_logSetLevelProxy",log.setLevel);var Utils$1=Utils={};WorkerBroker.addTarget("Utils",Utils),Utils.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Utils.isMicrosoft=function(){return/(Trident\/7.0|Edge[ /](\d+[\.\d]+))/i.test(navigator.userAgent)},Utils._requests={},Utils._proxy_requests={},Utils.io=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"GET",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(Thread.is_worker&&Utils.isMicrosoft())return log("debug","Proxying request for URL to worker",e),o&&(Utils._proxy_requests[o]=!0),WorkerBroker.postMessage("Utils.io",e,t,r,i,n,o,!0);var s=new XMLHttpRequest,l=new Promise((function(n,o){s.open(i,e,!0),s.timeout=t,s.responseType=r,s.onload=function(){200===s.status?["text","json"].indexOf(s.responseType)>-1?n(s.responseText):n(s.response):o(Error("Request error with a status of "+s.statusText))},s.onerror=function(e){o(Error("There was a network error"+e.toString()))},s.ontimeout=function(e){o(Error("timeout "+e.toString()))},s.send()}));return l=l.then((function(e){return o&&delete Utils._requests[o],a?WorkerBroker.withTransferables(e):e})),o&&(Utils._requests[o]=s),l},Utils.cancelRequest=function(e){if(Thread.is_worker&&Utils._proxy_requests[e])return WorkerBroker.postMessage("Utils.cancelRequest",e);Utils._requests[e]?(log("trace","Cancelling network request key '".concat(e,"'")),Utils._requests[e].abort(),delete Utils._requests[e]):log("trace","Could not find network request key '".concat(e,"'"))},Utils.requestAnimationFramePolyfill=function(){"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)})},Utils.serializeWithFunctions=function(e){return"function"==typeof e?e.toString():JSON.stringify(e,(function(e,t){return"function"==typeof t?t.toString():t}))},Utils.stringsToFunctions=function(e,t){if("string"==typeof e)e=Utils.stringToFunction(e,t);else if(null!=e&&"object"===_typeof(e))for(var r in e)e[r]=Utils.stringsToFunctions(e[r],t);return e},Utils._use_count=0,Utils._function_cache={};var _clear_function_cache=debounce((function(){log("trace","Cleared cached ".concat(Object.keys(Utils._function_cache).length," functions (reused ").concat(Utils._use_count," times)")),Utils._use_count=0,Utils._function_cache={}}),1e4),FUNCTION_MATCH_RGX=/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m,_createObjectURL,_revokeObjectURL;function addBaseURL(e,t){if(!e||!isRelativeURL(e))return e;var r,i="/"!==e[0];if(t?(r=document.createElement("a")).href=t:r=window.location,i){e=pathForURL(r.href)+e}else{var n=r.origin;n||(n=r.protocol+"//"+r.host),e=n+e}return e}function pathForURL(e){if("string"==typeof e&&-1===e.search(/^(data|blob):/)){var t=e.indexOf("?");t>-1&&(e=e.substr(0,t));var r=e.indexOf("#");return r>-1&&(e=e.substr(0,r)),e.substr(0,e.lastIndexOf("/")+1)||""}return""}function extensionForURL(e){var t=(e=e.split("/").pop()).lastIndexOf(".");if(t>-1)return e.substring(t+1)}function isRelativeURL(e){if("string"==typeof e)return!(e.search(/^(http|https|data|blob):/)>-1||"//"===e.substr(0,2))}function addParamsToURL(e,t){if(!t||0===Object.keys(t).length)return[e,[]];var r=e.indexOf("?"),i=e.indexOf("#"),n="";i>-1&&(n=e.slice(i),e=e.slice(0,i)),-1===r&&(r=e.length,e+="?"),r++;var o="",a=[];for(var s in t)""===getURLParameter(s,e)?o+="".concat(s,"=").concat(t[s],"&"):a.push([s,t[s]]);return[e=e.slice(0,r)+o+e.slice(r)+n,a]}function createObjectURL(e){return void 0===_createObjectURL&&"function"!=typeof(_createObjectURL=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(_createObjectURL=null,log("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),_createObjectURL?_createObjectURL(e):e}function revokeObjectURL(e){return void 0===_revokeObjectURL&&"function"!=typeof(_revokeObjectURL=window.URL&&window.URL.revokeObjectURL||window.webkitURL&&window.webkitURL.revokeObjectURL)&&(_revokeObjectURL=null,log("warn","window.URL.revokeObjectURL (or vendor prefix) not found, unable to create local blob URLs")),_revokeObjectURL?_revokeObjectURL(e):e}function getURLParameter(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}Utils.stringToFunction=function(e,t){var r=e;t&&(r+=t.toString());var i=Utils._function_cache[r];if(_clear_function_cache(),i)return Utils._use_count++,i;var n="string"==typeof e&&e.match(FUNCTION_MATCH_RGX);if(n&&n.length>2)try{var o=n[2],a=n[1].length>0&&n[1].split(",").map((function(e){return e.trim()})).filter((function(e){return e}));a=a.length>0?a:["context"];var s=new Function(a.toString(),"function"==typeof t?t(o):o);return Utils._function_cache[r]=s,s}catch(t){return e}return e},Utils.device_pixel_ratio=1,Utils.isPowerOf2=function(e){return 0==(e&e-1)},Utils.interpolate=function(e,t,r){if(!Array.isArray(t)||!Array.isArray(t[0]))return t;if(t.length<1)return t;var i,n,o,a,s;if(e<=t[0][0])a=t[0][1],"function"==typeof r&&(a=r(a));else if(e>=t[t.length-1][0])a=t[t.length-1][1],"function"==typeof r&&(a=r(a));else for(var l=0;l<t.length-1;l++)if(e>=t[l][0]&&e<t[l+1][0]){if(i=t[l][0],n=t[l+1][0],Array.isArray(t[l][1])){a=[];for(var u=0;u<t[l][1].length;u++)"function"==typeof r?(s=r(t[l][1][u]),o=r(t[l+1][1][u])-s,a[u]=o*(e-i)/(n-i)+s):(o=t[l+1][1][u]-t[l][1][u],a[u]=o*(e-i)/(n-i)+t[l][1][u])}else"function"==typeof r?(s=r(t[l][1]),a=(o=r(t[l+1][1])-s)*(e-i)/(n-i)+s):a=(o=t[l+1][1]-t[l][1])*(e-i)/(n-i)+t[l][1];break}return a},Utils.toCSSColor=function(e){return 1===e[3]?"rgb(".concat(e.slice(0,3).map((function(e){return Math.round(255*e)})).join(", "),")"):"rgba(".concat(e.map((function(e,t){return t<3&&Math.round(255*e)||e})).join(", "),")")},Utils.pointInTile=function(e){return e[0]>=0&&e[1]>-Geo$1.tile_scale&&e[0]<Geo$1.tile_scale&&e[1]<=0},Utils.zoomToTileLevel=function(e){return Math.floor(e)};var DataSource=function(){function e(t,r){var i=this;if(_classCallCheck(this,e),this.config=t,this.sources=r,this.id=t.id,this.name=t.name,this.pad_scale=t.pad_scale||1e-4,this.default_winding=null,this.rasters=[],Array.isArray(t.rasters)&&t.rasters.forEach((function(e){-1===i.rasters.indexOf(e)&&i.rasters.push(e)})),this.preprocess=t.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=t.transform,"function"==typeof this.transform)this.transform=this.transform.bind(this);else if("object"===_typeof(this.transform))for(var n in this.transform)"function"==typeof this.transform[n]&&(this.transform[n]=this.transform[n].bind(this));this.extra_data=t.extra_data,this.scripts=t.scripts,this.max_zoom=null!=t.max_zoom?t.max_zoom:Geo$1.default_source_max_zoom,this.setTileSize(t.tile_size),this.max_coord_zoom=this.max_zoom+this.zoom_bias,this.min_display_zoom=null!=t.min_display_zoom?t.min_display_zoom:0,this.max_display_zoom=null!=t.max_display_zoom?t.max_display_zoom:null,this._has_volatile_data=!!t.has_volatile_data}return _createClass(e,[{key:"hasLabeledData",value:function(){return!0}},{key:"_transformTile",value:function(e){if(e.source_data.layers){var t={coords:e.coords},r=[];if("function"==typeof this.transform)r.push(this.transform);else if("object"===_typeof(this.transform))for(var i=Object.keys(this.transform).sort(),n=0;n<i.length;n++)r.push(this.transform[i[n]]);for(var o=1===Object.keys(e.source_data.layers).length&&e.source_data.layers._default,a=0;a<r.length;a++)o?e.source_data.layers._default=r[a](e.source_data.layers._default,this.extra_data,t):e.source_data.layers=r[a](e.source_data.layers,this.extra_data,t)}}},{key:"_postProcessTile",value:function(e){var t=this;for(var r in this._transformTile(e),e.source_data.layers){var i=e.source_data.layers[r];i&&i.features&&i.features.forEach((function(e){Geo$1.transformGeometry(e.geometry,(function(e){e[1]=-e[1],t.pad_scale&&(e[0]=Math.round(e[0]*(1+t.pad_scale)-Geo$1.tile_scale*t.pad_scale/2),e[1]=Math.round(e[1]*(1+t.pad_scale)-Geo$1.tile_scale*t.pad_scale/2))})),t.updateDefaultWinding(e.geometry)}))}e.default_winding=this.default_winding||"CCW"}},{key:"load",value:function(e){return e.source_data={},e.source_data.layers={},e.pad_scale=this.pad_scale,e.rasters=_toConsumableArray(this.rasters),this._load(e)}},{key:"_load",value:function(e){throw new MethodNotImplemented("_load")}},{key:"setTileSize",value:function(e){this.tile_size=e||256,("number"!=typeof this.tile_size||this.tile_size<256||!Utils$1.isPowerOf2(this.tile_size))&&(log({level:"warn",once:!0},"Data source '".concat(this.name,"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '").concat(e,"'")),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8}},{key:"updateDefaultWinding",value:function(e){return null==this.default_winding&&("Polygon"===e.type?this.default_winding=Geo$1.ringWinding(e.coordinates[0]):"MultiPolygon"===e.type&&(this.default_winding=Geo$1.ringWinding(e.coordinates[0][0]))),this.default_winding}},{key:"includesTile",value:function(e,t){if(e.z<this.min_display_zoom||null!=this.max_display_zoom&&t>this.max_display_zoom)return!1;for(var r=0;r<this.rasters.length;r++){var i=this.rasters[r];if(this.sources[i]&&this.sources[i]!==this&&!this.sources[i].includesTile(e,e.z))return!1}return!0}},{key:"has_volatile_data",get:function(){return this._has_volatile_data},set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._has_volatile_data=e}}],[{key:"create",value:function(t,r){for(var i in r)if(r[i].config.name===t.name&&e.sameConfig(r[i],{config:t}))return r[i];if(e.types[t.type])return new e.types[t.type](t,r)}},{key:"sameConfig",value:function(e,t){if(!e||!t)return!1;var r=Object.assign({},e.config,{id:null,tiled:null,url:null}),i=Object.assign({},t.config,{id:null,tiled:null,url:null});return JSON.stringify(r)===JSON.stringify(i)}},{key:"coordsToMeters",value:function(e){var t=_slicedToArray(Geo$1.latLngToMeters(e),2),r=t[0],i=t[1];e[0]=r,e[1]=i}},{key:"projectData",value:function(t){for(var r in t.layers)for(var i=t.layers[r].features.length,n=0;n<i;n++){var o=t.layers[r].features[n];Geo$1.transformGeometry(o.geometry,e.coordsToMeters)}}},{key:"metersToTileUnits",value:function(e,t,r){r[0]=Math.round((r[0]-t.x)*e),r[1]=-1*Math.round((r[1]-t.y)*e)}},{key:"scaleData",value:function(t,r){var i=r.coords.z,n=r.min;r.max;var o=e.metersToTileUnits.bind(this,Geo$1.unitsPerMeter(i),n);for(var a in t.layers)for(var s=t.layers[a].features.length,l=0;l<s;l++){var u=t.layers[a].features[l];Geo$1.transformGeometry(u.geometry,o)}}},{key:"register",value:function(t,r){t&&r&&(e.types[r]=t)}}]),e}();DataSource.types={};var network_request_id=0,NetworkSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;_classCallCheck(this,r),(n=t.call(this,e,i)).response_type="";var o=_slicedToArray(addParamsToURL(e.url,e.url_params),2),a=o[0],s=o[1];if(n.url=a,s.forEach((function(t){var r=_slicedToArray(t,2),i=r[0],o=r[1];log({level:"warn",once:!0},"Data source '".concat(n.name,"': parameter '").concat(i,"' already present in URL '").concat(e.url,"', ")+"skipping value '".concat(i,"=").concat(o,"' specified in 'url_params'"))})),"string"!=typeof n.url)throw Error("Network data source must provide a string `url` property");return n}return _createClass(r,[{key:"_load",value:function(e){var t=this,r=this.formatUrl(this.url,e),i=e.source_data;return i.url=r,new Promise((function(n,o){i.error=null;var a=network_request_id+++"-"+r,s=Utils$1.io(r,6e4,t.response_type,"GET",{},a);i.request_id=a,s.then((function(r){"function"==typeof t.preprocess&&(r=t.preprocess(r)),(r=r instanceof Promise?r:Promise.resolve(r)).then((function(r){t.parseSourceData(e,i,r),t._postProcessTile(e),n(e)}))}),(function(r){i.error=r.stack,t._postProcessTile(e),n(e)}))}))}},{key:"formatUrl",value:function(e,t){throw new MethodNotImplemented("formatUrl")}},{key:"parseSourceData",value:function(e,t,r){throw new MethodNotImplemented("parseSourceData")}}]),r}(DataSource),NetworkTileSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),(n=t.call(this,e,i)).tiled=!0,n.parseBounds(e),n.builds_geometry_tiles=!1,n.tms=!0===e.tms,n.url.search("{s}")>-1&&(Array.isArray(e.url_subdomains)&&e.url_subdomains.length>0?(n.url_subdomains=e.url_subdomains,n.next_url_subdomain=0):log({level:"warn",once:!0},"Data source '".concat(n.name,"': source URL includes '{s}' subdomain marker ('").concat(n.url,"'), but no subdomains ")+"were specified in 'url_subdomains' parameter")),n}return _createClass(r,[{key:"parseBounds",value:function(e){if(Array.isArray(e.bounds)&&4===e.bounds.length){this.bounds=e.bounds;var t=_slicedToArray(this.bounds,4),r=t[0],i=t[1],n=t[2],o=t[3];this.bounds_meters={min:Geo$1.latLngToMeters([r,o]),max:Geo$1.latLngToMeters([n,i])},this.bounds_tiles={min:{},max:{}}}}},{key:"checkBounds",value:function(e){if(this.bounds){e=Geo$1.wrapTile(e,{x:!0});var t=this.bounds_tiles.min[e.z];t||(t=this.bounds_tiles.min[e.z]=Geo$1.tileForMeters(this.bounds_meters.min,e.z));var r=this.bounds_tiles.max[e.z];if(r||(r=this.bounds_tiles.max[e.z]=Geo$1.tileForMeters(this.bounds_meters.max,e.z)),e.x<t.x||e.x>r.x||e.y<t.y||e.y>r.y)return!1}return!0}},{key:"includesTile",value:function(e,t){return!!_get(_getPrototypeOf(r.prototype),"includesTile",this).call(this,e,t)&&!!this.checkBounds(e)}},{key:"formatUrl",value:function(e,t){var r=Geo$1.wrapTile(t.coords,{x:!0});this.tms&&(r.y=Math.pow(2,r.z)-1-r.y);var i=e.replace("{x}",r.x).replace("{y}",r.y).replace("{z}",r.z);return null!=this.url_subdomains&&(i=i.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),i}},{key:"urlHasTilePattern",value:function(e){return e&&e.search("{x}")>-1&&e.search("{y}")>-1&&e.search("{z}")>-1}}]),r}(NetworkSource),MapsJsSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),(n=t.call(this,e,i)).target_name="MapsJsSource"+e.uid,n.tiled=!!e.tiled,WorkerBroker.addTarget(n.target_name,_assertThisInitialized(n)),Thread.is_worker&&WorkerBroker.postMessage(n.target_name+".onWorkerInitialized"),Thread.is_main&&(n._workers_left=0),n}return _createClass(r,[{key:"initialize",value:function(e,t,r,i){this._main_initialized||(this.provider=e,this.worker=i,this._workers_left+=r,this._on_update=t,this._main_initialized=!0,this._onProviderUpdate=this._onProviderUpdate.bind(this),e.addEventListener("update",this._onProviderUpdate),this._isReady()&&this.onReady())}},{key:"onWorkerInitialized",value:function(){--this._workers_left,this._isReady()&&this.onReady()}},{key:"onReady",value:function(){}},{key:"_isReady",value:function(){return this._main_initialized&&!this._workers_left}},{key:"_onProviderUpdate",value:function(e){this._isReady()&&this.onProviderUpdate(e)}},{key:"onProviderUpdate",value:function(e){this.dispatchUpdate(void 0,e.data)}},{key:"dispatchUpdate",value:function(e,t){this._on_update(this.name,e,t)}},{key:"dispose",value:function(){WorkerBroker.removeTarget(this.target_name),this.provider.removeEventListener("update",this._onProviderUpdate)}}]),r}(DataSource),ieee754$1={read:function(e,t,r,i,n){var o,a,s=8*n-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?n-1:0,f=r?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,i),o-=u}return(d?-1:1)*a*Math.pow(2,o-i)},write:function(e,t,r,i,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,_=i?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,n),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;e[r+d]=255&s,d+=_,s/=256,n-=8);for(a=a<<n|s,u+=n;u>0;e[r+d]=255&a,d+=_,a/=256,u-=8);e[r+d-_]|=128*p}},pbf=Pbf,ieee754=ieee754$1;function Pbf(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32;function readVarintRemainder(e,t,r){var i,n,o=r.buf;if(i=(112&(n=o[r.pos++]))>>4,n<128)return toNum(e,i,t);if(i|=(127&(n=o[r.pos++]))<<3,n<128)return toNum(e,i,t);if(i|=(127&(n=o[r.pos++]))<<10,n<128)return toNum(e,i,t);if(i|=(127&(n=o[r.pos++]))<<17,n<128)return toNum(e,i,t);if(i|=(127&(n=o[r.pos++]))<<24,n<128)return toNum(e,i,t);if(i|=(1&(n=o[r.pos++]))<<31,n<128)return toNum(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(e){return e.type===Pbf.Bytes?e.readVarint()+e.pos:e.pos+1}function toNum(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function writeBigVarint(e,t){var r,i;if(e>=0?(r=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),writeBigVarintLow(r,i,t),writeBigVarintHigh(i,t)}function writeBigVarintLow(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}function writeBigVarintHigh(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}function makeRoomForExtraLength(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=e;n--)r.buf[n+i]=r.buf[n]}function writePackedVarint(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function writePackedSVarint(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function writePackedFloat(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function writePackedDouble(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function writePackedBoolean(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function writePackedFixed32(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function writePackedSFixed32(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function writePackedFixed64(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function writePackedSFixed64(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function readUInt32(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function writeInt32(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function readInt32(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function readUtf8(e,t,r){for(var i="",n=t;n<r;){var o,a,s,l=e[n],u=null,c=l>239?4:l>223?3:l>191?2:1;if(n+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(o=e[n+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=e[n+1],a=e[n+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=e[n+1],a=e[n+2],s=e[n+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),n+=c}return i}function writeUtf8(e,t,r){for(var i,n,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):n=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(e[r++]=239,e[r++]=191,e[r++]=189,n=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,e(n,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=readUInt32(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=readInt32(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,e},readSFixed64:function(){var e=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,e},readFloat:function(){var e=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,i=this.buf;return t=127&(r=i[this.pos++]),r<128?t:(t|=(127&(r=i[this.pos++]))<<7,r<128?t:(t|=(127&(r=i[this.pos++]))<<14,r<128?t:(t|=(127&(r=i[this.pos++]))<<21,r<128?t:readVarintRemainder(t|=(15&(r=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=readUtf8(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=readPackedEnd(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(t===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Pbf.Fixed32)this.pos+=4;else{if(t!==Pbf.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?writeBigVarint(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=writeUtf8(this.buf,e,this.pos);var r=this.pos-t;r>=128&&makeRoomForExtraLength(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),ieee754.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ieee754.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&makeRoomForExtraLength(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,Pbf.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,writePackedVarint,t)},writePackedSVarint:function(e,t){this.writeMessage(e,writePackedSVarint,t)},writePackedBoolean:function(e,t){this.writeMessage(e,writePackedBoolean,t)},writePackedFloat:function(e,t){this.writeMessage(e,writePackedFloat,t)},writePackedDouble:function(e,t){this.writeMessage(e,writePackedDouble,t)},writePackedFixed32:function(e,t){this.writeMessage(e,writePackedFixed32,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,writePackedSFixed32,t)},writePackedFixed64:function(e,t){this.writeMessage(e,writePackedFixed64,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,writePackedSFixed64,t)},writeBytesField:function(e,t){this.writeTag(e,Pbf.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Pbf.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Pbf.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Pbf.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Pbf.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Pbf.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Pbf$1=getDefaultExportFromCjs(pbf),pointGeometry=Point$1;function Point$1(e,t){this.x=e,this.y=t}Point$1.prototype={clone:function(){return new Point$1(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=t*this.x-r*this.y,n=r*this.x+t*this.y;return this.x=i,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),n=t.x+r*(this.x-t.x)-i*(this.y-t.y),o=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point$1.convert=function(e){return e instanceof Point$1?e:Array.isArray(e)?new Point$1(e[0],e[1]):e};var Point=pointGeometry,vectortilefeature=VectorTileFeature$2;function VectorTileFeature$2(e,t,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=n,e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t.id=r.readVarint():2==e?readTag(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function readTag(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n}}function classifyRings(e){var t=e.length;if(t<=1)return[e];for(var r,i,n=[],o=0;o<t;o++){var a=signedArea$1(e[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[e[o]]):r.push(e[o]))}return r&&n.push(r),n}function signedArea$1(e){for(var t,r,i=0,n=0,o=e.length,a=o-1;n<o;a=n++)t=e[n],i+=((r=e[a]).x-t.x)*(t.y+r.y);return i}VectorTileFeature$2.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature$2.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,n=0,o=0,a=0,s=[];e.pos<r;){if(!n){var l=e.readVarint();i=7&l,n=l>>3}if(n--,1===i||2===i)o+=e.readSVarint(),a+=e.readSVarint(),1===i&&(t&&s.push(t),t=[]),t.push(new Point(o,a));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&s.push(t),s},VectorTileFeature$2.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;e.pos<t;){if(!i){var c=e.readVarint();r=7&c,i=c>>3}if(i--,1===r||2===r)(n+=e.readSVarint())<a&&(a=n),n>s&&(s=n),(o+=e.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},VectorTileFeature$2.prototype.toGeoJSON=function(e,t,r){var i,n,o=this.extent*Math.pow(2,r),a=this.extent*e,s=this.extent*t,l=this.loadGeometry(),u=VectorTileFeature$2.types[this.type];function c(e){for(var t=0;t<e.length;t++){var r=e[t],i=180-360*(r.y+s)/o;e[t]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];c(l=h);break;case 2:for(i=0;i<l.length;i++)c(l[i]);break;case 3:for(l=classifyRings(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)c(l[i][n])}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var VectorTileFeature$1=vectortilefeature;function VectorTileLayer$1(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer$1,this,t),this.length=this._features.length}function readLayer$1(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage$1(r))}function readValueMessage$1(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}VectorTileLayer$1.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature$1(this._pbf,t,this.extent,this._keys,this._values)};var VectorTileFeature=vectortilefeature,long=Long,wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function isLong(e){return!0===(e&&e.__isLong__)}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,t){var r,i,n;return t?(n=0<=(e>>>=0)&&e<256)&&(i=UINT_CACHE[e])?i:(r=fromBits(e,(0|e)<0?-1:0,!0),n&&(UINT_CACHE[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(i=INT_CACHE[e])?i:(r=fromBits(e,e<0?-1:0,!1),n&&(INT_CACHE[e]=r),r)}function fromNumber(e,t){if(isNaN(e))return t?UZERO:ZERO;if(t){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE$1}return e<0?fromNumber(-e,t).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,t)}function fromBits(e,t,r){return new Long(e,t,r)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString$1(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return ZERO;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return fromString$1(e.substring(1),t,r).neg();for(var n=fromNumber(pow_dbl(r,8)),o=ZERO,a=0;a<e.length;a+=8){var s=Math.min(8,e.length-a),l=parseInt(e.substring(a,a+s),r);if(s<8){var u=fromNumber(pow_dbl(r,s));o=o.mul(u).add(fromNumber(l))}else o=(o=o.mul(n)).add(fromNumber(l))}return o.unsigned=t,o}function fromValue(e,t){return"number"==typeof e?fromNumber(e,t):"string"==typeof e?fromString$1(e,t):fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Long.fromString=fromString$1,Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE$1=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE$1;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var t=fromNumber(e),r=this.div(t),i=r.mul(t).sub(this);return r.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var n=fromNumber(pow_dbl(e,6),this.unsigned),o=this,a="";;){var s=o.div(n),l=(o.sub(s.mul(n)).toInt()>>>0).toString(e);if((o=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return 1==(1&this.low)},LongPrototype.isEven=function(){return 0==(1&this.low)},LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(e){return!this.eq(e)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(e){return this.comp(e)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(e){return this.comp(e)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,n=65535&this.low,o=e.high>>>16,a=65535&e.high,s=e.low>>>16,l=0,u=0,c=0,h=0;return c+=(h+=n+(65535&e.low))>>>16,u+=(c+=i+s)>>>16,l+=(u+=r+a)>>>16,l+=t+o,fromBits((c&=65535)<<16|(h&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(e){if(this.isZero())return ZERO;if(isLong(e)||(e=fromValue(e)),wasm)return fromBits(wasm.mul(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned);if(e.isZero())return ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,n=65535&this.low,o=e.high>>>16,a=65535&e.high,s=e.low>>>16,l=65535&e.low,u=0,c=0,h=0,f=0;return h+=(f+=n*l)>>>16,c+=(h+=i*l)>>>16,h&=65535,c+=(h+=n*s)>>>16,u+=(c+=r*l)>>>16,c&=65535,u+=(c+=i*s)>>>16,c&=65535,u+=(c+=n*a)>>>16,u+=t*l+r*s+i*a+n*o,fromBits((h&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");var t,r,i;if(wasm)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?fromBits((this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?UZERO:ZERO;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;i=UZERO}else{if(this.eq(MIN_VALUE))return e.eq(ONE)||e.eq(NEG_ONE)?MIN_VALUE:e.eq(MIN_VALUE)?ONE:(t=this.shr(1).div(e).shl(1)).eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ZERO}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var n=Math.ceil(Math.log(t)/Math.LN2),o=n<=48?1:pow_dbl(2,n-48),a=fromNumber(t),s=a.mul(e);s.isNegative()||s.gt(r);)s=(a=fromNumber(t-=o,this.unsigned)).mul(e);a.isZero()&&(a=ONE),i=i.add(a),r=r.sub(s)}return i},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(e){return isLong(e)||(e=fromValue(e)),wasm?fromBits((this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(e){if(isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?fromBits(this.low>>>e|t<<32-e,t>>>e,this.unsigned):fromBits(32===e?t:t>>>e-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LongPrototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Long.fromBytes=function(e,t,r){return r?Long.fromBytesLE(e,t):Long.fromBytesBE(e,t)},Long.fromBytesLE=function(e,t){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Long.fromBytesBE=function(e,t){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Long$1=getDefaultExportFromCjs(long),indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;return hasRequiredAspromise=1,aspromise=function(e,t){var r=new Array(arguments.length-1),i=0,n=2,o=!0;for(;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,a){r[i]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,a(e))}}))},aspromise}var base64$1={},hasRequiredBase64,eventemitter,hasRequiredEventemitter,float$1,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),i=new Array(123),n=0;n<64;)i[r[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;t.encode=function(e,t,i){for(var n,o=null,a=[],s=0,l=0;t<i;){var u=e[t++];switch(l){case 0:a[s++]=r[u>>2],n=(3&u)<<4,l=1;break;case 1:a[s++]=r[n|u>>4],n=(15&u)<<2,l=2;break;case 2:a[s++]=r[n|u>>6],a[s++]=r[63&u],l=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return l&&(a[s++]=r[n],a[s++]=61,1===l&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var o="invalid encoding";t.decode=function(e,t,r){for(var n,a=r,s=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&s>1)break;if(void 0===(u=i[u]))throw Error(o);switch(s){case 0:n=u,s=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:t[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error(o);return r-a},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(base64$1)),base64$1}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function e(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=e,e.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float$1;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),i=128===r[3];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function o(e,i,n){t[0]=e,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function a(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],t[0]}function s(e,i){return r[3]=e[i],r[2]=e[i+1],r[1]=e[i+2],r[0]=e[i+3],t[0]}e.writeFloatLE=i?n:o,e.writeFloatBE=i?o:n,e.readFloatLE=i?a:s,e.readFloatBE=i?s:a}():function(){function o(e,t,r,i){var n=t<0?1:0;if(n&&(t=-t),0===t)e(1/t>0?0:2147483648,r,i);else if(isNaN(t))e(2143289344,r,i);else if(t>34028234663852886e22)e((n<<31|2139095040)>>>0,r,i);else if(t<11754943508222875e-54)e((n<<31|Math.round(t/1401298464324817e-60))>>>0,r,i);else{var o=Math.floor(Math.log(t)/Math.LN2);e((n<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,i)}}function a(e,t,r){var i=e(t,r),n=2*(i>>31)+1,o=i>>>23&255,a=8388607&i;return 255===o?a?NaN:n*(1/0):0===o?1401298464324817e-60*n*a:n*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=o.bind(null,t),e.writeFloatBE=o.bind(null,r),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,n)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),i=128===r[7];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function o(e,i,n){t[0]=e,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function a(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],r[4]=e[i+4],r[5]=e[i+5],r[6]=e[i+6],r[7]=e[i+7],t[0]}function s(e,i){return r[7]=e[i],r[6]=e[i+1],r[5]=e[i+2],r[4]=e[i+3],r[3]=e[i+4],r[2]=e[i+5],r[1]=e[i+6],r[0]=e[i+7],t[0]}e.writeDoubleLE=i?n:o,e.writeDoubleBE=i?o:n,e.readDoubleLE=i?a:s,e.readDoubleBE=i?s:a}():function(){function o(e,t,r,i,n,o){var a=i<0?1:0;if(a&&(i=-i),0===i)e(0,n,o+t),e(1/i>0?0:2147483648,n,o+r);else if(isNaN(i))e(0,n,o+t),e(2146959360,n,o+r);else if(i>17976931348623157e292)e(0,n,o+t),e((a<<31|2146435072)>>>0,n,o+r);else{var s;if(i<22250738585072014e-324)e((s=i/5e-324)>>>0,n,o+t),e((a<<31|s/4294967296)>>>0,n,o+r);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(s=i*Math.pow(2,-l))>>>0,n,o+t),e((a<<31|l+1023<<20|1048576*s&1048575)>>>0,n,o+r)}}}function a(e,t,r,i,n){var o=e(i,n+t),a=e(i,n+r),s=2*(a>>31)+1,l=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===l?u?NaN:s*(1/0):0===l?5e-324*s*u:s*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=o.bind(null,t,0,4),e.writeDoubleBE=o.bind(null,r,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,n,4,0)}(),e}function t(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function r(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function n(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return hasRequiredFloat=1,float$1=e(e)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}return hasRequiredInquire=1,inquire_1=inquire,inquire_1}var utf8$2={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(e){var t=e;t.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)(r=e.charCodeAt(i))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var i,n=null,o=[],a=0;t<r;)(i=e[t++])<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),a=0);return n?(a&&n.push(String.fromCharCode.apply(String,o.slice(0,a))),n.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,r){for(var i,n,o=r,a=0;a<e.length;++a)(i=e.charCodeAt(a))<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=e.charCodeAt(a+1)))?(i=65536+((1023&i)<<10)+(1023&n),++a,t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128);return r-o}}(utf8$2)),utf8$2}function requirePool(){if(hasRequiredPool)return pool_1;return hasRequiredPool=1,pool_1=function(e,t,r){var i=r||8192,n=i>>>1,o=null,a=i;return function(r){if(r<1||r>n)return e(r);a+r>i&&(o=e(i),a=0);var s=t.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}},pool_1}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var i=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return r;var i=e<0;i&&(e=-e);var n=e>>>0,o=(e-n)/4294967296>>>0;return i&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new t(n,o)},t.from=function(i){if("number"==typeof i)return t.fromNumber(i);if(e.isString(i)){if(!e.Long)return t.fromNumber(parseInt(i,10));i=e.Long.fromString(i)}return i.low||i.high?new t(i.low>>>0,i.high>>>0):r},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var n=String.prototype.charCodeAt;return t.fromHash=function(e){return e===i?r:new t((n.call(e,0)|n.call(e,1)<<8|n.call(e,2)<<16|n.call(e,3)<<24)>>>0,(n.call(e,4)|n.call(e,5)<<8|n.call(e,6)<<16|n.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;function r(e,t,r){for(var i=Object.keys(t),n=0;n<i.length;++n)void 0!==e[i[n]]&&r||(e[i[n]]=t[i[n]]);return e}function i(e){function t(e,i){if(!(this instanceof t))return new t(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var i=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(i.lo,i.hi,r):i.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=i,t.ProtocolError=i("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State$2(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var r=Writer$1.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State$2(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal(),exports;function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,r,i,n,o){if(!n)throw TypeError("request must be specified");var a=this;if(!o)return util.asPromise(e,a,t,r,i,n);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},exports=rpc,exports.Service=service;var roots={};!function(e){var t=e;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=r,r()}(indexMinimal);var minimal=indexMinimal,protobuf=getDefaultExportFromCjs(minimal);protobuf.util.Long=Long$1,protobuf.configure(),VectorTileFeature.prototype.loadGeometry=function(e){var t=this._pbf;t.pos=this._geometry;for(var r,i=t.readVarint()+t.pos,n=1,o=0,a=0,s=0,l=[];t.pos<i;){if(o<=0){var u=t.readVarint();n=7&u,o=u>>3}if(o--,1===n||2===n)a+=t.readSVarint(),s+=t.readSVarint(),1===n&&(r&&l.push(r),r=[]),r.push([a*e,s*e]);else{if(7!==n)throw new Error("unknown command "+n);r&&r.push(r[0].slice())}}return r&&l.push(r),l};var MAX_SAFE_INTEGER=Long$1.fromNumber(Number.MAX_SAFE_INTEGER,!0),MIN_SAFE_INTEGER=Long$1.fromNumber(Number.MIN_SAFE_INTEGER,!1);function readLong(e,t,r){t.pos=e.pos;var i=r.call(t);return e.pos=t.pos,Long$1.isLong(i)?i.comp(MAX_SAFE_INTEGER)>0||i.comp(MIN_SAFE_INTEGER)<0?i.toString():i.toNumber():i}var VectorTileLayer=function(){function e(t,r){_classCallCheck(this,e),this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],this._protobufjsReader=protobuf.Reader.create(t.buf),t.readFields(readLayer,this,r),this.length=this._features.length}return _createClass(e,[{key:"feature",value:function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values)}}]),e}();function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage(r,t._protobufjsReader))}function readValueMessage(e,t){for(var r=null,i=e.readVarint()+e.pos;e.pos<i;){var n=e.readVarint()>>3;r=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?readLong(e,t,t.int64):5===n?readLong(e,t,t.uint64):6===n?readLong(e,t,t.sint64):7===n?e.readBoolean():null}return r}var VectorTile=function e(t,r){_classCallCheck(this,e),this.layers=t.readFields(readTile,{},r)};function readTile(e,t,r){if(3===e){var i=new VectorTileLayer(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}function getLayersFromMVT(e){var t={};for(var r in e.layers){for(var i=e.layers[r],n=[],o=Geo$1.tile_scale/i.extent,a=0,s=i.length;a<s;a++){var l,u=i.feature(a),c=VectorTileFeature.types[u.type];l=u.loadGeometry(o);var h=null;switch(c){case"Point":h=decodePoint({coordinates:l});break;case"LineString":h=1===l.length?{type:c,coordinates:l[0]}:{type:"MultiLineString",coordinates:l};break;case"Polygon":h=decodeMultiPolygon({coordinates:l})}h&&h.coordinates&&n.push({type:"Feature",geometry:h,properties:u.properties})}t[r]={type:"FeatureCollection",features:n}}return t}var GeomType={UNKNOWN:0,POINT:1,LINESTRING:2,POLYGON:3};function parseGeoJSONVectorTile(e){var t=[],r=e&&e.features;if(r)for(var i=0,n=r.length;i<n;i++){var o=r[i],a=o.type,s=void 0;switch(a){case GeomType.POINT:s={type:"MultiPoint",coordinates:o.geometry.map((function(e){return e.slice()}))};break;case GeomType.LINESTRING:case GeomType.POLYGON:if(s={type:"MultiLineString",coordinates:o.geometry.map((function(e){return e.map((function(e){return e.slice()}))}))},a===GeomType.POLYGON&&null==(s=decodeMultiPolygon(s)))continue;break;default:continue}t.push({id:o.id,type:"Feature",geometry:s,properties:o.tags})}return{type:"FeatureCollection",features:t}}function decodeMultiPolygon(e){for(var t,r=[],i=[],n=0,o=e.coordinates.length;n<o;n++){var a=e.coordinates[n],s=Geo$1.ringWinding(a);null!=s&&(s===(t=t||s)&&i.length&&(r.push(i),i=[]),i.push(a))}return i.length>0&&r.push(i),1===r.length?(e.type="Polygon",e.coordinates=r[0]):r.length>1?(e.type="MultiPolygon",e.coordinates=r):e=null,e}function decodePoint(e){var t=e.coordinates.length;if(t>1){e.type="MultiPoint";for(var r=[],i=0;i<t;i++)r.push(e.coordinates[i][0]);e.coordinates=r}else e.type="Point",e.coordinates=e.coordinates[0][0];return e}var EMPTY_FEATURE_COLLECTION$1={type:"FeatureCollection",features:[]},MVTSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){return _classCallCheck(this,r),e.tiled=!0,t.call(this,e,i)}return _createClass(r,[{key:"fetchTile",value:function(e,t,r){return this.provider?this.provider.requestTileAsPromise(e,t,r).then((function(e){return e.data})):Promise.resolve()}},{key:"_load",value:function(e){var t=this,r=Geo$1.wrapTile(e.coords,{x:!0,y:!0}),i=r.x,n=r.y,o=r.z;return WorkerBroker.postMessage(this.target_name+".fetchTile",i,n,o).then((function(r){if(r instanceof ArrayBuffer){var i=new Pbf$1(new Uint8Array(r));e.source_data.layers=getLayersFromMVT(new VectorTile(i))}else r?e.source_data.error=r:e.source_data.layers={_default:EMPTY_FEATURE_COLLECTION$1};return t._postProcessTile(e),e}))}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),r}(MapsJsSource);DataSource.register(MVTSource,"MVT"),DataSource.register(MVTSource,"OMV");var csscolorparser={},parseCSSColor_1,kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clamp_css_byte(e){return(e=Math.round(e))<0?0:e>255?255:e}function clamp_css_float(e){return e<0?0:e>1?1:e}function parse_css_int(e){return"%"===e[e.length-1]?clamp_css_byte(parseFloat(e)/100*255):clamp_css_byte(parseInt(e))}function parse_css_float(e){return"%"===e[e.length-1]?clamp_css_float(parseFloat(e)/100):clamp_css_float(parseFloat(e))}function css_hue_to_rgb(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function parseCSSColor(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=r.indexOf("("),n=r.indexOf(")");if(-1!==i&&n+1===r.length){var o=r.substr(0,i),a=r.substr(i+1,n-(i+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=parse_css_float(a.pop());case"rgb":return 3!==a.length?null:[parse_css_int(a[0]),parse_css_int(a[1]),parse_css_int(a[2]),s];case"hsla":if(4!==a.length)return null;s=parse_css_float(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=parse_css_float(a[1]),c=parse_css_float(a[2]),h=c<=.5?c*(u+1):c+u-c*u,f=2*c-h;return[clamp_css_byte(255*css_hue_to_rgb(f,h,l+1/3)),clamp_css_byte(255*css_hue_to_rgb(f,h,l)),clamp_css_byte(255*css_hue_to_rgb(f,h,l-1/3)),s];default:return null}}return null}try{parseCSSColor_1=csscolorparser.parseCSSColor=parseCSSColor}catch(e){}var StyleParser={},clampPositive=function(e){return Math.max(e,0)},noNaN=function(e){return isNaN(e)?0:e},parseNumber=function(e){return Array.isArray(e)?e.map(parseFloat).map(noNaN):noNaN(parseFloat(e))},parsePositiveNumber=function(e){return Array.isArray(e)?e.map(parseNumber).map(clampPositive):clampPositive(parseNumber(e))};Object.assign(StyleParser,{clampPositive:clampPositive,noNaN:noNaN,parseNumber:parseNumber,parsePositiveNumber:parsePositiveNumber}),StyleParser.wrapFunction=function(e){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var sources = context.sources;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n\n        var val = (function(){ ".concat(e," }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    ")},StyleParser.zeroPair=Object.freeze([0,0]),StyleParser.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},StyleParser.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},StyleParser.getFeatureParseContext=function(e,t,r,i){return{feature:e,tile:t,global:r,sources:i,zoom:t.style_zoom,geometry:Geo$1.geometryType(e.geometry.type),meters_per_pixel:t.meters_per_pixel,meters_per_pixel_sq:t.meters_per_pixel_sq,units_per_meter_overzoom:t.units_per_meter_overzoom}};var CACHE_TYPE={STATIC:0,DYNAMIC:1,ZOOM:2};StyleParser.CACHE_TYPE=CACHE_TYPE,StyleParser.createPropertyCache=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=e){if(e.value)return{value:e.value,zoom:e.zoom?{}:null,type:e.type};var r={value:e,type:CACHE_TYPE.STATIC};return Array.isArray(r.value)&&Array.isArray(r.value[0])?(r.zoom={},r.type=CACHE_TYPE.ZOOM):"function"==typeof r.value&&(r.type=CACHE_TYPE.DYNAMIC),"function"==typeof t&&(r.zoom?r.value=r.value.map((function(e,r){return[e[0],t(e[1],r)]})):"function"!=typeof r.value&&(r.value=t(r.value,0))),r}},StyleParser.createColorPropertyCache=function(e){return StyleParser.createPropertyCache(e,(function(e){return"Style.color.pseudoRandomColor"===e?Utils$1.stringToFunction(StyleParser.wrapFunction(StyleParser.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===e?StyleParser.macros["Style.color.randomColor"]:e}))};var isPercent=function(e){return"string"==typeof e&&"%"===e[e.length-1]},isRatio=function(e){return"auto"===e},isComputed=function(e){return isPercent(e)||isRatio(e)},dualRatioError="'size' can specify either width or height as derived from aspect ratio, but not both";StyleParser.createPointSizePropertyCache=function(e){var t=null,r=null;if(isPercent(e))t=[!0];else if(Array.isArray(e))if(Array.isArray(e[0])){if(e.some((function(e){return Array.isArray(e[1])?e[1].some((function(e){return isComputed(e)})):isPercent(e[1])}))&&(t=e.map((function(e){return Array.isArray(e[1])?e[1].map((function(e){return isPercent(e)})):isPercent(e[1])})),(r=e.map((function(e){return Array.isArray(e[1])&&e[1].map((function(e){return isRatio(e)}))}))).some((function(e){return Array.isArray(e)&&e.every((function(e){return e}))}))))throw dualRatioError}else if(e.some(isComputed)&&(t=[e.map(isPercent)],(r=[e.map(isRatio)])[0].every((function(e){return e}))))throw dualRatioError;return t?((e={value:e}).has_pct=t,e.has_ratio=r,e.sprites={}):e=StyleParser.createPropertyCache(e,parsePositiveNumber),e},StyleParser.evalCachedPointSizeProperty=function(e,t,r){return e.has_pct||e.has_ratio?t?(e.sprites[t.sprite]||(e.sprites[t.sprite]=StyleParser.createPropertyCache(e.value,(function(r,i){return Array.isArray(r)?(r=r.map((function(t,r){return e.has_ratio[i][r]?t:parsePositiveNumber(t)})).map((function(r,n){return e.has_pct[i][n]?t.css_size[n]*r/100:r})),e.has_ratio[i][0]?r[0]=r[1]*t.aspect:e.has_ratio[i][1]&&(r[1]=r[0]/t.aspect)):(r=parsePositiveNumber(r),r=e.has_pct[i]?t.css_size.map((function(e){return e*r/100})):[r,r]),r}))),StyleParser.evalCachedProperty(e.sprites[t.sprite],r)):void 0:StyleParser.evalCachedProperty(e,r)},StyleParser.evalCachedProperty=function(e,t){if(null!=e)return e.dynamic?e.dynamic(t):e.static?e.static:e.zoom&&e.zoom[t.zoom]?e.zoom[t.zoom]:"function"==typeof e.value?(e.dynamic=e.value,e.dynamic(t)):Array.isArray(e.value)&&Array.isArray(e.value[0])?(e.zoom=e.zoom||{},e.zoom[t.zoom]=Utils$1.interpolate(t.zoom,e.value),e.zoom[t.zoom]):(e.static=e.value,e.static)},StyleParser.convertUnits=function(e,t){if(null!=e.val)return"px"===e.units?e.val*Geo$1.metersPerPixel(t.zoom):e.val;if("string"==typeof e)"px"===e.trim().slice(-2)?(e=parseNumber(e),e*=Geo$1.metersPerPixel(t.zoom)):e=parseNumber(e);else if(Array.isArray(e))return Array.isArray(e[0])?e.map((function(e){return[e[0],StyleParser.convertUnits(e[1],t)]})):e.map((function(e){return StyleParser.convertUnits(e,t)}));return e},StyleParser.parseUnits=function(e){var t={val:parseNumber(e)};return 0!==t.val&&"string"==typeof e&&"px"===e.trim().slice(-2)&&(t.units="px"),t},StyleParser.evalCachedDistanceProperty=function(e,t){return e.dynamic?e.dynamic(t):e.zoom&&e.zoom[t.zoom]?e.zoom[t.zoom]:"function"==typeof e.value?(e.dynamic=e.value,e.dynamic(t)):e.zoom?(e.zoom[t.zoom]=Utils$1.interpolate(t.zoom,e.value,(function(e){return StyleParser.convertUnits(e,t)})),e.zoom[t.zoom]):StyleParser.convertUnits(e.value,t)},StyleParser.string_colors={},StyleParser.colorForString=function(e){if(StyleParser.string_colors[e])return StyleParser.string_colors[e];var t=null;return"none"!==e&&((t=csscolorparser.parseCSSColor(e))&&4===t.length?(t[0]/=255,t[1]/=255,t[2]/=255):t=StyleParser.defaults.color),StyleParser.string_colors[e]=t,t},StyleParser.evalCachedColorProperty=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.dynamic){var r=e.dynamic(t);return"string"==typeof r&&(r=StyleParser.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if(e.static)return e.static;if(e.zoom&&e.zoom[t.zoom])return e.zoom[t.zoom];if("function"==typeof e.value){e.dynamic=e.value;var i=e.dynamic(t);return"string"==typeof i&&(i=StyleParser.colorForString(i)),i&&null==i[3]&&(i[3]=1),i}if("string"==typeof e.value)return e.static=StyleParser.colorForString(e.value),e.static;if(e.zoom){if(!e.zoom_preprocessed){for(var n=0;n<e.value.length;n++){var o=e.value[n];o&&"string"==typeof o[1]&&(o[1]=StyleParser.colorForString(o[1]))}e.zoom_preprocessed=!0}return e.zoom[t.zoom]=Utils$1.interpolate(t.zoom,e.value),e.zoom[t.zoom][3]=e.zoom[t.zoom][3]||1,e.zoom[t.zoom]}return e.static=e.value.map((function(e){return e})),e.static&&null==e.static[3]&&(e.static[3]=1),e.static},StyleParser.parseColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof e&&(e=e(t)),"string"==typeof e)e=StyleParser.colorForString(e);else if(Array.isArray(e)&&Array.isArray(e[0])){for(var r=0;r<e.length;r++){var i=e[r];"string"==typeof i[1]&&(i[1]=StyleParser.colorForString(i[1]))}t.zoom&&(e=Utils$1.interpolate(t.zoom,e))}return Array.isArray(e)?null==(e=e.map((function(e){return e})))[3]&&(e[3]=1):e=[0,0,0,1],e},StyleParser.calculateOrder=function(e,t){return"function"==typeof e?e=e(t):"string"==typeof e&&(e=t.feature.properties[e]?t.feature.properties[e]:parsePositiveNumber(e)),e},StyleParser.evalProperty=function(e,t){return"function"==typeof e?e(t):e};var RepeatGroup=function(){function e(t,r){_classCallCheck(this,e),this.key=t,this.repeat_dist=r,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}return _createClass(e,[{key:"check",value:function(e){for(var t=e.position,r=0;r<this.positions.length;r++){var i=this.positions[r],n=t[0]-i[0],o=t[1]-i[1],a=n*n+o*o;if(a<this.repeat_dist_sq)return{dist_sq:a,repeat_dist_sq:this.repeat_dist_sq}}}},{key:"add",value:function(e){e&&e.position&&this.positions.push(e.position)}}],[{key:"clear",value:function(e){this.groups[e]={}}},{key:"check",value:function(e,t,r){if(t.repeat_distance&&t.repeat_group&&this.groups[r][t.repeat_group])return this.groups[r][t.repeat_group].check(e)}},{key:"add",value:function(t,r,i){r.repeat_distance&&r.repeat_group&&(null==this.groups[i][r.repeat_group]&&(this.groups[i][r.repeat_group]=new e(r.repeat_group,r.repeat_distance*r.repeat_scale)),this.groups[i][r.repeat_group].add(t))}}]),e}();RepeatGroup.groups={};var GridIndex=function(){function e(t,r,i){_classCallCheck(this,e);var n=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(r/i);for(var a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}return _createClass(e,[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(e,t,r,i,n){this._forEachCell(t,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)}},{key:"insertCircle",value:function(e,t,r,i){this._forEachCell(t-i,r-i,t+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(i)}},{key:"insertCircleList",value:function(e,t){for(var r=0;r<t.length-2;r+=3)this.insertCircle("".concat(e,"/").concat(r),t[r],t[r+1],t[r+2])}},{key:"_insertBoxCell",value:function(e,t,r,i,n,o){this.boxCells[n].push(o)}},{key:"_insertCircleCell",value:function(e,t,r,i,n,o){this.circleCells[n].push(o)}},{key:"_query",value:function(e,t,r,i,n,o){if(r<0||e>this.width||i<0||t>this.height)return!n&&[];var a=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?a.filter(o):a}var f={hitTest:n,seenUids:{box:{},circle:{}}};return this._forEachCell(e,t,r,i,this._queryCell,a,f,o),n?a.length>0:a}},{key:"_queryCircle",value:function(e,t,r,i,n){var o=e-r,a=e+r,s=t-r,l=t+r;if(a<0||o>this.width||l<0||s>this.height)return!i&&[];var u=[],c={hitTest:i,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}};return this._forEachCell(o,s,a,l,this._queryCellCircle,u,c,n),i?u.length>0:u}},{key:"query",value:function(e,t,r,i,n){return this._query(e,t,r,i,!1,n)}},{key:"hitTest",value:function(e,t,r,i,n){return this._query(e,t,r,i,!0,n)}},{key:"hitTestCircle",value:function(e,t,r,i){return this._queryCircle(e,t,r,!0,i)}},{key:"hitTestCircleList",value:function(e,t){for(var r=0;r<e.length-2;r+=3)if(this.hitTestCircle(e[r],e[r+1],e[r+2],t))return!0;return!1}},{key:"_queryCell",value:function(e,t,r,i,n,o,a,s){var l=a.seenUids,u=this.boxCells[n];if(null!==u){var c,h=this.bboxes,f=_createForOfIteratorHelper(u);try{for(f.s();!(c=f.n()).done;){var d=c.value;if(!l.box[d]){l.box[d]=!0;var _=4*d;if(e<=h[_+2]&&t<=h[_+3]&&r>=h[_+0]&&i>=h[_+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:h[_],y1:h[_+1],x2:h[_+2],y2:h[_+3]})}}}}catch(e){f.e(e)}finally{f.f()}}var p=this.circleCells[n];if(null!==p){var g,m=this.circles,y=_createForOfIteratorHelper(p);try{for(y.s();!(g=y.n()).done;){var v=g.value;if(!l.circle[v]){l.circle[v]=!0;var x=3*v;if(this._circleAndRectCollide(m[x],m[x+1],m[x+2],e,t,r,i)&&(!s||s(this.circleKeys[v]))){if(a.hitTest)return o.push(!0),!0;var b=m[x],T=m[x+1],A=m[x+2];o.push({key:this.circleKeys[v],x1:b-A,y1:T-A,x2:b+A,y2:T+A})}}}}catch(e){y.e(e)}finally{y.f()}}}},{key:"_queryCellCircle",value:function(e,t,r,i,n,o,a,s){var l=a.circle,u=a.seenUids,c=this.boxCells[n];if(null!==c){var h,f=this.bboxes,d=_createForOfIteratorHelper(c);try{for(d.s();!(h=d.n()).done;){var _=h.value;if(!u.box[_]){u.box[_]=!0;var p=4*_;if(this._circleAndRectCollide(l.x,l.y,l.radius,f[p+0],f[p+1],f[p+2],f[p+3])&&(!s||s(this.boxKeys[_])))return o.push(!0),!0}}}catch(e){d.e(e)}finally{d.f()}}var g=this.circleCells[n];if(null!==g){var m,y=this.circles,v=_createForOfIteratorHelper(g);try{for(v.s();!(m=v.n()).done;){var x=m.value;if(!u.circle[x]){u.circle[x]=!0;var b=3*x;if(this._circlesCollide(y[b],y[b+1],y[b+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}}catch(e){v.e(e)}finally{v.f()}}}},{key:"_forEachCell",value:function(e,t,r,i,n,o,a,s){for(var l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i),f=l;f<=c;f++)for(var d=u;d<=h;d++){var _=this.xCellCount*d+f;if(n.call(this,e,t,r,i,_,o,a,s))return}}},{key:"_convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"_convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}},{key:"_circlesCollide",value:function(e,t,r,i,n,o){var a=i-e,s=n-t,l=r+o;return l*l>a*a+s*s}},{key:"_circleAndRectCollide",value:function(e,t,r,i,n,o,a){var s=(o-i)/2,l=Math.abs(e-(i+s));if(l>s+r)return!1;var u=(a-n)/2,c=Math.abs(t-(n+u));if(c>u+r)return!1;if(l<=s||c<=u)return!0;var h=l-s,f=c-u;return h*h+f*f<=r*r}}]),e}(),CollisionUtils={toDiscardLabel:function(e,t,r,i){var n;if(i&&(n=function(e){return e!==i.id}),!t){if("point"===e.type&&!e.angle){var o=e.getAABB(),a=o.left,s=o.top,l=o.right,u=o.bottom;if(r.hitTest(a,-s,l,-u,n)){if(Array.isArray(e.layout.anchor))for(var c=1;c<e.layout.anchor.length;c++){e.setAnchor(e.layout.anchor[c]);var h=e.getAABB(),f=h.left,d=h.top,_=h.right,p=h.bottom;if(!r.hitTest(f,-d,_,-p,n))return!1}return!0}return!1}var g=e.getBoundingCircles();return r.hitTestCircleList(g,n)}if(t){if("point"===e.type&&!e.isFlat()){var m=e.getScreenSpaceBoundingBox(),y=m.left,v=m.top,x=m.right,b=m.bottom;return r.hitTest(y,v,x,b,n)}var T=e.getBoundingCircles();return r.hitTestCircleList(T,n)}return!1},addLabel:function(e,t,r){var i=e.id;if(e.placed=!0,!t)if("point"!==e.type||e.angle){var n=e.getBoundingCircles();r.insertCircleList(i,n)}else{var o=e.getAABB(),a=o.left,s=o.top,l=o.right,u=o.bottom;r.insert(i,a,-s,l,-u)}if(t)if("point"!==e.type||e.isFlat()){var c=e.getBoundingCircles();r.insertCircleList(i,c)}else{var h=e.getScreenSpaceBoundingBox(),f=h.left,d=h.top,_=h.right,p=h.bottom;r.insert(i,f,d,_,p)}}},Collision={tiles:{},startTile:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.apply_repeat_groups,i=void 0===r||r,n=t.return_hidden,o=void 0!==n&&n,a=t.grid_index,s=void 0===a?null:a,l=this.tiles[e]={grid_index:s||new GridIndex(Geo$1.tile_scale,Geo$1.tile_scale,240),objects:{},labels:{},styles:{},repeat:i,return_hidden:o};null==l.complete&&(l.complete=new Promise((function(e,t){l.resolve=e,l.reject=t})))},resetTile:function(e){delete this.tiles[e]},abortTile:function(e){this.tiles[e]&&this.tiles[e].resolve&&this.tiles[e].resolve([]),this.resetTile(e)},addStyle:function(e,t){this.tiles[t].styles[e]=!0},collide:function(e,t,r){var i=this.tiles[r];if(!i)return Promise.resolve([]);for(var n=i.objects,o=0;o<e.length;o++){var a=e[o],s=a.label.layout.priority;n[s]=n[s]||{},n[s][t]=n[s][t]||[],n[s][t].push(a)}return delete i.styles[t],0===Object.keys(i.styles).length&&this.endTile(r),i.complete.then((function(){return i.resolve=null,i.labels[t]||[]}))},endTile:function(e){var t=this.tiles[e],r=t.labels;t.repeat&&RepeatGroup.clear(e);for(var i=Object.keys(t.objects).sort((function(e,t){return e-t})),n=0;n<i.length;n++){var o=t.objects[i[n]];if(o)for(var a in o){var s=o[a];r[a]=r[a]||[];for(var l=0;l<s.length;l++){var u=s[l];this.canBePlaced(u,e,u.linked,t)?u.linked?this.canBePlaced(u.linked,e,u,t)?(u.show=!0,(u.label.breach||u.linked.label.breach)&&(u.label.breach=!0,u.linked.label.breach=!0),r[a].push(u),this.place(u,e,t),this.place(u.linked,e,t)):t.return_hidden&&(u.show=!1,r[a].push(u)):(u.show=!0,r[a].push(u),this.place(u,e,t)):t.return_hidden&&(u.show=!1,r[a].push(u))}}}delete this.tiles[e],t.resolve()},canBePlaced:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).repeat,n=void 0===i||i,o=e.label,a=e.label.layout;if(null!==o.placed)return o.placed;var s=this.tiles[t].grid_index;if(a.collide&&CollisionUtils.toDiscardLabel(o,"main"===t,s,r&&r.label))a.collide&&(o.placed=!1);else{if(!(n&&RepeatGroup.check(o,a,t)))return!0;o.placed=!1}return o.placed},place:function(e,t,r){var i=e.label,n=r.repeat,o=void 0===n||n;null===i.placed&&(o&&RepeatGroup.add(i,i.layout,t),CollisionUtils.addLabel(i,"main"===t,this.tiles[t].grid_index))}},Task={id:0,queue:[],max_time:20,start_time:null,state:{},ignore_user_moving_view:!1,_ignoreViewMoveWithDebounce:debounce((function(){Task.ignore_user_moving_view=!0}),0,500),add:function(e){e.id=Task.id++,e.max_time=e.max_time||Task.max_time,e.pause_factor=e.pause_factor||1;var t=new Promise((function(t,r){e.resolve=t,e.reject=r}));return e.promise=t,e.total_elapsed=0,e.stats={calls:0},this.queue.push(e),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,this.elapsed<Task.max_time&&this.process(e),e.promise},remove:function(e){var t=this.queue.indexOf(e);t>-1&&this.queue.splice(t,1)},process:function(e){if(!this.state.user_moving_view||!1!==e.user_moving_view||this.ignore_user_moving_view)return e.pause?(e.pause--,!0):(e.stats.calls++,e.start_time=performance.now(),e.run(e));Task._ignoreViewMoveWithDebounce()},processAll:function(){this.start_time=this.start_time||performance.now(),this.ignore_user_moving_view&&!this.hasPendingTasks()&&(this.ignore_user_moving_view=!1);for(var e=0;e<this.queue.length;e++){var t=this.queue[e];if(!0!==this.process(t)&&(t.pause||(t.pause=t.elapsed>t.max_time?t.pause_factor:0),t.total_elapsed+=t.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Task.max_time){this.start_time=null;break}}},finish:function(e,t){return e.elapsed=performance.now()-e.start_time,e.total_elapsed+=e.elapsed,this.remove(e),e.resolve(t),e.promise},cancel:function(e){var t;e.cancel instanceof Function&&(t=e.cancel(e)),e.resolve(t||{})},shouldContinue:function(e){return e.elapsed=performance.now()-e.start_time,this.elapsed=performance.now()-this.start_time,e.elapsed<e.max_time&&this.elapsed<Task.max_time},removeForTile:function(e){for(var t=this.queue.length-1;t>=0;t--)this.queue[t].tile_id===e&&(this.cancel(this.queue[t]),this.queue.splice(t,1))},setState:function(e){this.state=e},hasPendingTasks:function(){return!!this.queue.length}};function sliceOptions(e){return{coords:e.coords,uid:e.uid,filtering:e.filtering,sprites:e.sprites,url:e.url,element:e.element,data:e.data,width:e.width,height:e.height,density:e.density,repeat:e.repeat,TEXTURE_WRAP_S:e.TEXTURE_WRAP_S,TEXTURE_WRAP_T:e.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:e.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:e.UNPACK_PREMULTIPLY_ALPHA_WEBGL}}var Texture=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,e),n=sliceOptions(n),this.gl=t,this.texture=t.createTexture(),this.texture&&(this.valid=!0),this.manager=i,this.bind(),this.name=r,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=n.filtering,this.density=n.density||1,this.sprites=n.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this._byte_length=0,this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,this.manager.textures[this.name]&&(this.retain_count=this.manager.textures[this.name].retain_count,this.manager.textures[this.name].retain_count=0,this.manager.textures[this.name].destroy()),this.manager.textures[this.name]=this,this.manager.texture_configs[this.name]=JSON.stringify(Object.assign({name:r},n)),this.load(n),log("trace","creating Texture ".concat(this.name))}return _createClass(e,[{key:"destroy",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).force;this.retain_count>0&&!e?log("error","Texture '".concat(this.name,"': destroying texture with retain count of '").concat(this.retain_count,"'")):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,delete this.manager.textures[this.name],delete this.manager.texture_configs[this.name],this.valid=!1,this._byte_length=0,log("trace","destroying Texture ".concat(this.name)))}},{key:"retain",value:function(){this.retain_count++}},{key:"release",value:function(){this.retain_count<=0&&log("error","Texture '".concat(this.name,"': releasing texture with retain count of '").concat(this.retain_count,"'")),this.retain_count--,this.retain_count<=0&&this.destroy()}},{key:"bind",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.valid&&(this.manager.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.manager.activeUnit=e,this.manager.boundTexture=null),this.manager.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.manager.boundTexture=this.texture))}},{key:"load",value:function(e){var t=this;return e?(this.loading=null,"string"==typeof e.url?(this.config_type="url",this.setUrl(e.url,e)):e.element?(this.config_type="element",this.setElement(e.element,e)):e.data&&e.width&&e.height&&(this.config_type="data",this.setData(e.width,e.height,e.data,e)),this.loading=this.loading&&this.loading.then((function(){return t.calculateSprites(),t}))||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)}},{key:"setUrl",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=e,this.loading=new Promise((function(e,i){var n=new Image;n.onload=function(){try{t.setElement(n,r)}catch(e){t.loaded=!1,log("warn","Texture '".concat(t.name,"': failed to load url: '").concat(t.url,"'"),e,r),t.manager.trigger("warning",{message:"Failed to load texture from ".concat(t.url),error:e,texture:r})}t.loaded=!0,e(t)},n.onerror=function(i){t.loaded=!1,log("warn","Texture '".concat(t.name,"': failed to load url: '").concat(t.url,"'"),i,r),t.manager.trigger("warning",{message:"Failed to load texture from ".concat(t.url),error:i,texture:r}),e(t)},Utils$1.isSafari()&&"data:"===t.url.slice(0,5)||(n.crossOrigin="anonymous"),n.src=t.url})),this.loading}},{key:"setData",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=e,this.height=t,Array.isArray(r)&&(r=new Uint8Array(r)),this.update(r,i),this.setFiltering(i),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(e,t){var r=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.update(e,t),this.setFiltering(t);else{this.loaded=!1;var i="the 'element' parameter (`element: ".concat(JSON.stringify(r),"`) must be a CSS ");i+="selector string, or a <canvas>, <image> or <video> object",log("warn","Texture '".concat(this.name,"': ").concat(i),t),this.manager.trigger("warning",{message:"Failed to load texture because ".concat(i),texture:t})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.valid&&(this.bind(),e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof HTMLImageElement&&e.complete?(this.width=e.width,this.height=e.height,this._byte_length=this.width*this.height*4,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==t.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)):(this._byte_length=e?e.byteLength:0,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)),this.manager.trigger("update",this))}},{key:"getByteLength",value:function(){return this._byte_length}},{key:"setFiltering",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){e.filtering=e.filtering||"linear";var t=this.gl;this.bind(),Utils$1.isPowerOf2(this.width)&&Utils$1.isPowerOf2(this.height)?(this.power_of_2=!0,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.TEXTURE_WRAP_S||e.repeat&&t.REPEAT||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.TEXTURE_WRAP_T||e.repeat&&t.REPEAT||t.CLAMP_TO_EDGE),"mipmap"===e.filtering?(this.filtering="mipmap",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D)):"linear"===e.filtering?(this.filtering="linear",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):"nearest"===e.filtering&&(this.filtering="nearest",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST))):(this.power_of_2=!1,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),"nearest"===e.filtering?(this.filtering="nearest",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)):(this.filtering="linear",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR))),this.manager.trigger("update",this)}}},{key:"calculateSprites",value:function(){if(this.sprites)for(var e in this.sprites){var t=this.sprites[e];this.texcoords[e]=this.manager.getTexcoordsForSprite([t[0],t[1]],[t[2],t[3]],[this.width,this.height]),this.sizes[e]=[t[2],t[3]],this.css_sizes[e]=[t[2]/this.density,t[3]/this.density],this.aspects[e]=t[2]/t[3]}}}]),e}();function subscribeMixin(e){var t=[];return Object.assign(e,{subscribe:function(e){-1===t.indexOf(e)&&t.push(e)},unsubscribe:function(e){var r=t.indexOf(e);r>-1&&t.splice(r,1)},unsubscribeAll:function(){t=[]},trigger:function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];t.forEach((function(t){if("function"==typeof t[e])try{t[e].apply(t,i)}catch(t){log("warn","Caught exception in listener for event '".concat(e,"':"),t)}}))},hasSubscribersFor:function(e){var r=!1;return t.forEach((function(t){"function"==typeof t[e]&&(r=!0)})),r}})}var TextureManager=function(){function e(t){_classCallCheck(this,e),this.default=e.DEFAULT_TEXTURE_NAME,this.textures={},this.texture_configs={},this.boundTexture=null,this.activeUnit=null,this.scene_id=t,WorkerBroker.addTarget("Texture"+this.scene_id,this),subscribeMixin(this)}return _createClass(e,[{key:"create",value:function(t,r,i){for(var n=e.matchers_,o=0;o<n.length;o++){var a=n[o][0],s=n[o][1];if(s&&s(i))return new a(t,r,this,i)}return new Texture(t,r,this,i)}},{key:"retain",value:function(e){this.textures[e]&&this.textures[e].retain()}},{key:"release",value:function(e){this.textures[e]&&this.textures[e].release()}},{key:"getRetainCount",value:function(e){if(this.textures[e])return this.textures[e].retain_count}},{key:"getByteLength",value:function(e){if(this.textures[e])return this.textures[e].getByteLength()}},{key:"destroy",value:function(e){var t=this;Object.keys(this.textures).forEach((function(r){var i=t.textures[r];r!==t.default&&i.gl===e&&i.destroy({force:!0})}))}},{key:"getSpriteInfo",value:function(e,t){var r=this.textures[e];return r&&{size:r.sizes[t],css_size:r.css_sizes[t],aspect:r.aspects[t],texcoords:r.texcoords[t]}}},{key:"getTexcoordsForSprite",value:function(e,t,r){var i=r[1]-e[1]-t[1];return[e[0]/r[0],i/r[1],(t[0]+e[0])/r[0],(t[1]+i)/r[1]]}},{key:"createFromObject",value:function(e,t){var r=[];if(t)for(var i in t){var n=t[i];if(this.changed(i,n)){var o=this.create(e,i,n);r.push(o.loading)}}return Promise.all(r)}},{key:"createDefault",value:function(e){return this.create(e,this.default)}},{key:"changed",value:function(e,t){var r=this.textures[e];if(r){if("element"===r.config_type||null!=t.element)return!0;if(t=sliceOptions(t),this.texture_configs[e]===JSON.stringify(Object.assign({name:e},t)))return!1}return!0}},{key:"getInfo",value:function(e){var t=this;if(e||(e=Object.keys(this.textures)),Array.isArray(e))return Promise.all(e.map((function(e){return t.getInfo(e)})));var r=this.textures[e];return r?(r.loading||Promise.resolve(r)).then((function(){return{name:r.name,width:r.width,height:r.height,density:r.density,sprites:r.sprites,texcoords:r.texcoords,sizes:r.sizes,css_sizes:r.css_sizes,aspects:r.aspects,filtering:r.filtering,power_of_2:r.power_of_2,valid:r.valid}})):Promise.resolve(null)}},{key:"syncTexturesToWorker",value:function(e){var t=this;return Thread.is_main?Promise.all(e.map((function(e){var r=t.textures[e];return r&&r.loading||Promise.resolve()}))).then((function(){return t.textures})):WorkerBroker.postMessage("Texture"+this.scene_id+".getInfo",e).then((function(e){return e.forEach((function(e){t.textures[e.name]=e})),t.textures}))}},{key:"getMaxTextureSize",value:function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)}}],[{key:"register",value:function(t,r){var i=e.matchers_;if(!(t instanceof Function&&r instanceof Function))throw"Invalid texture constructor or matcher";this.deRegister(t),i.push([t,r])}},{key:"deRegister",value:function(t){for(var r=e.matchers_,i=0;i<r.length;i++)r[i][0]===t&&r.splice(i,1)}}]),e}();TextureManager.DEFAULT_TEXTURE_NAME="__default",TextureManager.matchers_=[];var Registry={};function getTextureManager(e){return Registry[e]||(Registry[e]=new TextureManager(e)),Registry[e]}var transformMat4_1$1=transformMat4$1;function transformMat4$1(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,e}var vec3_transformMat4=getDefaultExportFromCjs(transformMat4_1$1),normalFromMat4_1=normalFromMat4;function normalFromMat4(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],p=t[13],g=t[14],m=t[15],y=r*s-i*a,v=r*l-n*a,x=r*u-o*a,b=i*l-n*s,T=i*u-o*s,A=n*u-o*l,E=c*p-h*_,w=c*g-f*_,S=c*m-d*_,k=h*g-f*p,P=h*m-d*p,R=f*m-d*g,M=y*R-v*P+x*k+b*S-T*w+A*E;return M?(M=1/M,e[0]=(s*R-l*P+u*k)*M,e[1]=(l*S-a*R-u*w)*M,e[2]=(a*P-s*S+u*E)*M,e[3]=(n*P-i*R-o*k)*M,e[4]=(r*R-n*S+o*w)*M,e[5]=(i*S-r*P-o*E)*M,e[6]=(p*A-g*T+m*b)*M,e[7]=(g*x-_*A-m*v)*M,e[8]=(_*T-p*x+m*y)*M,e):null}var mat3_normalFromMat4=getDefaultExportFromCjs(normalFromMat4_1),invert_1$1=invert$1;function invert$1(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=c*a-s*u,f=-c*o+s*l,d=u*o-a*l,_=r*h+i*f+n*d;return _?(_=1/_,e[0]=h*_,e[1]=(-c*i+n*u)*_,e[2]=(s*i-n*a)*_,e[3]=f*_,e[4]=(c*r-n*l)*_,e[5]=(-s*r+n*o)*_,e[6]=d*_,e[7]=(-u*r+i*l)*_,e[8]=(a*r-i*o)*_,e):null}var mat3_invert=getDefaultExportFromCjs(invert_1$1),identity_1$1=identity$2;function identity$2(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}var mat3_identity=getDefaultExportFromCjs(identity_1$1),multiply_1=multiply;function multiply(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],_=t[11],p=t[12],g=t[13],m=t[14],y=t[15],v=r[0],x=r[1],b=r[2],T=r[3];return e[0]=v*i+x*s+b*h+T*p,e[1]=v*n+x*l+b*f+T*g,e[2]=v*o+x*u+b*d+T*m,e[3]=v*a+x*c+b*_+T*y,v=r[4],x=r[5],b=r[6],T=r[7],e[4]=v*i+x*s+b*h+T*p,e[5]=v*n+x*l+b*f+T*g,e[6]=v*o+x*u+b*d+T*m,e[7]=v*a+x*c+b*_+T*y,v=r[8],x=r[9],b=r[10],T=r[11],e[8]=v*i+x*s+b*h+T*p,e[9]=v*n+x*l+b*f+T*g,e[10]=v*o+x*u+b*d+T*m,e[11]=v*a+x*c+b*_+T*y,v=r[12],x=r[13],b=r[14],T=r[15],e[12]=v*i+x*s+b*h+T*p,e[13]=v*n+x*l+b*f+T*g,e[14]=v*o+x*u+b*d+T*m,e[15]=v*a+x*c+b*_+T*y,e}var mat4_multiply=getDefaultExportFromCjs(multiply_1),translate_1=translate;function translate(e,t,r){var i,n,o,a,s,l,u,c,h,f,d,_,p=r[0],g=r[1],m=r[2];return t===e?(e[12]=t[0]*p+t[4]*g+t[8]*m+t[12],e[13]=t[1]*p+t[5]*g+t[9]*m+t[13],e[14]=t[2]*p+t[6]*g+t[10]*m+t[14],e[15]=t[3]*p+t[7]*g+t[11]*m+t[15]):(i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],_=t[11],e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=_,e[12]=i*p+s*g+h*m+t[12],e[13]=n*p+l*g+f*m+t[13],e[14]=o*p+u*g+d*m+t[14],e[15]=a*p+c*g+_*m+t[15]),e}var mat4_translate=getDefaultExportFromCjs(translate_1),scale_1$1=scale$1;function scale$1(e,t,r){var i=r[0],n=r[1],o=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var mat4_scale=getDefaultExportFromCjs(scale_1$1),perspective_1=perspective;function perspective(e,t,r,i,n){var o=1/Math.tan(t/2),a=1/(i-n);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*a,e[15]=0,e}var mat4_perspective=getDefaultExportFromCjs(perspective_1),identity_1=identity$1;function identity$1(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var mat4_identity=getDefaultExportFromCjs(identity_1),identity=identity_1,lookAt_1=lookAt;function lookAt(e,t,r,i){var n,o,a,s,l,u,c,h,f,d,_=t[0],p=t[1],g=t[2],m=i[0],y=i[1],v=i[2],x=r[0],b=r[1],T=r[2];return Math.abs(_-x)<1e-6&&Math.abs(p-b)<1e-6&&Math.abs(g-T)<1e-6?identity(e):(c=_-x,h=p-b,f=g-T,n=y*(f*=d=1/Math.sqrt(c*c+h*h+f*f))-v*(h*=d),o=v*(c*=d)-m*f,a=m*h-y*c,(d=Math.sqrt(n*n+o*o+a*a))?(n*=d=1/d,o*=d,a*=d):(n=0,o=0,a=0),s=h*a-f*o,l=f*n-c*a,u=c*o-h*n,(d=Math.sqrt(s*s+l*l+u*u))?(s*=d=1/d,l*=d,u*=d):(s=0,l=0,u=0),e[0]=n,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=u,e[10]=f,e[11]=0,e[12]=-(n*_+o*p+a*g),e[13]=-(s*_+l*p+u*g),e[14]=-(c*_+h*p+f*g),e[15]=1,e)}var mat4_lookAt=getDefaultExportFromCjs(lookAt_1),copy_1=copy;function copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var mat4_copy=getDefaultExportFromCjs(copy_1),invert_1=invert;function invert(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],p=t[13],g=t[14],m=t[15],y=r*s-i*a,v=r*l-n*a,x=r*u-o*a,b=i*l-n*s,T=i*u-o*s,A=n*u-o*l,E=c*p-h*_,w=c*g-f*_,S=c*m-d*_,k=h*g-f*p,P=h*m-d*p,R=f*m-d*g,M=y*R-v*P+x*k+b*S-T*w+A*E;return M?(M=1/M,e[0]=(s*R-l*P+u*k)*M,e[1]=(n*P-i*R-o*k)*M,e[2]=(p*A-g*T+m*b)*M,e[3]=(f*T-h*A-d*b)*M,e[4]=(l*S-a*R-u*w)*M,e[5]=(r*R-n*S+o*w)*M,e[6]=(g*x-_*A-m*v)*M,e[7]=(c*A-f*x+d*v)*M,e[8]=(a*P-s*S+u*E)*M,e[9]=(i*S-r*P-o*E)*M,e[10]=(_*T-p*x+m*y)*M,e[11]=(h*x-c*T-d*y)*M,e[12]=(s*w-a*k-l*E)*M,e[13]=(r*k-i*w+n*E)*M,e[14]=(p*v-_*b-g*y)*M,e[15]=(c*b-h*v+f*y)*M,e):null}var mat4_invert=getDefaultExportFromCjs(invert_1),transformMat4_1=transformMat4;function transformMat4(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,e}var vec4_transformMat4=getDefaultExportFromCjs(transformMat4_1),normalize_1=normalize;function normalize(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=o*a),e}var vec4_normalize=getDefaultExportFromCjs(normalize_1),scale_1=scale;function scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}var vec4_scale=getDefaultExportFromCjs(scale_1),vec3={fromValues:function(e,t,r){var i=new Float64Array(3);return i[0]=e,i[1]=t,i[2]=r,i},transformMat4:vec3_transformMat4},mat3={normalFromMat4:mat3_normalFromMat4,invert:mat3_invert,identity:mat3_identity},mat4={multiply:mat4_multiply,translate:mat4_translate,scale:mat4_scale,perspective:mat4_perspective,lookAt:mat4_lookAt,identity:mat4_identity,copy:mat4_copy,invert:mat4_invert},vec4={transformMat4:vec4_transformMat4,normalize:vec4_normalize,scale:vec4_scale},FeatureSelection=function(){function e(t,r){_classCallCheck(this,e),this._gl=t,this._requests={},this._pixels=null,this._has_dirty_buffer=!1,this._fbo=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._fbo_size={width:256,height:256};var i=getTextureManager(r).create(this._gl,"selection_fbo",{filtering:"nearest"});i.setData(this._fbo_size.width,this._fbo_size.height,null,{filtering:"nearest"}),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,i.texture,0);var n=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,n),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._fbo_size.width,this._fbo_size.height),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,n),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return _createClass(e,[{key:"destroy",value:function(){this._gl&&this._fbo&&(this._gl.deleteFramebuffer(this._fbo),this._fbo=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null))}},{key:"bind",value:function(){var t;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._gl.viewport(0,0,this._fbo_size.width,this._fbo_size.height),(t=this._gl).clearColor.apply(t,_toConsumableArray(e.defaultColor))}},{key:"getFeatureAt",value:function(t,r,i){var n=r.radius,o=r.top_most_only,a=void 0===o||o;!t||t.x<0||t.y<0||t.x>1||t.y>1?i({features:null}):(this.selection_request_id=this.selection_request_id+1||0,this._requests[this.selection_request_id]={id:this.selection_request_id,point:t,radius:n,top_most_only:a,ttl:a?1:e.MAX_PICKING_TRIES,callback:i})}},{key:"hasPendingRequests",value:function(){return Object.keys(this._requests).length>0}},{key:"clearPendingRequests",value:function(){for(var e in this._requests){this._requests[e].callback(new Error("cleared")),delete this._requests[e]}this._pending_deep_request=null}},{key:"read",value:function(e){if(this.hasPendingRequests()){var t=this._gl;for(var r in t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),this._pending_deep_request&&this.processRequest(this._pending_deep_request,e),this._requests)if(this.processRequest(this._requests[r],e))break;t.bindFramebuffer(t.FRAMEBUFFER,null)}}},{key:"processRequest",value:function(t,r){var i,n,o=this._gl,a=255,s=t.point,l=t.radius;if(l){var u=Math.min(this._fbo_size.width,this._fbo_size.height);n={x:Math.min(Math.ceil(2*l.x*this._fbo_size.width),u),y:Math.min(Math.ceil(2*l.y*this._fbo_size.height),u)}}else l={x:0,y:0},n={x:1,y:1};var c=n.x*n.y*4;if(null==this._pixels||this._pixels.byteLength<c)this._pixels=new Uint8Array(c);else if(this._pixels.fill instanceof Function)this._pixels.fill(0,0,c);else for(var h=0;h<c;h++)this._pixels[h]=0;o.readPixels(Math.round((s.x-l.x)*this._fbo_size.width),Math.round((1-s.y-l.y)*this._fbo_size.height),n.x,n.y,o.RGBA,o.UNSIGNED_BYTE,this._pixels),t.ttl--;var f=Math.floor(n.x/2),d=Math.floor(n.y/2),_=4*(d*n.x+f),p=this._pixels.slice(_,_+4),g=p[0]+(p[1]<<8)+(p[2]<<16);if(g>0)i=g+(p[3]<<24)>>>0,a=p[3];else if(c>4){var m=1/0;_=0;for(var y=0;y<n.y;y++)for(var v=0;v<n.x;v++,_+=4)if((g=(p=this._pixels.slice(_,_+4))[0]+(p[1]<<8)+(p[2]<<16))>0){var x=Math.pow(v-f,2)+Math.pow(y-d,2);x<m&&(i=g+(p[3]<<24)>>>0,a=p[3],m=x)}}if(255!==a){var b=this._getFeatureByKey(i,r);if(t.features||(t.features=[]),!b)return void this._finishRead(t);if(t.features.every((function(e){return e.id!==b.id}))&&t.features.push(b),t.ttl)return this._pending_deep_request=t,e._discardColor(p),this._has_dirty_buffer=!0,!0;this._finishRead(t)}else this._finishRead(t)}},{key:"_finishRead",value:function(t){var r=t.features||e.EMPTY_ARRAY;t.top_most_only||(this._pending_deep_request=null,e._resetDiscardedColors()),delete this._requests[t.id],t.callback({features:r})}},{key:"_getFeatureByKey",value:function(e,t){for(var r=null,i=0;i<t.length;i++){var n=t[i];if(n.selection_data&&(r=n.selection_data[e])){r.tile={coords:n.coords};break}}return r}},{key:"setupDiscards",value:function(t){for(var r=e.MAX_PICKING_TRIES;r--;)t.uniform("4fv","u_selection_discard".concat(r),e._discarded_colors[r]||e.defaultColor)}},{key:"has_dirty_buffer",get:function(){return this._has_dirty_buffer},set:function(e){this._has_dirty_buffer=!!this._pending_deep_request}}],[{key:"makeEntry",value:function(){this.map_entry++;var e=255&this.map_entry,t=this.map_entry>>8&255,r=this.map_entry>>16&255,i=this.map_prefix;return{key:e+(t<<8)+(r<<16)+(i<<24)>>>0,color:[e/255,t/255,r/255,i/255]}}},{key:"reset",value:function(){this.map_entry=0}},{key:"setPrefix",value:function(e){this.map_prefix=e}},{key:"_discardColor",value:function(e){this._discarded_colors.push([e[0]/255,e[1]/255,e[2]/255,e[3]/255])}},{key:"_resetDiscardedColors",value:function(){this._discarded_colors.length=0}}]),e}();FeatureSelection._discarded_colors=[],FeatureSelection.map_entry=0,FeatureSelection.map_prefix=0,FeatureSelection.defaultColor=[0,0,0,1],FeatureSelection.MAX_PICKING_TRIES=10,FeatureSelection.EMPTY_ARRAY=Object.freeze([]);var GLSL={parseUniforms:function(e){var t=[];for(var r in e){var i,n=r,o=e[r];if("number"==typeof o)t.push({type:"float",method:"1f",name:r,value:o,key:n,uniforms:e});else if(Array.isArray(o)){if("number"==typeof o[0])o.length>=2&&o.length<=4?t.push({type:"vec"+o.length,method:o.length+"fv",name:r,value:o,key:n,uniforms:e}):o.length>4&&t.push({type:"float[]",method:"1fv",name:r+"[0]",value:o,key:n,uniforms:e});else if("string"==typeof o[0])for(i=0;i<o.length;i++)t.push({type:"sampler2D",method:"1i",name:r+"["+i+"]",value:o[i],key:i,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&o[0].length>=2&&o[0].length<=4)for(i=0;i<o.length;i++)t.push({type:"vec"+o[0].length,method:o[i].length+"fv",name:r+"["+i+"]",value:o[i],key:i,uniforms:o})}else"boolean"==typeof o?t.push({type:"bool",method:"1i",name:r,value:o,key:n,uniforms:e}):"string"==typeof o&&t.push({type:"sampler2D",method:"1i",name:r,value:o,key:n,uniforms:e})}return t},defineVariable:function(e,t){var r,i;if("number"==typeof t)r="float";else if(Array.isArray(t))"number"==typeof t[0]?t.length>=2&&t.length<=4?r="vec"+t.length:(r="float",i=t.length):"string"==typeof t[0]&&(r="sampler2D",i=t.length);else if("boolean"==typeof t)r="bool";else{if("string"!=typeof t)return;r="sampler2D"}var n="";return n+="".concat(r," ").concat(e),i&&(n+="[".concat(i,"]")),n+=";\n"},defineUniform:function(e,t){var r=GLSL.defineVariable(e,t);if(r)return"uniform "+r},isUniformDefined:function(e,t){var r=new RegExp("uniform[^;]+(?:{[\\s\\S]*})?[^;]*\\b"+e+"\\b","g");return!!t.match(r)},isSymbolReferenced:function(e,t){var r=new RegExp("\\b"+e+"\\b","g");return t.search(r)>=0},expandVec3:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(e)){if(2!==e.length)return e;t=[].concat(_toConsumableArray(e),[r]).map(parseFloat)}else t=[e,e,e].map(parseFloat);if(t&&t.every((function(e){return"number"==typeof e&&!isNaN(e)})))return t},expandVec4:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(e)){if(3!==e.length)return e;t=[].concat(_toConsumableArray(e),[r]).map(parseFloat)}else t=[e,e,e,r].map(parseFloat);if(t&&t.every((function(e){return"number"==typeof e&&!isNaN(e)})))return t}},extensions=[];function getExtension(e,t){var r=extensions.filter((function(t){return t[0]===e}))[0];return(r=r&&r[1])||(extensions.push([e,{}]),r=extensions[extensions.length-1][1]),r[t]||(r[t]=e.getExtension(t)),r[t]}function hashString(e){var t,r,i=0;if(0===e.length)return i;for(t=0,r=e.length;t<r;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return i}var stripComments={exports:{}},reBlock="\\/\\*",reBlockIgnore="\\/\\*(?!\\*?\\!)",reBlockEnd="(.|[\\r\\n]|\\n)*?\\*\\/\\n?\\n?",reLine=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,reLineIgnore=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm,strip=stripComments.exports=function(e,t){return e?strip.block(strip.line(e,t),t):""};
/*!
	 * strip-comments <https://github.com/jonschlinkert/strip-comments>
	 *
	 * Copyright (c) 2014 Jon Schlinkert, contributors.
	 * Licensed under the MIT license.
	 */strip.block=function(e,t){t=t||{};var r=new RegExp(reBlock+reBlockEnd,"gm");return t.safe&&(r=new RegExp(reBlockIgnore+reBlockEnd,"gm")),e?e.replace(r,""):""},strip.line=function(e,t){var r=reLine;return(t=t||{}).safe&&(r=reLineIgnore),e?e.replace(r,""):""};var stripCommentsExports=stripComments.exports,strip$1=getDefaultExportFromCjs(stripCommentsExports),glShaderErrors=parseErrors;function parseErrors(e){e=String(e);for(var t,r=[];t=e.match(/ERROR\:([^\n]+)/);){e=e.slice(t.index+1);var i=(a=t[1].trim()).split(":"),n=i.slice(2).join(":").trim(),o=parseInt(i[0],10),a=parseInt(i[1],10);r.push({message:n,file:o,line:a})}return r}var parseShaderErrors=getDefaultExportFromCjs(glShaderErrors),re_pragma=/^\s*#pragma.*$/gm,re_continue_line=/\\\s*\n/gm,ShaderProgram=function(){function e(t,r,i,n,o){if(_classCallCheck(this,e),o=o||{},this.textureManager=getTextureManager(n),this.gl=t,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,!e.polyfills[n]){e.polyfills[n]={};try{this.gl.uniformMatrix3fv(null,!1,new Float64Array(9))}catch(t){e.polyfills[n].uniformMatrix3fv=this.gl.uniformMatrix3fv,this.gl.uniformMatrix3fv=function(t,r,i){e.polyfills[n].uniformMatrix3fv.call(this,t,r,new Float32Array(i))}}try{this.gl.uniformMatrix4fv(null,!1,new Float64Array(16))}catch(t){e.polyfills[n].uniformMatrix4fv=this.gl.uniformMatrix4fv,this.gl.uniformMatrix4fv=function(t,r,i){e.polyfills[n].uniformMatrix4fv.call(this,t,r,new Float32Array(i))}}}this.defines=Object.assign({},o.defines||{}),this.blocks=Object.assign({},o.blocks||{}),this.block_scopes=Object.assign({},o.block_scopes||{}),this.extensions=o.extensions||[],this.dependent_uniforms=o.uniforms,this.uniforms={},this.attribs={},this.vertex_source=r,this.fragment_source=i,this.id=e.id++,this.name=o.name}return _createClass(e,[{key:"destroy",value:function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1}},{key:"use",value:function(){this.compiled&&(e.current!==this&&this.gl.useProgram(this.program),e.current=this)}},{key:"compile",value:function(){var t=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for ".concat(this.id," (").concat(this.name,") because already compiling"));this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var r,i=this.checkExtensions(),n=this.buildDefineList(),o=this.buildShaderBlockList();for(var a in o){var s=o[a];if(s&&(!Array.isArray(s)||0!==s.length)){r=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+a+"\\s*$","m");var l=this.computed_vertex_source.match(r),u=this.computed_fragment_source.match(r);if(null!=l||null!=u){var c="";s.forEach((function(e){var t="".concat(e.scope,", ").concat(e.key,", ").concat(e.num);c+="\n// tangram-block-start: ".concat(t,"\n"),c+=e.source,c+="\n// tangram-block-end: ".concat(t,"\n")})),null!=l&&(this.computed_vertex_source=this.computed_vertex_source.replace(r,c)),null!=u&&(this.computed_fragment_source=this.computed_fragment_source.replace(r,c)),n["TANGRAM_BLOCK_"+a.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(re_pragma,""),this.computed_fragment_source=this.computed_fragment_source.replace(re_pragma,""),this.ensureUniforms(this.dependent_uniforms);var h="",f=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);h=f&&f.precision>0?"precision highp float;\n":"precision mediump float;\n",n.TANGRAM_VERTEX_SHADER=!0,n.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=h+e.buildDefineString(n)+this.computed_vertex_source,n.TANGRAM_VERTEX_SHADER=!1,n.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=e.buildExtensionString(i)+h+e.buildDefineString(n)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(re_continue_line,""),this.computed_fragment_source=this.computed_fragment_source.replace(re_continue_line,"");try{this.program=e.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(e){throw this.program=null,this.compiled=!1,this.compiling=!1,this.error=e,"vertex"!==e.type&&"fragment"!==e.type||(this.shader_errors=e.errors,this.shader_errors.forEach((function(r){r.type=e.type,r.block=t.block(e.type,r.line)}))),e}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()}},{key:"buildDefineList",value:function(){var t,r={};for(t in e.defines)r[t]=e.defines[t];for(t in this.defines)r[t]=this.defines[t];return r}},{key:"buildShaderBlockList",value:function(){var t,r={};for(t in e.blocks){var i;if(r[t]=[],Array.isArray(e.blocks[t]))(i=r[t]).push.apply(i,_toConsumableArray(e.blocks[t].map((function(e,r){return{key:t,source:e,num:r,scope:"ShaderProgram"}}))));else r[t]=[{key:t,source:e.blocks[t],num:0,scope:"ShaderProgram"}]}for(t in this.blocks)if(r[t]=r[t]||[],Array.isArray(this.blocks[t]))for(var n=this.block_scopes&&this.block_scopes[t]||[],o=null,a=0,s=0;s<this.blocks[t].length;s++)n[s]!==o&&(o=n[s],a=0),r[t].push({key:t,source:this.blocks[t][s],num:a,scope:o||this.name}),a++;else r[t].push({key:t,source:this.blocks[t],num:0,scope:this.name});return r}},{key:"ensureUniforms",value:function(e){if(e){var t,r=strip$1(this.computed_vertex_source),i=strip$1(this.computed_fragment_source),n=[],o=[];for(var a in e){var s=GLSL.isUniformDefined(a,r),l=GLSL.isUniformDefined(a,i);if(!s||!l){if(!(t=GLSL.defineUniform(a,e[a])))continue;s||(log("trace","Program ".concat(this.name,": ").concat(a," not defined in vertex shader, injecting: '").concat(t,"'")),n.push(t)),l||(log("trace","Program ".concat(this.name,": ").concat(a," not defined in fragment shader, injecting: '").concat(t,"'")),o.push(t))}}n.length>0&&(this.computed_vertex_source=n.join("\n")+this.computed_vertex_source),o.length>0&&(this.computed_fragment_source=o.join("\n")+this.computed_fragment_source)}}},{key:"setUniforms",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.compiled){t&&(this.texture_unit=0);for(var r=GLSL.parseUniforms(e),i=0;i<r.length;i++){var n=r[i];"sampler2D"===n.type?this.setTextureUniform(n.name,n.value):this.uniform(n.method,n.name,n.value)}}}},{key:"saveUniforms",value:function(e){var t=e||this.uniforms;for(var r in t){var i=this.uniforms[r];i&&(i.saved_value=i.value)}this.saved_texture_unit=this.texture_unit||0}},{key:"restoreUniforms",value:function(e){var t=e||this.uniforms;for(var r in t){var i=this.uniforms[r];i&&i.saved_value&&(i.value=i.saved_value,this.updateUniform(i))}this.texture_unit=this.saved_texture_unit||0}},{key:"setTextureUniform",value:function(e,t){var r=this.textureManager.textures[t];null!=r?(r.bind(this.texture_unit),this.uniform("1i",e,this.texture_unit),this.texture_unit++):log("warn","Cannot find texture '".concat(t,"'"))}},{key:"uniform",value:function(e,t,r){if(this.compiled){this.uniforms[t]=this.uniforms[t]||{};var i=this.uniforms[t];i.name=t,void 0===i.location&&(i.location=this.gl.getUniformLocation(this.program,t)),i.method=e,i.value=r,this.updateUniform(i)}}},{key:"updateUniform",value:function(e){this.compiled&&e&&null!=e.location&&(this.use(),this.commitUniform(e))}},{key:"commitUniform",value:function(e){var t=e.location,r=e.value;switch(e.method){case"1i":this.gl.uniform1i(t,r);break;case"1f":this.gl.uniform1f(t,r);break;case"2f":this.gl.uniform2f(t,r[0],r[1]);break;case"3f":this.gl.uniform3f(t,r[0],r[1],r[2]);break;case"4f":this.gl.uniform4f(t,r[0],r[1],r[2],r[3]);break;case"1iv":this.gl.uniform1iv(t,r);break;case"3iv":this.gl.uniform3iv(t,r);break;case"1fv":this.gl.uniform1fv(t,r);break;case"2fv":this.gl.uniform2fv(t,r);break;case"3fv":this.gl.uniform3fv(t,r);break;case"4fv":this.gl.uniform4fv(t,r);break;case"Matrix3fv":this.gl.uniformMatrix3fv(t,!1,r);break;case"Matrix4fv":this.gl.uniformMatrix4fv(t,!1,r)}}},{key:"refreshUniforms",value:function(){if(this.compiled)for(var e in this.uniforms){var t=this.uniforms[e];t.location=this.gl.getUniformLocation(this.program,e),this.updateUniform(t)}}},{key:"refreshAttributes",value:function(){this.attribs={}}},{key:"attribute",value:function(e){if(this.compiled){var t=this.attribs[e]=this.attribs[e]||{};return null!=t.location||(t.name=e,t.location=this.gl.getAttribLocation(this.program,e)),t}}},{key:"source",value:function(e){return"vertex"===e?this.computed_vertex_source:"fragment"===e?this.computed_fragment_source:void 0}},{key:"lines",value:function(e){var t=this.source(e);return t?t.split("\n"):[]}},{key:"line",value:function(e,t){var r=this.lines(e);if(r)return r[t]}},{key:"block",value:function(e,t){for(var r,i=this.lines(e),n=0;n<t&&n<i.length;n++){var o=i[n],a=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);a&&a.length>1?r={scope:a[1],name:a[2],num:a[3]}:(a=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&a.length>1&&(r=null),r&&(r.line=null==r.line?-1:r.line+1,r.source=o)}return r}},{key:"checkExtensions",value:function(){var e=this,t=[];return this.extensions.forEach((function(r){var i=getExtension(e.gl,r),n="TANGRAM_EXTENSION_".concat(r);e.defines[n]=null!=i,i?t.push(r):log("debug","Could not enable extension '".concat(r,"'"))})),t}}]),e}();ShaderProgram.polyfills={},ShaderProgram.id=0,ShaderProgram.current=null,ShaderProgram.defines={},ShaderProgram.blocks={},ShaderProgram.reset=function(){ShaderProgram.programs_by_source={},ShaderProgram.shaders_by_source={}},ShaderProgram.reset(),ShaderProgram.buildDefineString=function(e){var t="";for(var r in e)null!=e[r]&&!1!==e[r]&&("boolean"==typeof e[r]&&!0===e[r]?t+="#define "+r+"\n":"number"==typeof e[r]&&Math.floor(e[r])===e[r]?t+="#define "+r+" "+e[r].toFixed(1)+"\n":t+="#define "+r+" "+e[r]+"\n");return t},ShaderProgram.buildExtensionString=function(e){var t="";return(e=e||[]).forEach((function(e){t+="#ifdef GL_".concat(e,"\n#extension GL_").concat(e," : enable\n#endif\n")})),t},ShaderProgram.addBlock=function(e){var t;ShaderProgram.blocks[e]=ShaderProgram.blocks[e]||[];for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];(t=ShaderProgram.blocks[e]).push.apply(t,i)},ShaderProgram.removeBlock=function(e){ShaderProgram.blocks[e]=[]},ShaderProgram.replaceBlock=function(e){ShaderProgram.removeBlock(e);for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];ShaderProgram.addBlock.apply(ShaderProgram,[e].concat(r))},ShaderProgram.updateProgram=function(e,t,r,i){var n=hashString(e._tangram_id+"::"+r+"::"+i);if(ShaderProgram.programs_by_source[n])return log("trace","Reusing identical source GL program object"),ShaderProgram.programs_by_source[n];var o=ShaderProgram.createShader(e,r,e.VERTEX_SHADER),a=ShaderProgram.createShader(e,i,e.FRAGMENT_SHADER);if(e.useProgram(null),null!=t)for(var s=e.getAttachedShaders(t),l=0;l<s.length;l++)e.detachShader(t,s[l]);else t=e.createProgram();if(null==o||null==a)return t;if(e.attachShader(t,o),e.attachShader(t,a),e.linkProgram(t),!e.getProgramParameter(t,e.LINK_STATUS)){var u=new Error("WebGL program error:\n            VALIDATE_STATUS: ".concat(e.getProgramParameter(t,e.VALIDATE_STATUS),"\n            ERROR: ").concat(e.getError(),"\n            --- Vertex Shader ---\n            ").concat(r,"\n            --- Fragment Shader ---\n            ").concat(i));throw Object.assign(new Error(u),{type:"program"})}return ShaderProgram.programs_by_source[n]=t,t},ShaderProgram.createShader=function(e,t,r){var i=hashString(e._tangram_id+"::"+t);if(ShaderProgram.shaders_by_source[i])return log("trace","Reusing identical source GL shader object"),ShaderProgram.shaders_by_source[i];var n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var o=r===e.VERTEX_SHADER?"vertex":"fragment",a=e.getShaderInfoLog(n),s=parseShaderErrors(a);throw Object.assign(new Error(a),{type:o,errors:s})}return ShaderProgram.shaders_by_source[i]=n,n};var VertexArrayObject={disabled:!1,bound_vao:[],init:function(e){var t;!0!==this.disabled&&(t=getExtension(e,"OES_vertex_array_object")),null!=t?log("info","Vertex Array Object extension available"):!0!==this.disabled?log("warn","Vertex Array Object extension NOT available"):log("warn","Vertex Array Object extension force disabled")},create:function(e,t,r){var i={};i.setup=t,i.teardown=r;var n=getExtension(e,"OES_vertex_array_object");return null!=n&&(i._vao=n.createVertexArrayOES(),n.bindVertexArrayOES(i._vao)),i.setup(!0),i},getCurrentBinding:function(e){var t=this.bound_vao.filter((function(t){return t[0]===e}))[0];return t&&t[1]},setCurrentBinding:function(e,t){var r=this.bound_vao,i=r.filter((function(t){return t[0]===e}))[0];null==i?r.push([e,t]):i[1]=t},bind:function(e,t){var r=getExtension(e,"OES_vertex_array_object");if(null!=t)null!=r&&null!=t._vao?(r.bindVertexArrayOES(t._vao),this.setCurrentBinding(e,t)):t.setup(!1);else{var i=this.getCurrentBinding(e);null!=r?r.bindVertexArrayOES(null):null!=i&&"function"==typeof i.teardown&&i.teardown(),this.setCurrentBinding(e,null)}},destroy:function(e,t){var r=getExtension(e,"OES_vertex_array_object");null!=r&&null!=t&&null!=t._vao&&(r.deleteVertexArrayOES(t._vao),t._vao=null)}},VBOMesh=function(){function e(t,r,i,n,o,a){_classCallCheck(this,e),a=a||{},this.textureManager=getTextureManager(o),this.gl=t,this.vertex_data=r,this.element_data=i,this.vertex_layout=n,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=a.draw_mode||this.gl.TRIANGLES,this.data_usage=a.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=a.uniforms,this.textures=a.textures,this.retain=a.retain||!1,this.created_at=+new Date,this.fade_in_time=a.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}return _createClass(e,[{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.valid)return!1;var t=e.program||ShaderProgram.current;t.use(),this.uniforms&&(t.saveUniforms(this.uniforms),t.setUniforms(this.uniforms,!1));var r=(+new Date-this.created_at)/1e3;return t.uniform("1f","u_visible_time",r),this.bind(t),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),VertexArrayObject.bind(this.gl,null),this.uniforms&&t.restoreUniforms(this.uniforms),r<this.fade_in_time}},{key:"bind",value:function(e){var t=this,r=this.vaos[e.id];r?VertexArrayObject.bind(this.gl,r):this.vaos[e.id]=VertexArrayObject.create(this.gl,(function(r){t.gl.bindBuffer(t.gl.ARRAY_BUFFER,t.vertex_buffer),t.toggle_element_array&&t.gl.bindBuffer(t.gl.ELEMENT_ARRAY_BUFFER,t.element_buffer),t.vertex_layout.enable(t.gl,e,r)}))}},{key:"upload",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)}},{key:"destroy",value:function(){var e=this;if(!this.valid)return!1;for(var t in this.valid=!1,this.vaos)VertexArrayObject.destroy(this.gl,this.vaos[t]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach((function(t){return e.textureManager.release(t)})),!0}}]),e}(),shaderSrc_material="/*Defines globals:materiallight_accumulator_**/struct Material{\n#ifdef TANGRAM_MATERIAL_EMISSION\nvec4 emission;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nvec3 emissionScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT\nvec4 ambient;\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nvec3 ambientScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nvec4 diffuse;\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nvec3 diffuseScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 specular;float shininess;\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nvec3 specularScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvec3 normalScale;float normalAmount;\n#endif\n};uniform Material u_material;Material material;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\nvec4 light_accumulator_ambient=vec4(vec3(0.0),1.);vec4 light_accumulator_diffuse=vec4(vec3(0.0),1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 light_accumulator_specular=vec4(vec3(0.0),1.);\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap(in sampler2D _tex,in vec3 _eyeToPoint,in vec3 _normal,in vec2 _skew){vec3 eye=normalize(_eyeToPoint);eye.xy-=_skew;eye=normalize(eye);vec3 r=reflect(eye,_normal);r.z+=1.0;float m=2.*length(r);vec2 uv=r.xy/m+.5;return texture2D(_tex,uv);}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend(in vec3 _normal){vec3 blending=abs(_normal);blending=normalize(max(blending,0.00001));float b=(blending.x+blending.y+blending.z);return blending/b;}vec4 getTriPlanar(in sampler2D _tex,in vec3 _pos,in vec3 _normal,in vec3 _scale){vec3 blending=getTriPlanarBlend(_normal);vec4 xaxis=texture2D(_tex,fract(_pos.yz*_scale.x));vec4 yaxis=texture2D(_tex,fract(_pos.xz*_scale.y));vec4 zaxis=texture2D(_tex,fract(_pos.xy*_scale.z));return xaxis*blending.x+yaxis*blending.y+zaxis*blending.z;}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar(in sampler2D _tex,in vec3 _pos,in vec2 _scale){return texture2D(_tex,fract(_pos.xy*_scale.x));}\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal(inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n_normal+=texture2D(u_material_normal_texture,fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\nvec3 normalTex=getPlanar(u_material_normal_texture,v_world_position.xyz,material.normalScale.xy).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\nvec3 normalTex=getTriPlanar(u_material_normal_texture,v_world_position.xyz,_normal,material.normalScale).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n_normal=normalize(_normal);}\n#endif\nvoid calculateMaterial(in vec3 _eyeToPoint,inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\nmaterial.emission*=texture2D(u_material_emission_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\nmaterial.emission*=getPlanar(u_material_emission_texture,v_world_position.xyz,material.emissionScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\nmaterial.emission*=getTriPlanar(u_material_emission_texture,v_world_position.xyz,_normal,material.emissionScale);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\nmaterial.emission*=getSphereMap(u_material_emission_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\nmaterial.ambient*=texture2D(u_material_ambient_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\nmaterial.ambient*=getPlanar(u_material_ambient_texture,v_world_position.xyz,material.ambientScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\nmaterial.ambient*=getTriPlanar(u_material_ambient_texture,v_world_position.xyz,_normal,material.ambientScale);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\nmaterial.ambient*=getSphereMap(u_material_ambient_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\nmaterial.diffuse*=texture2D(u_material_diffuse_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\nmaterial.diffuse*=getPlanar(u_material_diffuse_texture,v_world_position.xyz,material.diffuseScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\nmaterial.diffuse*=getTriPlanar(u_material_diffuse_texture,v_world_position.xyz,_normal,material.diffuseScale);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\nmaterial.diffuse*=getSphereMap(u_material_diffuse_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\nmaterial.specular*=texture2D(u_material_specular_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\nmaterial.specular*=getPlanar(u_material_specular_texture,v_world_position.xyz,material.specularScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\nmaterial.specular*=getTriPlanar(u_material_specular_texture,v_world_position.xyz,_normal,material.specularScale);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\nmaterial.specular*=getSphereMap(u_material_specular_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n}",material_props=["emission","ambient","diffuse","specular"],Material=function(){function e(t){var r=this;_classCallCheck(this,e),t=t||{},material_props.forEach((function(e){var i=t[e];null!=i&&(i.texture?r[e]={texture:i.texture,mapping:i.mapping||"spheremap",scale:GLSL.expandVec3(null!=i.scale?i.scale:1),amount:GLSL.expandVec4(null!=i.amount?i.amount:1)}:"number"==typeof i||Array.isArray(i)?r[e]={amount:GLSL.expandVec4(i)}:r[e]="string"==typeof i?{amount:StyleParser.parseColor(i)}:i)})),this.specular&&(this.specular.shininess=t.shininess?parseFloat(t.shininess):.2),null!=t.normal&&(this.normal={texture:t.normal.texture,mapping:t.normal.mapping||"triplanar",scale:GLSL.expandVec3(null!=t.normal.scale?t.normal.scale:1),amount:null!=t.normal.amount?t.normal.amount:1})}return _createClass(e,[{key:"inject",value:function(t){var r=this;material_props.forEach((function(e){var i="TANGRAM_MATERIAL_".concat(e.toUpperCase()),n=i+"_TEXTURE";t.defines[i]=null!=r[e],r[e]&&r[e].texture&&(t.defines[n]=!0,t.defines[n+"_"+r[e].mapping.toUpperCase()]=!0,t.defines["TANGRAM_MATERIAL_TEXTURE_".concat(r[e].mapping.toUpperCase())]=!0,t.texcoords=t.texcoords||"uv"===r[e].mapping)})),this.normal&&this.normal.texture&&(t.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,t.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,t.defines["TANGRAM_MATERIAL_TEXTURE_".concat(this.normal.mapping.toUpperCase())]=!0,t.texcoords=t.texcoords||"uv"===this.normal.mapping),t.replaceShaderBlock(e.block,shaderSrc_material,"Material"),t.addShaderBlock("setup","\nmaterial = u_material;\n","Material")}},{key:"setupProgram",value:function(e){var t=this;material_props.forEach((function(r){t[r]&&(t[r].texture?(e.setTextureUniform("u_material_".concat(r,"_texture"),t[r].texture),e.uniform("3fv","u_material.".concat(r,"Scale"),t[r].scale),e.uniform("4fv","u_material.".concat(r),t[r].amount)):t[r].amount&&e.uniform("4fv","u_material.".concat(r),t[r].amount))})),this.specular&&e.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(e.setTextureUniform("u_material_normal_texture",this.normal.texture),e.uniform("3fv","u_material.normalScale",this.normal.scale),e.uniform("1f","u_material.normalAmount",this.normal.amount))}}],[{key:"isValid",value:function(e){return null!=e&&(null!=e.emission||null!=e.ambient||null!=e.diffuse||null!=e.specular)}}]),e}(),Vector;Material.block="material";var Vector$1=Vector={};Vector.copy=function(e){for(var t=[],r=e.length,i=0;i<r;i++)t[i]=e[i];return t},Vector.neg=function(e){for(var t=[],r=e.length,i=0;i<r;i++)t[i]=-e[i];return t},Vector.add=function(e,t){for(var r=[],i=Math.min(e.length,t.length),n=0;n<i;n++)r[n]=e[n]+t[n];return r},Vector.sub=function(e,t){for(var r=[],i=Math.min(e.length,t.length),n=0;n<i;n++)r[n]=e[n]-t[n];return r},Vector.signed_area=function(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])},Vector.mult=function(e,t){var r,i=[],n=e.length;if("number"==typeof t)for(r=0;r<n;r++)i[r]=e[r]*t;else for(n=Math.min(e.length,t.length),r=0;r<n;r++)i[r]=e[r]*t[r];return i},Vector.multMatrix=function(e,t){return[e[0][0]*t[0]+e[0][1]*t[1],e[1][0]*t[0]+e[1][1]*t[1]]},Vector.div=function(e,t){var r,i=[];if("number"==typeof t)for(r=0;r<e.length;r++)i[r]=e[r]/t;else{var n=Math.min(e.length,t.length);for(r=0;r<n;r++)i[r]=e[r]/t[r]}return i},Vector.perp=function(e,t){return[t[1]-e[1],e[0]-t[0]]},Vector.rot=function(e,t){var r=Math.cos(t),i=Math.sin(t);return[e[0]*r-e[1]*i,e[0]*i+e[1]*r]},Vector.angle=function(e){var t=_slicedToArray(e,2),r=t[0],i=t[1];return Math.atan2(i,r)},Vector.angleBetween=function(e,t){var r=Vector.dot(Vector.normalize(Vector.copy(e)),Vector.normalize(Vector.copy(t)));return r>1&&(r=1),Math.acos(r)},Vector.signedAngleBetween=function(e,t){return Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1])},Vector.isEqual=function(e,t){for(var r=e.length,i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0},Vector.lengthSq=function(e){return 2===e.length?e[0]*e[0]+e[1]*e[1]:e.length>=3?e[0]*e[0]+e[1]*e[1]+e[2]*e[2]:0},Vector.length=function(e){return Math.sqrt(Vector.lengthSq(e))},Vector.normalize=function(e){var t;if(2===e.length){if(1===(t=e[0]*e[0]+e[1]*e[1]))return e;0!==(t=Math.sqrt(t))?(e[0]/=t,e[1]/=t):(e[0]=0,e[1]=0)}else if(e.length>=3){if(1===(t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]))return e;0!==(t=Math.sqrt(t))?(e[0]/=t,e[1]/=t,e[2]/=t):(e[0]=0,e[1]=0,e[2]=0)}return e},Vector.cross=function(e,t){return 2===e.length?e[0]*t[1]-e[1]*t[0]:3===e.length?[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]:void 0},Vector.dot=function(e,t){for(var r=0,i=Math.min(e.length,t.length),n=0;n<i;n++)r+=e[n]*t[n];return r};var shaderSrc_ambientLight="/*Expected globals:light_accumulator_**/struct AmbientLight{vec3 ambient;};void calculateLight(in AmbientLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;}",shaderSrc_directionalLight="/*Expected globals:materiallight_accumulator_**/struct DirectionalLight{vec3 ambient;vec3 diffuse;vec3 specular;vec3 direction;};void calculateLight(in DirectionalLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;float nDotVP=clamp(dot(_normal,-_light.direction),0.0,1.0);\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(_light.direction,_normal);float eyeDotR=max(dot(normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf;\n#endif\n}",shaderSrc_pointLight="/*Expected globals:materiallight_accumulator_**/struct PointLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\n};void calculateLight(in PointLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(VP,_normal),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nlight_accumulator_ambient.rgb+=_light.ambient*attenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(0.0,dot(-normalize(_eyeToPoint),reflectVector));pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation;\n#endif\n}",shaderSrc_spotLight="/*Expected globals:materiallight_accumulator_**/struct SpotLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\nvec3 direction;float spotCosCutoff;float spotExponent;};void calculateLight(in SpotLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(_normal,VP),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nfloat spotAttenuation=0.0;float spotDot=clamp(dot(-VP,_light.direction),0.0,1.0);if(spotDot>=_light.spotCosCutoff){spotAttenuation=pow(spotDot,_light.spotExponent);}light_accumulator_ambient.rgb+=_light.ambient*attenuation*spotAttenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation*spotAttenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(dot(-normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation*spotAttenuation;\n#endif\n}",Light=function(){function e(t,r){_classCallCheck(this,e),this.name=r.name,this.view=t,null==r.ambient||"number"==typeof r.ambient?this.ambient=GLSL.expandVec3(r.ambient||0):this.ambient=StyleParser.parseColor(r.ambient).slice(0,3),null==r.diffuse||"number"==typeof r.diffuse?this.diffuse=GLSL.expandVec3(null!=r.diffuse?r.diffuse:1):this.diffuse=StyleParser.parseColor(r.diffuse).slice(0,3),null==r.specular||"number"==typeof r.specular?this.specular=GLSL.expandVec3(r.specular||0):this.specular=StyleParser.parseColor(r.specular).slice(0,3)}return _createClass(e,[{key:"inject",value:function(){var t="\n            uniform ".concat(this.struct_name," u_").concat(this.name,";\n            ").concat(this.struct_name," ").concat(this.name,";\n            "),r="\n            ".concat(this.name," = u_").concat(this.name,";\n\n        ");ShaderProgram.addBlock(e.block,t),ShaderProgram.addBlock("setup",r)}},{key:"update",value:function(){}},{key:"setupProgram",value:function(e){e.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient),e.uniform("3fv","u_".concat(this.name,".diffuse"),this.diffuse),e.uniform("3fv","u_".concat(this.name,".specular"),this.specular)}}],[{key:"create",value:function(t,r){if(e.types[r.type])return new e.types[r.type](t,r)}},{key:"setMode",value:function(t,r){!0===t&&(t="fragment"),t=e.enabled&&(null!=t?t:"fragment"),r.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===t,r.defines.TANGRAM_LIGHTING_VERTEX="vertex"===t}},{key:"inject",value:function(t){if(ShaderProgram.removeBlock(e.block),e.enabled){var r="";if(t&&Object.keys(t).length>0){var i={};for(var n in t)i[t[n].type]=!0;for(var o in i)e.types[o].inject();for(var a in t)t[a].inject(),r+="calculateLight(".concat(a,", _eyeToPoint, _normal);\n")}var s="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                ".concat(r,"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }");ShaderProgram.addBlock(e.block,s)}}}]),e}();Light.types={},Light.block="lighting",Light.enabled=!0;var AmbientLight=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),(n=t.call(this,e,i)).type="ambient",n.struct_name="AmbientLight",n}return _createClass(r,[{key:"setupProgram",value:function(e){e.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient)}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_ambientLight)}}]),r}(Light);Light.types.ambient=AmbientLight;var DirectionalLight=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;if(_classCallCheck(this,r),(n=t.call(this,e,i)).type="directional",n.struct_name="DirectionalLight",i.direction)n._direction=i.direction;else{var o=Math.sin(60*Math.PI/180);n._direction=[Math.cos(135*Math.PI/180)*o,Math.sin(135*Math.PI/180)*o,-.5]}return null==i.ambient&&(n.ambient=GLSL.expandVec3(.5)),n.direction=n._direction.map(parseFloat),n._initial_direction=[n.direction[0],n.direction[1],n.direction[2]],n}return _createClass(r,[{key:"update",value:function(){vec3.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"setupProgram",value:function(e){_get(_getPrototypeOf(r.prototype),"setupProgram",this).call(this,e),e.uniform("3fv","u_".concat(this.name,".direction"),this.direction)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=Vector$1.normalize(Vector$1.copy(e))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_directionalLight)}}]),r}(Light);Light.types.directional=DirectionalLight;var PointLight=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),(n=t.call(this,e,i)).type="point",n.struct_name="PointLight",n.position=i.position||[0,0,"100px"],n.position_eye=[],n.origin=i.origin||"ground",n.attenuation=isNaN(parseFloat(i.attenuation))?0:parseFloat(i.attenuation),i.radius?Array.isArray(i.radius)&&2===i.radius.length?n.radius=i.radius:n.radius=[null,i.radius]:n.radius=null,n}return _createClass(r,[{key:"inject",value:function(){_get(_getPrototypeOf(r.prototype),"inject",this).call(this),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius}},{key:"update",value:function(){var e=this.view.lookAtManipulator.getLookAtData().zoom;if("world"===this.origin){var t=_slicedToArray(Geo$1.latLngToMeters(this.position),2),r=t[0],i=t[1];this.position_eye[0]=r-this.view.lookAtManipulator.getLookAtData().position[0],this.position_eye[1]=i-this.view.lookAtManipulator.getLookAtData().position[1],this.position_eye[2]=StyleParser.convertUnits(this.position[2],{zoom:e,meters_per_pixel:Geo$1.metersPerPixel(e)}),this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance}else"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=StyleParser.convertUnits(this.position,{zoom:e,meters_per_pixel:Geo$1.metersPerPixel(e)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance));this.position_eye[3]=1}},{key:"setupProgram",value:function(e){_get(_getPrototypeOf(r.prototype),"setupProgram",this).call(this,e),e.uniform("4fv","u_".concat(this.name,".position"),this.position_eye),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&e.uniform("1f","u_".concat(this.name,".attenuationExponent"),this.attenuation);var t=this.view.lookAtManipulator.getLookAtData().zoom;ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&e.uniform("1f","u_".concat(this.name,".innerRadius"),StyleParser.convertUnits(this.radius[0],{zoom:t,meters_per_pixel:Geo$1.metersPerPixel(t)})),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&e.uniform("1f","u_".concat(this.name,".outerRadius"),StyleParser.convertUnits(this.radius[1],{zoom:t,meters_per_pixel:Geo$1.metersPerPixel(t)}))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_pointLight)}}]),r}(Light);Light.types.point=PointLight;var SpotLight=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),(n=t.call(this,e,i)).type="spotlight",n.struct_name="SpotLight",n.direction=n._direction=(i.direction||[0,0,-1]).map(parseFloat),n._initial_direction=[n.direction[0],n.direction[1],n.direction[2]],n.exponent=i.exponent?parseFloat(i.exponent):.2,n.angle=i.angle?parseFloat(i.angle):20,n}return _createClass(r,[{key:"setupProgram",value:function(e){_get(_getPrototypeOf(r.prototype),"setupProgram",this).call(this,e),e.uniform("3fv","u_".concat(this.name,".direction"),this.direction),e.uniform("1f","u_".concat(this.name,".spotCosCutoff"),Math.cos(3.14159*this.angle/180)),e.uniform("1f","u_".concat(this.name,".spotExponent"),this.exponent)}},{key:"update",value:function(){_get(_getPrototypeOf(r.prototype),"update",this).call(this),vec3.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=Vector$1.normalize(Vector$1.copy(e))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_spotLight)}}]),r}(PointLight);function mergeObjects(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var r=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(r)for(var i in r){var n=r[i];null===n||"object"!==_typeof(n)||Array.isArray(n)?void 0!==n&&(e[i]=n):null===e[i]||"object"!==_typeof(e[i])||Array.isArray(e[i])?e[i]=mergeObjects({},n):e[i]=mergeObjects(e[i],n)}}return e}Light.types.spotlight=SpotLight;var shaderSrc_selectionFragment="\n#ifdef TANGRAM_FEATURE_SELECTION\nvarying vec4 v_selection_color;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\ngl_FragColor=v_selection_color;\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}",shaderSrc_selectionCropFragment="\n#pragma tangram: utils\n#ifdef TANGRAM_FEATURE_SELECTION\nuniform float u_meters_per_pixel;varying vec4 v_selection_color;varying vec4 v_local_space_position;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}else{gl_FragColor=v_selection_color;}\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}",shaderSrc_rasters="#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_raster;uniform vec3 u_raster_offset;\n#define sampleRaster() (texture2D(u_raster, v_modelpos_base_zoom.xy * u_raster_offset.z + u_raster_offset.xy))\n#endif\n",Style={init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.generation,r=e.styles,i=e.sources,n=void 0===i?{}:i,o=e.introspection,a=e.id,s=void 0!==a?a+"/":"";this.scene_id=a,this.textureManager=getTextureManager(a),this.main_thread_target="".concat(s,"Style/").concat(this.name),this.setGeneration(t),this.styles=r,this.sources=n,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=o||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque",this.defines["TANGRAM_BLEND_".concat(this.blend.toUpperCase())]=!0,null==this.blend_order&&(this.blend_order=-1),this.removeShaderBlock("setup"),this.material instanceof Material||(Material.isValid(this.material)||(this.material=StyleParser.defaults.material),this.material=new Material(this.material)),this.material.inject(this),Light.setMode(this.lighting,this),this.setupRasters(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),WorkerBroker.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(e){this.generation=e,Thread.is_main&&WorkerBroker.addTarget(this.main_thread_target,this)},fillVertexTemplate:function(e,t,r,i){var n=i.size,o=i.offset;o=void 0===o?0:o;var a=e.index[t];if(void 0!==a)for(var s=0;s<n;++s){var l=r.length>s?r[s]:r;this.vertex_template[a+s+o]=l}else log("warn","Style: in style '".concat(this.name,"', no index found in vertex layout for attribute '").concat(t,"'"))},startData:function(e){this.tile_data[e.id]=this.tile_data[e.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(e){var t=this.tile_data[e.id];if(this.tile_data[e.id]=null,t&&Object.keys(t.meshes).length>0){for(var r in t.meshes){var i=t.meshes[r];0!==i.vertex_data.vertex_count?(i.vertex_data.end(),i.vertex_elements=i.vertex_data.element_buffer,i.vertex_data=i.vertex_data.vertex_buffer):delete t.meshes[r]}return e.mesh_data[this.name]=t,this.buildRasterTextures(e,t).then((function(e){return e}))}return Promise.resolve(null)},hasDataForTile:function(e){return null!=this.tile_data[e.id]},getTileMesh:function(e,t){var r=this.tile_data[e.id].meshes;return null==r[t.key]&&(r[t.key]={variant:t,vertex_data:this.vertexLayoutForMeshVariant(t).createVertexData()}),r[t.key]},vertexLayoutForMeshVariant:function(e){return this.vertex_layout},default_mesh_variant:{key:0},style_mesh_variants:{default:{variants:{0:{variant:{key:0},times_unref:0}}}},addMeshVariantForDraw:function(e,t){this.style_mesh_variants[e]||(this.style_mesh_variants[e]={variants:{}});var r=this.computeVariantForDraw(t);return this.style_mesh_variants[e].variants[r.key]={variant:r,times_unref:0},this.style_mesh_variants[e].variants[r.key].variant},getMeshVariantTypeForDraw:function(e){return this.getMeshVariantType(this.base,e)},getMeshVariantType:function(e,t){void 0===e&&(e="default");var r=this.style_mesh_variants[e];if(void 0===t.variantKey||!r||!r.variants[t.variantKey])return this.addMeshVariantForDraw(e,t);var i=t.variantKey,n=r.variants[i];return n.times_unref=0,n.variant},updateMeshVariantTypeCache:function(e){for(var t in this.style_mesh_variants){var r=this.style_mesh_variants[t].variants;for(var i in r){var n=r[i];n.times_unref++,n.times_unref>e&&("default"!==t||0!=+i)&&(delete r[i],0===Object.keys(r).length&&delete this.style_mesh_variants[t])}}},computeVariantForDraw:function(e){return this.default_mesh_variant},addFeature:function(e,t,r){var i=r.tile;this.tile_data[i.id]||this.startData(i);var n=this.parseFeature(e,t,r);if(n){var o="lines"===this.base?this.getMeshVariantTypeForDraw(t):this.getMeshVariantTypeForDraw(n),a=this.getTileMesh(i,o),s=a.vertex_data.offset,l=a.vertex_data.vertex_count;this.buildGeometry(e.geometry,n,a,r)>0?e.generation=this.generation:a.vertex_data.vertex_count>l&&(a.vertex_data.vertex_buffer.fill(0,s,a.vertex_data.offset),a.vertex_data.vertex_count=l,a.vertex_data.offset=s)}},buildGeometry:function(e,t,r,i){var n;return"Polygon"===e.type?n=this.buildPolygons([e.coordinates],t,r,i):"MultiPolygon"===e.type?n=this.buildPolygons(e.coordinates,t,r,i):"LineString"===e.type?n=this.buildLines([e.coordinates],t,r,i):"MultiLineString"===e.type?n=this.buildLines(e.coordinates,t,r,i):"Point"===e.type?n=this.buildPoints([e.coordinates],t,r,i):"MultiPoint"===e.type&&(n=this.buildPoints(e.coordinates,t,r,i)),n},parseFeature:function(e,t,r){try{var i=this.feature_style;if(i.order=this.parseOrder(t.order,r),null==i.order&&"overlay"!==this.blend){var n="Layer '".concat(t.layers.join(", "),"', draw group '").concat(t.group,"': ");return n+="'order' parameter is required unless blend mode is 'overlay'",null!=t.order&&(n+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",n+="or JS function), but evaluated to null for one or more features"),void log({level:"warn",once:!0},n)}if(!(i=this._parseFeature(e,t,r)))return;if(this.selection?i.interactive=StyleParser.evalProperty(this.introspection||t.interactive,r):i.interactive=!1,!0===i.interactive){var o=FeatureSelection.makeEntry(),a=o.color,s=o.key;i.selection_color=a,r.tile.selection_data||(r.tile.selection_data={}),r.tile.selection_data[s]={id:e.id||s,properties:e.properties,source_name:r.source,source_layer:r.layer,layers:r.layers}}else i.selection_color=FeatureSelection.defaultColor;return i}catch(t){log("error","Style.parseFeature: style parsing error",e,i,t.stack)}},_parseFeature:function(e,t,r){return this.feature_style},preprocess:function(e,t){if(!e.preprocessed){if(this.draw)for(var r in this.draw){var i=this.draw[r];"object"!==_typeof(i)||Array.isArray(i)?null==e[r]&&(e[r]=i):e[r]=mergeObjects({},i,e[r])}var n=t||"";if(!(e=this._preprocess(e,n)))return;e.preprocessed=!0}return e},_preprocess:function(e,t){return e},parseOrder:function(e,t){return"number"!=typeof e?StyleParser.calculateOrder(e,t):e},scaleOrder:function(e){return 2*e},parseColor:function(e,t){return e?StyleParser.evalCachedColorProperty(e,t):this.shaders.blocks.color||this.shaders.blocks.filter?StyleParser.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(e){this.gl=e,this.max_texture_size=this.textureManager.getMaxTextureSize(this.gl)},makeMesh:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.vertexLayoutForMeshVariant(r.variant);return new VBOMesh(this.gl,e,t,i,this.scene_id,r)},render:function(e){return e.render()},getProgram:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program";this.compileSetup();var t=this[e];if(t&&!t.error){if(!t.compiled)try{t.compile()}catch(t){log("error","Style: error compiling program for style '".concat(this.name,"' (program key '").concat(e,"')"),this,t.stack)}return t}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for ".concat(this.name," because no GL context"));var e=this.buildDefineList();if(this.selection){var t=Object.assign({},e);t.TANGRAM_FEATURE_SELECTION=!0}var r=this.shaders&&this.shaders.blocks,i=this.shaders&&this.shaders.block_scopes,n=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in n)null==n[o]&&log({level:"warn",once:!0},"Style '".concat(this.name,"' has invalid uniform '").concat(o,"': uniform values must be non-null"));var a=this.shaders&&this.shaders.extensions;"string"==typeof a&&(a=[a]),this.program=new ShaderProgram(this.gl,this.vertex_shader_src,this.fragment_shader_src,this.scene_id,{name:this.name,defines:e,uniforms:n,blocks:r,block_scopes:i,extensions:a}),this.selection?this.selection_program=new ShaderProgram(this.gl,this.vertex_shader_src,this.crop_by_tile?shaderSrc_selectionCropFragment:shaderSrc_selectionFragment,this.scene_id,{name:this.name+" (selection)",defines:t,uniforms:n,blocks:r,block_scopes:i,extensions:a}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[e]=this.shaders.blocks[e]||[],this.shaders.blocks[e].push(t),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[e]=this.shaders.block_scopes[e]||[],this.shaders.block_scopes[e].push(r)},removeShaderBlock:function(e){this.shaders.blocks&&(this.shaders.blocks[e]=null)},replaceShaderBlock:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.removeShaderBlock(e),this.addShaderBlock(e,t,r)},buildDefineList:function(){var e={};if(null!=this.defines)for(var t in this.defines)e[t]=this.defines[t];if(null!=this.shaders&&null!=this.shaders.defines)for(t in this.shaders.defines)e[t]=this.shaders.defines[t];return e},hasRasters:function(){return["color","normal","custom"].indexOf(this.raster)>-1},setupRasters:function(){if(!Thread.is_main)return!1;if(!this.hasRasters())return!1;"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var e=!1;for(var t in this.sources)if(this.sources[t]instanceof RasterTileSource){e=!0;break}return!!e&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",shaderSrc_rasters,"Raster"),!0)},buildRasterTextures:function(e,t){var r=this;if(!this.hasRasters())return Promise.resolve(t);var i={};return e.rasters.map((function(e){return r.sources[e]})).filter((function(e){return e})).forEach((function(t,r){if(t instanceof RasterTileSource){var n=t.tileTexture(e);i[n.url]=n}})),0===Object.keys(i).length?Promise.resolve(t):WorkerBroker.postMessage(this.main_thread_target+".loadTextures",i).then((function(r){if(!r||r.length<1)return log("trace","Missing texture info for tile ".concat(e.key)),null;if(r.some((function(e){return!e.loaded})))return null;t.uniforms=t.uniforms||{},t.textures=t.textures||[];var n=r[0].name,o=i[n].coords;if(t.uniforms.u_raster=n,t.textures.push(n),e.coords.z>o.z){var a=e.coords.z-o.z,s=Math.pow(2,a);t.uniforms.u_raster_offset=[(e.coords.x%s+s)%s/s,(s-1-e.coords.y%s)/s,1/s]}else t.uniforms.u_raster_offset=[0,0,1];return t}))},loadTextures:function(e){var t=this;return this.textureManager.createFromObject(this.gl,e).then((function(){return Promise.all(Object.keys(e).map((function(e){return t.textureManager.textures[e]&&t.textureManager.textures[e].load()})).filter((function(e){return e})))})).then((function(e){return e.forEach((function(e){return e.retain()})),e.map((function(e){return{name:e.name,width:e.width,height:e.height,loaded:e.loaded}}))}))},setup:function(){this.setUniforms(),this.material.setupProgram(ShaderProgram.current)},setUniforms:function(){var e=ShaderProgram.current;e&&e.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:0,add:1,multiply:2,inlay:3,translucent:4,overlay:5},sortByBlendOrderWithinLayers:function(e){var t=[],r={};for(var i in e.forEach((function(e){var t=parseInt(e.name,10)||0;r[t]||(r[t]=[]),r[t].push(e)})),r)t.push.apply(t,_toConsumableArray(r[i].sort(Style.blendOrderSort)));return t},blendOrderSort:function(e,t){return"opaque"===e.blend||"opaque"===t.blend?"opaque"===e.blend&&"opaque"===t.blend?e.name<t.name?-1:1:"opaque"===e.blend?-1:1:e.blend_order<t.blend_order?-1:e.blend_order>t.blend_order?1:Style.default_blend_orders[e.blend]<Style.default_blend_orders[t.blend]?-1:Style.default_blend_orders[e.blend]>Style.default_blend_orders[t.blend]?1:e.name<t.name?-1:1}},id$1=0,build_id=0,Tile=function(){function e(t){var r=t.coords,i=t.style_zoom,n=t.source,o=t.worker,a=t.view,s=t.sceneId;_classCallCheck(this,e),this.textureManager=getTextureManager(s),this.id=id$1++,this.worker=o,this.view=a,this.source=n,this.generation=null,this.valid=!0,this.proxy_for=null,this.proxy_depth=0,this.proxied_as=null,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.style_zoom=i,this.coords=e.normalizedCoordinate(r,this.source,this.style_zoom),this.key=e.key(this.coords,this.source,this.style_zoom),this.overzoom=Math.max(this.style_zoom-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=Geo$1.metersForTile(this.coords),this.max=Geo$1.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:this.max.y-this.min.y},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.center_dist=0,this.meters_per_pixel=Geo$1.metersPerPixel(this.style_zoom),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=Geo$1.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=Geo$1.unitsPerMeter(this.coords.z)*this.overzoom2,this.meshes={},this.new_mesh_styles=[]}return _createClass(e,[{key:"freeResources",value:function(){for(var e in this.meshes)this.meshes[e].forEach((function(e){return e.destroy()}));this.meshes={}}},{key:"destroy",value:function(){Task.removeForTile(this.id),this.workerMessage("self.removeTile",this.id),this.freeResources(),this.worker=null,this.valid=!1}},{key:"buildAsMessage",value:function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_zoom:this.style_zoom,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation}}},{key:"workerMessage",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return WorkerBroker.postMessage.apply(WorkerBroker,[this.worker].concat(t))}},{key:"build",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).fade_in,r=void 0===t||t;return this.generation=e,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()})}},{key:"buildMeshes",value:function(e,t){if(!this.error){this.build_id=build_id++;var r={},i=this.mesh_data;if(i)for(var n in i){for(var o in i[n].meshes){var a=i[n].meshes[o];if(a.vertex_data){if(!e[n]){log("warn","Could not create mesh because style '".concat(n,"' not found, for tile ").concat(this.key,", aborting tile"));break}var s=Object.assign({},i[n]);s.uniforms=Object.assign({},s.uniforms,a.uniforms),s.variant=a.variant,a.textures&&(s.textures=a.textures),a.labels&&(s.retain=!0);var l=e[n].makeMesh(a.vertex_data,a.vertex_elements,s);l.variant=s.variant,l.labels=a.labels,r[n]=r[n]||[],r[n].push(l),null==l.variant.order&&(l.variant.order=r[n].length-1)}}r[n]&&r[n].sort((function(e,t){var r=e.variant.order,i=t.variant.order;return null==r?1:null==i||r<i?-1:1}))}for(var u in delete this.mesh_data,r)this.meshes[u]&&this.meshes[u].forEach((function(e){return e.destroy()})),this.meshes[u]=r[u],this.new_mesh_styles.push(u);if(t.done){for(var c in this.meshes)-1===this.new_mesh_styles.indexOf(c)&&(this.meshes[c].forEach((function(e){return e.destroy()})),delete this.meshes[c]);this.new_mesh_styles=[]}}}},{key:"setProxyFor",value:function(e){e?(this.proxy_for=this.proxy_for||[],this.proxy_for.push(e),this.proxy_depth=1,e.proxied_as=e.style_zoom>this.style_zoom?"child":"parent"):(this.proxy_for=null,this.proxy_depth=0)}},{key:"isProxy",value:function(){return null!=this.proxy_for}},{key:"shouldProxyForStyle",value:function(e){return!this.proxy_for||this.proxy_for.some((function(t){return null==t.meshes[e]}))}},{key:"setupProgram",value:function(e,t){var r=e.model,i=e.model32;t.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_zoom,this.coords.z]),t.uniform("1f","u_tile_proxy_depth",this.proxy_depth),mat4.identity(r),mat4.translate(r,r,vec3.fromValues(this.min.x,this.min.y,0)),mat4.scale(r,r,vec3.fromValues(this.span.x/Geo$1.tile_scale,-1*this.span.y/Geo$1.tile_scale,1)),mat4.copy(i,r),t.uniform("Matrix4fv","u_model",i),t.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)}},{key:"merge",value:function(e){return this.loading=e.loading,this.loaded=e.loaded,this.generation=e.generation,this.error=e.error,this.mesh_data=e.mesh_data,this.selection_data?Object.assign(this.selection_data,e.selection_data):this.selection_data=e.selection_data,this}}],[{key:"coord",value:function(t){return{x:t.x,y:t.y,z:t.z,key:e.coordKey(t)}}},{key:"coordKey",value:function(e){return e.x+"/"+e.y+"/"+e.z}},{key:"key",value:function(e,t,r){if(!(e.y<0||e.y>=1<<e.z||e.z<0))return[t.name,r,e.x,e.y,e.z].join("/")}},{key:"normalizedKey",value:function(t,r,i){return e.key(e.normalizedCoordinate(t,r,i),r,i)}},{key:"normalizedCoordinate",value:function(t,r,i){return r.zoom_bias&&(t=e.coordinateAtZoom(t,Math.max(0,t.z-r.zoom_bias))),e.coordinateWithMaxZoom(t,r.max_zoom)}},{key:"coordinateAtZoom",value:function(t,r){var i=t.x,n=t.y,o=t.z;if(o!==r){var a=Math.pow(2,o-r);i=Math.floor(i/a),n=Math.floor(n/a),o=r}return e.coord({x:i,y:n,z:o})}},{key:"coordinateWithMaxZoom",value:function(t,r){var i=t.x,n=t.y,o=t.z;return void 0!==r&&o>r?e.coordinateAtZoom({x:i,y:n,z:o},r):e.coord({x:i,y:n,z:o})}},{key:"childrenForCoordinate",value:function(t){var r=t.x,i=t.y,n=t.z,o=t.key;return e.coord_children[o]||(n++,r*=2,i*=2,e.coord_children[o]=[e.coord({x:r,y:i,z:n}),e.coord({x:r+1,y:i,z:n}),e.coord({x:r,y:i+1,z:n}),e.coord({x:r+1,y:i+1,z:n})]),e.coord_children[o]}},{key:"isDescendant",value:function(t,r){if(r.z>t.z){var i=e.coordinateAtZoom(r,t.z),n=i.x,o=i.y;return t.x===n&&t.y===o}return!1}},{key:"cancel",value:function(t){t&&(t.canceled=!0,t.source_data&&t.source_data.request_id&&(Utils$1.cancelRequest(t.source_data.request_id),t.source_data.request_id=null),e.abortBuild(t))}},{key:"buildGeometry",value:function(t,r){var i=r.scene_id,n=r.layers,o=r.styles,a=r.global,s=r.sources,l=r.meshVariantMaxLife,u=t.source_data;for(var c in Collision.startTile(t.id,{apply_repeat_groups:!0}),n){var h=n[c];if(h&&h.config_data){if(h.config_data.source===t.source)for(var f=e._getDataForSource(u,h.config_data,c),d=0;d<f.length;d++){var _=f[d],p=_.geom;if(p)for(var g=0;g<p.features.length;g++){var m=p.features[g];if(null!=m.geometry){var y=StyleParser.getFeatureParseContext(m,t,a,s);y.winding=t.default_winding,y.source=t.source,y.layer=_.layer;var v=h.buildDrawGroups(y,!0);if(v)for(var x in v){var b=v[x],T=b.style||x,A=o[T];A?null!=(b=A.preprocess(b,t.source))&&!1!==b.visible&&(y.layers=b.layers,A.addFeature(m,b,y)):log("warn","Style '".concat(T,"' not found, skipping layer '").concat(c,"':"),b,m)}}}}}else log("warn","Layer ".concat(c," was defined without a geometry data source and will not be rendered."))}var E=e._stylesForTile(t,o);e._sendStyleGroups(t,E,{scene_id:i,meshVariantMaxLife:l},(function(e){return e.collision?"collision":"non-collision"}))}},{key:"_stylesForTile",value:function(e,t){var r=[];for(var i in t)t[i].hasDataForTile(e)&&r.push(t[i]);return r}},{key:"_sendStyleGroups",value:function(t,r,i,n){var o=i.scene_id,a=i.meshVariantMaxLife,s={};r.forEach((function(e){var t=n(e);s[t]=s[t]||[],s[t].push(e)})),Object.keys(s).length>0?function(){var r={start:!0};t.mesh_data={};var i=function(i){var n=s[i];Promise.all(n.map((function(e){return e.endData(t)}))).then((function(){log("trace","Finished style group '".concat(i,"' for tile ").concat(t.key)),s[i]=[],Object.keys(s).every((function(e){return 0===s[e].length}))&&(r.done=!0),WorkerBroker.postMessage("TileManager_".concat(o,".buildTileStylesCompleted"),WorkerBroker.withTransferables({tile:e.slice(t,["mesh_data","selection_data"]),progress:r})),r.start=null,t.mesh_data={},t.selection_data={},r.done&&Collision.resetTile(t.id)}),(function(e){log("error","Error for style group '".concat(i,"' for tile ").concat(t.key),e)}))};for(var n in s)i(n);Style.updateMeshVariantTypeCache(a)}():(WorkerBroker.postMessage("TileManager_".concat(o,".buildTileStylesCompleted"),WorkerBroker.withTransferables({tile:e.slice(t),progress:{start:!0,done:!0}})),Collision.resetTile(t.id))}},{key:"_getDataForSource",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=[];return null!=t&&null!=e&&null!=e.layers&&(!t.layer&&e.layers._default||"string"==typeof t.layer&&!e.layers[t.layer]&&new RegExp("^\\d+_"+t.layer+"$").test(r)&&e.layers._default?i.push({geom:e.layers._default}):!t.layer&&r?i.push({layer:r,geom:e.layers[r]}):"string"==typeof t.layer?i.push({layer:t.layer,geom:e.layers[t.layer]}):Array.isArray(t.layer)&&t.layer.forEach((function(t){e.layers[t]&&e.layers[t].features&&i.push({layer:t,geom:e.layers[t]})}))),i}},{key:"abortBuild",value:function(e,t){if(Task.removeForTile(e.id),Collision.abortTile(e.id),e.mesh_data)for(var r in e.mesh_data){var i=e.mesh_data[r].textures;i&&i.forEach((function(r){var i=getTextureManager(t).textures[r];i&&(log("trace","releasing texture ".concat(r," for tile ").concat(e.key)),i.release())}))}}},{key:"slice",value:function(e,t){var r=["id","key","loading","loaded","generation","error","debug"];Array.isArray(t)&&r.push.apply(r,_toConsumableArray(t));for(var i={},n=0;n<r.length;n++){var o=r[n];i[o]=e[o]}return i}}]),e}();Tile.coord_children={};var RasterTileSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),-1===(n=t.call(this,e,i)).rasters.indexOf(n.name)&&n.rasters.unshift(n.name),n.filtering=e.filtering,n.textures={},n}return _createClass(r,[{key:"load",value:function(e){e.source_data={},e.source_data.layers={},e.pad_scale=this.pad_scale,e.rasters=_toConsumableArray(this.rasters);var t=Geo$1.tile_scale;return e.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[t,0],[t,-t],[0,-t],[0,0]]]},properties:{}}]}},e.default_winding="CW",Promise.resolve(e)}},{key:"tileTexture",value:function(e){var t=e.coords.key;if(!this.textures[t]){var r=Tile.coordinateWithMaxZoom(e.coords,this.max_zoom),i=this.formatUrl(this.url,{coords:r});this.textures[t]={url:i,filtering:this.filtering,coords:r}}return this.textures[t]}}]),r}(NetworkTileSource),ArrayUtils;DataSource.register(RasterTileSource,"Raster");var ArrayUtils$1=ArrayUtils={};function simplify(e,t,r,i){for(var n,o=i,a=r-t>>1,s=r-t,l=e[t],u=e[t+1],c=e[r],h=e[r+1],f=t+3;f<r;f+=3){var d=getSqSegDist(e[f],e[f+1],l,u,c,h);if(d>o)n=f,o=d;else if(d===o){var _=Math.abs(f-a);_<s&&(n=f,s=_)}}o>i&&(n-t>3&&simplify(e,t,n,i),e[n+2]=o,r-n>3&&simplify(e,n,r,i))}function getSqSegDist(e,t,r,i,n,o){var a=n-r,s=o-i;if(0!==a||0!==s){var l=((e-r)*a+(t-i)*s)/(a*a+s*s);l>1?(r=n,i=o):l>0&&(r+=a*l,i+=s*l)}return(a=e-r)*a+(s=t-i)*s}function createFeature(e,t,r,i){var n={id:void 0===e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return calcBBox(n),n}function calcBBox(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)calcLineBBox(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<t.length;i++)calcLineBBox(e,t[i]);else if("MultiPolygon"===r)for(i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++)calcLineBBox(e,t[i][n])}function calcLineBBox(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function convert(e,t){var r=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)convertFeature(r,e.features[i],t,i);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r,i){if(t.geometry){var n=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===o)convertPoint(n,s);else if("MultiPoint"===o)for(var u=0;u<n.length;u++)convertPoint(n[u],s);else if("LineString"===o)convertLine(n,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<n.length;u++)s=[],convertLine(n[u],s,a,!1),e.push(createFeature(l,"LineString",s,t.properties));return}convertLines(n,s,a,!1)}else if("Polygon"===o)convertLines(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<t.geometry.geometries.length;u++)convertFeature(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<n.length;u++){var c=[];convertLines(n[u],c,a,!0),s.push(c)}}e.push(createFeature(l,o,s,t.properties))}}function convertPoint(e,t){t.push(projectX(e[0])),t.push(projectY(e[1])),t.push(0)}function convertLine(e,t,r,i){for(var n,o,a=0,s=0;s<e.length;s++){var l=projectX(e[s][0]),u=projectY(e[s][1]);t.push(l),t.push(u),t.push(0),s>0&&(a+=i?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var c=t.length-3;t[2]=1,simplify(t,0,c,r),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function convertLines(e,t,r,i){for(var n=0;n<e.length;n++){var o=[];convertLine(e[n],o,r,i),t.push(o)}}function projectX(e){return e/360+.5}function projectY(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function clip(e,t,r,i,n,o,a,s){if(i/=t,o>=(r/=t)&&a<i)return e;if(a<r||o>=i)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],h=c.geometry,f=c.type,d=0===n?c.minX:c.minY,_=0===n?c.maxX:c.maxY;if(d>=r&&_<i)l.push(c);else if(!(_<r||d>=i)){var p=[];if("Point"===f||"MultiPoint"===f)clipPoints(h,p,r,i,n);else if("LineString"===f)clipLine(h,p,r,i,n,!1,s.lineMetrics);else if("MultiLineString"===f)clipLines(h,p,r,i,n,!1);else if("Polygon"===f)clipLines(h,p,r,i,n,!0);else if("MultiPolygon"===f)for(var g=0;g<h.length;g++){var m=[];clipLines(h[g],m,r,i,n,!0),m.length&&p.push(m)}if(p.length){if(s.lineMetrics&&"LineString"===f){for(g=0;g<p.length;g++)l.push(createFeature(c.id,f,p[g],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===p.length?(f="LineString",p=p[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===p.length?"Point":"MultiPoint"),l.push(createFeature(c.id,f,p,c.tags))}}}return l.length?l:null}function clipPoints(e,t,r,i,n){for(var o=0;o<e.length;o+=3){var a=e[o+n];a>=r&&a<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function clipLine(e,t,r,i,n,o,a){for(var s,l,u=newSlice(e),c=0===n?intersectX:intersectY,h=e.start,f=0;f<e.length-3;f+=3){var d=e[f],_=e[f+1],p=e[f+2],g=e[f+3],m=e[f+4],y=0===n?d:_,v=0===n?g:m,x=!1;a&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(_-m,2))),y<r?v>r&&(l=c(u,d,_,g,m,r),a&&(u.start=h+s*l)):y>i?v<i&&(l=c(u,d,_,g,m,i),a&&(u.start=h+s*l)):addPoint(u,d,_,p),v<r&&y>=r&&(l=c(u,d,_,g,m,r),x=!0),v>i&&y<=i&&(l=c(u,d,_,g,m,i),x=!0),!o&&x&&(a&&(u.end=h+s*l),t.push(u),u=newSlice(e)),a&&(h+=s)}var b=e.length-3;d=e[b],_=e[b+1],p=e[b+2],(y=0===n?d:_)>=r&&y<=i&&addPoint(u,d,_,p),b=u.length-3,o&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&addPoint(u,u[0],u[1],u[2]),u.length&&t.push(u)}function newSlice(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function clipLines(e,t,r,i,n,o){for(var a=0;a<e.length;a++)clipLine(e[a],t,r,i,n,o,!1)}function addPoint(e,t,r,i){e.push(t),e.push(r),e.push(i)}function intersectX(e,t,r,i,n,o){var a=(o-t)/(i-t);return e.push(o),e.push(r+(n-r)*a),e.push(1),a}function intersectY(e,t,r,i,n,o){var a=(o-r)/(n-r);return e.push(t+(i-t)*a),e.push(o),e.push(1),a}function wrap$1(e,t){var r=t.buffer/t.extent,i=e,n=clip(e,1,-1-r,r,0,-1,2,t),o=clip(e,1,1-r,2+r,0,-1,2,t);return(n||o)&&(i=clip(e,1,-r,1+r,0,-1,2,t)||[],n&&(i=shiftFeatureCoords(n,1).concat(i)),o&&(i=i.concat(shiftFeatureCoords(o,-1)))),i}function shiftFeatureCoords(e,t){for(var r=[],i=0;i<e.length;i++){var n,o=e[i],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=shiftCoords(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(shiftCoords(o.geometry[s],t))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(shiftCoords(o.geometry[s][u],t));n.push(l)}r.push(createFeature(o.id,a,n,o.tags))}return r}function shiftCoords(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function transformTile(e,t){if(e.transformed)return e;var r,i,n,o=1<<e.z,a=e.x,s=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(i=0;i<u.length;i+=2)l.geometry.push(transformPoint(u[i],u[i+1],t,o,a,s));else for(i=0;i<u.length;i++){var h=[];for(n=0;n<u[i].length;n+=2)h.push(transformPoint(u[i][n],u[i][n+1],t,o,a,s));l.geometry.push(h)}}return e.transformed=!0,e}function transformPoint(e,t,r,i,n,o){return[Math.round(r*(e*i-n)),Math.round(r*(t*i-o))]}function createTile(e,t,r,i,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,addFeature(a,e[s],o,n);var l=e[s].minX,u=e[s].minY,c=e[s].maxX,h=e[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function addFeature(e,t,r,i){var n=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)addLine(a,n,e,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)addLine(a,n[s],e,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)addLine(a,u[s],e,r,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(f.id=t.id),e.features.push(f)}}function addLine(e,t,r,i,n,o){var a=i*i;if(i>0&&t.size<(n?a:i))r.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>a)&&(r.numSimplified++,s.push(t[l]),s.push(t[l+1])),r.numPoints++;n&&rewind(s,o),e.push(s)}}function rewind(e,t){for(var r=0,i=0,n=e.length,o=n-2;i<n;o=i,i+=2)r+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(r>0===t)for(i=0,n=e.length;i<n/2;i+=2){var a=e[i],s=e[i+1];e[i]=e[n-2-i],e[i+1]=e[n-1-i],e[n-2-i]=a,e[n-1-i]=s}}ArrayUtils.deepClone=function(e){return Array.isArray(e)?e.map(ArrayUtils.deepClone):e};var defaults={maxZoom:14,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1};function createGeoJsonTile(e,t,r,i,n){var o=Object.assign({},defaults,n),a=convert(e,o),s=getBBox(a=wrap$1(a,o)),l=s.minX,u=s.minY,c=s.maxX,h=s.maxY,f=1<<t,d=o.buffer/o.extent,_=1+d;return a=clip(a,f,r-d,r+_,0,l,c,o)||[],transformTile(createTile(a=clip(a,f,i-d,i+_,1,u,h,o)||[],t,r,i,o),o.extent)}function getBBox(e){var t,r=2,i=-1,n=1,o=0,a=_createForOfIteratorHelper(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;s.minX<r&&(r=s.minX),s.maxX>i&&(i=s.maxX),s.minY<n&&(n=s.minY),s.maxY>o&&(o=s.maxY)}}catch(e){a.e(e)}finally{a.f()}return{minX:r,maxX:i,minY:n,maxY:o}}function PackingSmith$1(e,t){this.items=[],this.algorithm=e;var r=void 0===(t=t||{}).sort||t.sort;this.sort=r}PackingSmith$1.prototype={addItem:function(e){this.items.push(e)},normalizeCoordinates:function(){var e=this.items,t=1/0,r=1/0;e.forEach((function(e){var i=e;t=Math.min(t,i.x),r=Math.min(r,i.y)})),e.forEach((function(e){var i=e;i.x-=t,i.y-=r}))},getStats:function(){var e=this.items.map((function(e){return e})),t=e.map((function(e){return e.x})),r=e.map((function(e){return e.y})),i=e.map((function(e){return e.x+e.width})),n=e.map((function(e){return e.y+e.height}));return{minX:Math.max.apply(Math,t),minY:Math.max.apply(Math,r),maxX:Math.max.apply(Math,i),maxY:Math.max.apply(Math,n)}},getItems:function(){return this.items},processItems:function(){var e=this.items;return this.sort&&(e=this.algorithm.sort(e)),e=this.algorithm.placeItems(e),this.items=e,e},exportItems:function(){return this.processItems(),this.normalizeCoordinates(),this.items},export:function(){var e=this.exportItems(),t=this.getStats();return{height:t.maxY,width:t.maxX,items:e}}};var packing_smith=PackingSmith$1,lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)lookup[t]=e[t],revLookup[e.charCodeAt(t)]=t;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(e){var t,r,i,n,o,a;inited||init();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[s-2]?2:"="===e[s-1]?1:0,a=new Arr(3*s/4-o),i=o>0?s-4:s;var l=0;for(t=0,r=0;t<i;t+=4,r+=3)n=revLookup[e.charCodeAt(t)]<<18|revLookup[e.charCodeAt(t+1)]<<12|revLookup[e.charCodeAt(t+2)]<<6|revLookup[e.charCodeAt(t+3)],a[l++]=n>>16&255,a[l++]=n>>8&255,a[l++]=255&n;return 2===o?(n=revLookup[e.charCodeAt(t)]<<2|revLookup[e.charCodeAt(t+1)]>>4,a[l++]=255&n):1===o&&(n=revLookup[e.charCodeAt(t)]<<10|revLookup[e.charCodeAt(t+1)]<<4|revLookup[e.charCodeAt(t+2)]>>2,a[l++]=n>>8&255,a[l++]=255&n),a}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,t,r){for(var i,n=[],o=t;o<r;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],n.push(tripletToBase64(i));return n.join("")}function fromByteArray(e){var t;inited||init();for(var r=e.length,i=r%3,n="",o=[],a=16383,s=0,l=r-i;s<l;s+=a)o.push(encodeChunk(e,s,s+a>l?l:s+a));return 1===i?(t=e[r-1],n+=lookup[t>>2],n+=lookup[t<<4&63],n+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],n+=lookup[t>>10],n+=lookup[t>>4&63],n+=lookup[t<<2&63],n+="="),o.push(n),o.join("")}function read(e,t,r,i,n){var o,a,s=8*n-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?n-1:0,f=r?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,i),o-=u}return(d?-1:1)*a*Math.pow(2,o-i)}function write(e,t,r,i,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,_=i?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,n),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;e[r+d]=255&s,d+=_,s/=256,n-=8);for(a=a<<n|s,u+=n;u>0;e[r+d]=255&a,d+=_,a/=256,u-=8);e[r+d-_]|=128*p}var toString={}.toString,isArray$1=Array.isArray||function(e){return"[object Array]"==toString.call(e)},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(e,t){if(kMaxLength()<t)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer.prototype:(null===e&&(e=new Buffer(t)),e.length=t),e}function Buffer(e,t,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,e)}return from(this,e,t,r)}function from(e,t,r,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?fromArrayBuffer(e,t,r,i):"string"==typeof t?fromString(e,t,r):fromObject(e,t)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc(e,t,r,i){return assertSize(t),t<=0?createBuffer(e,t):void 0!==r?"string"==typeof i?createBuffer(e,t).fill(r,i):createBuffer(e,t).fill(r):createBuffer(e,t)}function allocUnsafe(e,t){if(assertSize(t),e=createBuffer(e,t<0?0:0|checked(t)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function fromString(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|byteLength(t,r),n=(e=createBuffer(e,i)).write(t,r);return n!==i&&(e=e.slice(0,n)),e}function fromArrayLike(e,t){var r=t.length<0?0:0|checked(t.length);e=createBuffer(e,r);for(var i=0;i<r;i+=1)e[i]=255&t[i];return e}function fromArrayBuffer(e,t,r,i){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,r):new Uint8Array(t,r,i),Buffer.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer.prototype:e=fromArrayLike(e,t),e}function fromObject(e,t){if(internalIsBuffer(t)){var r=0|checked(t.length);return 0===(e=createBuffer(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||isnan(t.length)?createBuffer(e,0):fromArrayLike(e,t);if("Buffer"===t.type&&isArray$1(t.data))return fromArrayLike(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(e){if(e>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|e}function internalIsBuffer(e){return!(null==e||!e._isBuffer)}function byteLength(e,t){if(internalIsBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(i)return utf8ToBytes(e).length;t=(""+t).toLowerCase(),i=!0}}function slowToString(e,t,r){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function swap(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function bidirectionalIndexOf(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,i)),internalIsBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,i,n);if("number"==typeof t)return t&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,i,n){var o,a=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var c=-1;for(o=r;o<s;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+l>s&&(r=s-l),o=r;o>=0;o--){for(var h=!0,f=0;f<l;f++)if(u(e,o+f)!==u(t,f)){h=!1;break}if(h)return o}return-1}function hexWrite(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function utf8Write(e,t,r,i){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,i)}function asciiWrite(e,t,r,i){return blitBuffer(asciiToBytes(t),e,r,i)}function latin1Write(e,t,r,i){return asciiWrite(e,t,r,i)}function base64Write(e,t,r,i){return blitBuffer(base64ToBytes(t),e,r,i)}function ucs2Write(e,t,r,i){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,i)}function base64Slice(e,t,r){return 0===t&&r===e.length?fromByteArray(e):fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var o,a,s,l,u=e[n],c=null,h=u>239?4:u>223?3:u>191?2:1;if(n+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[n+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=e[n+1],a=e[n+2],128==(192&o)&&128==(192&a)&&(l=(15&u)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[n+1],a=e[n+2],s=e[n+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),n+=h}return decodeCodePointsArray(i)}Buffer.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT,kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(e){return e.__proto__=Buffer.prototype,e},Buffer.from=function(e,t,r){return from(null,e,t,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]),Buffer.alloc=function(e,t,r){return alloc(null,e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(null,e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(null,e)},Buffer.isBuffer=isBuffer,Buffer.compare=function(e,t){if(!internalIsBuffer(e)||!internalIsBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,n=0,o=Math.min(r,i);n<o;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!isArray$1(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=Buffer.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var o=e[r];if(!internalIsBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,n),n+=o.length}return i},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,r,i,n){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(i>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(i,n),u=e.slice(t,r),c=0;c<s;++c)if(l[c]!==u[c]){o=l[c],a=u[c];break}return o<a?-1:a<o?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",i=0;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function latin1Slice(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function hexSlice(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",o=t;o<r;++o)n+=toHex(e[o]);return n}function utf16leSlice(e,t,r){for(var i=e.slice(t,r),n="",o=0;o<i.length;o+=2)n+=String.fromCharCode(i[o]+256*i[o+1]);return n}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,i,n,o){if(!internalIsBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-r,2);n<o;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function objectWriteUInt32(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-r,4);n<o;++n)e[r+n]=t>>>8*(i?n:3-n)&255}function checkIEEE754(e,t,r,i,n,o){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,i,n){return n||checkIEEE754(e,t,r,4),write(e,t,r,i,23,4),r+4}function writeDouble(e,t,r,i,n){return n||checkIEEE754(e,t,r,8),write(e,t,r,i,52,8),r+8}Buffer.prototype.slice=function(e,t){var r,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),Buffer.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Buffer.prototype;else{var n=t-e;r=new Buffer(n,void 0);for(var o=0;o<n;++o)r[o]=this[o+e]}return r},Buffer.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var i=this[e],n=1,o=0;++o<t&&(n*=256);)i+=this[e+o]*n;return i},Buffer.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},Buffer.prototype.readUInt8=function(e,t){return t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var i=this[e],n=1,o=0;++o<t&&(n*=256);)i+=this[e+o]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},Buffer.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var i=t,n=1,o=this[e+--i];i>0&&(n*=256);)o+=this[e+--i]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},Buffer.prototype.readInt8=function(e,t){return t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,o=0;for(this[t]=255&e;++o<r&&(n*=256);)this[t+o]=e/n&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,i){(e=+e,t|=0,r|=0,i)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);checkInt(this,e,t,r,n-1,-n)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t|=0,!i){var n=Math.pow(2,8*r-1);checkInt(this,e,t,r,n-1,-n)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,i){if(r||(r=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n,o=i-r;if(this===e&&r<t&&t<i)for(n=o-1;n>=0;--n)e[n+t]=this[n+r];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},Buffer.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Buffer.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=internalIsBuffer(e)?e:utf8ToBytes(new Buffer(e,i).toString()),s=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(e){if((e=stringtrim(e).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var i=e.length,n=null,o=[],a=0;a<i;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,i,n,o=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(r=e.charCodeAt(a))>>8,n=r%256,o.push(n),o.push(i);return o}function base64ToBytes(e){return toByteArray(base64clean(e))}function blitBuffer(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function isnan(e){return e!=e}function isBuffer(e){return null!=e&&(!!e._isBuffer||isFastBuffer(e)||isSlowBuffer(e))}function isFastBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isFastBuffer(e.slice(0,0))}global$1.setTimeout,global$1.clearTimeout;var performance$1=global$1.performance||{},inherits;performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow,inherits="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var inherits$1=inherits;function inspect$1(e,t){var r={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),isBoolean$1(t)?r.showHidden=t:t&&_extend(r,t),isUndefined(r.showHidden)&&(r.showHidden=!1),isUndefined(r.depth)&&(r.depth=2),isUndefined(r.colors)&&(r.colors=!1),isUndefined(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=stylizeWithColor),formatValue(r,e,r.depth)}function stylizeWithColor(e,t){var r=inspect$1.styles[t];return r?"\x1b["+inspect$1.colors[r][0]+"m"+e+"\x1b["+inspect$1.colors[r][1]+"m":e}function stylizeNoColor(e,t){return e}function arrayToHash(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}function formatValue(e,t,r){if(e.customInspect&&t&&isFunction(t.inspect)&&t.inspect!==inspect$1&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return isString(i)||(i=formatValue(e,i,r)),i}var n=formatPrimitive(e,t);if(n)return n;var o=Object.keys(t),a=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),isError(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError$1(t);if(0===o.length){if(isFunction(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(isError(t))return formatError$1(t)}var l,u="",c=!1,h=["{","}"];(isArray(t)&&(c=!0,h=["[","]"]),isFunction(t))&&(u=" [Function"+(t.name?": "+t.name:"")+"]");return isRegExp(t)&&(u=" "+RegExp.prototype.toString.call(t)),isDate(t)&&(u=" "+Date.prototype.toUTCString.call(t)),isError(t)&&(u=" "+formatError$1(t)),0!==o.length||c&&0!=t.length?r<0?isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=c?formatArray(e,t,r,a,o):o.map((function(i){return formatProperty(e,t,r,a,i,c)})),e.seen.pop(),reduceToSingleString(l,u,h)):h[0]+u+h[1]}function formatPrimitive(e,t){if(isUndefined(t))return e.stylize("undefined","undefined");if(isString(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return isNumber(t)?e.stylize(""+t,"number"):isBoolean$1(t)?e.stylize(""+t,"boolean"):isNull$1(t)?e.stylize("null","null"):void 0}function formatError$1(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,t,r,i,n){for(var o=[],a=0,s=t.length;a<s;++a)hasOwnProperty(t,String(a))?o.push(formatProperty(e,t,r,i,String(a),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(formatProperty(e,t,r,i,n,!0))})),o}function formatProperty(e,t,r,i,n,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),hasOwnProperty(i,n)||(a="["+n+"]"),s||(e.seen.indexOf(l.value)<0?(s=isNull$1(r)?formatValue(e,l.value,null):formatValue(e,l.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),isUndefined(a)){if(o&&n.match(/^\d+$/))return s;(a=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function reduceToSingleString(e,t,r){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function isArray(e){return Array.isArray(e)}function isBoolean$1(e){return"boolean"==typeof e}function isNull$1(e){return null===e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject$1(e)&&"[object RegExp]"===objectToString(e)}function isObject$1(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject$1(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject$1(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function _extend(e,t){if(!t||!isObject$1(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function compare(e,t){if(e===t)return 0;for(var r=e.length,i=t.length,n=0,o=Math.min(r,i);n<o;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0}inspect$1.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect$1.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var hasOwn=Object.prototype.hasOwnProperty,objectKeys=Object.keys||function(e){var t=[];for(var r in e)hasOwn.call(e,r)&&t.push(r);return t},pSlice=Array.prototype.slice,_functionsHaveNames;function functionsHaveNames(){return void 0!==_functionsHaveNames?_functionsHaveNames:_functionsHaveNames="foo"===function(){}.name}function pToString(e){return Object.prototype.toString.call(e)}function isView(e){return!isBuffer(e)&&("function"==typeof global$1.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function assert$1(e,t){e||fail(e,!0,t,"==",ok)}var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(e){if(isFunction(e)){if(functionsHaveNames())return e.name;var t=e.toString().match(regex);return t&&t[1]}}function AssertionError(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var t=e.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var i=r.stack,n=getName(t),o=i.indexOf("\n"+n);if(o>=0){var a=i.indexOf("\n",o+1);i=i.substring(a+1)}this.stack=i}}}function truncate(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function inspect(e){if(functionsHaveNames()||!isFunction(e))return inspect$1(e);var t=getName(e);return"[Function"+(t?": "+t:"")+"]"}function getMessage(e){return truncate(inspect(e.actual),128)+" "+e.operator+" "+truncate(inspect(e.expected),128)}function fail(e,t,r,i,n){throw new AssertionError({message:r,actual:e,expected:t,operator:i,stackStartFunction:n})}function ok(e,t){e||fail(e,!0,t,"==",ok)}function equal(e,t,r){e!=t&&fail(e,t,r,"==",equal)}function notEqual(e,t,r){e==t&&fail(e,t,r,"!=",notEqual)}function deepEqual(e,t,r){_deepEqual(e,t,!1)||fail(e,t,r,"deepEqual",deepEqual)}function deepStrictEqual(e,t,r){_deepEqual(e,t,!0)||fail(e,t,r,"deepStrictEqual",deepStrictEqual)}function _deepEqual(e,t,r,i){if(e===t)return!0;if(isBuffer(e)&&isBuffer(t))return 0===compare(e,t);if(isDate(e)&&isDate(t))return e.getTime()===t.getTime();if(isRegExp(e)&&isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(isView(e)&&isView(t)&&pToString(e)===pToString(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===compare(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(isBuffer(e)!==isBuffer(t))return!1;var n=(i=i||{actual:[],expected:[]}).actual.indexOf(e);return-1!==n&&n===i.expected.indexOf(t)||(i.actual.push(e),i.expected.push(t),objEquiv(e,t,r,i))}return r?e===t:e==t}function isArguments(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function objEquiv(e,t,r,i){if(null==e||null==t)return!1;if(isPrimitive(e)||isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var n=isArguments(e),o=isArguments(t);if(n&&!o||!n&&o)return!1;if(n)return _deepEqual(e=pSlice.call(e),t=pSlice.call(t),r);var a,s,l=objectKeys(e),u=objectKeys(t);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),s=l.length-1;s>=0;s--)if(l[s]!==u[s])return!1;for(s=l.length-1;s>=0;s--)if(!_deepEqual(e[a=l[s]],t[a],r,i))return!1;return!0}function notDeepEqual(e,t,r){_deepEqual(e,t,!1)&&fail(e,t,r,"notDeepEqual",notDeepEqual)}function notDeepStrictEqual(e,t,r){_deepEqual(e,t,!0)&&fail(e,t,r,"notDeepStrictEqual",notDeepStrictEqual)}function strictEqual(e,t,r){e!==t&&fail(e,t,r,"===",strictEqual)}function notStrictEqual(e,t,r){e===t&&fail(e,t,r,"!==",notStrictEqual)}function expectedException(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function _tryBlock(e){var t;try{e()}catch(e){t=e}return t}function _throws(e,t,r,i){var n;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(i=r,r=null),n=_tryBlock(t),i=(r&&r.name?" ("+r.name+").":".")+(i?" "+i:"."),e&&!n&&fail(n,r,"Missing expected exception"+i);var o="string"==typeof i,a=!e&&n&&!r;if((!e&&isError(n)&&o&&expectedException(n,r)||a)&&fail(n,r,"Got unwanted exception"+i),e&&n&&r&&!expectedException(n,r)||!e&&n)throw n}function throws(e,t,r){_throws(!0,e,t,r)}function doesNotThrow(e,t,r){_throws(!1,e,t,r)}function ifError(e){if(e)throw e}assert$1.AssertionError=AssertionError,inherits$1(AssertionError,Error),assert$1.fail=fail,assert$1.ok=ok,assert$1.equal=equal,assert$1.notEqual=notEqual,assert$1.deepEqual=deepEqual,assert$1.deepStrictEqual=deepStrictEqual,assert$1.notDeepEqual=notDeepEqual,assert$1.notDeepStrictEqual=notDeepStrictEqual,assert$1.strictEqual=strictEqual,assert$1.notStrictEqual=notStrictEqual,assert$1.throws=throws,assert$1.doesNotThrow=doesNotThrow,assert$1.ifError=ifError;var assert$2=Object.freeze({__proto__:null,default:assert$1,AssertionError:AssertionError,fail:fail,ok:ok,assert:ok,equal:equal,notEqual:notEqual,deepEqual:deepEqual,deepStrictEqual:deepStrictEqual,notDeepEqual:notDeepEqual,notDeepStrictEqual:notDeepStrictEqual,strictEqual:strictEqual,notStrictEqual:notStrictEqual,throws:throws,doesNotThrow:doesNotThrow,ifError:ifError}),require$$1=getAugmentedNamespace(assert$2),topDown_algorithm={},hasRequiredTopDown_algorithm;function requireTopDown_algorithm(){return hasRequiredTopDown_algorithm||(hasRequiredTopDown_algorithm=1,topDown_algorithm.sort=function(e){return e.sort((function(e,t){return e.height-t.height})),e},topDown_algorithm.placeItems=function(e){var t=0;return e.forEach((function(e){e.x=0,e.y=t,t+=e.height})),e}),topDown_algorithm}var leftRight_algorithm={},hasRequiredLeftRight_algorithm;function requireLeftRight_algorithm(){return hasRequiredLeftRight_algorithm||(hasRequiredLeftRight_algorithm=1,leftRight_algorithm.sort=function(e){return e.sort((function(e,t){return e.width-t.width})),e},leftRight_algorithm.placeItems=function(e){var t=0;return e.forEach((function(e){e.x=t,e.y=0,t+=e.width})),e}),leftRight_algorithm}var diagonal_algorithm={},hasRequiredDiagonal_algorithm;function requireDiagonal_algorithm(){return hasRequiredDiagonal_algorithm||(hasRequiredDiagonal_algorithm=1,diagonal_algorithm.sort=function(e){return e.sort((function(e,t){return Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))-Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))})),e},diagonal_algorithm.placeItems=function(e){var t=0,r=0;return e.forEach((function(e){e.x=t,e.y=r,t+=e.width,r+=e.height})),e}),diagonal_algorithm}var altDiagonal_algorithm={},hasRequiredAltDiagonal_algorithm;function requireAltDiagonal_algorithm(){return hasRequiredAltDiagonal_algorithm||(hasRequiredAltDiagonal_algorithm=1,altDiagonal_algorithm.sort=function(e){return e.sort((function(e,t){return Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))-Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))})),e},altDiagonal_algorithm.placeItems=function(e){var t=0,r=0;return e.forEach((function(e){var i=e.width;e.x=t-i,e.y=r,t-=i,r+=e.height})),e}),altDiagonal_algorithm}var binaryTree_algorithm={},packer_growing,hasRequiredPacker_growing,binPack,hasRequiredBinPack,hasRequiredBinaryTree_algorithm;function requirePacker_growing(){if(hasRequiredPacker_growing)return packer_growing;hasRequiredPacker_growing=1;var e=function(){};return e.prototype={fit:function(e){var t,r,i,n,o=e.length,a=o>0?e[0].width:0,s=o>0?e[0].height:0;for(this.root={x:0,y:0,width:a,height:s},t=0;t<o;t++)i=e[t],(r=this.findNode(this.root,i.width,i.height))?(n=this.splitNode(r,i.width,i.height),i.x=n.x,i.y=n.y):(n=this.growNode(i.width,i.height),i.x=n.x,i.y=n.y)},findNode:function(e,t,r){return e.used?this.findNode(e.right,t,r)||this.findNode(e.down,t,r):t<=e.width&&r<=e.height?e:null},splitNode:function(e,t,r){return e.used=!0,e.down={x:e.x,y:e.y+r,width:e.width,height:e.height-r},e.right={x:e.x+t,y:e.y,width:e.width-t,height:r},e},growNode:function(e,t){var r=e<=this.root.width,i=t<=this.root.height,n=i&&this.root.height>=this.root.width+e,o=r&&this.root.width>=this.root.height+t;return n?this.growRight(e,t):o?this.growDown(e,t):i?this.growRight(e,t):r?this.growDown(e,t):null},growRight:function(e,t){var r;return this.root={used:!0,x:0,y:0,width:this.root.width+e,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:e,height:this.root.height}},(r=this.findNode(this.root,e,t))?this.splitNode(r,e,t):null},growDown:function(e,t){var r;return this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+t,down:{x:0,y:this.root.height,width:this.root.width,height:t},right:this.root},(r=this.findNode(this.root,e,t))?this.splitNode(r,e,t):null}},packer_growing=e}function requireBinPack(){if(hasRequiredBinPack)return binPack;hasRequiredBinPack=1;var e=requirePacker_growing();return binPack=function(t,r){r=r||{};var i=new e,n=r.inPlace||!1,o=t.map((function(e){return n?e:{width:e.width,height:e.height,item:e}}));o=o.sort((function(e,t){return t.width*t.height-e.width*e.height})),i.fit(o);var a={width:o.reduce((function(e,t){return Math.max(e,t.x+t.width)}),0),height:o.reduce((function(e,t){return Math.max(e,t.y+t.height)}),0)};return n||(a.items=o),a}}function requireBinaryTree_algorithm(){if(hasRequiredBinaryTree_algorithm)return binaryTree_algorithm;hasRequiredBinaryTree_algorithm=1;var e=requireBinPack();return binaryTree_algorithm.sort=function(e){return e},binaryTree_algorithm.placeItems=function(t){return e(t,{inPlace:!0}),t},binaryTree_algorithm}var PackingSmith=packing_smith,assert=require$$1,algorithms={};function Layout(e,t){var r=e||"top-down";return"string"==typeof r&&(r=algorithms[e],assert(r,"Sorry, the '"+e+"' algorithm could not be loaded.")),new PackingSmith(r,t)}function addAlgorithm(e,t){algorithms[e]=t}Layout.PackingSmith=PackingSmith,Layout.addAlgorithm=addAlgorithm,Layout.algorithms=algorithms,addAlgorithm("top-down",requireTopDown_algorithm()),addAlgorithm("left-right",requireLeftRight_algorithm()),addAlgorithm("diagonal",requireDiagonal_algorithm()),addAlgorithm("alt-diagonal",requireAltDiagonal_algorithm()),addAlgorithm("binary-tree",requireBinaryTree_algorithm());var layout=Layout,layout$1=getDefaultExportFromCjs(layout);function isTainting(e){var t;try{e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1)}catch(e){t=e.message}return t}function bitmapToCanvas(e,t,r){if(e instanceof HTMLImageElement){var i=e.ownerDocument.createElement("canvas");i.width=t,i.height=r,i.getContext("2d").drawImage(e,0,0,t,r),e=i}return e}var MAX_LNG_LAT=Geo$1.metersToLatLng([Geo$1.half_circumference_meters,Geo$1.half_circumference_meters]),TILE_EXPONENT=Math.log(Geo$1.tile_size)/Math.LN2,ICON_READY=1,DOM_MARKER_TYPE=8,GROUP_TYPE=16,TILE_MARGIN=100,AFFECTED_BBOX_CALC_THRESHOLD=10,ObjectSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),n=t.call(this,e,i),Thread.is_worker&&(n._quad_tree=new ns.H.geo.QuadTree,n._marker_quad_tree=new ns.H.geo.QuadTree,n._tree_entries_by_object_id={},n._groups_by_id={},n._layersCache=new ns.H.util.Cache(100)),Thread.is_main&&(n._objects_by_id={},n._commands=[],n._sendCommands=debounce(n._sendCommands,100,200),n.dispatchUpdate=n.dispatchUpdate.bind(_assertThisInitialized(n))),n}return _createClass(r,[{key:"hasLabeledData",value:function(){return!1}},{key:"onReady",value:function(){this._synced_at=this.provider.getInvalidations().getMark();var e,t,r=this.provider.getRootGroup(),i=r.getObjects(!0),n=[];for(i.push(r),e=i.length;e--;)t=i[e],this._isObjectSupported(t)&&this._shouldBeStored(t)&&(this._objects_by_id[t.getId()]=t,n.push(t.forWorkerMessage()));var o=[{method_name:"addObjects",arguments:[n]}];this._sendImmediateCommands(o)}},{key:"onProviderUpdate",value:function(e){var t=e.target,r=e.currentTarget.getInvalidations(t.type);if(this._isObjectSupported(t)){var i=this._synced_at,n=t.getId();if(r.isRemove(i))delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n],!0]});else if(r.isAdd(i))this._shouldBeStored(t)&&(this._objects_by_id[n]=t,this._commands.push({method_name:"addObjects",arguments:[[t.forWorkerMessage()]]}));else if(r.isSpatial(i)||r.isZOrder(i)){if(this._shouldBeStored(t)){this._objects_by_id[n]=t;var o=[{method_name:"removeObjectsByIds",arguments:[[n],!0]},{method_name:"addObjects",arguments:[[t.forWorkerMessage()]]}];this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands(o):this._commands.push(o[0],o[1])}}else if(r.isVisual(i)){if(this._shouldBeStored(t)){this._objects_by_id[n]=t;var a={method_name:"updateObjectProperties",arguments:[t.forWorkerMessage()]};this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands([a]):this._commands.push(a)}}else r.isVolatility(i)&&(delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n],!0]}),this._shouldBeStored(t)&&(this._objects_by_id[n]=t,this._commands.push({method_name:"addObjects",arguments:[[t.forWorkerMessage()]]})));this._commands.length&&this._sendCommands()}this._synced_at=r.getMark()}},{key:"_shouldBeStored",value:function(e){return e.type===GROUP_TYPE||(!e.getIcon||e.getIcon().getState()===ICON_READY)&&this._hasSameVolatility(e)}},{key:"_hasSameVolatility",value:function(e){return e.getVolatility(!0)===this.has_volatile_data}},{key:"hasPendingCommands",value:function(){return this._commands.length>0}},{key:"_sendCommands",value:function(){this._sendImmediateCommands(this._commands),this._commands=[]}},{key:"_sendImmediateCommands",value:function(e){e.length&&WorkerBroker.postMessage(this.worker,this.target_name+".executeCommands",e).then(this.dispatchUpdate)}},{key:"_isObjectSupported",value:function(e){return e.forWorkerMessage&&e.type!==DOM_MARKER_TYPE}},{key:"getSyncedAt",value:function(){return this._synced_at}},{key:"getMapObjectById",value:function(e){return this._objects_by_id[e]}},{key:"getIconBitmapByObjectId",value:function(e,t){var r=this.getMapObjectById(e);if(r){var i=r.getIcon();if(i.uid===t&&i.getState()===ICON_READY){var n=i.getSize();return bitmapToCanvas(i.getBitmap(),n.w,n.h)}}}},{key:"_getRastersForMarkers",value:function(e){for(var t={},r=layout$1("binary-tree"),i=0;i<e.length;i++){var n=e[i],o=n.properties.icon;t[o.id]||(r.addItem({width:o.size.w,height:o.size.h,meta:{objectId:n.id,id:o.id}}),t[o.id]=!0)}return r.export()}},{key:"fetchFeaturesForTile",value:function(e){var t=[],i=[],n=[],o=[],a=[],s=this._marker_quad_tree.intersectBoundingBox(Geo$1.getTileBoundingBox(e.coords,this.tile_size));e.source_data.error=null;for(var l=0;l<s.length;l++){var u={id:s[l].$feature$.id,properties:Object.assign({},s[l].$feature$.properties),geometry:{type:s[l].$feature$.geometry.type,coordinates:ArrayUtils$1.deepClone(s[l].$feature$.geometry.coordinates)}};t.push(u)}s=this._quad_tree.intersectBoundingBox(Geo$1.getTileBoundingBox(e.coords,this.tile_size,TILE_MARGIN));for(var c=0;c<s.length;c++){var h={id:s[c].$feature$.id,properties:Object.assign({},s[c].$feature$.properties),geometry:{type:s[c].$feature$.geometry.type,coordinates:ArrayUtils$1.deepClone(s[c].$feature$.geometry.coordinates)}};if(h.properties.overlay)i.push(h);else if(h.geometry.type.includes("LineString"))n.push(h);else if(h.geometry.type.includes("Polygon")){o.push(h);var f={id:h.id,properties:h.properties,geometry:{type:h.geometry.type,coordinates:ArrayUtils$1.deepClone(h.geometry.coordinates)}};a.push(f)}}t.sort(r._compareZInfo),o.sort(r._compareZInfo),i.sort(r._compareZInfo);var d=this.has_volatile_data?4096:0;a.sort(r._compareZInfo);for(var _=0;_<a.length;_++)a[_].properties.effectiveZIdx=d++;n.sort(r._compareZInfo);for(var p=0;p<n.length;p++)n[p].properties.effectiveZIdx=d++;e.source_data.layers.markers={type:"FeatureCollection",features:t},e.source_data.layers.polylines={type:"FeatureCollection",features:n},e.source_data.layers.polygons={type:"FeatureCollection",features:o},e.source_data.layers.outlines={type:"FeatureCollection",features:a},e.source_data.layers.overlays={type:"FeatureCollection",features:i}}},{key:"tileTexture",value:function(e){var t=e.source_data.layers.overlays;if(t){var r=this.name+"_"+e.coords.key,i=Tile.coordinateWithMaxZoom(e.coords,this.max_zoom),n=t.features[0].properties.overlays_config;return{name:r,filtering:this.filtering,coords:i,width:Geo$1.tile_size,height:Geo$1.tile_size,overlays_config:n,source:this.name}}}},{key:"_load",value:function(e){var t=Geo$1.wrapTile(e.coords,{x:!0}),r=t.z,i=t.x,n=t.y,o="".concat(r,"_").concat(i,"_").concat(n),a=this._layersCache.get(o),s=!1;if(a)e.source_data.layers=a;else{this.fetchFeaturesForTile(e);var l={maxZoom:this.max_zoom,tolerance:1.5,extent:Geo$1.tile_scale},u=e.source_data.layers.overlays;u.features.length&&delete e.source_data.layers.overlays;var c=e.source_data.layers.markers;for(var h in c.features.length&&delete e.source_data.layers.markers,e.source_data.layers){var f=e.source_data.layers[h];if(f.features.length){l.buffer=h.includes("lines")?TILE_MARGIN*Geo$1.units_per_pixel:0;var d=createGeoJsonTile(f,r,i,n,l);e.source_data.layers[h]=parseGeoJSONVectorTile(d)}}e.source_data.layers.overlays=this._processOverlays(e,u);for(var _=e.source_data.layers.overlays.features.length;_--;)if(!e.source_data.layers.overlays.features[_].id){s=!0,this._layersCache.drop(o);break}e.source_data.layers.markers=this._processMarkers(e,c),this._postProcessTile(e),s||this._layersCache.add(o,e.source_data.layers,1)}return e.rasters=this._getRastersForMarkers(e.source_data.layers.markers.features),Promise.resolve(e)}},{key:"_processMarkers",value:function(e,t){var r=t.features.length;if(r){for(var i=Geo$1.unitsPerMeter(e.coords.z),n=Geo$1.wrapTile(e.coords,{x:!0}),o=Geo$1.metersForTile(n),a=Geo$1.isLastTile(n),s=Geo$1.wrapMeters(e.min),l=Geo$1.wrapMeters(e.max),u=function(t){DataSource.coordsToMeters(t);var r=_slicedToArray(t,2),n=r[0],u=r[1],c=n>=s.x&&(a.column||n<l.x)&&u>=l.y&&(a.row||!e.coords.y||u<s.y);return DataSource.metersToTileUnits(i,o,t),c},c=[],h=0;h<r;h++){var f=t.features[h].geometry,d=!1;if("Point"===f.type){var _=f.coordinates;u(_)?f.coordinates=_:d=!0}else"MultiPoint"===f.type&&(f.coordinates=f.coordinates.filter(u),0===f.coordinates.length&&(d=!0));d||c.push(t.features[h])}t.features=c}return t}},{key:"_processOverlays",value:function(e,t){var r=this;if(!t.features.length)return t;var i={coords:e.coords,min:Geo$1.metersForTile(Geo$1.wrapTile(e.coords,{x:!0}))},n={coords:e.coords,source_data:{layers:{_default:{type:"FeatureCollection",features:t.features}}}},o=Math.pow(2,e.coords.z+TILE_EXPONENT);MapsJsSource.projectData(n.source_data),MapsJsSource.scaleData(n.source_data,i);var a=t.features.map((function(e){var t=e.geometry.coordinates[0],r=t[0],i=t[5===t.length?2:3],n=Math.floor(r[0]/Geo$1.tile_scale*Geo$1.tile_size),a=Math.floor(r[1]/Geo$1.tile_scale*Geo$1.tile_size),s=Math.floor(i[0]/Geo$1.tile_scale*Geo$1.tile_size),l=Math.floor(i[1]/Geo$1.tile_scale*Geo$1.tile_size)-a,u=n>=s,c=u?o-(n-s):s-n,h=[];return n<=Geo$1.tile_size&&h.push([n,a,c,l]),u&&s>0&&h.push([n-o,a,c,l]),{id:e.id,properties:e.properties,texcoords:h}})).filter((function(t){return r._isVisible(t.properties)&&r.isInMinMaxRange(t.properties,e.style_zoom)})),s=Geo$1.tile_scale;return e.pad_scale=this.pad_scale,e.default_winding="CW",t.features=a.length?[{geometry:{type:"Polygon",coordinates:[[[0,0],[s,0],[s,s],[0,s],[0,0]]]},properties:{overlays_config:a}}]:a,t}},{key:"executeCommands",value:function(e){for(var t,r=e.length<AFFECTED_BBOX_CALC_THRESHOLD,i=0;i<e.length;i++){var n=e[i];n.arguments.push(r);var o=this[n.method_name].apply(this,n.arguments);r&&(o&&t?t.mergeRect(o,!0,t):o&&(t=o))}return t?t.forWorkerMessage():void 0}},{key:"_getClampedGeoRectForFeature",value:function(e){var t=e.geometry.boundingBox;return new ns.H.geo.Rect(MathUtils$1.clamp(t[0],-MAX_LNG_LAT[1],MAX_LNG_LAT[1]),t[1],MathUtils$1.clamp(t[2],-MAX_LNG_LAT[1],MAX_LNG_LAT[1]),t[3])}},{key:"addObjects",value:function(e){for(var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;n<e.length;n++){var o=e[n];if("Group"===o.type)o.$children_ids$={},this._groups_by_id[o.id]=o;else{r._preprocessGeometry(o.geometry);var a=this._getClampedGeoRectForFeature(o);i&&(t?t.mergeRect(a,!0,t):t=a);var s=-1!==o.geometry.type.indexOf("Point")?this._marker_quad_tree:this._quad_tree,l=s.insertBoundingBox(a);l.$tree=s,l.$feature$=o,this._tree_entries_by_object_id[o.id]=l}}for(var u=0;u<e.length;u++){var c=e[u];if(c.properties.parent)this._groups_by_id[c.properties.parent].$children_ids$[c.id]=c.id;c.properties.ref={effectiveVisibility:this._isVisible(c.properties),zInfo:this._getZInfo([],c)}}return this._layersCache.removeAll(),t}},{key:"removeObjectsByIds",value:function(e,t){for(var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=0;n<e.length;n++){var o=e[n],a=void 0,s=void 0;if(a=this._tree_entries_by_object_id[o]){if(i){var l=this._getClampedGeoRectForFeature(a.$feature$);r?r.mergeRect(l,!0,r):r=l}delete this._groups_by_id[a.$feature$.properties.parent].$children_ids$[o],a.$tree.remove(a),delete this._tree_entries_by_object_id[o]}else(s=this._groups_by_id[o])&&(s.properties.parent&&delete this._groups_by_id[s.properties.parent].$children_ids$[o],t&&this.removeObjectsByIds(Object.keys(s.$children_ids$),!0),delete this._groups_by_id[o])}return this._layersCache.removeAll(),r}},{key:"updateObjectProperties",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"Group"===e.type?(mergeObjects(this._groups_by_id[e.id].properties,e.properties),this._groups_by_id[e.id].properties.ref.effectiveVisibility=this._isVisible(e.properties)):(this._tree_entries_by_object_id[e.id]||this.addObjects([e]),mergeObjects(this._tree_entries_by_object_id[e.id].$feature$.properties,e.properties),this._tree_entries_by_object_id[e.id].$feature$.properties.ref.effectiveVisibility=this._isVisible(e.properties),r&&(t=this._getClampedGeoRectForFeature(e))),t}},{key:"_getZInfo",value:function(e,t){var r=t.properties.zIdx,i=t.properties.sIdx;return e[0]|=undefined!==r,e.splice(1,0,r||0,i<0?t.id:i),0===t.properties.parent?e:this._getZInfo(e,this._groups_by_id[t.properties.parent])}},{key:"_isVisible",value:function(e){var t=e.visible,r=!e.parent||this._isVisible(this._groups_by_id[e.parent].properties);return t&&r}},{key:"isInMinMaxRange",value:function(e,t){var r=e.min<=t&&e.max>=t,i=!e.parent||this.isInMinMaxRange(this._groups_by_id[e.parent].properties,t);return r&&i}},{key:"dispose",value:function(){this._commands=[],_get(_getPrototypeOf(r.prototype),"dispose",this).call(this)}}],[{key:"_compareZInfo",value:function(e,t){for(var r,i=e.properties.ref.zInfo,n=t.properties.ref.zInfo,o=i.length,a=n.length,s=Math.min(o,a),l=1;l<s;l++)if(r=i[l]-n[l])return r;return o-a}},{key:"_preprocessGeometry",value:function(e){var t=e.type;e.coordinates="Point"===t?r._processPointCoordinates(e.coordinates):"MultiPoint"===t?e.coordinates.map(r._processPointCoordinates):"LineString"===t?r._processLineStringCoordinates(e.coordinates):"MultiLineString"===t?e.coordinates.map(r._processLineStringCoordinates):"Polygon"===t?e.coordinates.map(r._processPolygonCoordinates):"MultiPolygon"===t?e.coordinates.map(r._processMultiPolygonCoordinates):[]}},{key:"_processPointCoordinates",value:function(e){return[e[1],e[0],e[2]]}},{key:"_processLineStringCoordinates",value:function(e){return r._latLngAltArrayToLineString(e,!1)}},{key:"_processPolygonCoordinates",value:function(e){return r._latLngAltArrayToLineString(e,!0)}},{key:"_processMultiPolygonCoordinates",value:function(e){return e.map(r._processPolygonCoordinates)}},{key:"_latLngAltArrayToLineString",value:function(e,t){for(var r=[],i=e.length,n=0;n<i;n+=3)r.push([e[n+1],e[n]]);return t&&r.push([e[1],e[0]]),r}}]),r}(MapsJsSource);MapsJsSource.register(ObjectSource,"ObjectSource");var GEOMETRY_TYPE={POLYGON:1,POLYLINE:2,OUTLINE:3},IconMap=function(){function e(){_classCallCheck(this,e),this._map={}}return _createClass(e,[{key:"set",value:function(e,t,r){if(this._map[e])this._map[e].accumulator.add(r);else{var i=new Set;i.add(r),this._map[e]={value:t,accumulator:i}}}},{key:"get",value:function(e){return this._map[e]&&this._map[e].value}},{key:"delete",value:function(e,t){var r=this._map[e];r&&r.accumulator&&(r.accumulator.delete(t),0===r.accumulator.size&&delete this._map[e])}}]),e}(),ObjectTileSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),n=t.call(this,e,i),Thread.is_worker||(n._icons=new IconMap),n}return _createClass(r,[{key:"onProviderUpdate",value:function(e){e.target instanceof H.map.provider.Tile?this.dispatchUpdate(e.target,e.data):this.dispatchUpdate(void 0,e.data)}},{key:"onReady",value:function(){var e=this.provider;e.setTileCanvasRendering&&e.setTileCanvasRendering(!1),e.providesMarkers()&&(this._onCacheDrop=this._onCacheDrop.bind(this),e.getCache().registerOnDrop(this._onCacheDrop)),this.dispatchUpdate()}},{key:"dispose",value:function(){_get(_getPrototypeOf(r.prototype),"dispose",this).call(this);var e=this.provider;e.providesMarkers()&&e.getCache().deRegisterOnDrop(this._onCacheDrop)}},{key:"_onCacheDrop",value:function(e,t,r){this.provider.cacheFilter(e)&&this._deleteIcons(e,t.data)}},{key:"_deleteIcons",value:function(e,t){for(var r=0,i=t.length;r<i;r++){var n=t[r].getIcon();this._icons.delete(n.uid,e)}}},{key:"getIconBitmapByObjectId",value:function(e,t){var r=this._icons.get(t);return r&&r.getBitmap()}},{key:"requestMarkerTile",value:function(e){var t=this,r=new Promise((function(r,i){t.provider?t.provider.requestTileAsPromise(e.x,e.y,e.z,!1).then((function(e){var i,n,o=[];if(e.data)for(n=(i=e.data).length;n--;){var a=i[n],s=a.getIcon();t._icons.set(s.uid,s,e.key),o.push(a.forWorkerMessage())}r(o)})):r([])}));return r}},{key:"requestSpatialTile",value:function(e){var t=this,r=new Promise((function(r,i){t.provider?t.provider.requestTileAsPromise(e.x,e.y,e.z,!1).then((function(e){var t,i=[];if(e.getObjects){t=e.getObjects();for(var n=0;n<t.length;n++){var o=t[n];i.push({id:o.getId(),geometries:o.getGeometriesForTile(e),isClosed:o.isClosed(),style:o.getStyle().forWorkerMessage()})}}r(i)})):r([])}));return r}},{key:"_pointToArray",value:function(e){var t=Geo$1.tile_scale/this.tile_size;return[e.x*t,e.y*t]}},{key:"_getGeoJsonMultiPolygon",value:function(e){for(var t=e.geometries,r=t.length,i=[],n={coordinates:i,type:"MultiPolygon"},o=0;o<r;o++){var a=t[o],s=a.paths,l=s.length,u=a.interiorsIndex,c=a.outlinesIndex,h=Math.min(u,c,l),f=void 0,d=void 0;for(d=0;d<h;d++)f=[s[d].map(this._pointToArray,this)],i.push(f);if(1===h)for(h=Math.min(c,l),d=u;d<h;d++)f.push(s[d].map(this._pointToArray,this))}return n}},{key:"_getGeoJsonMultiLineString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={coordinates:[],type:"MultiLineString"},i=e.geometries,n=0;n<i.length;n++)for(var o=i[n],a=t?o.outlinesIndex:0,s=t?o.paths.length:Math.min(o.interiorsIndex,o.outlinesIndex,o.paths.length),l=a;l<s;l++){var u=o.paths[l].map(this._pointToArray,this);r.coordinates.push(u)}return r}},{key:"_getGeoJsonGeometry",value:function(e,t){var r;return(r=t===GEOMETRY_TYPE.POLYGON?this._getGeoJsonMultiPolygon(e):this._getGeoJsonMultiLineString(e,t===GEOMETRY_TYPE.OUTLINE)).coordinates.length?r:null}},{key:"_load",value:function(e){var t,r=this;return t=new Promise((function(t,i){var n=WorkerBroker.postMessage(r.target_name+".requestMarkerTile",e.coords).then(r._prepareTileData.bind(r,e)),o=new Promise((function(t,i){WorkerBroker.postMessage(r.target_name+".requestSpatialTile",e.coords).then((function(i){for(var n=[],o=[],a=[],s=0;s<i.length;s++){var l=i[s],u=void 0,c=void 0;l.isClosed?(u=o,c=GEOMETRY_TYPE.POLYGON):(u=n,c=GEOMETRY_TYPE.POLYLINE);var h=r._getGeoJsonGeometry(l,c);if(h){var f={id:l.id,type:"Feature",properties:{height:0,style:l.style},geometry:h};c===GEOMETRY_TYPE.POLYLINE&&(f.properties.effectiveZIdx=n.length),u.push(f)}var d=r._getGeoJsonGeometry(l,GEOMETRY_TYPE.OUTLINE);d&&a.push({id:l.id,type:"Feature",properties:{height:0,style:l.style,effectiveZIdx:a.length},geometry:d})}e.source_data.layers.polylines={type:"FeatureCollection",features:n},e.source_data.layers.polygons={type:"FeatureCollection",features:o},e.source_data.layers.outlines={type:"FeatureCollection",features:a},t(e)}))}));Promise.all([n,o]).then((function(i){r._postProcessTile(e),t(e)}))})),t}},{key:"_prepareTileData",value:function(e,t){var r=Geo$1.wrapTile(e.coords,{x:!0,y:!0}),i=Geo$1.metersForTile(r);e.source_data.layers={markers:{features:t,type:"FeatureCollection"}};var n={coords:r,min:i},o=e.source_data,a=layout$1("binary-tree"),s={};for(var l in o.layers)for(var u=o.layers[l].features.length,c=0;c<u;c++){var h=o.layers[l].features[c],f=h.properties.icon;s[f.id]||(a.addItem({width:f.size.w,height:f.size.h,meta:{objectId:h.id,id:f.id}}),s[f.id]=!0),Geo$1.transformGeometry(h.geometry,(function(e){var t=e[0];e[0]=e[1],e[1]=t}))}return e.rasters=a.export(),MapsJsSource.projectData(e.source_data),MapsJsSource.scaleData(e.source_data,n),e}}]),r}(MapsJsSource);MapsJsSource.register(ObjectTileSource,"ObjectTileSource");var RemoteRasterTileSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){var n;return _classCallCheck(this,r),(n=t.call(this,e,i)).uid_=e.uid,n}return _createClass(r,[{key:"initialize",value:function(e,t,r,i){this.provider=e,this._on_update=t,this._onProviderUpdate=this._onProviderUpdate.bind(this),e.addEventListener("update",this._onProviderUpdate)}},{key:"_onProviderUpdate",value:function(e){this._on_update(this.name)}},{key:"tileTexture",value:function(e){return Object.assign(_get(_getPrototypeOf(r.prototype),"tileTexture",this).call(this,e),{uid:this.uid_,url:this.uid_+"_"+e.coords.key,coords:e.coords})}},{key:"dispose",value:function(){this.provider.removeEventListener("update",this._onProviderUpdate)}}]),r}(RasterTileSource);function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){var r=(t=this.options=extend$1(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=convert(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=wrap$1(i,t)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,t,r){return 32*((1<<e)*r+t)+e}function extend$1(e,t){for(var r in t)e[r]=t[r];return e}DataSource.register(RemoteRasterTileSource,"RemoteRasterTileSource"),GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,r,i,n,o,a){for(var s=[e,t,r,i],l=this.options,u=l.debug;s.length;){i=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=toID(t,r,i),f=this.tiles[h];if(!f&&(u>1&&console.time("creation"),f=this.tiles[h]=createTile(e,t,r,i,l),this.tileCoords.push({z:t,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=e,n){if(t===l.maxZoom||t===n)continue;var _=1<<n-t;if(r!==Math.floor(o/_)||i!==Math.floor(a/_))continue}else if(t===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==e.length){u>1&&console.time("clipping");var p,g,m,y,v,x,b=.5*l.buffer/l.extent,T=.5-b,A=.5+b,E=1+b;p=g=m=y=null,v=clip(e,c,r-b,r+A,0,f.minX,f.maxX,l),x=clip(e,c,r+T,r+E,0,f.minX,f.maxX,l),e=null,v&&(p=clip(v,c,i-b,i+A,1,f.minY,f.maxY,l),g=clip(v,c,i+T,i+E,1,f.minY,f.maxY,l),v=null),x&&(m=clip(x,c,i-b,i+A,1,f.minY,f.maxY,l),y=clip(x,c,i+T,i+E,1,f.minY,f.maxY,l),x=null),u>1&&console.timeEnd("clipping"),s.push(p||[],t+1,2*r,2*i),s.push(g||[],t+1,2*r,2*i+1),s.push(m||[],t+1,2*r+1,2*i),s.push(y||[],t+1,2*r+1,2*i+1)}}},GeoJSONVT.prototype.getTile=function(e,t,r){var i=this.options,n=i.extent,o=i.debug;if(e<0||e>24)return null;var a=1<<e,s=toID(e,t=(t%a+a)%a,r);if(this.tiles[s])return transformTile(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,u=e,c=t,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[toID(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?transformTile(this.tiles[s],n):null):null};var EMPTY_FEATURE_COLLECTION={type:"FeatureCollection",features:[]},GeoJSONTileSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){return _classCallCheck(this,r),e.tiled=!0,e.url="",t.call(this,e,i)}return _createClass(r,[{key:"fetchTile",value:function(e,t,r){return this.provider?this.provider.requestTileAsPromise(e,t,r).then((function(e){return e.data})):Promise.resolve(EMPTY_FEATURE_COLLECTION)}},{key:"_load",value:function(e){var t=this,r=Geo$1.wrapTile(e.coords,{x:!0,y:!0}),i={indexMaxZoom:0,maxZoom:this.max_zoom,tolerance:1.5,extent:Geo$1.tile_scale};return WorkerBroker.postMessage(this.target_name+".fetchTile",r.x,r.y,r.z).then((function(n){for(var o in e.source_data.layers="FeatureCollection"===n.type?{_default:n}:n,e.source_data.layers){var a=geojsonvt(e.source_data.layers[o],i).getTile(r.z,r.x,r.y);e.source_data.layers[o]=parseGeoJSONVectorTile(a)}return t._postProcessTile(e),e}))}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),r}(MapsJsSource);DataSource.register(GeoJSONTileSource,"GeoJSONTileSource");var DEFAULT_RESPONSE={layers:{_default:{type:"FeatureCollection",features:[{type:"Point",geometry:{}}]}}},SkyBoxSource=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i){return _classCallCheck(this,r),e.max_zoom=0,t.call(this,e,i)}return _createClass(r,[{key:"load",value:function(e){return e.source_data="0/0/0"===e.coords.key?DEFAULT_RESPONSE:void 0,Promise.resolve(e)}}]),r}(DataSource),debugSettings;DataSource.register(SkyBoxSource,"SkyBox");var debugSettings$1=debugSettings={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1};function mergeDebugSettings(e){Object.assign(debugSettings,e)}var WorkerType={NATIVE:0,FAKE:1},Context;function sliceObject(e,t){var r={};return t.forEach((function(t){return r[t]=e[t]})),r}var Context$1=Context={},context_id=0,gl;Context.getContext=function(e,t){var r=!1;null==e&&((e=document.createElement("canvas")).style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=-1,document.body.appendChild(e),r=!0);var i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!i)throw new Error("Couldn't create WebGL context.");return i._tangram_id=context_id++,r?(Context.resize(i,window.innerWidth,window.innerHeight,t.device_pixel_ratio),window.addEventListener("resize",(function(){Context.resize(i,window.innerWidth,window.innerHeight,t.device_pixel_ratio)}))):Context.resize(i,parseFloat(e.style.width),parseFloat(e.style.height),t.device_pixel_ratio),i},Context.resize=function(e,t,r,i){e.canvas.style.width=t+"px",e.canvas.style.height=r+"px",e.canvas.width=Math.round(t*i),e.canvas.height=Math.round(r*i),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)};var gl$1=gl={};gl.BYTE=5120,gl.UNSIGNED_BYTE=5121,gl.SHORT=5122,gl.UNSIGNED_SHORT=5123,gl.INT=5124,gl.UNSIGNED_INT=5125,gl.FLOAT=5126;var MAX_VALUE=Math.pow(2,16)-1,DEFAULT_SIZE=1024,HAS_ELEMENT_INDEX_UINT=!1,VertexElements=function(){function e(t){_classCallCheck(this,e),this.size_=t||DEFAULT_SIZE,this.position_=0,this.ArrayType_=Uint16Array,this.buffer_=new this.ArrayType_(this.size_),this.overflows_=!1}return _createClass(e,[{key:"push",value:function(e){if(!this.overflows_||HAS_ELEMENT_INDEX_UINT){if(e>MAX_VALUE){if(this.overflows_=!0,!HAS_ELEMENT_INDEX_UINT)return;this.ArrayType_===Uint16Array&&(this.ArrayType_=Uint32Array,this.buffer_=new this.ArrayType_(this.buffer_))}this.position_===this.size_&&this.expand_(),this.buffer_[this.position_]=e,this.position_+=1}}},{key:"end",value:function(){if(0!==this.position_){var e=this.buffer_,t=this.position_;return this.buffer_=new this.ArrayType_(this.size_),this.position_=0,this.overflows_=!1,e.subarray(0,t)}return!1}},{key:"expand_",value:function(){this.size_=this.size_<<1;var e=new this.ArrayType_(this.size_);e.set(this.buffer_),this.buffer_=e}}]),e}(),_array_types;VertexElements.setElementIndexUint=function(e){HAS_ELEMENT_INDEX_UINT=e};var array_types=(_array_types={},_defineProperty(_array_types,gl$1.FLOAT,Float32Array),_defineProperty(_array_types,gl$1.BYTE,Int8Array),_defineProperty(_array_types,gl$1.UNSIGNED_BYTE,Uint8Array),_defineProperty(_array_types,gl$1.INT,Int32Array),_defineProperty(_array_types,gl$1.UNSIGNED_INT,Uint32Array),_defineProperty(_array_types,gl$1.SHORT,Int16Array),_defineProperty(_array_types,gl$1.UNSIGNED_SHORT,Uint16Array),_array_types),VertexData=function(){function e(t){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).prealloc,i=void 0===r?500:r;_classCallCheck(this,e),this.vertex_layout=t,this.vertex_elements=new VertexElements,this.stride=this.vertex_layout.stride,e.array_pool.length>0?(this.vertex_buffer=e.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),log("trace","VertexData: reused buffer of bytes ".concat(this.byte_length,", ").concat(this.size," vertices"))):(this.size=i,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}return _createClass(e,[{key:"setBufferViews",value:function(){var e=this;this.views={},this.views[gl$1.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach((function(t){if(null==e.views[t.type]){var r=array_types[t.type];e.views[t.type]=new r(e.vertex_buffer.buffer)}}))}},{key:"checkBufferSize",value:function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var t=new Uint8Array(this.byte_length);t.set(this.vertex_buffer),e.array_pool.push(this.vertex_buffer),this.vertex_buffer=t,this.setBufferViews(),this.realloc_count++}}},{key:"setAddVertexFunction",value:function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()}},{key:"addVertex",value:function(e){this.checkBufferSize(),this.vertexLayoutAddVertex(e,this.views,this.offset),this.offset+=this.stride,this.vertex_count++}},{key:"end",value:function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),log("trace","VertexData: ".concat(this.size," vertices total, realloc count ").concat(this.realloc_count)),this}}]),e}();VertexData.array_pool=[];var VertexLayout=function(){function e(t){_classCallCheck(this,e),this.attribs=t,this.dynamic_attribs=this.attribs.filter((function(e){return!e.static})),this.components=[],this.index={},this.offset={},this.stride=0;for(var r=0,i=0,n=0;n<this.attribs.length;n++){var o=this.attribs[n];if(null==o.static){o.offset=this.stride,o.byte_size=o.size;var a=0;switch(o.type){case gl$1.FLOAT:case gl$1.INT:case gl$1.UNSIGNED_INT:o.byte_size*=4,a=2;break;case gl$1.SHORT:case gl$1.UNSIGNED_SHORT:o.byte_size*=2,a=1}3&o.byte_size&&(o.byte_size+=4-(3&o.byte_size)),this.stride+=o.byte_size;for(var s=o.offset>>a,l=0;l<o.size;l++)this.components.push({type:o.type,shift:a,offset:s++,index:i++});this.index[o.name]=r,r+=o.size,this.offset[o.name]=o.offset}else o.static=Array.isArray(o.static)?o.static:[o.static],o.method="vertexAttrib".concat(o.static.length,"fv")}}return _createClass(e,[{key:"enable",value:function(t,r,i){for(var n,o,a=0;a<this.attribs.length;a++)n=this.attribs[a],-1!==(o=r.attribute(n.name).location)&&(null==n.static?(e.enabled_attribs[o]&&!i||t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.size,n.type,n.normalized,this.stride,n.offset),e.enabled_attribs[o]=r):t[n.method]instanceof Function&&(t.enableVertexAttribArray(o),t[n.method](o,n.static),t.disableVertexAttribArray(o),delete e.enabled_attribs[o]));for(o in e.enabled_attribs)this.disableUnusedAttribute(t,o,r)}},{key:"disableUnusedAttribute",value:function(t,r,i){e.enabled_attribs[r]!==i&&(t.disableVertexAttribArray(r),delete e.enabled_attribs[r])}},{key:"createVertexData",value:function(){return new VertexData(this)}},{key:"getAddVertexFunction",value:function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex}},{key:"createAddVertexFunction",value:function(){var t=hashString(JSON.stringify(this.attribs));if(null==e.add_vertex_funcs[t]){var r,i=["var t, o;"],n=_toConsumableArray(this.components);n.sort((function(e,t){return e.type!==t.type?e.type-t.type:e.index-t.index}));for(var o=0;o<n.length;o++){var a=n[o];r!==a.type&&(i.push("t = vs[".concat(a.type,"];")),i.push("o = off".concat(a.shift?" >> "+a.shift:"",";")),r=a.type),i.push("t[o + ".concat(a.offset,"] = v[").concat(a.index,"];"))}i=i.join("\n");var s=new Function("v","vs","off",i);e.add_vertex_funcs[t]=s}this.addVertex=e.add_vertex_funcs[t]}}]),e}();VertexLayout.enabled_attribs={},VertexLayout.add_vertex_funcs={};var tile_bounds=[{x:0,y:0},{x:Geo$1.tile_scale,y:-Geo$1.tile_scale}],default_uvs=[0,0,1,1];function outsideTile(e,t,r){var i=tile_bounds[0],n=tile_bounds[1];return e[0]<=i.x+r&&t[0]<=i.x+r||e[0]>=n.x-r&&t[0]>=n.x-r||e[1]>=i.y-r&&t[1]>=i.y-r||e[1]<=n.y+r&&t[1]<=n.y+r}function isCoordOutsideTile(e,t){t=t||0;var r=tile_bounds[0],i=tile_bounds[1];return e[0]<=r.x+t||e[0]>=i.x-t||e[1]>=r.y-t||e[1]<=i.y+t}var earcut_1=earcut;function earcut(e,t,r){r=r||2;var i,n,o,a,s,l,u,c=t&&t.length,h=c?t[0]*r:e.length,f=linkedList(e,0,h,r,!0),d=[];if(!f)return d;if(c&&(f=eliminateHoles(e,t,f,r)),e.length>80*r){i=o=e[0],n=a=e[1];for(var _=r;_<h;_+=r)(s=e[_])<i&&(i=s),(l=e[_+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);u=Math.max(o-i,a-n)}return earcutLinked(f,d,r,i,n,u),d}function linkedList(e,t,r,i,n){var o,a;if(n===signedArea(e,t,r,i)>0)for(o=t;o<r;o+=i)a=insertNode(o,e[o],e[o+1],a);else for(o=r-i;o>=t;o-=i)a=insertNode(o,e[o],e[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!equals(i,i.next)&&0!==area(i.prev,i,i.next))i=i.next;else{if(removeNode(i),(i=t=i.prev)===i.next)return null;r=!0}}while(r||i!==t);return t}function earcutLinked(e,t,r,i,n,o,a){if(e){!a&&o&&indexCurve(e,i,n,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?isEarHashed(e,i,n,o):isEar(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),removeNode(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?earcutLinked(e=cureLocalIntersections(e,t,r),t,r,i,n,o,2):2===a&&splitEarcut(e,t,r,i,n,o):earcutLinked(filterPoints(e),t,r,i,n,o,1);break}}}function isEar(e){var t=e.prev,r=e,i=e.next;if(area(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function isEarHashed(e,t,r,i){var n=e.prev,o=e,a=e.next;if(area(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=zOrder(s,l,t,r,i),f=zOrder(u,c,t,r,i),d=e.nextZ;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function cureLocalIntersections(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!equals(n,o)&&intersects(n,i,i.next,o)&&locallyInside(n,o)&&locallyInside(o,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(o.i/r),removeNode(i),removeNode(i.next),i=e=o),i=i.next}while(i!==e);return i}function splitEarcut(e,t,r,i,n,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&isValidDiagonal(a,s)){var l=splitPolygon(a,s);return a=filterPoints(a,a.next),l=filterPoints(l,l.next),earcutLinked(a,t,r,i,n,o),void earcutLinked(l,t,r,i,n,o)}s=s.next}a=a.next}while(a!==e)}function eliminateHoles(e,t,r,i){var n,o,a,s=[];for(n=0,o=t.length;n<o;n++)(a=linkedList(e,t[n]*i,n<o-1?t[n+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),s.push(getLeftmost(a));for(s.sort(compareX),n=0;n<s.length;n++)eliminateHole(s[n],r),r=filterPoints(r,r.next);return r}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t)){var r=splitPolygon(t,e);filterPoints(r,r.next)}}function findHoleBridge(e,t){var r,i=t,n=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===a)return r.prev;var l,u=r,c=r.x,h=r.y,f=1/0;for(i=r.next;i!==u;)n>=i.x&&i.x>=c&&pointInTriangle(o<h?n:a,o,c,h,o<h?a:n,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(n-i.x))<f||l===f&&i.x>r.x)&&locallyInside(i,e)&&(r=i,f=l),i=i.next;return r}function indexCurve(e,t,r,i){var n=e;do{null===n.z&&(n.z=zOrder(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(e){var t,r,i,n,o,a,s,l,u=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,i=r,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0===s?(n=i,i=i.nextZ,l--):0!==l&&i?r.z<=i.z?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--):(n=r,r=r.nextZ,s--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,u*=2}while(a>1);return e}function zOrder(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function pointInTriangle(e,t,r,i,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(n-a)*(i-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,i){return!!(equals(e,t)&&equals(r,i)||equals(e,i)&&equals(r,t))||area(e,t,r)>0!=area(e,t,i)>0&&area(r,i,e)>0!=area(r,i,t)>0}function intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),i=new Node(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function insertNode(e,t,r,i){var n=new Node(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,r,i){for(var n=0,o=t,a=r-i;o<r;o+=i)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}earcut.deviation=function(e,t,r,i){var n=t&&t.length,o=n?t[0]*r:e.length,a=Math.abs(signedArea(e,0,o,r));if(n)for(var s=0,l=t.length;s<l;s++){var u=t[s]*r,c=s<l-1?t[s+1]*r:e.length;a-=Math.abs(signedArea(e,u,c,r))}var h=0;for(s=0;s<i.length;s+=3){var f=i[s]*r,d=i[s+1]*r,_=i[s+2]*r;h+=Math.abs((e[f]-e[_])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[_+1]-e[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},earcut.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[n][o][a]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r};var earcut$1=getDefaultExportFromCjs(earcut_1),up_vec3=[0,0,1];function buildPolygons(e,t,r,i){var n=i.texcoord_index,o=i.texcoord_scale,a=i.texcoord_normalize,s=t.vertex_elements;if(n){a=a||1;var l=_slicedToArray(o||default_uvs,4),u=l[0],c=l[1],h=l[2],f=l[3]}for(var d=0,_=e.length,p=0;p<_;p++){var g=t.vertex_count,m=e[p];if(n)var y=_slicedToArray(Geo$1.findBoundingBox(m),4),v=y[0],x=y[1],b=(h-u)/(y[2]-v),T=(f-c)/(y[3]-x);for(var A=0;A<m.length;A++)for(var E=m[A],w=0;w<E.length;w++){var S=E[w];r[0]=S[0],r[1]=S[1],n&&(r[n+0]=((S[0]-v)*b+u)*a,r[n+1]=((S[1]-x)*T+c)*a),t.addVertex(r)}for(var k=triangulatePolygon(earcut$1.flatten(m)),P=0;P<k.length;P++)s.push(g+k[P]);d+=k.length/3}return d}function buildExtrudedPolygons(e,t,r,i,n,o,a,s,l){var u=l.remove_tile_edges,c=l.tile_edge_tolerance,h=l.texcoord_index,f=l.texcoord_scale,d=l.texcoord_normalize,_=l.winding,p=t+(i||0),g=t+r;o[2]=g;var m=buildPolygons(e,n,o,{texcoord_index:h,texcoord_scale:f,texcoord_normalize:d}),y=n.vertex_elements,v=n.vertex_count;if(h){d=d||1;var x=_slicedToArray(f||default_uvs,4),b=x[0],T=x[1],A=x[2],E=x[3],w=[[b,E],[b,T],[A,T],[A,E]]}for(var S=e.length,k=0;k<S;k++)for(var P=e[k],R=0;R<P.length;R++)for(var M=P[R],L=0;L<M.length-1;L++)if(!u||!outsideTile(M[L],M[L+1],c)){var O=void 0,C=void 0;"CCW"===_?(O=L,C=L+1):(O=L+1,C=L);var I=[[M[C][0],M[C][1],g],[M[C][0],M[C][1],p],[M[O][0],M[O][1],p],[M[O][0],M[O][1],g]],N=Vector$1.normalize([M[C][0]-M[O][0],M[C][1]-M[O][1],0]),$=Vector$1.cross(up_vec3,N);o[a+0]=$[0]*s,o[a+1]=$[1]*s,o[a+2]=$[2]*s;for(var B=0;B<I.length;B++)o[0]=I[B][0],o[1]=I[B][1],o[2]=I[B][2],h&&(o[h+0]=w[B][0]*d,o[h+1]=w[B][1]*d),n.addVertex(o);y.push(v+0),y.push(v+1),y.push(v+2),y.push(v+2),y.push(v+3),y.push(v+0),v+=4,m+=2}return m}function triangulatePolygon(e){return earcut$1(e.vertices,e.holes,e.dimensions)}var shaderSrc_polygonsVertex="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;attribute vec4 a_position;attribute vec4 a_color;\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\nattribute vec3 a_normal;\n#define TANGRAM_NORMAL a_normal\n#else\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nattribute vec2 a_extrude;attribute vec2 a_offset;attribute vec2 a_scaling;uniform float u_v_scale_adjust;\n#endif\nvarying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nattribute vec2 a_texcoord;varying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvoid main(){\n#pragma tangram: setup\n#ifdef TANGRAM_TEXTURE_COORDS\nv_texcoord=a_texcoord;\n#ifdef TANGRAM_EXTRUDE_LINES\nv_texcoord.y*=u_v_scale_adjust;\n#endif\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nvec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.);\n#ifdef TANGRAM_EXTRUDE_LINES\nvec2 extrude=a_extrude.xy;vec2 offset=a_offset.xy;float dz=clamp(u_map_position.z-u_tile_origin.z,0.,4.);dz+=step(1.,dz)*(1.-dz)+mix(0.,2.,clamp((dz-2.)/2.,0.,1.));float mdz=(dz-0.5)*2.;extrude-=extrude*UNPACK_SCALING(a_scaling.x)*mdz;float dwdz=UNPACK_SCALING(a_scaling.y);float sdwdz=sign(step(0.,dwdz)-0.5);offset-=offset*abs(dwdz)*((1.-step(0.,sdwdz))-(dz*-sdwdz));float ssz=exp2(-dz-(u_tile_origin.z-u_tile_origin.w));extrude*=ssz;offset*=ssz;\n#ifdef TANGRAM_BLOCK_WIDTH\nfloat width=1.;\n#pragma tangram: width\nextrude*=width;\n#endif\nposition.xy+=extrude+offset;\n#endif\nv_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);v_color=a_color;\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#if defined(SNAP_TO_PIXEL_GRID)\nsnapToPixelGrid(position);\n#endif\ngl_Position=position;}",shaderSrc_polygonsFragment="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_EXTRUDE_LINES\nuniform bool u_has_line_texture;uniform sampler2D u_texture;uniform float u_texture_ratio;uniform vec4 u_dash_background_color;\n#endif\n#define TANGRAM_NORMAL v_normal\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nvarying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#pragma tangram: utils\nvoid main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_COLOR\ncolor*=sampleRaster();\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nif(u_has_line_texture){vec2 _line_st=vec2(v_texcoord.x,fract(v_texcoord.y/u_texture_ratio));vec4 _line_color=texture2D(u_texture,_line_st);if(_line_color.a<TANGRAM_ALPHA_TEST){\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY)\nif(u_dash_background_color.a==0.){discard;}color=u_dash_background_color;\n#else\ncolor=vec4(u_dash_background_color.rgb,color.a*step(TANGRAM_EPSILON,u_dash_background_color.a));\n#endif\n}else{color*=_line_color;}}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_NORMAL\nnormal=normalize(sampleRaster().rgb*2.-1.);\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\ngl_FragColor=color;}",Polygons=Object.create(Style);Object.assign(Polygons,{name:"polygons",built_in:!0,vertex_shader_src:shaderSrc_polygonsVertex,fragment_shader_src:shaderSrc_polygonsFragment,selection:!0,init:function(){Style.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0)},vertexLayoutForMeshVariant:function(e){if(!this.vertex_layout){var t=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_normal",size:3,type:gl$1.BYTE,normalized:!0},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}];this.texcoords&&t.push({name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0}),this.vertex_layout=new VertexLayout(t)}return this.vertex_layout},_parseFeature:function(e,t,r){var i=this.feature_style;return i.color=this.parseColor(t.color,r),i.color?(i.z=t.z&&StyleParser.evalCachedDistanceProperty(t.z,r)||StyleParser.defaults.z,i.z*=Geo$1.height_scale,i.extrude=StyleParser.evalProperty(t.extrude,r),i.extrude&&(!0===i.extrude?(i.height=void 0!==e.properties.height?e.properties.height:StyleParser.defaults.height,i.min_height=void 0!==e.properties.min_height?e.properties.min_height:StyleParser.defaults.min_height):"number"==typeof i.extrude?(i.height=i.extrude,i.min_height=0):Array.isArray(i.extrude)&&(i.min_height=i.extrude[0],i.height=i.extrude[1]),i.height*=Geo$1.height_scale,i.min_height*=Geo$1.height_scale),i.tile_edges=t.tile_edges,i):null},_preprocess:function(e){return e.color=StyleParser.createColorPropertyCache(e.color),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits),e},makeVertexTemplate:function(e){var t=0;return this.vertex_template[t++]=0,this.vertex_template[t++]=0,this.vertex_template[t++]=e.z||0,this.vertex_template[t++]=this.scaleOrder(e.order),this.vertex_template[t++]=0,this.vertex_template[t++]=0,this.vertex_template[t++]=127,this.vertex_template[t++]=255*e.color[0],this.vertex_template[t++]=255*e.color[1],this.vertex_template[t++]=255*e.color[2],this.vertex_template[t++]=255*e.color[3],this.selection&&(this.vertex_template[t++]=255*e.selection_color[0],this.vertex_template[t++]=255*e.selection_color[1],this.vertex_template[t++]=255*e.selection_color[2],this.vertex_template[t++]=255*e.selection_color[3]),this.texcoords&&(this.vertex_template[t++]=0,this.vertex_template[t++]=0),this.vertex_template},buildPolygons:function(e,t,r,i){var n=this.makeVertexTemplate(t),o={texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!t.tile_edges,tile_edge_tolerance:Geo$1.tile_scale*i.tile.pad_scale*4,winding:i.winding};return t.extrude&&t.height?buildExtrudedPolygons(e,t.z,t.height,t.min_height,r.vertex_data,n,this.vertex_layout.index.a_normal,127,o):buildPolygons(e,r.vertex_data,n,o)}});var zero_vec2=[0,0],CAP_TYPE$1={butt:0,square:1,round:2},JOIN_TYPE$1={miter:0,bevel:1,round:2},DEFAULT={MITER_LIMIT:3,TEXCOORD_NORMALIZE:1,TEXCOORD_RATIO:1,MIN_FAN_WIDTH:5},v_scale_adjust=Geo$1.tile_scale,zero_v=[0,0],one_v=[1,0],mid_v=[.5,0];function buildPolylines$1(e,t,r,i,n){var o=n.closed_polygon,a=n.remove_tile_edges,s=n.tile_edge_tolerance,l=n.texcoord_index;n.texcoord_scale;var u,c=n.texcoord_width,h=n.texcoord_ratio,f=n.texcoord_normalize,d=n.extrude_index,_=n.offset_index,p=n.join,g=n.cap,m=n.miter_limit,y=n.offset,v=n.crop_by_tile,x=g?CAP_TYPE$1[g]:CAP_TYPE$1.butt,b=p?JOIN_TYPE$1[p]:JOIN_TYPE$1.miter;if(b===JOIN_TYPE$1.miter)var T=(m=m||DEFAULT.MITER_LIMIT)*m;l&&(f=f||DEFAULT.TEXCOORD_NORMALIZE,u=1/(c*(h=h||DEFAULT.TEXCOORD_RATIO)*v_scale_adjust));for(var A={closed_polygon:o,remove_tile_edges:a,tile_edge_tolerance:s,miter_len_sq:T,join_type:b,cap_type:x,vertex_data:r,vertex_template:i,half_width:t/2,extrude_index:d,offset_index:_,v_scale:u,texcoord_index:l,texcoord_width:c,texcoord_normalize:f,offset:y,geom_count:0,crop_by_tile:v},E=0;E<e.length;E++)buildPolyline$1(e[E],A);if(A.extra_lines)for(var w=0;w<A.extra_lines.length;w++)buildPolyline$1(A.extra_lines[w],A);return A.geom_count}function buildPolyline$1(e,t){if(!(e.length<2)){var r,i,n,o,a=t.join_type,s=t.cap_type,l=t.closed_polygon,u=t.remove_tile_edges,c=t.tile_edge_tolerance,h=t.v_scale,f=t.miter_len_sq,d=t.crop_by_tile,_=null!=t.texcoord_index,p=0;if(l&&a===JOIN_TYPE$1.miter){var g=getTileBoundaryIndex(e);if(0!==g){var m=permuteLine(e,g);return t.extra_lines=t.extra_lines||[],void t.extra_lines.push(m)}}var y=0,v=e.length-1,x=0;for(r=e[y],i=e[y+1];Vector$1.isEqual(r,i);)if(r=i,i=e[++y+1],x++,y===e.length-1)return;for(;Vector$1.isEqual(e[v],e[v-1]);)if(x++,0===--v)return;if(!(e.length<2+x))if(o=Vector$1.normalize(Vector$1.perp(r,i)),u&&outsideTile(r,i,c)){var b=getNextNonBoundarySegment(e,y,c);b&&(t.extra_lines=t.extra_lines||[],t.extra_lines.push(b))}else{l?startPolygon(r,n=Vector$1.normalize(Vector$1.perp(e[v-1],r)),o,a,t):(!d&&isCoordOutsideTile(r)||(addCap(r,p,o,s,!0,t),_&&s!==CAP_TYPE$1.butt&&(p+=.5*h*t.texcoord_width)),addVertex$1(r,o,o,1,p,t,1),addVertex$1(r,o,o,0,p,t,-1)),_&&(p+=h*Vector$1.length(Vector$1.sub(i,r)));for(var T=y+1;T<v;T++){var A=T,E=T+1;if(r=e[A],i=e[E],!Vector$1.isEqual(r,i)){if(u&&outsideTile(r,i,c)){addVertex$1(r,o,o,1,p,t,1),addVertex$1(r,o,o,0,p,t,-1),indexPairs(1,t);var w=getNextNonBoundarySegment(e,A+1,c);return void(w&&(t.extra_lines=t.extra_lines||[],t.extra_lines.push(w)))}n=o,o=Vector$1.normalize(Vector$1.perp(r,i)),a===JOIN_TYPE$1.miter?addMiter(p,r,n,o,f,!1,t):addJoin(a,p,r,n,o,!1,t),_&&(p+=h*Vector$1.length(Vector$1.sub(i,r)))}}r=i,n=o,l?endPolygon(r,n,o=Vector$1.normalize(Vector$1.perp(r,e[1])),a,p,t):(addVertex$1(r,n,o,1,p,t,1),addVertex$1(r,n,o,0,p,t,-1),indexPairs(1,t),!d&&isCoordOutsideTile(r)||addCap(r,p,n,s,!1,t))}}}function getTileBoundaryIndex(e){if(isCoordOutsideTile(e[0]))return 0;for(var t=0;t<e.length;t++){if(isCoordOutsideTile(e[e.length-1-t]))return e.length-1-t}return 0}function getNextNonBoundarySegment(e,t,r){for(var i=t;e[i+1]&&outsideTile(e[i],e[i+1],r);)i++;return e.length-i>=2&&e.slice(i)}function startPolygon(e,t,r,i,n){if(void 0===i||isCoordOutsideTile(e)&&!n.crop_by_tile)addVertex$1(e,r,r,1,0,n,1),addVertex$1(e,r,r,0,0,n,-1);else{i===JOIN_TYPE$1.miter?addMiter(0,e,t,r,n.miter_len_sq,!0,n):addJoin(i,0,e,t,r,!0,n)}}function endPolygon(e,t,r,i,n,o){if(isCoordOutsideTile(e)&&!o.crop_by_tile)addVertex$1(e,t,t,1,n,o,1),addVertex$1(e,t,t,0,n,o,-1),indexPairs(1,o);else{var a=createMiterVec(t,r);i===JOIN_TYPE$1.miter&&Vector$1.lengthSq(a)>o.miter_len_sq&&(i=JOIN_TYPE$1.bevel),i===JOIN_TYPE$1.miter?(addVertex$1(e,a,t,1,n,o,1),addVertex$1(e,a,t,0,n,o,-1),indexPairs(1,o)):(addVertex$1(e,t,t,1,n,o,1),addVertex$1(e,t,t,0,n,o,-1),indexPairs(1,o))}}function createMiterVec(e,t){var r=Vector$1.normalize(Vector$1.add(e,t)),i=2/(1+Math.abs(Vector$1.dot(e,r)));return Vector$1.mult(r,i*i)}function addMiter(e,t,r,i,n,o,a){var s=createMiterVec(r,i);Vector$1.lengthSq(s)>n?addJoin(JOIN_TYPE$1.bevel,e,t,r,i,o,a):(addVertex$1(t,s,s,1,e,a,1),addVertex$1(t,s,s,0,e,a,-1),o||indexPairs(1,a))}function addJoin(e,t,r,i,n,o,a){var s=createMiterVec(i,n),l=n[0]*i[1]-n[1]*i[0]>0;null!=a.texcoord_index&&(zero_v[1]=t,one_v[1]=t),l?(addVertex$1(r,s,s,1,t,a,1),addVertex$1(r,i,s,0,t,a,-1),o||indexPairs(1,a),addFan(r,Vector$1.neg(i),s,Vector$1.neg(n),s,zero_v,one_v,zero_v,!1,e===JOIN_TYPE$1.bevel,a),addVertex$1(r,s,s,1,t,a,1),addVertex$1(r,n,s,0,t,a,-1)):(addVertex$1(r,i,s,1,t,a,1),addVertex$1(r,s,s,0,t,a,-1),o||indexPairs(1,a),addFan(r,i,Vector$1.neg(s),n,s,one_v,zero_v,one_v,!1,e===JOIN_TYPE$1.bevel,a),addVertex$1(r,n,s,1,t,a,1),addVertex$1(r,s,s,0,t,a,-1))}function indexPairs(e,t){for(var r=t.vertex_data.vertex_elements,i=t.vertex_data.vertex_count-2*e-2,n=0;n<e;n++)r.push(i+2*n+2),r.push(i+2*n+1),r.push(i+2*n+0),r.push(i+2*n+2),r.push(i+2*n+3),r.push(i+2*n+1),t.geom_count+=2}function addVertex$1(e,t,r,i,n,o,a){var s=o.vertex_template,l=o.vertex_data;s[0]=e[0],s[1]=e[1];var u=o.half_width*a;s[o.extrude_index+0]=t[0]*u,s[o.extrude_index+1]=t[1]*u,o.offset&&(s[o.offset_index+0]=r[0]*o.offset,s[o.offset_index+1]=r[1]*o.offset),null!=o.texcoord_index&&(s[o.texcoord_index+0]=i*o.texcoord_normalize,s[o.texcoord_index+1]=n*o.texcoord_normalize),l.addVertex(s)}var uvCurr=[0,0];function addFan(e,t,r,i,n,o,a,s,l,u,c){for(var h=t[0]*i[1]-t[1]*i[0],f=Vector$1.dot(t,i),d=Math.atan2(h,f);d>=Math.PI;)d-=2*Math.PI;if(u)_=1;else{var _=trianglesPerArc(d,c.half_width);if(_<1)return}var p=c.vertex_data.vertex_count,g=c.vertex_data.vertex_elements;addVertex$1(e,r,n,a[0],a[1],c,1),addVertex$1(e,t,n,o[0],o[1],c,1);var m=t,y=null!=c.texcoord_index;if(y)if(l)var v=Vector$1.sub(o,a);else{uvCurr=Vector$1.copy(o);var x=Vector$1.div(Vector$1.sub(s,o),_)}var b,T,A=d/_,E=d<0?-1:1;h>0?(b=2,T=1):(b=1,T=2);for(var w=0;w<_;w++)0===w&&d<0&&(m=Vector$1.neg(m)),m=Vector$1.rot(m,A),y&&(l?(v=Vector$1.rot(v,A),uvCurr[0]=v[0]+a[0],uvCurr[1]=v[1]*c.texcoord_width*c.v_scale+a[1]):uvCurr=Vector$1.add(uvCurr,x)),addVertex$1(e,m,n,uvCurr[0],uvCurr[1],c,E),g.push(p+w+b),g.push(p),g.push(p+w+T)}function addCap(e,t,r,i,n,o){var a=Vector$1.neg(r),s=null!=o.texcoord_index;switch(i){case CAP_TYPE$1.square:var l;n?(l=[r[1],-r[0]],addVertex$1(e,Vector$1.add(r,l),r,1,t,o,1),addVertex$1(e,Vector$1.add(a,l),r,0,t,o,1),s&&(t+=.5*o.texcoord_width*o.v_scale),addVertex$1(e,r,r,1,t,o,1),addVertex$1(e,a,r,0,t,o,1)):(l=[-r[1],r[0]],addVertex$1(e,r,r,1,t,o,1),addVertex$1(e,a,r,0,t,o,1),s&&(t+=.5*o.texcoord_width*o.v_scale),addVertex$1(e,Vector$1.add(r,l),r,1,t,o,1),addVertex$1(e,Vector$1.add(a,l),r,0,t,o,1)),indexPairs(1,o);break;case CAP_TYPE$1.round:var u,c,h=zero_v,f=one_v,d=mid_v;n?(u=r,c=a,s&&(t+=.5*o.texcoord_width*o.v_scale,h=one_v,f=zero_v,d=mid_v)):(u=a,c=r),s&&(zero_v[1]=t,one_v[1]=t,mid_v[1]=t),addFan(e,u,zero_vec2,c,r,h,d,f,!0,!1,o);break;case CAP_TYPE$1.butt:return}}function trianglesPerArc(e,t){e<0&&(e=-e);var r=t>2*DEFAULT.MIN_FAN_WIDTH?Math.log2(t/DEFAULT.MIN_FAN_WIDTH):1;return Math.ceil(e/Math.PI*r)}function permuteLine(e,t){for(var r=[],i=0;i<e.length;i++){var n=(i+t)%e.length;0!==n&&r.push(e[n])}return r.push(r[0]),r}var default_dash_color=[255,255,255,255],default_background_color=[0,0,0,0];function renderDashArray(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.dash_color||default_dash_color,i=t.background_color||default_background_color,n=e,o=t.scale||1;n.length%2==1&&Array.prototype.push.apply(n,n);for(var a=!0,s=[],l=0;l<n.length;l++){for(var u=Math.floor(n[l]*o),c=0;c<u;c++)Array.prototype.push.apply(s,a?r:i);a=!a}return{pixels:s=new Uint8Array(s),length:s.length/4}}var Lines=Object.create(Style);Lines.vertex_layouts=[[],[]],Lines.dash_textures={};var DASH_SCALE=20;function buildPolylines(e,t,r,i,n,o){for(var a={closed:o,vertex_data:r,vertex_template:i,half_width:t/2,vertex_layout_index:n,geom_count:0},s=0,l=e.length;s<l;s++)buildPolyline(e[s],a);return a.geom_count}function buildPolyline(e,t){if(!(e.length<2)){for(var r=[e[0]],i=0,n=[],o=[],a=1,s=e.length;a<s;a++)if(e[a][0]!==e[a-1][0]||e[a][1]!==e[a-1][1]){r.push(e[a]);var l=Vector$1.sub(e[a],e[a-1]),u=Vector$1.length(l);n.push(l),o.push([i,i+u]),i+=u}if(!(r.length<2)){var c=0,h=n[n.length-1],f=n[0],d=n[1],_=[0,0];r.length>2&&(t.closed&&(_[0]=Vector$1.signedAngleBetween(h,f)),_[1]=Vector$1.signedAngleBetween(f,d));var p=r[0],g=o[0];t.closed?(addVertex(p,t,c++,g,i,_,[h,f]),addVertex(p,t,c++,g,i,_,[h,f])):(addVertex(p,t,c++,g,i,_,[f,f]),addVertex(p,t,c++,g,i,_,[f,f]));for(var m=1,y=r.length-1;m<y;m++)p=r[m],h=n[m-1],f=n[m],d=n[m+1],addVertex(p,t,c++,g=o[m-1],i,_,[h,f]),addVertex(p,t,c++,g,i,_,[h,f]),triangulate(t),g=o[m],_[0]=_[1],_[1]=m!==y-1?Vector$1.signedAngleBetween(f,d):t.closed?Vector$1.signedAngleBetween(f,n[0]):0,addVertex(p,t,c++,g,i,_,[h,f]),addVertex(p,t,c++,g,i,_,[h,f]);p=r[r.length-1],g=o[o.length-1],f=n[n.length-1],t.closed?(addVertex(p,t,c++,g,i,_,[f,n[0]]),addVertex(p,t,c++,g,i,_,[f,n[0]])):(addVertex(p,t,c++,g,i,_,[f,f]),addVertex(p,t,c++,g,i,_,[f,f])),triangulate(t)}}}function triangulate(e){var t=e.vertex_data.vertex_elements,r=e.vertex_data.vertex_count-4;t.push(r+2),t.push(r+1),t.push(r+0),t.push(r+2),t.push(r+3),t.push(r+1),e.geom_count+=2}Object.assign(Lines,{name:"lines",built_in:!0,vertex_shader_src:shaderSrc_polygonsVertex,fragment_shader_src:shaderSrc_polygonsFragment,selection:!0,init:function(){Style.init.apply(this,arguments),this.styles=this.styles||{},this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style},calcDistance:function(e,t){return e&&StyleParser.evalCachedDistanceProperty(e,t)||0},calcDistanceNextZoom:function(e,t){t.zoom++;var r=this.calcDistance(e,t);return t.zoom--,r},calcWidth:function(e,t,r){var i=this.calcDistance(e.width,r);if(!(i<0)){var n;if(n=e.next_width?this.calcDistanceNextZoom(e.next_width,r):i/2,0===i&&0===n||n<0)return!1;if(t.width_unscaled=i,t.next_width_unscaled=n,e.next_width){var o=.5*(i+(n*=2));t.width=o*r.units_per_meter_overzoom,t.width_scale=1-n/o}else t.width=i*r.units_per_meter_overzoom,t.width_scale=0;return e.texcoords&&(e.inline_texcoord_width?t.texcoord_width=e.inline_texcoord_width:t.texcoord_width=(t.width_unscaled||t.next_width_unscaled)*r.units_per_meter_overzoom/r.tile.overzoom2),!0}},calcOffset:function(e,t,r){if(e.offset_precalc)t.offset=e.offset_precalc,t.offset_scale=e.offset_scale_precalc;else if(e.offset){var i=this.calcDistance(e.offset,r);if(e.next_offset){var n=2*this.calcDistanceNextZoom(e.next_offset,r);Math.abs(i)>=Math.abs(n)?(t.offset=i*r.units_per_meter_overzoom,t.offset_scale=0!==i?1-n/i:0):(t.offset=n*r.units_per_meter_overzoom,t.offset_scale=0!==n?-1*(1-i/n):0)}else t.offset=i*r.units_per_meter_overzoom,t.offset_scale=0}else t.offset=0,t.offset_scale=0;StyleParser.evalProperty(e.offset_reverse,r)&&(t.offset*=-1)},_parseFeature:function(e,t,r){var i=this.feature_style;if(!1!==this.calcWidth(t,i,r)&&(this.calcOffset(t,i,r),i.color=this.parseColor(t.color,r),i.color)){if(i.variantKey=t.variantKey,i.z=t.z&&StyleParser.evalCachedDistanceProperty(t.z||0,r)||StyleParser.defaults.z,i.height=e.properties.height||StyleParser.defaults.height,i.extrude=StyleParser.evalProperty(t.extrude,r),i.extrude&&("number"==typeof i.extrude?i.height=i.extrude:Array.isArray(i.extrude)&&(i.height=i.extrude[1])),i.extrude&&i.height&&(i.z+=i.height),i.z*=Geo$1.height_scale,i.height*=Geo$1.height_scale,i.cap=StyleParser.evalProperty(t.cap,r),i.join=StyleParser.evalProperty(t.join,r),i.miter_limit=StyleParser.evalProperty(t.miter_limit,r),i.tile_edges=t.tile_edges,i.outline=i.outline||{width:{},next_width:{},preprocessed:!0},t.outline&&!1!==t.outline.visible&&t.outline.color&&t.outline.width){var n=2*this.calcDistance(t.outline.width,r),o=2*this.calcDistanceNextZoom(t.outline.next_width,r);0===n&&0===o||n<0||o<0?(i.outline.width.value=null,i.outline.next_width.value=null,i.outline.color=null,i.outline.inline_texcoord_width=null,i.outline.texcoords=!1):(i.outline.width.value=n+i.width_unscaled,i.outline.next_width.value=o+i.next_width_unscaled,i.outline.inline_texcoord_width=i.texcoord_width,i.outline.offset_precalc=i.offset,i.outline.offset_scale_precalc=i.offset_scale,i.outline.color=t.outline.color,i.outline.cap=t.outline.cap,i.outline.join=t.outline.join,i.outline.miter_limit=t.outline.miter_limit,i.outline.texcoords=t.outline.texcoords,i.outline.style=t.outline.style,i.outline.variantKey=t.outline.variantKey,t.outline.order?i.outline.order=this.parseOrder(t.outline.order,r):i.outline.order=i.order,i.outline.order>i.order&&(i.outline.order=i.order),i.outline.order-=.5,i.outline.variant_order=0)}else i.outline.width.value=null,i.outline.next_width.value=null,i.outline.color=null,i.outline.inline_texcoord_width=null;return i}},_preprocess:function(e,t){var r=this.sources[t]?this.sources[t].config.uid:"";if(e.color=StyleParser.createColorPropertyCache(e.color),e.width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits),e.width&&e.width.type!==StyleParser.CACHE_TYPE.STATIC&&(e.next_width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits)),e.offset=e.offset&&StyleParser.createPropertyCache(e.offset,StyleParser.parseUnits),e.offset&&e.offset.type!==StyleParser.CACHE_TYPE.STATIC&&(e.next_offset=StyleParser.createPropertyCache(e.offset,StyleParser.parseUnits)),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits),e.dash=void 0!==e.dash?e.dash:this.dash,e.dash_key=e.dash&&this.dashTextureKey(e.dash,r),e.dash_background_color=void 0!==e.dash_background_color?e.dash_background_color:this.dash_background_color,e.dash_background_color=e.dash_background_color&&StyleParser.parseColor(e.dash_background_color),e.texture_merged=e.dash_key||(void 0!==e.texture?e.texture:this.texture),e.texcoords=this.texcoords||e.texture_merged?1:0,this.addMeshVariantForDraw(this.base,e),e.outline){e.outline.style=e.outline.style||this.name,e.outline.color=StyleParser.createColorPropertyCache(e.outline.color),e.outline.width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parseUnits),e.outline.next_width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parseUnits),e.outline.cap=e.outline.cap||e.cap,e.outline.join=e.outline.join||e.join,e.outline.miter_limit=e.outline.miter_limit||e.miter_limit,e.outline.offset=e.offset;var i=this.styles[e.outline.style];i?(e.outline.dash=void 0!==e.outline.dash?e.outline.dash:i.dash,e.outline.texture=void 0!==e.outline.texture?e.outline.texture:i.texture,null!=e.outline.dash?(e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash,r),e.outline.texture_merged=e.outline.dash_key):null===e.outline.dash||null!=e.outline.texture?(e.outline.dash_key=null,e.outline.texture_merged=e.outline.texture):(e.outline.dash=e.dash,e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash,r),e.outline.texture_merged=e.outline.dash_key),e.outline.dash_background_color=void 0!==e.outline.dash_background_color?e.outline.dash_background_color:i.dash_background_color,e.outline.dash_background_color=void 0!==e.outline.dash_background_color?e.outline.dash_background_color:e.dash_background_color,e.outline.dash_background_color=e.outline.dash_background_color&&StyleParser.parseColor(e.outline.dash_background_color),e.outline.texcoords=i.texcoords||e.outline.texture_merged?1:0,this.addMeshVariantForDraw(this.base,e.outline)):(log({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"line 'outline' specifies non-existent draw style '".concat(e.outline.style,"' (or maybe the style is ")+"defined but is missing a 'base' or has another error), skipping outlines in layer"),e.outline=null)}return e},dashTextureKey:function(e,t){return"__dash_"+t+"_"+this.scene_id+"_"+JSON.stringify(e)},getDashTexture:function(e,t){var r=this.dashTextureKey(e,this.sources[t].config.uid);if(null==Lines.dash_textures[r]){Lines.dash_textures[r]=!0;var i=renderDashArray(e,{scale:DASH_SCALE});this.textureManager.create(this.gl,r,{data:i.pixels,height:i.length,width:1,filtering:"nearest"})}},endData:function(e){var t=this;return Style.endData.call(this,e).then((function(r){if(r){r.uniforms.u_has_line_texture=!1,r.uniforms.u_texture=t.textureManager.default,r.uniforms.u_v_scale_adjust=Geo$1.tile_scale;var i=[],n=function(n){var o=r.meshes[n].variant;if(o.texture){var a=r.meshes[n].uniforms=r.meshes[n].uniforms||{};if(a.u_has_line_texture=!0,a.u_texture=o.texture,a.u_texture_ratio=1,o.dash&&(a.u_v_scale_adjust=Geo$1.tile_scale*DASH_SCALE,a.u_dash_background_color=o.dash_background_color||[0,0,0,0]),o.dash_key&&null==Lines.dash_textures[o.dash_key]&&(Lines.dash_textures[o.dash_key]=!0,WorkerBroker.postMessage(t.main_thread_target+".getDashTexture",o.dash,e.source)),null==t.textureManager.textures[o.texture])i.push(t.textureManager.syncTexturesToWorker([o.texture]).then((function(e){var t=e[o.texture];t&&(a.u_texture_ratio=t.height/t.width)})));else{var s=t.textureManager.textures[o.texture];a.u_texture_ratio=s.height/s.width}}};for(var o in r.meshes)n(o);return e.mesh_data[t.name]=r,Promise.all(i).then((function(){return r}))}return r}))},computeVariantForDraw:function(e){var t=e.offset?1:0;return e.dash_key&&(t+=e.dash_key,e.dash_background_color&&(t+=e.dash_background_color)),e.texture_merged&&(t+=e.texture_merged),t=hashString(t+="/"+e.texcoords),e.variantKey=t,{key:t,order:e.variant_order,offset:e.offset?1:0,texcoords:e.texcoords,texture:e.texture_merged,dash:e.dash,dash_key:e.dash_key,dash_background_color:e.dash_background_color}},vertexLayoutForMeshVariant:function(e){if(null==Lines.vertex_layouts[e.key]){var t=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_extrude",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1,static:e.offset?null:[0,0]},{name:"a_scaling",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0,static:e.texcoords?null:[0,0]},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}];Lines.vertex_layouts[e.key]=new VertexLayout(t)}return Lines.vertex_layouts[e.key]},makeVertexTemplate:function(e,t){var r=0;return this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=e.z||0,this.vertex_template[r++]=this.scaleOrder(e.order),this.vertex_template[r++]=0,this.vertex_template[r++]=0,t.variant.offset&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=1024*e.width_scale,this.vertex_template[r++]=1024*e.offset_scale,t.variant.texcoords&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=255*e.color[0],this.vertex_template[r++]=255*e.color[1],this.vertex_template[r++]=255*e.color[2],this.vertex_template[r++]=255*e.color[3],this.selection&&(this.vertex_template[r++]=255*e.selection_color[0],this.vertex_template[r++]=255*e.selection_color[1],this.vertex_template[r++]=255*e.selection_color[2],this.vertex_template[r++]=255*e.selection_color[3]),this.vertex_template},buildLines:function(e,t,r,i,n){if(this.feature_style=this.outline_feature_style,t.outline&&null!=t.outline.color&&null!=t.outline.width.value){var o=this.styles[t.outline.style];o&&o.addFeature(i.feature,t.outline,i)}this.feature_style=this.inline_feature_style;var a=r.vertex_data,s=a.vertex_layout,l=this.makeVertexTemplate(t,r);return buildPolylines$1(e,t.width,a,l,{cap:t.cap,join:t.join,miter_limit:t.miter_limit,extrude_index:s.index.a_extrude,offset_index:s.index.a_offset,texcoord_index:s.index.a_texcoord,texcoord_width:t.texcoord_width,texcoord_normalize:65535,closed_polygon:n&&n.closed_polygon,remove_tile_edges:!t.tile_edges&&n&&n.remove_tile_edges,tile_edge_tolerance:Geo$1.tile_scale*i.tile.pad_scale*2,offset:t.offset,crop_by_tile:this.crop_by_tile})},buildPolygons:function(e,t,r,i){for(var n=0,o=0;o<e.length;o++)n+=this.buildLines(e[o],t,r,i,{closed_polygon:!0,remove_tile_edges:!this.crop_by_tile});return n}});var TEX_COORDS=[[1,1],[1,-1],[-1,1],[-1,-1]];function addVertex(e,t,r,i,n,o,a){var s=t.vertex_template,l=t.vertex_data;if(setAttribute(t,"a_position",e),setAttribute(t,"a_width",t.half_width),t.vertex_layout_index.a_barycentric){var u=[0,0,0];u[r%3]=1,setAttribute(t,"a_barycentric",u)}setAttribute(t,"a_tangents",a[0].concat(a[1])),setAttribute(t,"a_segment",i),setAttribute(t,"a_texcoord",TEX_COORDS[r%4]),setAttribute(t,"a_length",n),setAttribute(t,"a_closed",t.closed?1:0),setAttribute(t,"a_angles",o),l.addVertex(s)}function setAttribute(e,t,r){var i=r.length,n=e.vertex_template,o=e.vertex_layout_index[t],a=0;if(i)for(;a!==i;)n[o+a]=r[a],a++;else n[o+a]=r}function buildPatternBuffer(e,t){for(var r=e.reduce((function(e,t){return e+t})),i=0,n=[],o=0,a=e.length;o<=a;o+=2){var s=Math.max(1e-4,e[o%a]),l=Math.max(1e-4,e[(o+1)%a]);n.push(i,i+s),i+=s+l}for(var u=new Uint8Array(4*t),c=0,h=function(e){var i=r*e/(t-1),o=minIdx(n.map((function(e){return Math.abs(e-i)}))),a=void 0,s=void 0,l=void 0;o%2==0?(a=i<=n[o]?1:0,s=n[o],l=n[o+1]):(a=i>n[o]?2:0,s=n[o-1],l=n[o]),u[c++]=n[o],u[c++]=a,u[c++]=s,u[c++]=l},f=0;f<t;f++)h(f);return u}function minIdx(e){for(var t=e[0],r=0,i=1,n=e.length;i<n;i++)e[i]<t&&(r=i,t=e[i]);return r}var vertex_shader_src="uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform sampler2D u_uniforms;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform vec3 u_map_position;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_index;uniform vec2 u_dash_caps;uniform float u_dash_phase;uniform float u_dash_period;attribute vec4 a_position;attribute vec4 a_color;attribute float a_width;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nattribute vec3 a_barycentric;\n#endif\nattribute vec2 a_normal;attribute float a_length;attribute vec2 a_segment;attribute vec2 a_texcoord;attribute vec2 a_angles;attribute vec4 a_tangents;attribute float a_closed;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#ifndef TANGRAM_HEIGHT_SCALE\nfloat TANGRAM_HEIGHT_SCALE=16.0;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\nconst float PI=3.141592653589793;const float THETA=15.0*PI/180.0;float cross(in vec2 v1,in vec2 v2){return v1.x*v2.y-v1.y*v2.x;}float signed_distance(in vec2 v1,in vec2 v2,in vec2 v3){return cross(v2-v1,v1-v3)/length(v2-v1);}void rotate(in vec2 v,in float angle,out vec2 result){float cosine=cos(angle);float sine=sin(angle);result=vec2(cosine*v.x-sine*v.y,sine*v.x+cosine*v.y);}void main(){\n#pragma tangram: setup\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nfloat linewidth=a_width*2.0;v_angles=a_angles;v_segment=a_segment;v_color=a_color;v_length=a_length;v_texcoord=a_texcoord;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nv_barycentric=a_barycentric;\n#endif\nv_color.a=min(linewidth,v_color.a);linewidth=max(linewidth,1.0);linewidth/=exp2(u_map_position.z-u_tile_origin.w);v_linewidth_and_closed=linewidth*(a_closed>0.0 ?-1.0 : 1.0);if(v_color.a<=0.0){gl_Position=vec4(0.0,0.0,0.0,1.0);return;}float width=ceil(1.25*u_antialias+linewidth)/2.0;vec2 t1=normalize(a_tangents.xy);vec2 t2=normalize(a_tangents.zw);float u=a_texcoord.x;u*=-1.0;float v=a_texcoord.y;vec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.0);if(t1!=t2){float angle=a_texcoord.x==1.0 ? a_angles.x : a_angles.y;vec2 t=normalize(t1+t2);vec2 o=vec2(+t.y,-t.x);float segmentLength=a_segment.y-a_segment.x;float magnitude=width/cos(angle/2.0);float sqMagnitude=magnitude*magnitude;float seg1SqMagnitude=dot(a_tangents.xy,a_tangents.xy);float seg2SqMagnitude=dot(a_tangents.zw,a_tangents.zw);if((abs(magnitude)>linewidth)&&(sqMagnitude>=min(seg1SqMagnitude,seg2SqMagnitude))){if(u==1.0){o=vec2(-t2.y,+t2.x);}else{o=vec2(-t1.y,+t1.x);}magnitude=width;angle=0.0;v_angles.x=0.0;v_angles.y=0.0;}if(u_dash_index>0.0){if((abs(angle)>THETA)){position.xy+=v*width*o/cos(angle/2.0);float s=sign(angle);if(angle<0.0){if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==1.0){position.xy-=2.0*width*t1/sin(angle);u-=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==1.0){position.xy+=2.0*width*t2/sin(angle);u+=2.0*width/sin(angle);}}}else{if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==-1.0){position.xy+=2.0*width*t1/sin(angle);u+=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==-1.0){position.xy-=2.0*width*t2/sin(angle);u-=2.0*width/sin(angle);}}}}else{position.xy+=v*width*o/cos(angle/2.0);if(u==+1.0){u=v_segment.y;}else{u=v_segment.x;}}}else{position.xy+=v*o*magnitude;if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);}else{u=v_segment.x-v*width*tan(angle/2.0);}}v_joinIndicator=(segmentLength+v*width*tan(angle/2.0))/segmentLength;}else{v_joinIndicator=-1.0;vec2 o=vec2(+t1.y,-t1.x);position.xy+=v*width*o;if(u==-1.0){u=v_segment.x-width;position.xy-=width*t1;}else{u=v_segment.y+width;position.xy+=width*t2;}}vec2 t;vec2 curr=a_position.xy;if(a_texcoord.x>=0.0){vec2 next=curr+t2*(v_segment.y-v_segment.x);rotate(t1,+a_angles.x/2.0,t);v_miter.x=signed_distance(curr,curr+t,position.xy);rotate(t2,+a_angles.y/2.0,t);v_miter.y=signed_distance(next,next+t,position.xy);}else{vec2 prev=curr-t1*(v_segment.y-v_segment.x);rotate(t1,-a_angles.x/2.0,t);v_miter.x=signed_distance(prev,prev+t,position.xy);rotate(t2,-a_angles.y/2.0,t);v_miter.y=signed_distance(curr,curr+t,position.xy);}v_distances=vec2(u,v*width);v_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#endif\ngl_Position=position;}",fragment_shader_src="uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_dash_atlas;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_phase;uniform float u_dash_period;uniform float u_dash_index;uniform vec2 u_dash_caps;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;\n#define TANGRAM_NORMAL v_normal\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\n#pragma tangram: utils\nconst float PI=3.141592653589793;const float HALF_PI=PI/2.0;const float THETA=15.0*PI/180.0;/***Compute distance to cap.*@param{int}type The Type of the cap(see CAP_TYPE in pattern_lines)*@param{float}dx The distance of the pixel from the beginning of the line(not straight distance,but along the legs)*@param{float}dy The distance of the pixel from the midline(see v_distances in vertex shader,aka \xb11*half_line_width)*@param{float}aa_radius The distance from the mid-line from where antialiasing starts.*For example for a linewidth 10px width and 2px filter radius it is 10px/2-2px=3px.*@return{float}distance*/float cap(int type,float dx,float dy,float aa_radius){float dist=0.0;dx=abs(dx);dy=abs(dy);if(type==1)dist=sqrt(dx*dx+dy*dy);else if(type==3)dist=(dx+abs(dy));else if(type==2)dist=max(abs(dy),(aa_radius+dx-abs(dy)));else if(type==4)dist=max(dx,dy);else if(type==5)dist=max(dx+aa_radius,dy);return dist;}/***Compute distance to join.*@param{int}type The type of the join(see JOIN_TYPE in pattern_lines)*@param{vec2}segment Interpolated a_segment attribute from the vertex shader*@param{vec2}texcoord Pair of u/v coordinates to identify the 4 different extruded points of the segment.*@param{vec2}distances 2 component vector where:*x is the distance of the pixel from the beginning of the line(along the legs)*y is the  distance of the pixel from the midline(see v_distances in vertex shader,\xb11*half_line_width)*@param{vec2}miter Miter point coordiante*@param{float}miter_limit The miter limit*@param{float}linewidth The width of the line*@return{float}computed distance*/float join(in int type,in vec2 segment,in vec2 texcoord,in vec2 distances,in vec2 miter,in float miter_limit,in float linewidth){float dx=distances.x;float result=abs(distances.y);if((dx<segment.x)||(dx>segment.y)){if(type==1){float s=dx<segment.x ? segment.x : segment.y;result=max(result,length(distances-vec2(s,0.0)));}else{float m=abs(texcoord.x>=0.0 ? miter.x : miter.y);if(type==2){result=max(result,m);}else if(type==0){result=max(result,m-miter_limit*linewidth/2.0);}}}return result;}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\nif(v_color.a<=0.0){discard;}bool solid=(u_dash_index==0.0);bool closed=v_linewidth_and_closed<0.0;float dx=v_distances.x;float dy=v_distances.y;float linewidth=abs(v_linewidth_and_closed);float aa_radius=linewidth/2.0-u_antialias;float dist=0.0;vec2 linecaps=u_linecaps;vec2 dash_caps=u_dash_caps;float line_start=0.0;float line_stop=v_length;if(solid){dist=abs(dy);bool potentialCap=!closed&&v_joinIndicator<0.0;if(potentialCap&&dx<line_start){dist=cap(int(u_linecaps.x),abs(dx),abs(dy),aa_radius);}else if(potentialCap&&dx>line_stop){dist=cap(int(u_linecaps.y),abs(dx)-line_stop,abs(dy),aa_radius);}else{dist=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);}}else{float segment_start=v_segment.x;float segment_stop=v_segment.y;float segment_center=(segment_start+segment_stop)/2.0;float freq=u_dash_period*linewidth;float dash_phase=u_dash_phase-1e-5;float u=mod(dx+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));float dash_center=float(tex.x)*255.0*linewidth;float dash_type=floor(float(tex.y)*255.0+0.5);float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;float dash_start=dx-u+_start;float dash_stop=dx-u+_stop;if((dash_stop<segment_start)&&(dash_caps.x!=5.0)){float u=mod(segment_start+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_start-u+_start;dash_stop=segment_start-u+_stop;}else if((dash_start>segment_stop)&&(dash_caps.y!=5.0)){float u=mod(segment_stop+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_stop-u+_start;dash_stop=segment_stop-u+_stop;}bool discontinuous=((dx<segment_center)&&abs(v_angles.x)>THETA)||((dx>=segment_center)&&abs(v_angles.y)>THETA);float d_join=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);if(closed){line_start+=linewidth/2.0;line_stop-=linewidth/2.0;}if(dash_stop<=line_start){discard;}if(dash_start>=line_stop){discard;}if(discontinuous){if((dash_start>segment_stop)){discard;}if((dash_stop<segment_start)){discard;}if(dash_caps.x==1.0){if((u>_stop)&&(dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){discard;}}if(dash_caps.y==1.0){if((u<_start)&&(dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){discard;}}if((dash_caps.x!=1.0)&&(dash_caps.x!=5.0)){if((dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){float a=v_angles.x/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(segment_start-dx)*cos_a-dy*sin_a;float y=(segment_start-dx)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.x=4.0;}}if((dash_caps.y!=1.0)&&(dash_caps.y!=5.0)){if((dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){float a=v_angles.y/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(dx-segment_stop)*cos_a-dy*sin_a;float y=(dx-segment_stop)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.y=4.0;}}}if((dx<line_start)&&(dash_start<=line_start)&&(dash_stop>line_start)){dist=cap(int(linecaps.x),dx-line_start,dy,aa_radius);}else if((dx>line_stop)&&(dash_stop>line_stop)&&(dash_start<line_stop)){dist=cap(int(linecaps.y),dx-line_stop,dy,aa_radius);}else if(dash_type==1.0){dist=cap(int(dash_caps.x),abs(dash_center-u),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}else if(dash_type==0.0){dist=abs(dy);}else if(dash_type==2.0){dist=cap(int(dash_caps.y),abs(u-dash_center),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}if((dx>line_start)&&(dx<line_stop)){if((dx<=segment_start)&&(dash_start<=segment_start)&&(dash_stop>=segment_start)){dist=d_join;float angle=HALF_PI+v_angles.x;float f=abs((segment_start-dx)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if((dx>segment_stop)&&(dash_start<=segment_stop)&&(dash_stop>=segment_stop)){dist=d_join;float angle=HALF_PI+v_angles.y;float f=abs((dx-segment_stop)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}dist=dist-aa_radius;if(dist>=0.0){if(u_antialias==0.0){discard;}else{color=vec4(color.rgb,exp(-dist*dist)*color.a);}}\n#ifdef TANGRAM_DEBUG_TRIANGLES\nif(any(lessThan(v_barycentric,vec3(0.0085)))){color=vec4(0.0,1.0,0.0,1.0);}\n#endif\ngl_FragColor=color;}",PatternLines=Object.create(Style),CAP_TYPE={round:1,"arrow-tail":2,"arrow-head":3,square:4,butt:5},JOIN_TYPE={miter:0,round:1,bevel:2},PATTERN_MAX_WIDTH=1024,DEFAULT_LINE_CAP=CAP_TYPE.round,DEFAULT_JOIN_TYPE=JOIN_TYPE.miter,DEFAULT_DASH_PATTERN=[0,0],VARIANT_UNIQUE_PROP_NAMES="antialias join linecaps miter_limit dash_index dash dash_caps dash_phase".split(" ");function getHashForStyle(e){for(var t=[],r=0,i=VARIANT_UNIQUE_PROP_NAMES.length;r<i;r++){var n=e[VARIANT_UNIQUE_PROP_NAMES[r]];Array.isArray(n)?t.push(n.join("_")):"boolean"==typeof n?t.push(n?1:0):n&&t.push(n.toString())}return t.join("/")}Object.assign(PatternLines,{name:"pattern-lines",built_in:!0,vertex_shader_src:vertex_shader_src,fragment_shader_src:fragment_shader_src,selection:!0,init:function(){Style.init.apply(this,arguments),this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_DEBUG_TRIANGLES=!1,this.defines.TANGRAM_DEBUG_NO_TEXTURE_FLOAT_SUPPORT=!1,this.styles=this.styles||{},PatternLines.vertex_layouts=[]},calcDistance:function(e,t){return e&&StyleParser.evalCachedDistanceProperty(e,t)||0},calcDash:function(e,t){var r=StyleParser.evalProperty(e.dash,t),i=0;return r&&((r=Array.isArray(r)&&r.length?r:DEFAULT_DASH_PATTERN).length%2==1&&(r=r.concat(r)),i=r.reduce((function(e,t){return e+t})),i=+i||0),{dash:r,dash_period:i}},calcWidth:function(e,t,r){var i=this.calcDistance(e.width,r);return!(i<0)&&(t.width=i*r.units_per_meter_overzoom,!0)},getCapType:function(e,t,r){var i=StyleParser.evalProperty(e,t);return void 0!==CAP_TYPE[i]?CAP_TYPE[i]:r},_parseFeature:function(e,t,r){if(!1!==this.calcWidth(t,this.feature_style,r)){var i=this.parseColor(t.color,r);if(i&&0!==i[3]){var n=this.getCapType(t.cap,r,DEFAULT_LINE_CAP),o=StyleParser.evalProperty(t.join,r),a=+StyleParser.evalProperty(t.miter_limit,r),s=this.calcDash(t,r),l=s.dash,u=s.dash_period,c=Object.assign({color:i,antialias:t.antialias,linecaps:[this.getCapType(t.tail_cap,r,n),this.getCapType(t.head_cap,r,n)],join:void 0!==JOIN_TYPE[o]?JOIN_TYPE[o]:DEFAULT_JOIN_TYPE,miter_limit:a>=0?a:3,dash_index:0===u?0:1,dash:l,dash_caps:[this.getCapType(t.tail_cap,r,n),this.getCapType(t.head_cap,r,n)],dash_phase:+StyleParser.evalProperty(t.dash_phase,r)||0,dash_period:u},this.feature_style);return c.z=t.z&&StyleParser.evalCachedDistanceProperty(t.z||0,r)||StyleParser.defaults.z,c.z*=Geo$1.height_scale,c.extrude=StyleParser.evalProperty(t.extrude,r),c.extrude&&(!0===c.extrude?(c.height=void 0!==e.properties.height?e.properties.height:StyleParser.defaults.height,c.min_height=void 0!==e.properties.min_height?e.properties.min_height:StyleParser.defaults.min_height):"number"==typeof c.extrude?(c.height=c.extrude,c.min_height=0):Array.isArray(c.extrude)&&(c.min_height=c.extrude[0],c.height=c.extrude[1]),c.height*=Geo$1.height_scale,c.min_height*=Geo$1.height_scale),this.addMeshVariantForDraw(this.base,c),c}}},_preprocess:function(e,t){e.color=StyleParser.createColorPropertyCache(e.color),e.width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits),e.width&&e.width.type!==StyleParser.CACHE_TYPE.STATIC&&(e.next_width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits)),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits);var r=+e.antialias;return e.antialias=isNaN(r)?0:r,e},buildRasterTextures:function(e,t){var r=[];for(var i in t.meshes){var n=this.getMeshVariantTypeForDraw({variantKey:i}),o=n.uniforms,a=n.pattern;if(o.u_dash_index){var s="__dash_"+a.join("_")+"_"+e.key+"_"+e.id;r.push({name:s,data:buildPatternBuffer(a,PATTERN_MAX_WIDTH)}),o.u_dash_atlas=s,t.meshes[i].textures=[s]}t.meshes[i].uniforms=o}return t.uniforms=t.uniforms||{},r.length?WorkerBroker.postMessage(this.main_thread_target+".loadTextures",r).then((function(e){return t})):Promise.resolve(t)},loadTextures:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=this.textureManager.textures[i.name];n||(n=this.textureManager.create(this.gl,i.name,{filtering:"nearest",repeat:!0,width:PATTERN_MAX_WIDTH,height:1,data:i.data})),t.push(n.loading)}return Promise.all(t).then((function(e){return e.map((function(e){return e.retain(),e.name}))}))},computeVariantForDraw:function(e){var t=getHashForStyle(e);return e.variantKey=t,{key:t,order:e.variant_order,uniforms:{u_antialias:e.antialias,u_linecaps:e.linecaps,u_linejoin:e.join,u_miter_limit:e.miter_limit,u_dash_index:e.dash_index,u_dash_caps:e.dash_caps,u_dash_phase:e.dash_phase,u_dash_period:e.dash_period},pattern:e.dash}},vertexLayoutForMeshVariant:function(e){if(null==PatternLines.vertex_layouts[e.key]){var t=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_width",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_tangents",size:4,type:gl$1.FLOAT,normalized:!1},{name:"a_segment",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_angles",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.FLOAT,normalized:!0},{name:"a_length",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_closed",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}];this.defines.TANGRAM_DEBUG_TRIANGLES&&t.push({name:"a_barycentric",size:3,type:gl$1.SHORT,normalized:!1}),PatternLines.vertex_layouts[e.key]=new VertexLayout(t)}return PatternLines.vertex_layouts[e.key]},makeVertexTemplate:function(e,t){var r=0;return this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=e.z+e.height||0,this.vertex_template[r++]=this.scaleOrder(e.order),this.vertex_template[r++]=255*e.color[0],this.vertex_template[r++]=255*e.color[1],this.vertex_template[r++]=255*e.color[2],this.vertex_template[r++]=255*e.color[3],this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.selection&&(this.vertex_template[r++]=255*e.selection_color[0],this.vertex_template[r++]=255*e.selection_color[1],this.vertex_template[r++]=255*e.selection_color[2],this.vertex_template[r++]=255*e.selection_color[3]),this.defines.TANGRAM_DEBUG_TRIANGLES&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template},buildLines:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=r.vertex_data,a=o.vertex_layout,s=this.makeVertexTemplate(t,r);return buildPolylines(e,t.width,o,s,a.index,n)},buildPolygons:function(e,t,r,i){for(var n=0,o=0,a=e.length;o<a;o++)n+=this.buildLines(e[o],t,r,i,!0);return n}});var STICK_WIDTH=1;function buildQuadsForPoints(e,t,r,i){var n=i.quad,o=i.quad_normalize,a=i.offset,s=i.offsets,l=i.offsets_alt,u=i.pre_angles,c=i.pre_angles_alt,h=i.angle,f=i.angles,d=i.angles_alt,_=i.is_flat,p=i.elevate_by_altitude,g=i.build_stick_points,m=i.color,y=i.stick_color,v=i.curve,x=i.texcoord_scale,b=i.texcoord_normalize,T=i.pre_angles_normalize,A=i.angles_normalize,E=i.offsets_normalize;o=o||1;var w,S=n[0]/2*o,k=n[1]/2*o,P=[[-S,-k],[S,-k],[S,k],[-S,k]],R=t.vertex_elements,M=t.vertex_count,L=t.vertex_layout.index,O=L.a_texcoord,C=L.a_position,I=L.a_shape,N=L.a_offset,$=L.a_offsets,B=L.a_offsets_alt,F=L.a_pre_angles,z=L.a_pre_angles_alt,D=L.a_angles,U=L.a_angles_alt,G=L.a_is_flat,j=L.a_is_stick,V=L.a_color;if(O){b=b||1;var q=_slicedToArray(x||default_uvs,4),W=q[0],Y=q[1],X=q[2],K=q[3];w=[[W,Y],[X,Y],[X,K],[W,K]]}for(var Z=0,J=e.length,Q=0;Q<J;Q++){var ee=e[Q];if(g){for(var te=STICK_WIDTH/2*o,re=1*o,ie=[[-te,0],[+te,0],[+te,re],[-te,re]],ne=0;ne<4;ne++)O&&(r[O+0]=w[ne][0]*b,r[O+1]=w[ne][1]*b),r[C+0]=ee[0],r[C+1]=ee[1],p&&(r[C+2]=MathUtils$1.clamp(ee[2],0,32767)),r[I+0]=ie[ne][0],r[I+1]=ie[ne][1],r[I+2]=0,r[V+0]=y[0],r[V+1]=y[1],r[V+2]=y[2],r[V+3]=y[3],r[j+0]=255,t.addVertex(r);R.push(M+0),R.push(M+1),R.push(M+2),R.push(M+2),R.push(M+3),R.push(M+0),M+=4,Z+=2}for(var oe=0;oe<4;oe++)O&&(r[O+0]=w[oe][0]*b,r[O+1]=w[oe][1]*b),r[C+0]=ee[0],r[C+1]=ee[1],p&&(r[C+2]=MathUtils$1.clamp(ee[2],0,32767)),r[I+0]=P[oe][0],r[I+1]=P[oe][1],r[I+2]=h,r[V+0]=m[0],r[V+1]=m[1],r[V+2]=m[2],r[V+3]=m[3],r[N+0]=a[0],r[N+1]=a[1],r[G+0]=_?255:0,g&&(r[j+0]=0),v&&(r[F+0]=T*u[0],r[F+1]=T*u[1],r[F+2]=T*u[2],r[F+3]=T*u[3],r[D+0]=A*f[0],r[D+1]=A*f[1],r[D+2]=A*f[2],r[D+3]=A*f[3],r[$+0]=E*s[0],r[$+1]=E*s[1],r[$+2]=E*s[2],r[$+3]=E*s[3],l&&(r[B+0]=E*l[0],r[B+1]=E*l[1],r[B+2]=E*l[2],r[B+3]=E*l[3],r[z+0]=T*c[0],r[z+1]=T*c[1],r[z+2]=T*c[2],r[z+3]=T*c[3],r[U+0]=A*d[0],r[U+1]=A*d[1],r[U+2]=A*d[2],r[U+3]=A*d[3])),t.addVertex(r);R.push(M+0),R.push(M+1),R.push(M+2),R.push(M+2),R.push(M+3),R.push(M+0),M+=4,Z+=2}return Z}var id=0,Label={id_prefix:"",nextLabelId:function(){return"".concat(Label.id_prefix,"/").concat(id++)}};function textLayoutToJSON(e){return{priority:e.priority,collide:e.collide,repeat_distance:e.repeat_distance,repeat_group:e.repeat_group,buffer:e.buffer,italic:e.italic}}var lefts=["left","top-left","bottom-left"],rights=["right","top-right","bottom-right"],tops=["top","top-left","top-right"],bottoms=["bottom","bottom-left","bottom-right"],PointAnchor={computeOffset:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!r||"center"===r)return e;var n=[e[0],e[1]];return i=i||this.default_buffer,this.isLeftAnchor(r)?(n[0]-=t[0]/2,"left"===r&&(n[0]-=i[0])):this.isRightAnchor(r)&&(n[0]+=t[0]/2,"right"===r&&(n[0]+=i[1])),this.isTopAnchor(r)?(n[1]-=t[1]/2,"top"===r&&(n[1]-=i[2])):this.isBottomAnchor(r)&&(n[1]+=t[1]/2,"bottom"===r&&(n[1]+=i[3])),n},alignForAnchor:function(e){if(e&&"center"!==e){if(this.isLeftAnchor(e))return"right";if(this.isRightAnchor(e))return"left"}return"center"},isLeftAnchor:function(e){return lefts.indexOf(e)>-1},isRightAnchor:function(e){return rights.indexOf(e)>-1},isTopAnchor:function(e){return tops.indexOf(e)>-1},isBottomAnchor:function(e){return bottoms.indexOf(e)>-1},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function encircleLine(e,t,r,i,n){var o=[],a=r-e,s=i-t,l=MathUtils$1.getLineLength(e,t,r,i),u=2*n,c=l/u;if(c<=1)o.push(e+a/2,t+s/2,n);else{var h=u/l,f=a*h,d=s*h;(c=l/n/2)%1&&o.push(r-f/2,i-d/2,n),c|=0;for(var _=e+f/2,p=t+d/2;c--;)o.push(_,p,n),_+=f,p+=d}return o}var LabelPoint=function(){function e(t,r,i,n){_classCallCheck(this,e),this.id=Label.nextLabelId(),this.position=[t[0],t[1]],void 0!==t[2]&&this.position.push(t[2]),this.size=r,this.layout=n,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.type="point",this.parent=this.layout.parent,this.offset=this.computeOffset(),this.align=this.layout.align||PointAnchor.alignForAnchor(this.anchor),this._is_flat=i}return _createClass(e,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,align:this.align,sides:this.getSides(),breach:!this.inTileBounds(),layout:textLayoutToJSON(this.layout)}}},{key:"inTileBounds",value:function(){var e=this.getAABB(),t=e.left,r=e.top,i=e.right,n=e.bottom;return Utils$1.pointInTile([t,r])&&Utils$1.pointInTile([i,n])}},{key:"isFlat",value:function(){return this._is_flat}},{key:"setAnchor",value:function(e){this._circles=void 0,this._aabb=void 0,this.anchor=e,this.offset=this.computeOffset()}},{key:"computeOffset",value:function(){var e=[this.layout.offset[0],this.layout.offset[1]];if(this.parent){var t=this.parent;e=PointAnchor.computeOffset(e,t.size,t.anchor,PointAnchor.zero_buffer),e=PointAnchor.computeOffset(e,t.size,this.anchor,PointAnchor.zero_buffer),t.offset!==StyleParser.zeroPair&&(e===StyleParser.zeroPair?e=t.offset:(e[0]+=t.offset[0],e[1]+=t.offset[1]))}return PointAnchor.computeOffset(e,this.size,this.anchor)}},{key:"getBoundingCircles",value:function(){if(!this.angle)return[];if(!this._circles){var e=this.layout.units_per_pixel,t=this.size[0]/2*e,r=t*Math.cos(this.angle),i=t*Math.sin(this.angle),n=-r,o=-i,a=_slicedToArray(this.position,2),s=a[0],l=a[1];r+=s,i+=l*=-1,n+=s,o+=l;var u=this.size[1]/2*e;this._circles=encircleLine(r,i,n,o,u)}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){var e=this.layout.units_per_pixel,t=(this.size[0]/2+this.layout.buffer[0])*e,r=(this.size[1]/2+this.layout.buffer[1])*e,i=this.position[0]+this.offset[0]*e,n=this.position[1]-this.offset[1]*e;this._aabb={left:i-t,top:n+r,right:i+t,bottom:n-r}}return this._aabb}},{key:"getSides",value:function(){var e=this.getAABB(),t=e.left,r=e.top,i=e.right,n=(r+e.bottom)/2;return[t,n,i,n]}}]),e}();LabelPoint.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var PLACEMENT$1=LabelPoint.PLACEMENT,default_spacing=80;function placePointsOnLine(e,t,r,i){var n=[],o=i.placement,a=Math.max(t[0],t[1])*i.placement_min_length_ratio*i.units_per_pixel;switch(o){case PLACEMENT$1.SPACED:var s=getPositionsAndAngles(e,a,i);if(!s)return[];for(var l=s.positions,u=s.angles,c=0;c<l.length;c++){var h=l[c],f=u[c];if(!0===i.tile_edges||!isCoordOutsideTile(h)){var d=new LabelPoint(h,t,r,i);d.angle=f,n.push(d)}}break;case PLACEMENT$1.VERTEX:for(var _,p,g,m=0;m<e.length-1;m++)_=e[m],p=e[m+1],!0!==i.tile_edges&&isCoordOutsideTile(_)||((g=new LabelPoint(_,t,r,i)).angle=getAngle(_,p,i.angle),n.push(g));(g=new LabelPoint(p,t,r,i)).angle=getAngle(_,p,i.angle),n.push(g);break;case PLACEMENT$1.MIDPOINT:for(var y=0;y<e.length-1;y++){var v=e[y],x=e[y+1],b=[.5*(v[0]+x[0]),.5*(v[1]+x[1])];if((!0===i.tile_edges||!isCoordOutsideTile(b))&&(!a||norm(v,x)>a)){var T=new LabelPoint(b,t,r,i);T.angle=getAngle(v,x,i.angle),n.push(T)}}}return n}function getPositionsAndAngles(e,t,r){var i=r.units_per_pixel,n=(r.placement_spacing||default_spacing)*i,o=getLineLength(e);if(o<=t)return!1;for(var a=Math.max(Math.floor(o/n),1),s=[],l=[],u=.5*(o-(a-1)*n),c=0;c<a;c++){var h=interpolateLine(e,u,t,r),f=h.position,d=h.angle;null!=f&&null!=d&&(s.push(f),l.push(d)),u+=n}return{positions:s,angles:l}}function getAngle(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"auto"===r?Math.atan2(t[0]-e[0],t[1]-e[1]):r}function getLineLength(e){for(var t=0,r=0;r<e.length-1;r++)t+=norm(e[r],e[r+1]);return t}function norm(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function interpolateLine(e,t,r,i){for(var n,o,a=0,s=0;s<e.length-1;s++){var l=e[s],u=e[s+1],c=norm(l,u);if(!(c<=r)&&(a+=c)>t){n=interpolateSegment(l,u,a-t),o=getAngle(l,u,i.angle);break}}return{position:n,angle:o}}function interpolateSegment(e,t,r){var i=r/norm(e,t);return[i*e[0]+(1-i)*t[0],i*e[1]+(1-i)*t[1]]}var TextSettings={key:function(e){return[e.style,e.weight,e.family,e.px_size,e.fill,e.stroke,e.stroke_width,e.transform,e.text_wrap,e.max_lines,e.supersample,e.background_color,e.outline_color,e.outline_width,e.padding,Utils$1.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:null,size:"12px",px_size:12,family:"Helvetica",fill:"white",text_wrap:15,max_lines:5,align:"center",stroke:null,stroke_width:0,background_color:null,outline_color:null,outline_width:0,padding:[0,0,0,0]},compute:function(e,t,r){var i={};if(t.font=t.font||this.defaults,i.can_articulate=t.can_articulate,i.fill=t.font.fill&&Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(t.font.fill,r))||this.defaults.fill,i.style=t.font.style||this.defaults.style,i.weight=t.font.weight||this.defaults.weight,t.font.family?(i.family=t.font.family,i.family!==this.defaults.family&&(i.family+=", "+this.defaults.family)):i.family=this.defaults.family,i.transform=t.font.transform,i.size=t.font.size||this.defaults.size,i.supersample=t.supersample_text?1.5:1,i.px_size=StyleParser.evalCachedProperty(t.font.px_size,r)*i.supersample,0!==i.px_size){t.font.stroke&&t.font.stroke.color&&(i.stroke=Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(t.font.stroke.color,r)||this.defaults.stroke),i.stroke_width=StyleParser.evalCachedProperty(t.font.stroke.width,r)||this.defaults.stroke_width),i.font_css=this.fontCSS(i);var n=t.text_wrap;return null==n&&"line"!==Geo$1.geometryType(e.geometry.type)&&(n=!0),!0===n&&(n=this.defaults.text_wrap),i.text_wrap=n,i.max_lines=t.max_lines||this.defaults.max_lines,i.background_color=t.background&&t.background.color&&!t.can_articulate?Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(t.background.color,r)):this.defaults.background_color,i.outline_color=t.outline&&t.outline.color&&!t.can_articulate?Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(t.outline.color,r)):this.defaults.outline_color,i.outline_width=t.outline&&t.outline.width&&!t.can_articulate?StyleParser.evalCachedProperty(t.outline.width,r):this.defaults.outline_width,i.padding=t.padding&&!t.can_articulate?StyleParser.evalCachedProperty(t.padding,r):this.defaults.padding,i}},fontCSS:function(e){return[e.style,e.weight,e.px_size+"px",e.family].filter((function(e){return e})).join(" ")}},fontfaceobserver_standalone={exports:{}};fontfaceobserver_standalone.exports,function(e){!function(){function t(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function r(e){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function i(e,t){e.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+t+";"}function n(e){var t=e.a.offsetWidth,r=t+100;return e.f.style.width=r+"px",e.c.scrollLeft=r,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t&&(e.g=t,!0)}function o(e,r){function i(){var e=o;n(e)&&e.a.parentNode&&r(e.g)}var o=e;t(e.b,i),t(e.c,i),n(e)}function a(e,t){var r=t||{};this.family=e,this.style=r.style||"normal",this.weight=r.weight||"normal",this.stretch=r.stretch||"normal"}var s=null,l=null,u=null,c=null;function h(){if(null===u){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(e){}u=""!==e.style.font}return u}function f(e,t){return[e.style,e.weight,h()?e.stretch:"","100px",t].join(" ")}a.prototype.load=function(e,t){var n=this,a=e||"BESbswy",u=0,h=t||3e3,d=(new Date).getTime();return new Promise((function(e,t){var _;if(null===c&&(c=!!document.fonts),(_=c)&&(null===l&&(l=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),_=!l),_){_=new Promise((function(e,t){!function r(){(new Date).getTime()-d>=h?t():document.fonts.load(f(n,'"'+n.family+'"'),a).then((function(t){1<=t.length?e():setTimeout(r,25)}),(function(){t()}))}()}));var p=new Promise((function(e,t){u=setTimeout(t,h)}));Promise.race([p,_]).then((function(){clearTimeout(u),e(n)}),(function(){t(n)}))}else!function(e){document.body?e():document.addEventListener?document.addEventListener("DOMContentLoaded",(function t(){document.removeEventListener("DOMContentLoaded",t),e()})):document.attachEvent("onreadystatechange",(function t(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",t),e())}))}((function(){function l(){var t;(t=-1!=g&&-1!=m||-1!=g&&-1!=y||-1!=m&&-1!=y)&&((t=g!=m&&g!=y&&m!=y)||(null===s&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),s=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=s&&(g==v&&m==v&&y==v||g==x&&m==x&&y==x||g==b&&m==b&&y==b)),t=!t),t&&(T.parentNode&&T.parentNode.removeChild(T),clearTimeout(u),e(n))}var c=new r(a),_=new r(a),p=new r(a),g=-1,m=-1,y=-1,v=-1,x=-1,b=-1,T=document.createElement("div");T.dir="ltr",i(c,f(n,"sans-serif")),i(_,f(n,"serif")),i(p,f(n,"monospace")),T.appendChild(c.a),T.appendChild(_.a),T.appendChild(p.a),document.body.appendChild(T),v=c.a.offsetWidth,x=_.a.offsetWidth,b=p.a.offsetWidth,function H(){if((new Date).getTime()-d>=h)T.parentNode&&T.parentNode.removeChild(T),t(n);else{var e=document.hidden;!0!==e&&void 0!==e||(g=c.a.offsetWidth,m=_.a.offsetWidth,y=p.a.offsetWidth,l()),u=setTimeout(H,50)}}(),o(c,(function(e){g=e,l()})),i(c,f(n,'"'+n.family+'",sans-serif')),o(_,(function(e){m=e,l()})),i(_,f(n,'"'+n.family+'",serif')),o(p,(function(e){y=e,l()})),i(p,f(n,'"'+n.family+'",monospace'))}))}))},e.exports=a}()}(fontfaceobserver_standalone);var fontfaceobserver_standaloneExports=fontfaceobserver_standalone.exports,FontFaceObserver=getDefaultExportFromCjs(fontfaceobserver_standaloneExports),FontManager={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(e){var t=this,r=JSON.stringify(e)===this.last_loaded;return e&&!r&&function(){var r=[],i=function(i){Array.isArray(e[i])?e[i].forEach((function(e){return r.push(t.loadFontFace(i,e))})):r.push(t.loadFontFace(i,e[i]))};for(var n in e)i(n);t.last_loaded=JSON.stringify(e),t.fonts_loaded=Promise.all(r.filter((function(e){return e})))}(),this.fonts_loaded},loadFontFace:function(e,t){if(null!=t&&("object"===_typeof(t)||"external"===t)){var r={family:e},i=Promise.resolve();"object"===_typeof(t)&&(Object.assign(r,t),"string"==typeof t.url&&(i=this.injectFontFace(r)));var n=new FontFaceObserver(e,r);return i.then((function(){return n.load()})).then((function(){log("debug","Font face '".concat(e,"' is available"),r)}),(function(){log("debug","Font face '".concat(e,"' is NOT available"),r)}))}},injectFontFace:function(e){var t=this,r=e.family,i=e.url,n=e.weight,o=e.style;void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace);var a=Promise.resolve(i);return"blob:"===i.slice(0,5)&&(a=Utils$1.io(i,6e4,"arraybuffer").then((function(e){var r=new Uint8Array(e);if(t.supports_native_font_loading)return r;for(var i="",n=0;n<r.length;n++)i+=String.fromCharCode(r[n]);return"data:font/opentype;base64,"+btoa(i)}))),a.then((function(e){if(t.supports_native_font_loading){var i;"string"==typeof e?i=new FontFace(r,"url(".concat(encodeURI(e),")"),{weight:n,style:o}):e instanceof Uint8Array&&(i=new FontFace(r,e,{weight:n,style:o})),document.fonts.add(i),log("trace","Adding FontFace to document.fonts:",i)}else{var a="\n                    @font-face {\n                        font-family: '".concat(r,"';\n                        font-weight: ").concat(n||"normal",";\n                        font-style: ").concat(o||"normal",";\n                        src: url(").concat(encodeURI(e),");\n                    }\n                "),s=document.createElement("style");s.appendChild(document.createTextNode("")),document.head.appendChild(s),s.sheet.insertRule(a,0),log("trace","Injecting CSS font face:",a)}}))}},CanvasText=function(){function e(){_classCallCheck(this,e),this.vertical_text_buffer=1,this.horizontal_text_buffer=1,this.layout=layout$1("binary-tree")}return _createClass(e,[{key:"createCanvas",value:function(e,t){var r=document.createElement("canvas");return e&&t&&(r.width=e,r.height=t),r.style.backgroundColor="transparent",r}},{key:"setFont",value:function(e,t){var r=t.font_css,i=t.fill,n=t.stroke,o=t.stroke_width,a=t.px_size,s=t.supersample;this.px_size=a;var l=Utils$1.device_pixel_ratio*s;n&&o>0&&(e.strokeStyle=n,e.lineWidth=o*l),e.fillStyle=i,e.textBaseline="bottom",e.font=r,e.miterLimit=2}},{key:"textSizes",value:function(e,t,r){var i=this;return FontManager.loadFonts().then((function(){return Task.add({type:"textSizes",run:i.processTextSizesTask.bind(i),texts:t,tile_id:e,cursor:{ctx:r,styles:Object.keys(t),texts:null,style_idx:null,text_idx:null}})}))}},{key:"processTextSizesTask",value:function(e){var t=e.cursor,r=e.texts,i=t.ctx;for(t.style_idx=t.style_idx||0;t.style_idx<t.styles.length;){var n=t.styles[t.style_idx];null==t.text_idx&&(t.text_idx=0,t.texts=Object.keys(r[n]));for(var o=r[n],a=!0;t.text_idx<t.texts.length;){var s=t.texts[t.text_idx],l=o[s],u=l.text_settings;if(a&&(this.setFont(i,u),a=!1),l.size=this.textSize(i,n,s,u).size,u.can_articulate){var c=!1,h=!1;if(isTextRTL(s)&&(isTextNeutral(s)?c=!0:h=!0),l.isRTL=c,l.no_curving=h||isTextCurveBlacklisted(s),l.vertical_buffer=this.vertical_text_buffer+u.outline_width+(u.padding[0]+u.padding[2])/2,l.segment_sizes=[],!l.no_curving){var f=splitLabelText(s,c);l.segments=f;for(var d=0;d<f.length;d++)l.segment_sizes.push(this.textSize(i,n,f[d],u).size)}}if(t.text_idx++,!Task.shouldContinue(e))return!1}t.text_idx=null,t.style_idx++}return Task.finish(e,{texts:r}),!0}},{key:"textSize",value:function(t,r,i,n){var o=n.transform,a=n.text_wrap,s=n.max_lines,l=n.stroke_width,u=void 0===l?0:l,c=n.supersample,h=n.padding,f=n.outline_width,d=n.can_articulate;if(e.cache.text[r]=e.cache.text[r]||{},e.cache.text[r][i])return e.cache.stats.text_hits++,e.cache.text[r][i];e.cache.stats.text_misses++,e.cache.text_count++;var _=Utils$1.device_pixel_ratio*c,p=this.applyTextTransform(i,o),g=_*(this.vertical_text_buffer+f+(h[0]+h[2])/2),m=_*(this.horizontal_text_buffer+f+u+(h[1]+h[3])/2),y=2*_,v=this.px_size+y,x=MultiLine.parse(p,a,s,v,t),b=x.height,T=x.width,A=x.lines,E=[T/_,b/_];d||(E[0]+=2*m/_,E[1]+=2*g/_);var w=[T+2*m,b+2*g],S=[w[0]/_,w[1]/_];return e.cache.text[r][i]={lines:A,size:{collision_size:E,texture_size:w,logical_size:S,line_height:v}},e.cache.text[r][i]}},{key:"drawTextMultiLine",value:function(e,t,r,i,n,o){var a=_slicedToArray(r,2),s=a[0],l=a[1],u=Utils$1.device_pixel_ratio*n.supersample,c=n.stroke_width||0,h=n.stroke;n.background_color&&(e.fillStyle=n.background_color,e.fillRect(s,l,i.texture_size[0],i.texture_size[1]));var f=n.outline_width*u,d=n.outline_color;f&&d&&(e.strokeStyle=d,e.lineWidth=f,e.strokeRect(s+f/2,l+f/2,i.texture_size[0]-f,i.texture_size[1]-f)),(n.background_color||f&&d)&&this.setFont(e,n);for(var _=i.line_height,p=l,g=0;g<t.length;g++){var m=t[g];this.drawTextLine(e,m,[s,p],i,n,o),p+=_}if(debugSettings$1.draw_label_collision_boxes){e.save();var y=u*(this.horizontal_text_buffer+n.outline_width+c+(n.padding[1]+n.padding[3])/2),v=u*(this.vertical_text_buffer+n.outline_width+(n.padding[0]+n.padding[2])/2),x=i.collision_size;e.strokeStyle="blue",e.lineWidth=2,e.strokeRect(s+y,l+v,u*x[0],u*x[1]),"curved"===o&&h&&c>0&&e.strokeRect(s+i.texture_size[0]+y,l+v,u*x[0],u*x[1]),e.restore()}if(debugSettings$1.draw_label_texture_boxes){e.save();var b=i.texture_size;e.strokeStyle="green",e.lineWidth=2,e.strokeRect(s+2,l+2,b[0]-4,b[1]-4),"curved"===o&&h&&c>0&&e.strokeRect(s+2+i.texture_size[0],l+2,b[0]-4,b[1]-4),e.restore()}}},{key:"drawTextLine",value:function(e,t,r,i,n,o){var a=_slicedToArray(r,2),s=a[0],l=a[1],u=n.stroke,c=n.stroke_width,h=void 0===c?0:c,f=n.transform,d=n.align,_=n.supersample,p=n.padding,g=n.outline_width,m=Utils$1.device_pixel_ratio*_;d=d||"center";var y,v=i.texture_size,x=i.line_height,b=m*(this.vertical_text_buffer+g),T=m*(this.horizontal_text_buffer+g+h),A=this.applyTextTransform(t.text,f);"left"===d?y=s+T+p[3]*m:"center"===d?y=s+v[0]/2-t.width/2-(p[1]-p[3])*m/2:"right"===d&&(y=s+v[0]-t.width-T-p[1]*m);var E=l+b+x+p[0]*m;if(u&&h>0){var w="curved"===o?v[0]:0;e.strokeText(A,y+w,E)}e.fillText(A,y,E)}},{key:"rasterize",value:function(t,r,i,n,o,a){return Task.removeForTile(i),Task.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:e.returnNoTextures,pause_factor:2,user_moving_view:!1,texts:t,textures:r,texture_prefix:n,gl:o,tile_id:i,texture_manager:a,cursor:{styles:Object.keys(t),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_names:[]}})}},{key:"processRasterizeTask",value:function(e){if(!Task.shouldContinue(e))return!1;for(var t,r=e.cursor,i=e.texts,n=e.textures;r.texture_idx<e.textures.length;){var o=!1;t=n[r.texture_idx];for(var a=this.createCanvas.apply(this,_toConsumableArray(t.texture_size)),s=a.getContext("2d");r.style_idx<r.styles.length;){var l=r.styles[r.style_idx];null==r.text_idx&&(r.text_idx=0,r.texts=Object.keys(i[l]));for(var u=i[l],c=!0;r.text_idx<r.texts.length;){var h=r.texts[r.text_idx],f=u[h],d=f.text_settings;if(c&&(this.setFont(s,d),c=!1),d.can_articulate){f.texcoords=f.texcoords||{};for(var _=0;_<f.type.length;_++){var p=f.type[_];switch(p){case"straight":if(f.textures[_]!==r.texture_idx)continue;var g=f.isRTL?h.split().reverse().join():h,m=t.texcoord_cache[l][g],y=void 0;if(m.texcoord)y=m.texcoord;else{var v=m.texture_position,x=this.textSize(s,l,g,d),b=x.size,T=x.lines;this.drawTextMultiLine(s,T,v,b,d,p),y=e.texture_manager.getTexcoordsForSprite(v,b.texture_size,t.texture_size),m.texcoord=y}f.texcoords[p]={texcoord:y,texture_id:m.texture_id};break;case"curved":var A=f.segments;f.texcoords.curved=[],f.texcoords_stroke=[];for(var E=0;E<A.length;E++)if(f.textures[_][E]===r.texture_idx){var w=A[E],S=t.texcoord_cache[l][w],k=void 0,P=void 0;if(S.texcoord&&S.texcoord_stroke)k=S.texcoord,P=S.texcoord_stroke,f.texcoords_stroke.push(P);else{var R=S.texture_position,M=this.textSize(s,l,w,d),L=M.size,O=M.lines;this.drawTextMultiLine(s,O,R,L,d,p),k=e.texture_manager.getTexcoordsForSprite(R,L.texture_size,t.texture_size),d.stroke&&d.stroke_width>0?P=e.texture_manager.getTexcoordsForSprite([R[0]+L.texture_size[0],R[1]],L.texture_size,t.texture_size):(o=!0,P=e.texture_manager.getTexcoordsForSprite([t.texture_size[0],t.texture_size[1]],[0,0],t.texture_size)),S.texcoord=k,S.texcoord_stroke=P,f.texcoords_stroke.push(P)}f.texcoords.curved.push({texcoord:k,texture_id:S.texture_id})}}}}else{var C=this.textSize(s,l,h,d).lines;for(var I in f.align)f.align[I].texture_id===r.texture_idx&&(this.drawTextMultiLine(s,C,f.align[I].texture_position,f.size,{stroke:d.stroke,stroke_width:d.stroke_width,transform:d.transform,supersample:d.supersample,align:I,background_color:d.background_color,outline_width:d.outline_width,outline_color:d.outline_color,padding:d.padding,fill:d.fill,font_css:d.font_css,px_size:d.px_size}),f.align[I].texcoords=e.texture_manager.getTexcoordsForSprite(f.align[I].texture_position,f.size.texture_size,t.texture_size))}r.text_idx++}r.text_idx=null,r.style_idx++}!0===o&&(s.fillStyle="rgba(0, 0, 0, 0)",s.fillRect(a.width-1,a.height-1,1,1));var N=e.texture_prefix+r.texture_idx;e.texture_manager.create(e.gl,N,{element:a,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),r.texture_names.push(N),r.texture_idx++,r.style_idx=0,a.width=0,a.height=0}return Task.finish(e,r.texture_names),!0}},{key:"setTextureTextPositions",value:function(e){var t={texture_id:0,texcoord_cache:{}},r=[];for(var i in e){var n=e[i];for(var o in n){var a=n[o],s=a.text_settings,l=s.can_articulate,u=s.stroke,c=s.stroke_width;if(l){a.textures=[],t.texcoord_cache[i]=t.texcoord_cache[i]||{};for(var h=0;h<a.type.length;h++){switch(a.type[h]){case"straight":var f=a.isRTL?o.split().reverse().join():o;if(!t.texcoord_cache[i][f]){var d=a.size.texture_size;t.texcoord_cache[i][f]={},this.placeText(d[0],d[1],{can_articulate:l,style:i,word:f})}a.textures[h]=t.texture_id;break;case"curved":a.textures[h]=[];for(var _=0;_<a.segment_sizes.length;_++){var p=a.segments[_];if(!t.texcoord_cache[i][p]){var g=a.segment_sizes[_].texture_size,m=g[0];u&&c>0&&(m*=2),t.texcoord_cache[i][p]={},this.placeText(m,g[1],{can_articulate:l,style:i,word:p})}a.textures[h].push(t.texture_id)}}}}else{var y=a.size.texture_size;this.placeText(y[0],y[1],{can_articulate:l,text_info:a})}}}var v=this.layout.export(),x=v.items,b=v.width,T=v.height;t.texcoord_cache={};for(var A=0,E=x.length;A<E;A++){var w=x[A],S=w.x,k=w.y;if(!w.meta.can_articulate){var P=w.meta.text_info;for(var R in P.align)P.align[R].texture_id=t.texture_id,P.align[R].texture_position=[S,k]}else{var M=w.meta,L=M.style,O=M.word;t.texcoord_cache[L]=t.texcoord_cache[L]||{},t.texcoord_cache[L][O]||(t.texcoord_cache[L][O]={texture_id:t.texture_id,texture_position:[S,k]})}}return b>0&&T>0&&(r[t.texture_id]={texture_size:[b,T],texcoord_cache:t.texcoord_cache}),r}},{key:"placeText",value:function(e,t,r){this.layout.addItem({width:e+this.vertical_text_buffer,height:t+this.vertical_text_buffer,meta:r})}},{key:"applyTextTransform",value:function(e,t){return"capitalize"===t?e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1)})):"uppercase"===t?e.toUpperCase():"lowercase"===t?e.toLowerCase():e}}],[{key:"fontPixelSize",value:function(t){if(null!=t){var r=_slicedToArray((t="string"==typeof t?t:String(t)).match(e.font_size_re)||[],3),i=r[1],n=r[2];return"em"===(n=n||"px")?i*=16:"pt"===n?i/=.75:"%"===n&&(i/=6.25),i=StyleParser.parsePositiveNumber(i),i*=Utils$1.device_pixel_ratio}}},{key:"pruneTextCache",value:function(){e.cache.text_count>e.cache.text_count_max&&(e.cache.text={},e.cache.text_count=0,log("debug","CanvasText: pruning text cache")),Object.keys(e.cache.segment).length>e.cache.segment_count_max&&(e.cache.segment={},log("debug","CanvasText: pruning segment cache"))}}]),e}();CanvasText.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,CanvasText.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}},CanvasText.EMPTY_TEXTURES_ARR=[],CanvasText.returnNoTextures=function(){return CanvasText.EMPTY_TEXTURES_ARR};var rtlDirCheck=new RegExp("[\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc]");function isTextRTL(e){return rtlDirCheck.test(e)}var neutral_chars="\0-/:-@[-`{-\xbf\xd7\xf7\u02b9-\u02ff\u2000-\u2bff\u2010-\u2029\u202c\u202f-\u2bff",neutralDirCheck=new RegExp("["+neutral_chars+"]+");function isTextNeutral(e){return neutralDirCheck.test(e)}var markRTL="\u200f",arabic_range=new RegExp("^["+neutral_chars+"\u0600-\u06ff]+"),arabic_splitters=new RegExp("["+neutral_chars+"\u0622-\u0625\u0627\u062f-\u0632\u0648\u0671-\u0677\u0688-\u0699\u06c4-\u06cb\u06cf\u06d2\u06d3\u06ee\u06ef]"),arabic_vowels=new RegExp("^[\u0610-\u061a\u064b-\u065f\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed]+"),accents_and_vowels="[\u0300-\u036f\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u07a6-\u07b0\u0900-\u0903\u093a-\u094c\u094e\u094f\u0951-\u0957\u0962\u0963\u0981-\u0983\u09bc\u09be-\u09cc\u09d7\u09e2\u09e3\u0a01-\u0a03\u0a3c-\u0a4c\u0a51\u0a81-\u0a83\u0abc\u0abe-\u0acc\u0ae2\u0ae3\u0b01-\u0b03\u0b3c\u0b3e-\u0b4c\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe-\u0bcd\u0bd7\u0c00-\u0c03\u0c3e-\u0c4c\u0c55\u0c56\u0c62\u0c63\u0c81-\u0c83\u0cbc\u0cbe-\u0ccc\u0cd5\u0cd6\u0ce2\u0ce3\u0d01-\u0d03\u0d3e-\u0d4c\u0d4e\u0d57\u0d62\u0d63\u0d82\u0d83\u0dca-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f83\u0f86\u0f87\u0f8d-\u0fbc\u0fc6\u102b-\u1038\u103a-\u103e\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f\u109a-\u109d\u17b4-\u17d1\u17d3\u1a55-\u1a5e\u1a61-\u1a7c\u1dc0-\u1dff\u20d0-\u20ff]",combo_characters="[\u094d\u09cd\u0a4d\u0acd\u0b4d\u0c4d\u0ccd\u0d4d\u0f84\u1039\u17d2\u1a60\u1a7f]",graphemeRegex=new RegExp("^.(?:"+accents_and_vowels+"+)?("+combo_characters+"\\W(?:"+accents_and_vowels+"+)?)*"),curve_blacklist={Mongolian:"\u1800-\u18af"},curve_blacklist_range=Object.keys(curve_blacklist).map((function(e){return curve_blacklist[e]})).join(""),curve_blacklist_test=new RegExp("["+curve_blacklist_range+"]");function isTextCurveBlacklisted(e){return curve_blacklist_test.test(e)}var default_segment_length=2;function splitLabelText(e,t){var r=t?1:default_segment_length;if(e.length<r)return[e];var i=e;if(CanvasText.cache.segment[i])return CanvasText.cache.stats.segment_hits++,CanvasText.cache.segment[i];var n=[];if(arabic_range.exec(e)){n=e.split(arabic_splitters);for(var o=-1,a=0;a<n.length-1;a++){if(a>0){var s=arabic_vowels.exec(n[a]);s&&(n[a]=n[a].substring(s[0].length),n[a-1]+=s[0],o+=s[0].length)}o+=1+n[a].length,n[a]+=e.slice(o,o+1)}e=""}for(;e.length;){for(var l="",u=e,c=0;c<r&&u.length;c++){var h=(graphemeRegex.exec(u)||u)[0];l+=h,u=u.substring(h.length)}n.push(l),e=e.substring(l.length)}return t&&n.reverse(),CanvasText.cache.stats.segment_misses++,CanvasText.cache.segment[i]=n,n}var MultiLine=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;_classCallCheck(this,e),this.width=0,this.height=0,this.lines=[],this.max_lines=r,this.text_wrap=i,this.context=t}return _createClass(e,[{key:"createLine",value:function(e){return this.lines.length<this.max_lines&&new Line(e,this.text_wrap)}},{key:"push",value:function(e){if(this.lines.length<this.max_lines){var t=this.context.measureText(e.text).width;return e.width=t,t>this.width&&(this.width=Math.ceil(t)),this.lines.push(e),this.height+=e.height,!0}return this.addEllipsis(),!1}},{key:"advance",value:function(e,t){return!!this.push(e)&&this.createLine(t)}},{key:"addEllipsis",value:function(){var t=this.lines[this.lines.length-1],r=Math.ceil(this.context.measureText(e.ellipsis).width);t.append(e.ellipsis),t.width+=r,t.width>this.width&&(this.width=t.width)}},{key:"finish",value:function(e){e?this.push(e):this.addEllipsis()}}],[{key:"parse",value:function(t,r,i,n,o){var a;a="number"==typeof r?t.split(" "):[t];for(var s=new e(o,i,r),l=s.createLine(n),u=0;u<a.length;u++){for(var c=a[u].split("\n"),h=0===u,f=0;f<c.length&&l;f++){var d=c[f];isTextRTL(d)&&isTextNeutral(d[d.length-1])&&(d+=markRTL);var _=h?d:" "+d;if(r&&u>0&&l.exceedsTextwrap(_)){if(!(l=s.advance(l,n)))break;l.append(d),h=!0}else l.append(_);f<c.length-1&&(l=s.advance(l,n),h=!0)}u===a.length-1&&s.finish(l)}return s}}]),e}();MultiLine.ellipsis="...";var Line=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),this.chars=0,this.text="",this.height=Math.ceil(t),this.text_wrap=r}return _createClass(e,[{key:"append",value:function(e){this.chars+=e.length,this.text+=e}},{key:"exceedsTextwrap",value:function(e){return e.length+this.chars>this.text_wrap}}]),e}(),TextLabels={resetText:function(){this.texts={}},freeText:function(e){delete this.texts[e.id]},parseTextFeature:function(e,t,r,i){var n=this.parseTextSource(e,t,r);if(null!=n&&""!==n){var o=TextSettings.compute(e,t,r);if(o){var a=TextSettings.key(o);this.texts[i.id]=this.texts[i.id]||{};var s=this.texts[i.id][a]=this.texts[i.id][a]||{};if(n instanceof Object){var l=[],u=n.left+"-"+n.right;for(var c in n){var h=n[c];if(h){var f=this.computeTextLayout({},e,t,r,i,h,o,u,c);s[h]||(s[h]={text_settings:o,ref:0}),l.push({draw:t,text:h,text_settings_key:a,layout:f})}}return l.length>0&&l}var d=this.computeTextLayout({},e,t,r,i,n,o);return s[n]||(s[n]={text_settings:o,ref:0}),{draw:t,text:n,text_settings_key:a,layout:d}}}},parseTextSource:function(e,t,r){var i,n=t.text_source||"name";if(null!=n&&"object"===_typeof(n))for(var o in i={},n)i[o]=this.parseTextSourceValue(n[o],e,r);else i=this.parseTextSourceValue(n,e,r);return i},parseTextSourceValue:function(e,t,r){var i;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("string"==typeof e[n]?i=t.properties[e[n]]:"function"==typeof e[n]&&(i=e[n](r)),i)return i}else"string"==typeof e?i=t.properties[e]:e instanceof Function&&(i=e(r));return i},prepareTextLabels:function(e,t,r){var i=this;return 0===Object.keys(this.texts[e.id]||{}).length?Promise.resolve([]):WorkerBroker.postMessage(this.main_thread_target+".calcTextSizes",e.id,this.texts[e.id]).then((function(t){var n=t.texts;return e.canceled?(log("trace","Style ".concat(i.name,": stop tile build because tile was canceled: ").concat(e.key,", post-calcTextSizes()")),[]):(i.texts[e.id]=n||[],n?i.buildTextLabels(e,r):(Collision.abortTile(e.id),[]))}))},collideAndRenderTextLabels:function(e,t,r){var i=this;return this.prepareTextLabels(e,t,r).then((function(r){return 0===r.length?(Collision.collide([],t,e.id),Promise.resolve({})):Collision.collide(r,t,e.id).then((function(t){if(e.canceled)return log("trace","stop tile build because tile was canceled: ".concat(e.key,", post-collide()")),{};var r=i.texts[e.id];return null==r||0===t.length?{}:(i.cullTextStyles(r,t),t.forEach((function(e){var t=e.text_settings_key,i=r[t]&&r[t][e.text];i.text_settings.can_articulate?(i.type||(i.type=[]),-1===i.type.indexOf(e.label.type)&&i.type.push(e.label.type)):(i.align=i.align||{},i.align[e.label.align]={})})),{labels:t,texts:r,textures:[]})}))}))},cullTextStyles:function(e,t){for(var r=0;r<t.length;r++){var i=t[r];e[i.text_settings_key][i.text].ref++}for(var n in e)for(var o in e[n])e[n][o].ref<1&&delete e[n][o];for(var a in e)0===Object.keys(e[a]).length&&delete e[a]},calcTextSizes:function(e,t){return this._canvas_text||(this._canvas_text=new CanvasText,this._canvas_ctx_for_sizes=this._canvas_text.createCanvas().getContext("2d")),this._canvas_text.textSizes(e,t,this._canvas_ctx_for_sizes)},preprocessText:function(e){if(e&&e.font&&"object"===_typeof(e.font))return e.font.fill=StyleParser.createPropertyCache(e.font.fill),e.font.stroke&&(e.font.stroke.color=StyleParser.createPropertyCache(e.font.stroke.color)),e.background&&e.background.color&&(e.background.color=StyleParser.createPropertyCache(e.background.color)),e.outline&&(e.outline.color&&(e.outline.color=StyleParser.createPropertyCache(e.outline.color)),e.outline.width&&(e.outline.width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parsePositiveNumber))),e.padding&&(Array.isArray(e.padding)?2===e.padding.length&&(e.padding=[e.padding[0],e.padding[1],e.padding[0],e.padding[1]]):e.padding=Array(4).fill(e.padding),e.padding=StyleParser.createPropertyCache(e.padding,(function(e){return e.map(StyleParser.parsePositiveNumber)}))),e.font.px_size=StyleParser.createPropertyCache(e.font.size||TextSettings.defaults.size,CanvasText.fontPixelSize),e.font.stroke&&null!=e.font.stroke.width&&(e.font.stroke.width=StyleParser.createPropertyCache(e.font.stroke.width,StyleParser.parsePositiveNumber)),e.offset=StyleParser.createPropertyCache(e.offset,(function(e){return Array.isArray(e)&&e.map(StyleParser.parseNumber)})),e.buffer=StyleParser.createPropertyCache(e.buffer,(function(e){return(Array.isArray(e)?e:[e,e]).map(StyleParser.parsePositiveNumber)})),e.repeat_distance=StyleParser.createPropertyCache(e.repeat_distance||Geo$1.tile_size,StyleParser.parsePositiveNumber),e},computeTextLayout:function(e,t,r,i,n,o,a,s,l){var u=e||{};return(u=this.computeLayout(u,t,r,i,n)).repeat_distance&&(s&&(u.repeat_group+="/"+s),u.repeat_group+="/"+o),u.subdiv=n.overzoom2,u.align=r.align,u.italic="normal"!==a.style,"right"===l?u.orientation=1:"left"===l&&(u.orientation=-1),u}};function degToRad(e){return e*Math.PI/180}var PI_OVER_180=Math.PI/180,HORIZON_THRESHOLD_MULTIPLIER=.75,ZOOM_FOR_BOUNDS_EPSILON=.001,NEAR_PLANE=1,LookAtManipulator=function(){function e(t,r){_classCallCheck(this,e),this._min_zoom=H.util.constants.DEFAULT_MIN_ZOOM_LEVEL,this._max_zoom=H.util.constants.DEFAULT_MAX_ZOOM_LEVEL,this._viewport=t,this._center_offset=[],this._center_offset_normalized=[],this._viewport_aspect_ratio=1,this._focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]],this._view_matrix=new Float64Array(16),this._projection_matrix=new Float64Array(16),this._heading_matrix=new Float64Array(16),this._tilt_matrix=new Float64Array(16),this._transformation_matrix=new Float64Array(16),this._camera_matrix=new Float64Array(16),this._lookAtData={position:[0,0,0],zoom:0,tile_level:0,tetragon:void 0,bounds:void 0,unpadded_bounds:void 0,distance:void 0,tilt:0,incline:0,heading:180},this._zoom_direction=0,this._horizon=0,this.handleViewportUpdate(!0),r?this.setLookAtData(r):this._updateMatrices(),ShaderProgram.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_center_offset;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }")}return _createClass(e,[{key:"getZoomForBounds",value:function(e,t,r,i){var n=this.clone(),o=this._max_zoom,a=this._min_zoom,s=(o-a)/2,l=o-s,u=t,c=MathUtils$1.getBBoxCenter(MathUtils$1.getBBox(e));if(void 0===u)u=c;else{var h=c[0]-u[0];Math.abs(h)>Geo$1.half_circumference_meters+1e-8&&(u[0]+=Math.round(h/Geo$1.circumference_meters)*Geo$1.circumference_meters)}for(var f=function(){n.setLookAtData({zoom:l,position:u,tilt:r,heading:i});var t=n.getLookAtData().bounds;if(e.every((function(e){return MathUtils$1.isPointInsidePolygon(e,t)})))a=l;else{var c=_slicedToArray(MathUtils$1.getBBox(t),4),h=c[0],f=c[1],d=c[2],_=c[3];d-h+1e-8>=Geo$1.circumference_meters&&_-f+1e-8>=Geo$1.circumference_meters?a=l:o=l}l=o-(s=(o-a)/2)};s>ZOOM_FOR_BOUNDS_EPSILON;)f();return a}},{key:"setZoomConstraints",value:function(e,t){this._min_zoom=e,this._max_zoom=t,this.setLookAtData(this.getLookAtData())}},{key:"setLookAtData",value:function(e,t){var r,i,n=e.position,o=e.zoom;if(n===r&&e.bounds!==r&&(n=MathUtils$1.getBBoxCenter(MathUtils$1.getBBox(e.bounds))),o===r&&e.bounds!==r&&(o=this.getZoomForBounds(e.bounds,n,e.tilt,e.heading)),t!==r&&(i=n||this.screenToWorld(t)),o!==r){o=MathUtils$1.clamp(o,this._min_zoom,this._max_zoom);var a=Utils$1.zoomToTileLevel(o),s=this._lookAtData.tile_level;a!==s&&(this._zoom_direction=a>s?1:-1),this._lookAtData.zoom=o,this._lookAtData.tile_level=a}if(e.tilt!==r&&(this._lookAtData.tilt=e.tilt),e.heading!==r&&(this._lookAtData.heading=e.heading),t!==r){this._updateMatrices();var l=this.screenToWorld(t);this._lookAtData.position[0]-=l[0]-i[0],this._lookAtData.position[1]-=l[1]-i[1]}else n&&(this._lookAtData.position=n);this._lookAtData.position[2]=0,this._lookAtData.position[1]=MathUtils$1.clamp(this._lookAtData.position[1],-Geo$1.half_circumference_meters,Geo$1.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"getZoomDirection",value:function(){return this._zoom_direction}},{key:"resetZoomDirection",value:function(){this._zoom_direction=0}},{key:"getLookAtData",value:function(){return this._lookAtData}},{key:"handleViewportUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._viewport,r=t.width,i=t.height;this._viewport_aspect_ratio=r/i;var n=this._viewport.center.x-(r/2<<0),o=this._viewport.center.y-(i/2<<0);this._center_offset[0]=n,this._center_offset[1]=o,this._center_offset_normalized[0]=n/r,this._center_offset_normalized[1]=o/-i,e||(this._updateMatrices(),this._updateVisibleBounds())}},{key:"setupMatrices",value:function(e,t){mat4.multiply(e.model_view32,this._view_matrix,e.model),t.uniform("Matrix4fv","u_modelView",e.model_view32),mat3.normalFromMat4(e.normal32,e.model_view32),mat3.invert(e.inverse_normal32,e.normal32),t.uniform("Matrix3fv","u_normalMatrix",e.normal32),t.uniform("Matrix3fv","u_inverseNormalMatrix",e.inverse_normal32)}},{key:"_updateMatrices",value:function(){var e=this._viewport.height*Geo$1.metersPerPixel(this._lookAtData.zoom),t=Utils$1.interpolate(this._lookAtData.zoom,this._focal_length);this._lookAtData.distance=e/2*t;var r=this._lookAtData.position[0],i=this._lookAtData.position[1];mat4.lookAt(this._view_matrix,vec3.fromValues(r,i,0),vec3.fromValues(r,i,-1),vec3.fromValues(0,1,0)),this._heading_matrix=mat4.identity(this._heading_matrix);var n=180-this._lookAtData.heading;n*=PI_OVER_180,this._heading_matrix[0]=Math.cos(n),this._heading_matrix[1]=-Math.sin(n),this._heading_matrix[4]=Math.sin(n),this._heading_matrix[5]=Math.cos(n),this._tilt_matrix=mat4.identity(this._tilt_matrix),n=(n=this._lookAtData.tilt?this._lookAtData.tilt*PI_OVER_180:0)>0?-n:n,this._tilt_matrix[5]=Math.cos(n),this._tilt_matrix[6]=Math.sin(n),this._tilt_matrix[9]=-Math.sin(n),this._tilt_matrix[10]=Math.cos(n),mat4.multiply(this._transformation_matrix,this._tilt_matrix,this._heading_matrix),mat4.multiply(this._view_matrix,this._transformation_matrix,this._view_matrix);var o=2*Math.atan(1/t),a=2*this._lookAtData.distance;this._depth_buffer_adjustment=2/Math.log(a/NEAR_PLANE),mat4.perspective(this._projection_matrix,o,this._viewport_aspect_ratio,NEAR_PLANE,a),this._projection_matrix[8]=2*-this._center_offset_normalized[0],this._projection_matrix[9]=2*-this._center_offset_normalized[1],mat4.translate(this._projection_matrix,this._projection_matrix,vec3.fromValues(0,0,-this._lookAtData.distance)),this._camera_matrix=mat4.multiply(this._camera_matrix,this._projection_matrix,this._view_matrix)}},{key:"_updateVisibleBounds",value:function(){var e=this._viewport,t=e.width,r=e.height,i=e.padding,n=degToRad(this._lookAtData.tilt);if(this._horizon=Math.max((i.top+r)/2-Math.cos(n)*(i.top*(1-Math.sin(n))+r*HORIZON_THRESHOLD_MULTIPLIER),0),this._lookAtData.tetragon=[this.screenToWorld([0,this._horizon]),this.screenToWorld([t,this._horizon]),this.screenToWorld([t,r]),this.screenToWorld([0,r])],this._lookAtData.unpadded_bounds=this._clipAgainstGeoBounds(this._lookAtData.tetragon),0===i.left&&0===i.top&&0===i.right&&0===i.bottom)this._lookAtData.bounds=this._lookAtData.unpadded_bounds;else{var o=i.left,a=Math.max(this._horizon,i.top),s=t-i.right,l=r-i.bottom,u=[this.screenToWorld([o,a]),this.screenToWorld([s,a]),this.screenToWorld([s,l]),this.screenToWorld([o,l])];this._lookAtData.bounds=this._clipAgainstGeoBounds(u)}}},{key:"_clipAgainstGeoBounds",value:function(e){var t=_slicedToArray(MathUtils$1.getBBox(e),4),r=t[0],i=t[1],n=t[2],o=t[3],a=Geo$1.half_circumference_meters,s=[[r-1,+a],[n+1,+a],[n+1,-a],[r-1,-a]],l=MathUtils$1.clipPolygon(s,e)[0],u=_slicedToArray(MathUtils$1.getBBox(l),4);if(r=u[0],i=u[1],n=u[2],o=u[3],n-r>=Geo$1.circumference_meters){var c=(n-r)/2;l=[[c-a,o],[c+a,o],[c+a,i],[c-a,i]]}var h=[];return l&&(h=MathUtils$1.splitLegs(l,a)),h}},{key:"applyPxOffset",value:function(e){var t=_slicedToArray(e,2),r=t[0],i=t[1],n=Math.PI-this._lookAtData.heading*PI_OVER_180,o=Geo$1.metersPerPixel(this._lookAtData.zoom);this._lookAtData.position[0]+=(r*Math.cos(n)+i*Math.sin(n))*o,this._lookAtData.position[1]-=(i*Math.cos(n)-r*Math.sin(n))*o,this._lookAtData.position[1]=MathUtils$1.clamp(this._lookAtData.position[1],-Geo$1.half_circumference_meters,Geo$1.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"screenToWorld",value:function(e){var t=_slicedToArray(e,2),r=t[0],i=t[1],n=this._viewport,o=n.width,a=n.height;return 0===o||0===a?[0,0]:(r-=o/2,i-=a/2,this._clipCoordsToWorldPlaneCoords([2*(r+o/2)/o-1,1-2*(i+a/2)/a,-1,1]))}},{key:"_clipToScreenCoords",value:function(e){var t=this._viewport,r=t.width,i=t.height;return[(.5*e[0]+.5)*r,i-(.5*e[1]+.5)*i]}},{key:"_isScreenPointInViewPort",value:function(e){var t=this._viewport,r=t.width,i=t.height;return e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i}},{key:"worldToScreen",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e[2]||(e[2]=0),r){var i=this._worldToClipCoords(e);t=this._clipToScreenCoords(i)}else{var n=Math.sign(this._lookAtData.position[0]),o=Math.trunc(this._lookAtData.position[0]/Geo$1.circumference_meters+n/2);e[0]+=Geo$1.circumference_meters*o;var a=this._worldToClipCoords(e),s=t=this._clipToScreenCoords(a);this._isScreenPointInViewPort(t)||(a=this._worldToClipCoords([e[0]+Geo$1.circumference_meters,e[1],e[2]]),t=this._clipToScreenCoords(a),this._isScreenPointInViewPort(t)||(a=this._worldToClipCoords([e[0]-Geo$1.circumference_meters,e[1],e[2]]),t=this._clipToScreenCoords(a)),this._isScreenPointInViewPort(t)||(t=s))}return t}},{key:"getHorizon",value:function(){return this._horizon}},{key:"_clipCoordsToWorldPlaneCoords",value:function(e){var t=[],r=this._lookAtData.distance,i=this._lookAtData.position,n=[0,0,r,0],o=0,a=r*Math.sin(PI_OVER_180*this._lookAtData.tilt)*Math.cos(PI_OVER_180*this._lookAtData.heading),s=r*Math.sin(PI_OVER_180*this._lookAtData.tilt)*Math.sin(PI_OVER_180*this._lookAtData.heading),l=new Float64Array(16),u=new Float64Array(16);return mat4.invert(l,this._projection_matrix),vec4.transformMat4(t,e,l),t[2]=-1,t[3]=0,mat4.invert(u,this._view_matrix),vec4.transformMat4(t,t,u),vec4.normalize(t,t),vec4.transformMat4(n,n,this._transformation_matrix),0!==t[2]&&(o=-n[2]/t[2]),vec4.scale(t,t,o),[i[0]+(t[0]+s),i[1]+(t[1]+a)]}},{key:"_worldToClipCoords",value:function(e){var t=[e[0],e[1],e[2],1];return vec4.transformMat4(t,t,this._view_matrix),vec4.transformMat4(t,t,this._projection_matrix),vec4.scale(t,t,1/t[3]),t}},{key:"setupProgram",value:function(e){e.uniform("Matrix4fv","u_projection",this._projection_matrix),e.uniform("3f","u_eye",[0,0,this._lookAtData.distance]),e.uniform("2fv","u_center_offset",this._center_offset_normalized),e.uniform("1f","u_tilt",this._lookAtData.tilt*PI_OVER_180),e.uniform("1f","u_heading",this._lookAtData.heading*PI_OVER_180),e.uniform("1f","u_near_plane",NEAR_PLANE),e.uniform("1f","u_depth_buffer_adjustment",this._depth_buffer_adjustment)}},{key:"getTransformationMatrix",value:function(){return this._transformation_matrix}},{key:"getCameraMatrix",value:function(){return this._camera_matrix}},{key:"clone",value:function(){var t=new e(this._viewport,this._lookAtData);return t.setZoomConstraints(this._min_zoom,this._max_zoom),t}},{key:"getViewport",value:function(){return this._viewport}}]),e}();function getX(e){return void 0===e.x?e[0]:e.x}function getY(e){return void 0===e.y?e[1]:e.y}function xAscendingComparator(e,t){return getX(e)-getX(t)}function yAscendingComparator(e,t){return getY(e)-getY(t)}function sortByX(e){return e.sort(xAscendingComparator)}function sortByY(e){return e.sort(yAscendingComparator)}function getMinMax(e,t){for(var r,i=e[0],n=i,o=0;o<e.length;o+=1)t(r=e[o],i)<0?i=r:t(r,n)>0&&(n=r);return[i,n]}function groupByCoord(e,t){return Object.values(t.reduce((function(t,r){var i=r[+e];return t[i]||(t[i]=[]),t[i].push(r),t}),{}))}function groupByX(e){return groupByCoord(!1,e)}function groupByY(e){return groupByCoord(!0,e)}function createTileRangeByCoord(e,t,r){var i=+e,n=t[i],o=r[i];if(n>o)return[];var a=[t];if(n>o)return a;for(var s=t[(i+1)%2],l=e?function(e){return a.push([s,e])}:function(e){return a.push([e,s])},u=n+1;u<o;u+=1)l(u);return a.push(r),a}function createTileRangeByX(e,t){return createTileRangeByCoord(!1,e,t)}function createTileRangeByY(e,t){return createTileRangeByCoord(!0,e,t)}function deduplicate(e){var t={},r=[];return e.forEach((function(e){var i=e.key||(Array.isArray(e)?"".concat(e[0],"/").concat(e[1]):"".concat(e.x,"/").concat(e.y));t[i]||(t[i]=!0,r.push(e))})),r}function flat(e){return e.reduce((function(e,t){return e.concat(t)}))}function applyMargin(e,t){if(t<=0)return e;var r=function(e){var r=_slicedToArray(getMinMax(e,xAscendingComparator),2),i=r[0],n=r[1],o=[i[0]-t,i[1]],a=[n[0]+t,n[1]];return e.concat(createTileRangeByX(o,i),createTileRangeByX(n,a))},i=function(e){var r=_slicedToArray(getMinMax(e,yAscendingComparator),2),i=r[0],n=r[1],o=[i[0],i[1]-t],a=[n[0],n[1]+t];return e.concat(createTileRangeByY(o,i),createTileRangeByY(n,a))};return deduplicate(function(e){return flat(e.map(r))}(groupByY(flat(groupByX(e).map(i)))))}function constructTiles(e,t,r){return e.map((function(e){var i=_slicedToArray(e,2),n=i[0],o=i[1];return Tile.coord(Geo$1.wrapTile({x:n,y:o,z:t},{x:!r,y:!0}))}))}function getTileGrid(e,t,r){var i=function(t){return Object.values(Geo$1.metersToExactTileCoords(t,e.tile_level))};return deduplicate(constructTiles(applyMargin(rasterizeTetragon(i(e.tetragon[0]),i(e.tetragon[1]),i(e.tetragon[3]),i(e.tetragon[2])),t),e.tile_level,r))}function rasterizeTetragon(e,t,r,i){var n=rasterizeTriangle(t,e,r),o=rasterizeTriangle(r,i,t);return deduplicate(n.concat(o))}function rasterizeTriangle(e,t,r){var i=_slicedToArray(sliceTriangle.apply(void 0,_toConsumableArray(sortByY([e,t,r]))),2),n=i[0],o=i[1];return deduplicate(rasterizeBottomFlatTriangle.apply(void 0,_toConsumableArray(n)).concat(rasterizeTopFlatTriangle.apply(void 0,_toConsumableArray(o))))}function sliceTriangle(e,t,r){var i=_slicedToArray(e,2),n=i[0],o=i[1],a=_slicedToArray(t,2),s=a[0],l=a[1],u=_slicedToArray(r,2),c=u[0],h=u[1],f=n+(l-o)/(h-o)*(c-n);return[[[n,o]].concat(_toConsumableArray(sortByX([[s,l],[f,l]]))),[].concat(_toConsumableArray(sortByX([[s,l],[f,l]])),[[c,h]])]}function rasterizeBottomFlatTriangle(e,t,r){var i=_slicedToArray(e,2),n=i[0],o=i[1],a=_slicedToArray(t,2),s=a[0],l=a[1];return scanFlatTriangle(n,s,_slicedToArray(r,1)[0],o,l)}function rasterizeTopFlatTriangle(e,t,r){var i=_slicedToArray(e,2),n=i[0],o=i[1],a=_slicedToArray(t,1)[0],s=_slicedToArray(r,2);return scanFlatTriangle(s[0],n,a,s[1],o)}var scanStepStatic=.125;function getScanStep(e,t){return scanStepStatic*(t-e)/(Math.ceil(t)-Math.floor(e))}function scanFlatTriangle(e,t,r,i,n){var o=Math.min(e,t),a=Math.max(e,r),s=Math.min(i,n),l=Math.max(i,n);if(Math.floor(i)===Math.floor(n))return scanRow(o,a,i);if(l-s<scanStepStatic)return scanRectangle([o,s],[a,l]);var u=getScanStep(s,l),c=(l-s)/u,h=(t-e)/c,f=(r-e)/c,d=[],_=e,p=e,g=function(e){d=d.concat(scanRow(_,p,Math.floor(e))),_+=h,p+=f};if(i<n)for(var m=s;m<=l;m+=u)g(m);else for(var y=l;y>=s;y-=u)g(y);return deduplicate(d)}function xCoordsToPoints(e,t){return e.map((function(e){return[e,t]}))}function createCoordRange(e,t){var r=Math.floor(e),i=Math.floor(t);if(r>i)return[];if(r===i)return[r];for(var n=[],o=r;o<=i;o+=1)n.push(o);return n}function scanRow(e,t,r){return xCoordsToPoints(createCoordRange(e,t),r)}function scanRectangle(e,t){var r=_slicedToArray(e,2),i=r[0],n=r[1],o=_slicedToArray(t,2),a=o[0],s=o[1],l=createCoordRange(i,a),u=xCoordsToPoints(l,n),c=xCoordsToPoints(l,s);return u.concat(c)}var VIEW_PAN_SNAP_TIME=.5,Z_PRECISION=1e5,View=function(){function e(t,r){_classCallCheck(this,e),subscribeMixin(this),this.scene=t,this.createMatrices(),this.bounds=null,this.center_tile=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={},this.buffer=0,this.wrap=!1!==r.wrapView,this.preserve_tiles_within_zoom=1,this.lookAtManipulator=new LookAtManipulator(r.viewport),this._viewport=r.viewport,this._offset_buffer=[0,0],this.handleViewportUpdate(!0)}return _createClass(e,[{key:"update",value:function(){this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout,this.scene.tile_manager.updateTilesVisibilityCounters()}},{key:"handleViewportUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._viewport,r=t.width,i=t.height;this.size.css={width:r,height:i},this.size.device={width:Math.round(r*Utils$1.device_pixel_ratio),height:Math.round(i*Utils$1.device_pixel_ratio)},this.lookAtManipulator.handleViewportUpdate(),e||this.updateBounds()}},{key:"setLookAtData",value:function(t,r){e._setLookAtDataForManipulator(this.lookAtManipulator,t,r),this.updateBounds()}},{key:"getLookAtData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e._getLookAtDataFromManipulator(this.lookAtManipulator,t)}},{key:"getBestLookAtData",value:function(t,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.lookAtManipulator.clone();return e._setLookAtDataForManipulator(n,t,r),e._getLookAtDataFromManipulator(n,i)}},{key:"getTileLevel",value:function(){return this.lookAtManipulator.getLookAtData().tile_level}},{key:"applyPxOffset",value:function(e){var t=this._offset_buffer;t[0]+=e[0],t[1]+=e[1];var r=Math.abs(t[0]),i=Math.abs(t[1]);if(r>=1||i>=1){var n=~~t[0],o=~~t[1];this.lookAtManipulator.applyPxOffset([r<1?0:n,i<1?0:o]),r>=1&&(t[0]-=n),i>=1&&(t[1]-=o),this.updateBounds()}}},{key:"setPanning",value:function(e){this.panning=e,this.panning||(this.panning_stop_at=+new Date)}},{key:"markUserInput",value:function(){this.user_input_at=+new Date}},{key:"ready",value:function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height}},{key:"updateBounds",value:function(){if(this.markUserInput(),this.ready()){this.center_tile=Geo$1.tileForMeters(this.lookAtManipulator.getLookAtData().position,this.lookAtManipulator.getLookAtData().tile_level);var e=this.lookAtManipulator.screenToWorld([0,this.size.css.height]),t=this.lookAtManipulator.screenToWorld([this.size.css.width,0]);this.bounds={sw:{x:e[0],y:e[1]},ne:{x:t[0],y:t[1]}},this.scene.tile_manager.updateTilesForView(!0),this.trigger("move"),this.scene.requestRedraw()}}},{key:"getTileGridFlatForBBox",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=this.lookAtManipulator.getLookAtData().tile_level,s=Geo$1.tileForMeters([t,e],a),l=Geo$1.tileForMeters([i,r],a);if(s.x-=n,s.y-=n,l.x+=n,l.y+=n,!1===o){var u=(1<<a)-1;s.x=Math.min(Math.max(0,s.x),u),s.y=Math.min(Math.max(0,s.y),u),l.x=Math.min(Math.max(0,l.x),u),l.y=Math.min(Math.max(0,l.y),u)}for(var c=[],h={},f=s.x;f<=l.x;f++)for(var d=s.y;d<=l.y;d++){var _=Tile.coord(Geo$1.wrapTile({x:f,y:d,z:a},{x:!o,y:!0}));h[_.key]||(h[_.key]=!0,c.push(_))}return c}},{key:"getTileGridFlat",value:function(){return this.getTileGridFlatForBBox(this.bounds.ne.y,this.bounds.sw.x,this.bounds.sw.y,this.bounds.ne.x,this.buffer,this.wrap)}},{key:"getTileGridDistorted",value:function(){return getTileGrid(this.lookAtManipulator.getLookAtData(),this.buffer,this.wrap)}},{key:"findVisibleTileCoordinates",value:function(){if(!this.bounds)return[];var e=this.lookAtManipulator.getLookAtData(),t=e.tilt,r=e.heading;return 0===t&&180===r?this.getTileGridFlat():this.getTileGridDistorted()}},{key:"createMatrices",value:function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)}},{key:"setupTile",value:function(e,t){e.setupProgram(this.matrices,t),this.lookAtManipulator.setupMatrices(this.matrices,t)}},{key:"setupProgram",value:function(e){var t=this.lookAtManipulator.getLookAtData();e.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),e.uniform("3fv","u_map_position",[t.position[0],t.position[1],Math.trunc(t.zoom*Z_PRECISION)/Z_PRECISION]),e.uniform("1f","u_meters_per_pixel",Geo$1.metersPerPixel(t.zoom)),e.uniform("1f","u_device_pixel_ratio",Utils$1.device_pixel_ratio),e.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),e.uniform("1i","u_view_panning",this.panning),e.uniform("1f","u_horizon",this.lookAtManipulator.getHorizon()/(this.size.css.height/2)),this.lookAtManipulator.setupProgram(e)}},{key:"isAnimating",value:function(){return this.pan_snap_timer<=VIEW_PAN_SNAP_TIME}},{key:"xyToGeo",value:function(e,t){var r=this.lookAtManipulator.screenToWorld([e,t]),i=_slicedToArray(Geo$1.metersToLatLng(r),2),n=i[0];return{lat:i[1],lng:n}}},{key:"geoToPixel",value:function(e){var t=Geo$1.latLngToMeters([e.lng,e.lat]);t.push(e.alt||0);var r=this.lookAtManipulator.worldToScreen(t);return{x:Math.floor(r[0]),y:Math.floor(r[1])}}},{key:"geoToMeters",value:function(e){var t=_slicedToArray(Geo$1.latLngToMeters([e.lng,e.lat]),2);return{x:t[0],y:t[1],z:e.alt||0}}},{key:"metersToGeo",value:function(e){var t=_slicedToArray(Geo$1.metersToLatLng([e.x,e.y]),2),r=t[0];return{lat:t[1],lng:r,alt:e.z||0}}},{key:"setZoomConstraints",value:function(e,t){this.lookAtManipulator.setZoomConstraints(e,t)}}],[{key:"_setLookAtDataForManipulator",value:function(e,t,r){var i=t.position,n=t.zoom,o=t.tilt,a=t.heading,s=t.bounds,l={zoom:n,tilt:o,heading:a};if(i&&"number"==typeof i.lng&&"number"==typeof i.lat&&(l.position=Geo$1.latLngToMeters([i.lng,i.lat])),s){var u=s.getExterior().getLatLngAltArray(),c=u.length/3,h=Array(c);if(s.getBoundingBox().isCDB())for(var f=u[1],d=0,_=0;_<c;_++){var p=u[3*_+1];if(_>0){var g=p-f;Math.abs(g)>180&&(d+=p>f?-360:360)}f=p,h[_]=Geo$1.latLngToMeters([p+d,u[3*_]])}else for(var m=0;m<c;m++)h[m]=Geo$1.latLngToMeters([u[3*m+1],u[3*m]]);l.bounds=h}e.setLookAtData(l,r)}},{key:"_getLookAtDataFromManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.getLookAtData(),i=r.heading,n=r.incline,o=r.tilt,a=r.zoom,s=r.position,l=r.bounds,u=r.unpadded_bounds,c=_slicedToArray(Geo$1.metersToLatLng(s),2),h=c[0],f=c[1],d=new H.geo.LineString;return(t?u:l).forEach((function(e){var t=Geo$1.metersToLatLng(e);d.pushLatLngAlt(t[1],t[0],0)})),{heading:i,incline:n,tilt:o,zoom:a,bounds:new H.geo.Polygon(d),position:{lat:f,lng:h,alt:s[2]}}}}]),e}(),shaderSrc_pointsVertex="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform bool u_tile_fade_in;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform bool u_view_panning;uniform float u_tilt;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_heading;uniform float u_near_plane;uniform float u_depth_buffer_adjustment;attribute vec4 a_position;attribute vec4 a_shape;attribute vec4 a_color;attribute vec2 a_texcoord;attribute vec2 a_offset;uniform float u_point_type;attribute float a_is_flat;\n#ifdef TANGRAM_IS_TEXT_STYLE\nattribute vec4 a_offsets_alt;attribute vec4 a_pre_angles_alt;attribute vec4 a_angles_alt;attribute vec4 a_offsets;attribute vec4 a_pre_angles;attribute vec4 a_angles;\n#endif\n#ifdef TANGRAM_POINT_DRAW_STICK\nattribute float a_is_stick;attribute float a_stick_height;varying float v_is_stick;\n#endif\nvarying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nattribute float a_outline_edge;attribute vec4 a_outline_color;varying float v_outline_edge;varying vec4 v_outline_color;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#define PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvec2 rotate2D(vec2 _st,float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle))*_st;}vec3 rotateX3D(vec3 _st,float _angle){return mat3(1.,0.,0.,0.,cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle))*_st;}vec3 rotateZ3D(vec3 _st,float _angle){return mat3(cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle),0.,0.,0.,1.)*_st;}\n#ifdef TANGRAM_IS_TEXT_STYLE\nfloat mix4linear(float a,float b,float c,float d,float x){return mix(mix(a,b,3.*x),mix(b,mix(c,d,3.*(max(x,.66)-.66)),3.*(clamp(x,.33,.66)-.33)),step(0.33,x));}\n#endif\nvoid main(){\n#pragma tangram: setup\n#ifndef TANGRAM_SHOW_HIDDEN_LABELS\nif(a_shape.w==0.){gl_Position=vec4(0.,0.,0.,1.);return;}\n#else\nif(a_shape.w==0.){v_label_hidden=1.;}else{v_label_hidden=0.;}\n#endif\nv_alpha_factor=1.0;v_color=a_color;v_texcoord=a_texcoord;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nv_outline_color=a_outline_color;v_outline_edge=a_outline_edge;if(u_point_type==TANGRAM_POINT_TYPE_SHADER){v_outline_color=a_outline_color;v_outline_edge=a_outline_edge;float size=abs(a_shape.x/128.);v_texcoord=sign(a_shape.xy)*(size+1.0)/size;size+=2.0;v_aa_offset=2.0/size;}\n#endif\nvec4 position=u_modelView*vec4(a_position.xyz,1.);vec4 shape=vec4(a_shape.xy,0.,0.);vec2 offset=vec2(a_offset.x,-a_offset.y);\n#ifdef TANGRAM_POINT_DRAW_STICK\nv_is_stick=a_is_stick;float scaled_stick_height=(sin(u_tilt+(1.5*PI))+1.0)*a_stick_height;offset.y+=(1.0-a_is_stick)*scaled_stick_height;\n#endif\nfloat zoom=clamp(u_map_position.z-u_tile_origin.z,0.,1.);float theta=a_shape.z/4096.;float heading=u_heading;float delta=(heading-PI);float new_theta=theta-delta;float reversed=abs(new_theta)>PI/2. ? 1. : 0.;if(a_is_flat==1.0){\n#ifdef TANGRAM_IS_TEXT_STYLE\nif(a_offsets[0]!=0.){vec4 angles_scaled;vec4 pre_angles_scaled;vec4 offsets_scaled;if(reversed==1.){offsets_scaled=a_offsets_alt*4.;angles_scaled=(PI/16384.)*a_angles_alt;pre_angles_scaled=(PI/128.)*a_pre_angles_alt;}else{offsets_scaled=a_offsets*4.;angles_scaled=(PI/16384.)*a_angles;pre_angles_scaled=(PI/128.)*a_pre_angles;}float pre_angle=mix4linear(pre_angles_scaled[0],pre_angles_scaled[1],pre_angles_scaled[2],pre_angles_scaled[3],zoom);float angle=mix4linear(angles_scaled[0],angles_scaled[1],angles_scaled[2],angles_scaled[3],zoom);float offset_curve=mix4linear(offsets_scaled[0],offsets_scaled[1],offsets_scaled[2],offsets_scaled[3],zoom);shape.xy=rotate2D(shape.xy,pre_angle+PI*reversed);shape.x+=offset_curve;shape.xy=rotate2D(shape.xy,angle);shape.xy+=rotate2D(offset,theta);}else{shape.xy=rotate2D(shape.xy+offset*256.,theta+(PI*reversed));}\n#else\nshape.xy=rotate2D(shape.xy+offset*256.,theta);\n#endif\nshape.xy/=pow(2.,4.+(u_map_position.z-u_tile_origin.w));shape=u_modelView*shape;position+=shape;}else{shape.xy/=256.;\n#ifdef TANGRAM_POINT_DRAW_STICK\nshape.y*=1.0+(scaled_stick_height-1.0)*a_is_stick;\n#endif\nshape.xy=rotate2D(shape.xy+offset,theta);}\n#ifdef TANGRAM_FADE_IN_RATE\nif(u_tile_fade_in){v_alpha_factor*=clamp(u_visible_time*TANGRAM_FADE_IN_RATE,0.,1.);}\n#endif\n#ifdef TANGRAM_FADE_ON_ZOOM_OUT\nv_alpha_factor*=clamp(1.+TANGRAM_FADE_ON_ZOOM_OUT_RATE*(u_map_position.z-u_tile_origin.z),0.,1.);\n#endif\nv_world_position=u_model*position;v_world_position.xy+=shape.xy*u_meters_per_pixel;v_world_position=wrapWorldPosition(v_world_position);\n#pragma tangram: position\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);/***Due to the precision loss on depth buffer,we had a z-fighting of translucent points when the distance to the camera was big.*For more information about the problem see: https:*For more information about the fix see: https:*position.z=(2.0*log(position.w/u_near_plane)/log(u_far_plane/u_near_plane)-1.0)*position.w;*/position.z=(log(position.w/u_near_plane)*u_depth_buffer_adjustment-1.0)*position.w;\n#endif\nif(a_is_flat!=1.){position.xy+=shape.xy*position.w*2.*u_device_pixel_ratio/u_resolution;}\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_SHADER){position.xy+=sign(shape.xy)*position.w*u_device_pixel_ratio/u_resolution;}\n#endif\nif(!u_view_panning){snapToPixelGrid(position);}gl_Position=position;}",shaderSrc_pointsFragment="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_texture;uniform float u_point_type;uniform bool u_apply_color_blocks;varying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nvarying vec4 v_outline_color;varying float v_outline_edge;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#ifdef TANGRAM_POINT_DRAW_STICK\nvarying float v_is_stick;\n#endif\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#ifdef TANGRAM_HAS_SHADER_POINTS\nfloat _tangram_antialias(float l,float R){float low=R-v_aa_offset;float high=R+v_aa_offset;return 1.-smoothstep(low,high,l);}\n#endif\nvoid mixTextureColor(inout vec4 color){\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_TEXTURE){color*=texture2D(u_texture,v_texcoord);}else if(u_point_type==TANGRAM_POINT_TYPE_LABEL){color=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);}else if(u_point_type==TANGRAM_POINT_TYPE_SHADER){float outline_edge=v_outline_edge;vec4 outlineColor=v_outline_color;float l=length(v_texcoord);float outer_alpha=_tangram_antialias(l,1.);float fill_alpha=_tangram_antialias(l,1.-v_outline_edge*0.5)*color.a;float stroke_alpha=(outer_alpha-_tangram_antialias(l,1.-v_outline_edge))*outlineColor.a;\n#ifdef TANGRAM_BLEND_ADD\ncolor.a=stroke_alpha+fill_alpha;color.rgb=color.rgb*fill_alpha+outlineColor.rgb*stroke_alpha;\n#else\ncolor.a=stroke_alpha+fill_alpha*(1.-stroke_alpha);color.rgb=mix(color.rgb*fill_alpha,outlineColor.rgb,stroke_alpha)/max(color.a,0.001);\n#endif\n}\n#else\ncolor=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);\n#endif\nif(u_apply_color_blocks){\n#pragma tangram: color\n#pragma tangram: filter\n}color.a*=v_alpha_factor;\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nif(v_label_hidden>0.){color.a*=0.5;color.rgb=vec3(1.,0.,0.);}\n#endif\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY) && !defined(TANGRAM_BLEND_ADD)\nif(color.a<TANGRAM_ALPHA_TEST){discard;}\n#endif\n}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;\n#ifdef TANGRAM_POINT_DRAW_STICK\nif(v_is_stick==0.0){mixTextureColor(color);}\n#else\nmixTextureColor(color);\n#endif\ngl_FragColor=color;}",PLACEMENT=LabelPoint.PLACEMENT,pre_angles_normalize=128/Math.PI,angles_normalize=16384/Math.PI,offsets_normalize=64,texcoord_normalize=65535,Points=Object.create(Style),TANGRAM_POINT_TYPE_TEXTURE=1,TANGRAM_POINT_TYPE_LABEL=2,TANGRAM_POINT_TYPE_SHADER=3,DEFAULT_POINT_SIZE=16;Object.assign(Points,TextLabels),Object.assign(Points,{name:"points",built_in:!0,vertex_shader_src:shaderSrc_pointsVertex,fragment_shader_src:shaderSrc_pointsFragment,selection:!0,collision:!0,blend:"overlay",init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Style.init.call(this,e),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=TANGRAM_POINT_TYPE_TEXTURE,this.defines.TANGRAM_POINT_TYPE_LABEL=TANGRAM_POINT_TYPE_LABEL,this.defines.TANGRAM_POINT_TYPE_SHADER=TANGRAM_POINT_TYPE_SHADER,this.defines.TANGRAM_POINT_DRAW_STICK=!!this.stick,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,debugSettings$1.suppress_label_fade_in||this.suppress_fade?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),debugSettings$1.suppress_snap_animation||(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=1/VIEW_PAN_SNAP_TIME),debugSettings$1.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(e,t,r){var i=r.tile,n={};if(n.color=this.parseColor(t.color,r),n.texture=t.texture,n.label_texture=null,n.color||n.texture){var o;if(this.hasSprites(n)){if(!(o=this.parseSprite(n,t,r)))return;n.texcoords=o.texcoords}if(n.size=t.size,n.size){if(n.size=StyleParser.evalCachedPointSizeProperty(t.size,o,r),null==n.size)return void log({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"'size' includes % and/or ratio-based scaling (".concat(JSON.stringify(t.size.value),"); ")+"these can only applied to sprites, but no sprite was specified, skipping features in layer");"number"==typeof n.size&&(n.size=[n.size,n.size])}else n.size=o&&o.css_size||[DEFAULT_POINT_SIZE,DEFAULT_POINT_SIZE];if(t.outline&&(n.outline_width=StyleParser.evalCachedProperty(t.outline.width,r)||StyleParser.defaults.outline.width,n.outline_color=this.parseColor(t.outline.color,r)),n.outline_edge_pct=0,n.outline_width&&n.outline_color){var a=n.outline_width;n.size[0]+=a,n.size[1]+=a,n.outline_edge_pct=a/Math.min(n.size[0],n.size[1])*2}if(n.size[0]=Math.min(n.size[0],256),n.size[1]=Math.min(n.size[1],256),n.placement=t.placement,n.placement_min_length_ratio=StyleParser.evalCachedProperty(t.placement_min_length_ratio,r),n.placement===PLACEMENT.SPACED&&t.placement_spacing&&(n.placement_spacing=StyleParser.evalCachedProperty(t.placement_spacing,r)),n.angle=StyleParser.evalProperty(t.angle,r)||0,n.elevate_by_altitude=!!t.elevate_by_altitude,n.z=t.z?MathUtils$1.clamp(StyleParser.evalCachedDistanceProperty(t.z,r),0,32767):StyleParser.defaults.z,n.flat=t.flat,n.tile_edges=t.tile_edges,this.computeLayout(n,e,t,r,i),t.stick&&!n.flat){var s=StyleParser.parseNumber(StyleParser.evalProperty(t.stick.height,r));n.stick={color:this.parseColor(t.stick.color,r)||StyleParser.defaults.color,height:s?Math.max(s,0):0}}var l=t.text&&!1!==StyleParser.evalProperty(t.text.visible,r)&&this.parseTextFeature(e,t.text,r,i);Array.isArray(l)&&(l=null,log({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; "+"provided 'text_source' value was ".concat(JSON.stringify(t.text.text_source)))),l&&(l.layout.parent=n,l.layout.priority=t.text.priority?Math.max(l.layout.priority,n.priority+.5):n.priority+.5,l.layout.move_into_tile=!1,Collision.addStyle(this.collision_group_text,i.id)),this.queueFeature({feature:e,draw:t,context:r,style:n,text_feature:l},i),Collision.addStyle(this.collision_group_points,i.id)}},hasSprites:function(e){return e.texture&&this.textureManager.textures[e.texture]&&this.textureManager.textures[e.texture].sprites},getSpriteInfo:function(e,t){var r=this.textureManager.textures[e.texture].sprites[t]&&this.textureManager.getSpriteInfo(e.texture,t);return t&&!r?(this.texture_missing_sprites[e.texture]=this.texture_missing_sprites[e.texture]||{},this.texture_missing_sprites[e.texture][t]||(log("debug","Style: in style '".concat(this.name,"', could not find sprite '").concat(t,"' for texture '").concat(e.texture,"'")),this.texture_missing_sprites[e.texture][t]=!0)):r&&(r.sprite=t),r},parseSprite:function(e,t,r){var i=StyleParser.evalProperty(t.sprite,r);return this.getSpriteInfo(e,i)||this.getSpriteInfo(e,t.sprite_default)},queueFeature:function(e,t){this.tile_data[t.id]&&this.queues[t.id]||this.startData(t),this.queues[t.id]=this.queues[t.id]||[],this.queues[t.id].push(e)},endData:function(e){var t=this;if(e.canceled)return log("trace","Style ".concat(this.name,": stop tile build because tile was canceled: ").concat(e.key)),Promise.resolve();var r=this.queues[e.id];delete this.queues[e.id];var i=[],n=[];return r.forEach((function(e){for(var r=e.style,o=e.feature,a=o.geometry,s=t.buildLabels(r.size,a,r),l=0;l<s.length;l++){var u=s[l],c={feature:o,draw:e.draw,context:e.context,style:r,label:u};if(n.push(c),e.text_feature){var h={feature:o,draw:e.text_feature.draw,context:e.context,text:e.text_feature.text,text_settings_key:e.text_feature.text_settings_key,layout:e.text_feature.layout,point_label:u,linked:c};i.push(h),e.draw.text.optional||(c.linked=h)}}})),Promise.all([Collision.collide(n,this.collision_group_points,e.id).then((function(e){e.forEach((function(e){t.feature_style=e.style,t.feature_style.label=e.label,t.feature_style.linked=e.linked,Style.addFeature.call(t,e.feature,e.draw,e.context)}))})),this.collideAndRenderTextLabels(e,this.collision_group_text,i)]).then((function(r){var i=_slicedToArray(r,2)[1],n=i.labels,o=i.texts;return n&&o&&n.forEach((function(e){var r=e.text_settings_key,i=o[r]&&o[r][e.text],n=t.feature_style;n.label=e.label,n.linked=e.linked,n.size=i.size.logical_size,n.angle=0,e.label.text_data={text_info:i,text_settings_key:r,text:e.text},n.label_texture=t.textureManager.default,Style.addFeature.call(t,e.feature,e.draw,e.context)})),t.freeText(e),Style.endData.call(t,e)}))},_preprocess:function(e){e.color=StyleParser.createColorPropertyCache(e.color),e.texture=void 0!==e.texture?e.texture:this.texture,e.outline&&(e.outline.color=StyleParser.createColorPropertyCache(e.outline.color),e.outline.width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parsePositiveNumber)),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits);try{e.size=StyleParser.createPointSizePropertyCache(e.size)}catch(t){return log({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"".concat(t," (").concat(JSON.stringify(e.size),"), skipping features in layer")),null}return e.offset=StyleParser.createPropertyCache(e.offset,(function(e){return Array.isArray(e)&&e.map(StyleParser.parseNumber)})),e.buffer=StyleParser.createPropertyCache(e.buffer,(function(e){return(Array.isArray(e)?e:[e,e]).map(StyleParser.parsePositiveNumber)})),e.repeat_distance=StyleParser.createPropertyCache(e.repeat_distance,StyleParser.parseNumber),null==e.repeat_group&&(e.repeat_group=e.layers.join("-")),e.placement=PLACEMENT[e.placement&&e.placement.toUpperCase()],null==e.placement&&(e.placement=PLACEMENT.VERTEX),e.placement_spacing=null!=e.placement_spacing?e.placement_spacing:80,e.placement_spacing=StyleParser.createPropertyCache(e.placement_spacing,StyleParser.parsePositiveNumber),e.placement_min_length_ratio=null!=e.placement_min_length_ratio?e.placement_min_length_ratio:1,e.placement_min_length_ratio=StyleParser.createPropertyCache(e.placement_min_length_ratio,StyleParser.parsePositiveNumber),"number"==typeof e.angle?e.angle=e.angle*Math.PI/180:e.angle=e.angle||0,e.text=this.preprocessText(e.text),e.text&&(e.text.variantKey=e.variantKey,e.text.group=e.group,e.text.layers=e.layers,e.text.order=e.order,e.text.repeat_group=e.text.repeat_group||e.repeat_group,e.text.anchor=e.text.anchor||this.default_anchor,e.text.optional="boolean"==typeof e.text.optional&&e.text.optional,e.text.interactive=e.text.interactive||e.interactive),e.stick&&(e.stick.color=StyleParser.createColorPropertyCache(e.stick.color)),e},default_anchor:["bottom","top","right","left"],computeLayout:function(e,t,r,i,n){var o=e||{};o.id=t,o.units_per_pixel=n.units_per_pixel||1,o.collide=!1!==r.collide,o.anchor=r.anchor,o.offset=StyleParser.evalCachedProperty(r.offset,i)||StyleParser.zeroPair,o.buffer=StyleParser.evalCachedProperty(r.buffer,i)||StyleParser.zeroPair,o.repeat_distance=StyleParser.evalCachedProperty(r.repeat_distance,i),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof r.repeat_group?o.repeat_group=r.repeat_group(i):o.repeat_group=r.repeat_group);var a=r.priority;return null!=a?"function"==typeof a&&(a=a(i)):a=-1>>>0,o.priority=a,o},buildTextLabels:function(e,t){for(var r=[],i=0;i<t.length;i++){var n=t[i],o=this.texts[e.id][n.text_settings_key][n.text].size.collision_size;n.label=new LabelPoint(n.point_label.position,o,n.point_label.isFlat(),n.layout),r.push(n)}return r},buildLabels:function(e,t,r){var i=!!r.flat,n=[];if("Point"===t.type)n.push(new LabelPoint(t.coordinates,e,i,r));else if("MultiPoint"===t.type)for(var o=t.coordinates,a=0;a<o.length;++a){var s=o[a];n.push(new LabelPoint(s,e,i,r))}else if("LineString"===t.type)for(var l=placePointsOnLine(t.coordinates,e,i,r),u=0;u<l.length;++u)n.push(l[u]);else if("MultiLineString"===t.type)for(var c=t.coordinates,h=0;h<c.length;h++)for(var f=placePointsOnLine(c[h],e,i,r),d=0;d<f.length;++d)n.push(f[d]);else if("Polygon"===t.type)if(r.placement===PLACEMENT.CENTROID){var _=Geo$1.centroid(t.coordinates);n.push(new LabelPoint(_,e,i,r))}else for(var p=t.coordinates,g=0;g<p.length;g++)for(var m=placePointsOnLine(p[g],e,i,r),y=0;y<m.length;++y)n.push(m[y]);else if("MultiPolygon"===t.type)if(r.placement===PLACEMENT.CENTROID){var v=Geo$1.multiCentroid(t.coordinates);n.push(new LabelPoint(v,e,i,r))}else for(var x=t.coordinates,b=0;b<x.length;b++)for(var T=x[b],A=0;A<T.length;A++)for(var E=placePointsOnLine(T[A],e,i,r),w=0;w<E.length;++w)n.push(E[w]);return n},makeVertexTemplate:function(e,t){var r=e.color||StyleParser.defaults.color,i=t.vertex_data.vertex_layout;if(this.fillVertexTemplate(i,"a_position",0,{size:2}),this.fillVertexTemplate(i,"a_position",e.z||0,{size:1,offset:2}),this.fillVertexTemplate(i,"a_position",this.scaleOrder(e.order),{size:1,offset:3}),this.fillVertexTemplate(i,"a_shape",0,{size:4}),this.fillVertexTemplate(i,"a_shape",e.label.layout.collide?0:1,{size:1,offset:3}),this.fillVertexTemplate(i,"a_texcoord",0,{size:2}),this.fillVertexTemplate(i,"a_offset",0,{size:2}),this.fillVertexTemplate(i,"a_color",Vector$1.mult(r,255),{size:4}),this.defines.TANGRAM_HAS_SHADER_POINTS&&t.variant.shader_point){var n=e.outline_color||StyleParser.defaults.outline.color;this.fillVertexTemplate(i,"a_outline_color",Vector$1.mult(n,255),{size:4}),this.fillVertexTemplate(i,"a_outline_edge",e.outline_edge_pct||StyleParser.defaults.outline.width,{size:1})}return this.selection&&this.fillVertexTemplate(i,"a_selection_color",Vector$1.mult(e.selection_color,255),{size:4}),this.fillVertexTemplate(i,"a_is_flat",0,{size:1}),this.defines.TANGRAM_POINT_DRAW_STICK&&e.stick&&(this.fillVertexTemplate(i,"a_is_stick",0,{size:1}),this.fillVertexTemplate(i,"a_stick_height",e.stick.height,{size:1})),this.vertex_template},buildQuad:function(e,t,r,i,n,o,a,s,l,u,c,h,f,d,_,p,g,m,y){return t[0]<=0||t[1]<=0?0:buildQuadsForPoints(e,_,p,{quad:t,quad_normalize:256,offset:s,offsets:l,offsets_alt:u,pre_angles:o,pre_angles_alt:a,angle:4096*r,angles:i,angles_alt:n,is_flat:f,elevate_by_altitude:d,build_stick_points:g,stick_color:g&&Vector$1.mult(m,255),color:Vector$1.mult(y||StyleParser.defaults.color,255),curve:h,texcoord_scale:c,texcoord_normalize:texcoord_normalize,pre_angles_normalize:pre_angles_normalize,angles_normalize:angles_normalize,offsets_normalize:offsets_normalize})},build:function(e,t,r){var i=e.label;return"curved"===i.type?this.buildCurvedLabel(i,e,t,r):this.buildStraightLabel(i,e,t,r)},buildStraightLabel:function(e,t,r,i){var n,o,a=this.makeVertexTemplate(t,r),s=e.angle||t.angle;"point"!==e.type?(n=t.size[e.type],o=default_uvs):(n=t.size,o=t.texcoords||default_uvs),r.uniforms=r.uniforms||{},t.label_texture?(r.uniforms.u_texture=t.label_texture,r.uniforms.u_point_type=TANGRAM_POINT_TYPE_LABEL,r.uniforms.u_apply_color_blocks=!1):t.texture?(r.uniforms.u_texture=t.texture,r.uniforms.u_point_type=TANGRAM_POINT_TYPE_TEXTURE,r.uniforms.u_apply_color_blocks=!0):(r.uniforms.u_texture=this.textureManager.default,r.uniforms.u_point_type=TANGRAM_POINT_TYPE_SHADER,r.uniforms.u_apply_color_blocks=!0);var l=e.offset,u=this.defines.TANGRAM_POINT_DRAW_STICK&&!t.label_texture&&t.stick&&t.stick.height>0,c=this.buildQuad([e.position],n,s,null,null,null,null,l,null,null,o,!1,e.isFlat(),t.elevate_by_altitude,r.vertex_data,a,u,u&&t.stick.color,t.color),h=t.linked&&t.linked.label.id;return this.trackLabel(e,h,r,c,i,u),c},buildCurvedLabel:function(e,t,r,i){for(var n=this.makeVertexTemplate(t,r),o=e.angle,a=0,s=!1,l=0;l<2;l++)for(var u=0;u<e.num_segments;u++){var c=t.size[e.type][u],h=default_uvs,f=this.getTileMesh(i.tile,this.getMeshVariantTypeForDraw(t));f.uniforms=f.uniforms||{},f.uniforms.u_texture=t.label_texture,f.uniforms.u_point_type=TANGRAM_POINT_TYPE_LABEL,f.uniforms.u_apply_color_blocks=!1;var d=e.offset||[0,0],_=e.position,p=e.angles[u],g=e.offsets[u],m=e.pre_angles[u],y=e.num_segments-u-1,v=e.alt_angles[y],x=e.alt_pre_angles[y],b=e.alt_offsets[y],T=this.buildQuad([_],c,o,p,v,m,x,d,g,b,h,!0,e.isFlat(),t.elevate_by_altitude,f.vertex_data,n,s,s,t.color);a+=T;var A=t.linked&&t.linked.label.id;this.trackLabel(e,A,r,T,i,s)}return a},trackLabel:function(e,t,r,i,n){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r.labels=r.labels||{},r.labels.collision=r.labels.collision||{},r.labels["non-collision"]=r.labels["non-collision"]||{};var a=e.layout.collide?r.labels.collision:r.labels["non-collision"];a[e.id]=a[e.id]||{container:{label:e.text_data?Object.assign(e.toJSON(),{text_data:e.text_data}):e.toJSON(),linked:t},ranges:[]};var s=2*i,l=r.vertex_data.offset-r.vertex_data.stride*s;a[e.id].ranges.push([l,s,o])},buildLines:function(e,t,r,i){return this.build(t,r,i)},buildPoints:function(e,t,r,i){return this.build(t,r,i)},buildPolygons:function(e,t,r,i){return this.build(t,r,i)},vertexLayoutForMeshVariant:function(e){if(!this.vertex_layout){var t=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_shape",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_outline_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0,static:[0,0,0,0]},{name:"a_outline_edge",size:1,type:gl$1.FLOAT,normalized:!1,static:0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0}];this.defines&&this.defines.TANGRAM_POINT_DRAW_STICK&&t.push({name:"a_is_stick",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_stick_height",size:1,type:gl$1.FLOAT,normalized:!1}),this.vertex_layout=new VertexLayout(t),(t=t.map((function(e){return Object.assign({},e)}))).forEach((function(e){"a_outline_color"!==e.name&&"a_outline_edge"!==e.name||(e.static=null)})),this.vertex_layout_shader_point=new VertexLayout(t)}return e.shader_point?this.vertex_layout_shader_point:this.vertex_layout},computeVariantForDraw:function(e){var t=e.label_texture||e.texture||this.default_mesh_variant.key;return{key:t,shader_point:t===this.default_mesh_variant.key,order:e.label_texture?1:0}},makeMesh:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=Object.assign({},r,{fade_in_time:this.fade_in_time}),Style.makeMesh.call(this,e,t,r)}});var STOPS=[0,.33,.66,.99],LINE_EXCEED_STRAIGHT=1.5,LINE_EXCEED_STRAIGHT_NO_CURVE=1.8,LINE_EXCEED_STAIGHT_LOOSE=2.3,STRAIGHT_ANGLE_TOLERANCE=.1,CURVE_MIN_TOTAL_COST=1.3,CURVE_MIN_AVG_COST=.4,CURVE_MAX_ANGLE=1,ORIENTED_LABEL_OFFSET_FACTOR=1.2,VERTICAL_ANGLE_TOLERANCE=.01,LabelLine={create:function(e,t,r,i,n){for(var o=[{type:"straight",tolerance:n.no_curving?LINE_EXCEED_STRAIGHT_NO_CURVE:LINE_EXCEED_STRAIGHT},{type:"curved"},{type:"straight",tolerance:LINE_EXCEED_STAIGHT_LOOSE}],a=0;a<o.length;a++){var s=o[a],l=void 0;if("straight"===s.type?l=new LabelLineStraight(t,r,i,n,s.tolerance):"curved"===s.type&&!n.no_curving&&r.length>2&&(l=new LabelLineCurved(e,r,i,n)),l&&!l.throw_away)return l}return!1}},LabelLineBase=function(){function e(t,r){_classCallCheck(this,e),this.id=Label.nextLabelId(),this.layout=r,this.position=[],this.angle=0,this.offset=r.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.type="",this.throw_away=!1,this._is_flat=t,this._circles=void 0,this.placed=null}return _createClass(e,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,layout:textLayoutToJSON(this.layout),circles:this.getBoundingCircles()}}},{key:"inTileBounds",value:function(){var e=this.getAABB(),t=e.left,r=e.top,i=e.right,n=e.bottom;return Utils$1.pointInTile([t,r])&&Utils$1.pointInTile([i,n])}},{key:"getAABBForSegment",value:function(e,t,r,i){var n=this.unit_scale,o=t/2,a=r/2,s=_slicedToArray(e,2),l=s[0],u=s[1];if(0!==this.offset[0]||0!==this.offset[1]){var c=Vector$1.rot(this.offset,this.angle);l+=c[0]*n,u-=c[1]*n}var h=[[Math.cos(i),-Math.sin(i)],[Math.sin(i),Math.cos(i)]],f=Vector$1.multMatrix(h,[-o,-a]),d=Vector$1.multMatrix(h,[o,-a]),_=Vector$1.multMatrix(h,[o,a]),p=Vector$1.multMatrix(h,[-o,a]);return{left:l+Math.min(f[0],d[0],_[0],p[0]),top:u+Math.max(f[1],d[1],_[1],p[1]),right:l+Math.max(f[0],d[0],_[0],p[0]),bottom:u+Math.min(f[1],d[1],_[1],p[1])}}},{key:"isFlat",value:function(){return this._is_flat}},{key:"getBoundingCircles",value:function(){}},{key:"getAABB",value:function(){}}],[{key:"splitLineByOrientation",value:function(e){for(var t=[e[0]],r=0,i=0,n=0,o=t,a=!1,s=1;s<e.length;s++){var l=e[s],u=e[s-1],c=Vector$1.length(Vector$1.sub(l,u));l[0]>u[0]?1===n?(t.push(l),(r+=c)>i&&(o=t,i=r,a=!1)):(t=[u,l],(r=c)>i&&(o=t,i=r,a=!1),n=1):l[0]<u[0]?-1===n?(t.unshift(l),(r+=c)>i&&(o=t,i=r,a=!0)):(t=[l,u],(r=c)>i&&(o=t,i=r,a=!0),n=-1):(-1===n?t.unshift(l):(t.push(l),n=1),(r+=c)>i&&(o=t,i=r,a=-1===n))}return[o,a]}}]),e}(),LabelLineStraight=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i,n,o,a){var s;return _classCallCheck(this,r),(s=t.call(this,n,o)).type="straight",s.size=e,s.throw_away=!s.fit(e,i,o,a),s}return _createClass(r,[{key:"fit",value:function(e,t,r,i){var n,o=this.unit_scale,a=_slicedToArray(LabelLineBase.splitLineByOrientation(t),2);t=a[0],n=a[1],"number"==typeof r.orientation&&(this.offset[1]+=ORIENTED_LABEL_OFFSET_FACTOR*(e[1]-r.vertical_buffer),n&&(this.offset[1]*=-1),-1===r.orientation&&(this.offset[1]*=-1));for(var s=getLineLengths(t),l=e[0]*o,u=0;u<t.length-1;u++)for(var c=t[u],h=0,f=0,d=u+1,_=void 0;d<t.length;){var p=t[d-1],g=t[d],m=getAngleForSegment(p,g);if(d!==u+1&&(h+=getAbsAngleDiff(m,_)),Math.abs(h)>STRAIGHT_ANGLE_TOLERANCE)break;if(calcFitness(f+=s[d-1],l)<i){var y=Vector$1.mult(Vector$1.add(c,g),.5);return this.angle=-m,Math.abs(this.angle-Math.PI/2)<VERTICAL_ANGLE_TOLERANCE&&(this.angle=-Math.PI/2,"number"==typeof r.orientation&&(this.offset[1]*=-1)),this.position=y,this.breach=!this.inTileBounds(),!0}_=m,d++}return!1}},{key:"getBoundingCircles",value:function(){if(!this._circles){var e=this.unit_scale,t=this.size[0]/2*e,r=t*Math.cos(this.angle),i=t*Math.sin(this.angle),n=-r,o=-i,a=this.offset[0]*e,s=this.offset[1]*e,l=_slicedToArray(this.position,2),u=l[0],c=l[1];if(c*=-1,a){var h=[r,i];Vector$1.normalize(h),h[0]*=a,h[1]*=a,u+=h[0],c+=h[1]}if(s){var f=[i,-r];Vector$1.normalize(f),f[0]*=s,f[1]*=s,u-=f[0],c-=f[1]}r+=u,i+=c,n+=u,o+=c;var d=this.size[1]/2*e;this._circles=encircleLine(r,i,n,o,d)}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){var e=this.unit_scale,t=this.size,r=this.layout.buffer,i=(t[0]+2*r[0])*e,n=(t[1]+2*r[1])*e;this._aabb=this.getAABBForSegment(this.position,i,n,this.angle)}return this._aabb}}]),r}(LabelLineBase),LabelLineCurved=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i,n,o){var a;return _classCallCheck(this,r),(a=t.call(this,n,o)).type="curved",a.positions=[],a.angles=[],a._aabbs=[],a.pre_angles=[],a.offsets=[],a.num_segments=e.length,a.sizes=e,a.alt_angles=[],a.alt_pre_angles=[],a.alt_offsets=[],a.throw_away=!a.fit(a.sizes,i,o),a}return _createClass(r,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,breach:this.breach,layout:textLayoutToJSON(this.layout),circles:this.getBoundingCircles()}}},{key:"fit",value:function(e,t,i){var n,o=this.unit_scale,a=Math.max.apply(Math,_toConsumableArray(e.map((function(e){return e[1]})))),s=a*o,l=_slicedToArray(LabelLineBase.splitLineByOrientation(t),2);t=l[0],n=l[1],"number"==typeof i.orientation&&(this.offset[1]+=ORIENTED_LABEL_OFFSET_FACTOR*(a-i.vertical_buffer),n&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));var u=getLineLengths(t),c=e.map((function(e){return e[0]*o})),h=u.reduce((function(e,t){return e+t}),0),f=c.reduce((function(e,t){return e+t}),0);if(f>h)return!1;var d=t.length-1;if(d-0<2)return!1;var _=r.curvaturePlacement(t,h,u,f,0,d),p=t[_];if(-1===_||d-_<2)return!1;this.position=p;for(var g=0;g<c.length;g++){this.positions[g]=[],this.offsets[g]=[],this.angles[g]=[],this.pre_angles[g]=[];for(var m=0;m<STOPS.length;m++){var y=STOPS[m],v=_slicedToArray(r.scaleLine(y,t),2),x=v[0],b=v[1];p=x[_];var T=r.placeAtIndex(_,x,b,c),A=T.positions,E=T.offsets,w=T.angles,S=T.pre_angles,k=E.map((function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])/o}));if(0===y){this.angle=1/w.length*w.reduce((function(e,t){return e+t}));for(var P=0;P<A.length;P++){var R=A[P],M=S[P],L=c[P],O=M+w[P];this._aabbs.push(this.getAABBForSegment(R,L,s,O))}}this.positions[g].push(A[g]),this.offsets[g].push(k[g]),this.angles[g].push(w[g]),this.pre_angles[g].push(S[g])}}c=e.slice().reverse().map((function(e){return e[0]*o}));for(var C=0;C<c.length;C++){this.alt_offsets[C]=[],this.alt_angles[C]=[],this.alt_pre_angles[C]=[];for(var I=0;I<STOPS.length;I++){var N=STOPS[I],$=_slicedToArray(r.scaleLine(N,t),2),B=$[0],F=$[1];p=B[_];var z=r.placeAtIndex(_,B,F,c),D=z.offsets,U=z.angles,G=z.pre_angles,j=D.map((function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])/o}));0===N&&(this.alt_angle=1/U.length*U.reduce((function(e,t){return e+t}))),this.alt_offsets[C].push(j[C]),this.alt_angles[C].push(U[C]),this.alt_pre_angles[C].push(G[C])}}return!0}},{key:"getBoundingCircles",value:function(){if(!this._circles){for(var e=[],t=this.unit_scale,r=0;r<this.positions.length;r++){var i=this.sizes[r],n=this.angles[r][0],o=this.positions[r][0],a=i[0]/2*t,s=a*Math.cos(n),l=a*Math.sin(n),u=-s,c=-l,h=_slicedToArray(o,2),f=h[0],d=h[1],_=encircleLine(s+=f,l+=d*=-1,u+=f,c+=d,i[1]/2*t);Array.prototype.push.apply(e,_)}this._circles=e}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){for(var e=1/0,t=-1/0,r=-1/0,i=1/0,n=0;n<this._aabbs.length;n++){var o=this._aabbs[n];e=Math.min(e,o.left),t=Math.max(t,o.top),r=Math.max(r,o.right),i=Math.min(i,o.bottom)}this._aabb={left:e,top:t,right:r,bottom:i}}return this._aabb}}],[{key:"curvaturePlacement",value:function(e,t,r,i,n,o){n=n||0,o=o||e.length-1;for(var a=[],s=n+1;s<o;s++){var l=e[s-1],u=e[s],c=e[s+1],h=Vector$1.perp(u,l),f=Vector$1.perp(c,u),d=Vector$1.angleBetween(h,f);d>CURVE_MAX_ANGLE&&(d=1/0),a.push(d)}a.push(1/0);for(var _=[],p=[],g=n,m=0,y=0;y<n;y++)m+=r[y];for(;m+i<t;){for(var v=m+i,x=m,b=g,T=0;b<o&&x+r[b]<v&&(T+=a[b])!==1/0;)x+=r[b],b++;if(0===T)return g;var A=T/(b-g);_.push(T),p.push(A),m+=r[g],g++}if(0===_.length)return-1;var E=Math.min.apply(null,_),w=p[_.indexOf(E)];return E<CURVE_MIN_TOTAL_COST&&w<CURVE_MIN_AVG_COST?_.indexOf(E):-1}},{key:"scaleLine",value:function(e,t){var r=[t[0]],i=[];return t.forEach((function(n,o){if(o!==t.length-1){var a=Vector$1.sub(t[o+1],t[o]),s=Vector$1.mult(a,1+e);r.push(Vector$1.add(r[o],s)),i.push(Vector$1.length(s))}})),[r,i]}},{key:"placeAtIndex",value:function(e,t,i,n){var o=t[e],a=_slicedToArray(r.getIndicesAndOffsets(e,i,n),2),s=a[0],l=a[1],u=r.getPositionsFromIndicesAndOffsets(t,s,l),c=_slicedToArray(r.getAnglesFromIndicesAndOffsets(o,s,t,u),3);return{positions:u,offsets:c[0],angles:c[1],pre_angles:c[2]}}},{key:"getIndicesAndOffsets",value:function(e,t,r){for(var i=r.length,n=[],o=[],a=0,s=0,l=0;a<i;){for(var u=r[a];a<i&&s+.5*u<=l+t[e];){var c=s-l+.5*u;o.push(c),n.push(e),s+=u,u=r[++a]}l+=t[e],e++}return[n,o]}},{key:"getPositionsFromIndicesAndOffsets",value:function(e,t,r){for(var i=[],n=0;n<t.length;n++){var o=t[n],a=r[n],s=getAngleForSegment(e[o],e[o+1]),l=Vector$1.rot([a,0],s),u=Vector$1.add(e[o],l);i.push(u)}return i}},{key:"getAnglesFromIndicesAndOffsets",value:function(e,t,r,i){for(var n=[],o=[],a=[],s=0;s<i.length;s++){var l=i[s],u=t[s],c=Vector$1.sub(l,e),h=-Vector$1.angle(c),f=getTextAngleForSegment(r[u],r[u+1])-h;if(s>0){var d=n[s-1],_=o[s-1];Math.abs(h-d)>Math.PI&&(h+=h>d?-2*Math.PI:2*Math.PI),Math.abs(_-f)>Math.PI&&(f+=f>_?-2*Math.PI:2*Math.PI)}n.push(h),o.push(f),a.push(c)}return[a,n,o]}}]),r}(LabelLineBase);function calcFitness(e,t){return t/e}function getAngleForSegment(e,t){var r=Vector$1.sub(t,e);return Vector$1.angle(r)}function getTextAngleForSegment(e,t){return-getAngleForSegment(e,t)}function getLineLengths(e){for(var t=[],r=0;r<e.length-1;r++){var i=e[r],n=e[r+1],o=Math.hypot(i[0]-n[0],i[1]-n[1]);t.push(o)}return t}function getAbsAngleDiff(e,t){var r,i;for(e>t?(r=t,i=e):(r=e,i=t);i-r>Math.PI;)r+=2*Math.PI;return Math.abs(i-r)}var TextStyle=Object.create(Points);Object.assign(TextStyle,{name:"text",super:Points,built_in:!0,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Style.init.call(this,e),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_IS_TEXT_STYLE=!0,this.reset()},makeVertexTemplate:function(e,t){this.super.makeVertexTemplate.apply(this,arguments);var r=t.vertex_data.vertex_layout;return this.fillVertexTemplate(r,"a_pre_angles",0,{size:4}),this.fillVertexTemplate(r,"a_offsets",0,{size:4}),this.fillVertexTemplate(r,"a_angles",0,{size:4}),this.fillVertexTemplate(r,"a_offsets_alt",0,{size:4}),this.fillVertexTemplate(r,"a_pre_angles_alt",0,{size:4}),this.fillVertexTemplate(r,"a_angles_alt",0,{size:4}),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(e,t,r){var i=this,n=r.tile,o=e.geometry.type;t.can_articulate="LineString"===o||"MultiLineString"===o,t.supersample_text="LineString"===o||"MultiLineString"===o;var a=this.parseTextFeature(e,t,r,n);a&&(a instanceof Array?a.forEach((function(t){t.feature=e,t.context=r,t.layout.vertex=!1,i.queueFeature(t,n)})):(a.feature=e,a.context=r,a.layout.vertex=!1,this.queueFeature(a,n)),Collision.addStyle(this.name,n.id))},endData:function(e){var t=this,r=this.queues[e.id];return delete this.queues[e.id],this.collideAndRenderTextLabels(e,this.name,r).then((function(r){var i=r.labels,n=r.texts;return i&&n&&(t.texts[e.id]=n,i.forEach((function(r){var i=r.text_settings_key,n=t.texts[e.id][i]&&t.texts[e.id][i][r.text],o=t.feature_style;o.label=r.label,r.label.text_data={text_info:n,text_settings_key:i,text:r.text},o.label_texture=t.textureManager.default,n.text_settings.can_articulate?(o.size={},"straight"===r.label.type?o.size.straight=n.size.logical_size:o.size.curved=n.segment_sizes.map((function(e){return e.logical_size}))):o.size=n.size.logical_size,Style.addFeature.call(t,r.feature,r.draw,r.context)}))),t.freeText(e),Style.endData.call(t,e).then((function(r){if(r){for(var i in r.meshes)r.meshes[i].uniforms.u_apply_color_blocks=!0;e.mesh_data[t.name]=r}return r}))}))},_preprocess:function(e){return this.preprocessText(e)},buildTextLabels:function(e,t){for(var r=[],i=0;i<t.length;i++){var n=t[i],o=this.texts[e.id][n.text_settings_key][n.text],a=void 0;if(n.layout.vertical_buffer=o.vertical_buffer,o.text_settings.can_articulate){var s=o.segment_sizes.map((function(e){return e.collision_size}));n.layout.no_curving=o.no_curving,a=this.buildLabels(s,n.feature.geometry,n.layout,o.size.collision_size)}else a=this.buildLabels(o.size.collision_size,n.feature.geometry,n.layout);for(var l=0;l<a.length;l++){var u=Object.create(n);u.label=a[l],r.push(u)}}return r},buildLabels:function(e,t,r,i){var n="Point"!==t.type,o=[];if("LineString"===t.type)Array.prototype.push.apply(o,this.buildLineLabels(t.coordinates,e,n,r,i));else if("MultiLineString"===t.type)for(var a=t.coordinates,s=0;s<a.length;++s)Array.prototype.push.apply(o,this.buildLineLabels(a[s],e,n,r,i));else if("Point"===t.type)o.push(new LabelPoint(t.coordinates,e,n,r));else if("MultiPoint"===t.type)for(var l=t.coordinates,u=0;u<l.length;++u)o.push(new LabelPoint(l[u],e,n,r));else if("Polygon"===t.type){var c=Geo$1.centroid(t.coordinates);o.push(new LabelPoint(c,e,n,r))}else if("MultiPolygon"===t.type){var h=Geo$1.multiCentroid(t.coordinates);o.push(new LabelPoint(h,e,n,r))}return o},buildLineLabels:function(e,t,r,i,n){var o=[],a=Math.min(i.subdiv,e.length-1);if(a>1)for(var s=(e.length-1)/a,l=0;l<a;l++){var u=Math.floor(l*s),c=Math.floor((l+1)*s)+1,h=e.slice(u,c),f=LabelLine.create(t,n,h,r,i);f&&o.push(f)}if(o.length<a){var d=LabelLine.create(t,n,e,r,i);d&&o.push(d)}return o},vertexLayoutForMeshVariant:function(){if(!this.vertex_layout){var e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_shape",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_angles",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_offsets",size:4,type:gl$1.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles",size:4,type:gl$1.BYTE,normalized:!1},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_offsets_alt",size:4,type:gl$1.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles_alt",size:4,type:gl$1.BYTE,normalized:!1},{name:"a_angles_alt",size:4,type:gl$1.SHORT,normalized:!1}];this.vertex_layout=new VertexLayout(e)}return this.vertex_layout},getMeshVariantTypeForDraw:Points.getMeshVariantTypeForDraw}),TextStyle.texture_id=0;var RasterStyle=Object.create(Polygons);Object.assign(RasterStyle,{name:"raster",super:Polygons,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1,this.defines.SNAP_TO_PIXEL_GRID=!0},_preprocess:function(e){return e.color=e.color||StyleParser.defaults.color,this.super._preprocess.apply(this,arguments)}});var CustomIcons=Object.create(Points);Object.assign(CustomIcons,{name:"custom_icons",collision:!1,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Points.init.call(this,e)},loadTexture:function(e,t,r){var i,n=e.width,o=e.height,a=e.items,s=document.createElement("canvas"),l=Utils$1.device_pixel_ratio,u=this.sources[t],c={sprites:{}};if(s.width=n*l,s.height=o*l,u){var h,f=a.length,d=s.getContext("2d");for(d.scale(l,l);h=a[--f];){var _=u.getIconBitmapByObjectId(h.meta.objectId,h.meta.id);if(_){var p=isTainting(_);p?log("error",p):(d.drawImage(_,h.x,h.y,h.width,h.height),c.sprites[h.meta.id]=[h.x,h.y,h.width,h.height])}}}return c.element=s,(i=this.textureManager.create(this.gl,r,c)).retain(),i.loading.then((function(e){return e.name}))},buildRasterTextures:function(e,t){return WorkerBroker.postMessage(this.main_thread_target+".loadTexture",e.rasters,e.source,e.texture_name).then((function(e){return t.textures.push(e),t}))},addFeature:function(e,t,r){var i=r.tile.rasters,n={};i.items.forEach((function(e){n[e.meta.id]=[e.x,e.y,e.width,e.height]}));var o="".concat(r.tile.source,"_dyn_").concat(r.tile.coords.key,"_").concat(this.generation,"_").concat(r.tile.id);t.texture=r.tile.texture_name=o;var a=Object.assign({},DEFAULT_TEXTURE_INFO,{name:o,width:i.width,height:i.height,sprites:n,manager:this.textureManager});Texture.prototype.calculateSprites.apply(a),this.textureManager.textures[o]=a,Points.addFeature.apply(this,arguments),delete this.textureManager.textures[o]}});var DEFAULT_TEXTURE_INFO={filtering:"linear",density:1,valid:!0,power_of_2:!1,texcoords:{},sizes:{},css_sizes:{},aspects:{}},OverlayStyle=Object.create(Polygons);Object.assign(OverlayStyle,{name:"overlays",super:Polygons,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selection=e.selection||!0,this.raster=this.raster||"color",this.super.init.apply(this,arguments)},setupRasters:function(){if(!Thread.is_main)return!1;if(this.super.setupRasters.call(this))return!0;var e=!1;for(var t in this.sources)if(this.sources[t]instanceof ObjectSource){e=!0;break}return!!e&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",shaderSrc_rasters,"Raster"),!0)},loadTextures:function(e,t){var r,i,n,o=this.sources[t],a=e.name;if(e.overlays_config.forEach((function(t){var a=t.texcoords,s=t.id,l=o.getMapObjectById(s),u=l.getBitmap();if(u){var c=isTainting(u=bitmapToCanvas(u,u.width,u.height));c?log("error",c):(r||((r=document.createElement("canvas")).width=e.width,r.height=e.height,i=r.getContext("2d")),i.save(),i.globalAlpha=l.getOpacity(),a.forEach((function(e){return i.drawImage(u,e[0],e[1],e[2],e[3])})),i.restore(),n=!0)}})),n){e.element=r;var s={};return s[a]=e,this.super.loadTextures.call(this,s)}var l=this.textureManager.textures[this.textureManager.default];return Promise.resolve([{name:l.name,width:l.width,height:l.height,loaded:l.loaded}])},buildRasterTextures:function(e,t){var r=this.sources[e.source].tileTexture(e);return r?WorkerBroker.postMessage(this.main_thread_target+".loadTextures",r,e.source).then((function(e){if(!e||e.length<1)return t;if(e.some((function(e){return!e.loaded})))return null;var r=e[0].name;return t.uniforms=t.uniforms||{},t.textures=t.textures||[],t.uniforms.u_raster=r,t.uniforms.u_raster_offset=[0,0,1],t.textures.push(r),t})):Promise.resolve(t)}});var shaderSrc_Vertex="uniform float u_horizon;uniform float u_tilt;uniform float u_zoom;attribute vec2 a_position;attribute float a_is_sky;attribute float a_is_top;attribute vec4 a_color;varying vec4 v_color;const float SIN_THRESHOLD_ANGLE=0.96126069082;void main(){v_color=a_color;float sin_tilt=sin(u_tilt);float sky_bottom_alpha=1.-max(sin_tilt-SIN_THRESHOLD_ANGLE,0.)*3.;if((a_position.y==1.&&a_is_sky==0.)||(a_position.y==0.&&a_is_sky==1.)){v_color.w=sky_bottom_alpha;}float fog_height=max((22.-u_zoom)*0.04,0.)*(sin_tilt-.7);float position_z=u_zoom<17. ? .942 : .9418;gl_Position=vec4(a_position.x,a_is_sky*(a_position.y+a_is_top)+1.0-u_horizon-(1.0-a_is_sky)*(1.0-a_position.y)*fog_height,position_z,1.0);}",shaderSrc_Fragment="varying vec4 v_color;void main(void){gl_FragColor=v_color;}",STYLE_NAME="skybox",SkyBox=Object.create(Style),positions=[-1,0,1,0,-1,1,-1,1,1,0,1,1,-1,0,1,0,-1,1,-1,1,1,0,1,1];Object.assign(SkyBox,{name:STYLE_NAME,built_in:!0,vertex_shader_src:shaderSrc_Vertex,fragment_shader_src:shaderSrc_Fragment,selection:!1,blend:"inlay",blend_order:1,init:function(){Style.init.apply(this,arguments),this.selection=!1},_preprocess:function(e){return e.color={top:StyleParser.createColorPropertyCache(e.color.zenith),bottom:StyleParser.createColorPropertyCache(e.color.horizon),fog:StyleParser.createColorPropertyCache(e.color.fog)},e},vertexLayoutForMeshVariant:function(e){if(!this.vertex_layout){var t=[{name:"a_position",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_is_sky",size:1,type:gl$1.FLOAT,normalized:!0},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_top",size:1,type:gl$1.FLOAT,normalized:!0}];this.vertex_layout=new VertexLayout(t)}return this.vertex_layout},makeVertexTemplate:function(e){var t=0;return this.vertex_template[t++]=0,this.vertex_template[t++]=0,this.vertex_template},parseFeature:function(e,t,r){var i=this.feature_style;return t.color&&t.color.top&&t.color.bottom&&(i.color_top=this.parseColor(t.color.top,r),i.color_bottom=this.parseColor(t.color.bottom,r),i.color_fog=this.parseColor(t.color.fog||"white",r),Array.isArray(i.color_fog)&&(i.color_fog=i.color_fog.slice(),i.color_fog[3]=0)),i},buildGeometry:function(e,t,r,i){for(var n=this.makeVertexTemplate(t),o=r.vertex_data,a=r.vertex_data.vertex_layout,s=o.vertex_layout.index.a_position,l={top:t.color_top,bottom:t.color_bottom},u={top:t.color_bottom,bottom:t.color_fog},c=0,h=positions.length-1;c<h;c+=2){n[s+0]=positions[c],n[s+1]=positions[c+1];var f=c<12,d=positions[c+1]>0,_=f?l:u;this.fillVertexTemplate(a,"a_is_sky",f?1:0,{size:1}),this.fillVertexTemplate(a,"a_is_top",d?1:0,{size:1}),this.fillVertexTemplate(a,"a_color",Vector$1.mult(d?_.top:_.bottom,255),{size:4}),o.addVertex(n)}return 4}});var shaderSrc_accessors="#ifdef TANGRAM_VERTEX_SHADER\nvec4 modelPosition(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE*exp2(u_tile_origin.z-u_tile_origin.w),1.)+vec4(0.,1.,0.,0.);}vec4 modelPositionBaseZoom(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE,1.)+vec4(0.,1.,0.,0.);}\n#endif\nvec4 worldPosition(){return v_world_position;}\n#ifdef TANGRAM_VERTEX_SHADER\nvec4 wrapWorldPosition(vec4 world_position){\n#if defined(TANGRAM_WORLD_POSITION_WRAP)\nvec2 anchor=u_tile_origin.xy-mod(u_tile_origin.xy,TANGRAM_WORLD_POSITION_WRAP);world_position.xy-=anchor;\n#endif\nreturn world_position;}\n#endif\n#if defined(TANGRAM_VERTEX_SHADER)\nvec3 worldNormal(){return TANGRAM_NORMAL;}\n#elif defined(TANGRAM_FRAGMENT_SHADER)\nvec3 worldNormal(){return u_inverseNormalMatrix*TANGRAM_NORMAL;}\n#endif\n",shaderSrc_layerOrder="void applyLayerOrder(float layer,inout vec4 position){position.z-=layer*TANGRAM_LAYER_DELTA*position.w;}",shaderSrc_selectionGlobals="\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nattribute vec4 a_selection_color;varying vec4 v_selection_color;uniform vec4 u_selection_discard0;uniform vec4 u_selection_discard1;uniform vec4 u_selection_discard2;uniform vec4 u_selection_discard3;uniform vec4 u_selection_discard4;uniform vec4 u_selection_discard5;uniform vec4 u_selection_discard6;uniform vec4 u_selection_discard7;uniform vec4 u_selection_discard8;uniform vec4 u_selection_discard9;\n#endif\n",shaderSrc_selectionVertex="\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nif(a_selection_color.rgb==vec3(0.)||a_selection_color==u_selection_discard0||a_selection_color==u_selection_discard1||a_selection_color==u_selection_discard2||a_selection_color==u_selection_discard3||a_selection_color==u_selection_discard4||a_selection_color==u_selection_discard5||a_selection_color==u_selection_discard6||a_selection_color==u_selection_discard7||a_selection_color==u_selection_discard8||a_selection_color==u_selection_discard9){gl_Position=vec4(0.,0.,0.,1.);return;}v_selection_color=a_selection_color;\n#endif\n",shaderSrc_utils="#ifndef UTILS\n#define UTILS\nbool isLocalSpacePixelOutsideTile(vec4 pixel_local_space_position,float tile_scale){return pixel_local_space_position.x<0.||pixel_local_space_position.x>=tile_scale||pixel_local_space_position.y>0.||pixel_local_space_position.y<=-tile_scale;}\n#endif\n",shaderSrc_snapToPixelGrid="uniform float u_view_pan_snap_timer;void snapToPixelGrid(inout vec4 position){vec2 position_fract=fract((((position.xy/position.w)+1.)*.5)*u_resolution);vec2 position_snap=position.xy+((step(0.5,position_fract)-position_fract)*position.w*2./u_resolution);\n#ifdef TANGRAM_VIEW_PAN_SNAP_RATE\nposition.xy=mix(position.xy,position_snap,clamp(u_view_pan_snap_timer*TANGRAM_VIEW_PAN_SNAP_RATE,0.,1.));\n#else\nposition.xy=position_snap;\n#endif\n}",StyleManager=function(){function e(){_classCallCheck(this,e),this.styles={},this.base_styles={},this.register(Object.create(Polygons)),this.register(Object.create(Lines)),this.register(Object.create(PatternLines)),this.register(Object.create(Points)),this.register(Object.create(TextStyle)),this.register(Object.create(RasterStyle)),this.register(Object.create(CustomIcons)),this.register(Object.create(OverlayStyle)),this.register(Object.create(SkyBox))}return _createClass(e,[{key:"init",value:function(){ShaderProgram.removeBlock("global"),ShaderProgram.removeBlock("setup"),ShaderProgram.addBlock("global",shaderSrc_accessors),ShaderProgram.addBlock("global",shaderSrc_layerOrder),ShaderProgram.addBlock("global",shaderSrc_selectionGlobals),ShaderProgram.addBlock("global",shaderSrc_snapToPixelGrid),ShaderProgram.replaceBlock("utils",shaderSrc_utils),ShaderProgram.replaceBlock("setup",shaderSrc_selectionVertex),ShaderProgram.defines.TANGRAM_EPSILON=1e-5,ShaderProgram.defines.TANGRAM_LAYER_DELTA=1/16384,ShaderProgram.defines.TANGRAM_TILE_SCALE="vec3(".concat(Geo$1.tile_scale,"., ").concat(Geo$1.tile_scale,"., u_meters_per_pixel * ").concat(Geo$1.tile_size,".)"),ShaderProgram.defines.TANGRAM_HEIGHT_SCALE=Geo$1.height_scale,ShaderProgram.defines.TANGRAM_ALPHA_TEST=.1,Lines.dash_textures={}}},{key:"destroy",value:function(e){var t=this;Object.keys(this.styles).forEach((function(r){var i=t.styles[r];i.gl===e&&(log("trace","StyleManager.destroy: destroying render style ".concat(i.name)),i.base&&t.remove(i.name),i.destroy())}))}},{key:"register",value:function(e){this.styles[e.name]=e,this.base_styles[e.name]=e}},{key:"remove",value:function(e){delete this.styles[e]}},{key:"mix",value:function(e,t){if(e.mixed)return e;e.mixed={};var r=[];if(e.mix){var i;if(Array.isArray(e.mix))(i=r).push.apply(i,_toConsumableArray(e.mix));else r.push(e.mix);(r=r.map((function(e){return t[e]})).filter((function(t){return t&&t!==e}))).forEach((function(t){return e.mixed[t.name]=!0}))}r.push(e),e.animated=r.some((function(e){return e&&e.animated})),e.texcoords=r.some((function(e){return e&&e.texcoords})),e.base=r.map((function(e){return e.base})).filter((function(e){return e})).pop(),e.lighting=r.map((function(e){return e.lighting})).filter((function(e){return null!=e})).pop(),e.texture=r.map((function(e){return e.texture})).filter((function(e){return e})).pop(),e.raster=r.map((function(e){return e.raster})).filter((function(e){return null!=e})).pop(),e.dash=r.map((function(e){return e.dash})).filter((function(e){return null!=e})).pop(),e.dash_background_color=r.map((function(e){return e.dash_background_color})).filter((function(e){return null!=e})).pop(),r.some((function(e){return e.hasOwnProperty("blend")&&e.blend}))&&(e.blend=r.map((function(e){return e.hasOwnProperty("blend")&&e.blend})).filter((function(e){return e})).pop()),e.blend_order=r.map((function(e){return e.blend_order})).filter((function(e){return null!=e})).pop(),e.defines=Object.assign.apply(Object,[{}].concat(_toConsumableArray(r.map((function(e){return e.defines})).filter((function(e){return e}))))),e.material=Object.assign.apply(Object,[{}].concat(_toConsumableArray(r.map((function(e){return e.material})).filter((function(e){return e})))));var n=r.map((function(e){return e.draw})).filter((function(e){return e}));return n.length>0&&(e.draw=mergeObjects.apply(void 0,[{}].concat(_toConsumableArray(n)))),this.mixShaders(e,t,r),e}},{key:"mixShaders",value:function(e,t,r){var i={},n=r.map((function(e){return e.shaders})).filter((function(e){return e}));if(i.defines=Object.assign.apply(Object,[{}].concat(_toConsumableArray(n.map((function(e){return e.defines})).filter((function(e){return e}))))),i.uniforms={},i._uniforms=e.shaders&&e.shaders.uniforms||{},i._uniform_scopes={},r.filter((function(e){return e.shaders&&e.shaders.uniforms})).forEach((function(e){var r=function(r){i._uniform_scopes[r]=e.name,Object.defineProperty(i.uniforms,r,{enumerable:!0,configurable:!0,get:function(){return void 0!==i._uniforms[r]?i._uniforms[r]:t[i._uniform_scopes[r]].shaders.uniforms!==i.uniforms?t[i._uniform_scopes[r]].shaders.uniforms[r]:void 0},set:function(e){i._uniforms[r]=e}})};for(var n in e.shaders.uniforms)r(n)})),i.extensions=Object.keys(n.map((function(e){return e.extensions})).filter((function(e){return e})).reduce((function(e,t){return"string"==typeof t?e[t]=!0:t.forEach((function(t){return e[t]=!0})),e}),{})||{}),e.shaders&&e.shaders.blocks)for(var o in e.shaders.block_scopes=e.shaders.block_scopes||{},e.shaders.blocks){var a,s=e.shaders.blocks[o];if(e.shaders.block_scopes[o]=e.shaders.block_scopes[o]||[],Array.isArray(s))(a=e.shaders.block_scopes[o]).push.apply(a,_toConsumableArray(s.map((function(){return e.name}))));else e.shaders.block_scopes[o].push(e.name)}var l={};return n.forEach((function(e){if(e.blocks){i.blocks=i.blocks||{},i.block_scopes=i.block_scopes||{};var t={};for(var r in e.blocks){var n=e.blocks[r],o=e.block_scopes[r];i.blocks[r]=i.blocks[r]||[],i.block_scopes[r]=i.block_scopes[r]||[],n=Array.isArray(n)?n:[n],o=Array.isArray(o)?o:[o];for(var a=0;a<n.length;a++)l[o[a]]||(t[o[a]]=!0,i.blocks[r].push(n[a]),i.block_scopes[r].push(o[a]))}Object.assign(l,t)}})),Object.assign(e.mixed,l),e.shaders=i,e}},{key:"create",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=mergeObjects({},t);return i.name=e,(i=this.mix(i,r)).base&&this.base_styles[i.base]?this.styles[e]=i=Object.assign(Object.create(this.base_styles[i.base]),i):i.base=null,i}},{key:"build",value:function(e){var t=this,r=Object.keys(e).sort((function(r,i){return t.inheritanceDepth(r,e)-t.inheritanceDepth(i,e)}));for(var i in this.styles)this.base_styles[i]?this.styles[i].reset():delete this.styles[i];var n={};return r.forEach((function(r){n[r]=t.create(r,e[r],n)})),this.styles}},{key:"initStyles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in this.styles)this.styles[t].init(e)}},{key:"inheritanceDepth",value:function(e,t){for(var r=this,i=0;;){var n=t[e];if(!n)break;if(!n.mix)break;if(i++,Array.isArray(n.mix)){i+=Math.max.apply(Math,_toConsumableArray(n.mix.map((function(i){if(e!==i)return r.inheritanceDepth(i,t)}))));break}if(e===n.mix)break;e=n.mix}return i}}]),e}();
/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */
function isNothing(e){return null==e}function isObject(e){return"object"==typeof e&&null!==e}function toArray(e){return Array.isArray(e)?e:isNothing(e)?[]:[e]}function extend(e,t){var r,i,n,o;if(t)for(r=0,i=(o=Object.keys(t)).length;r<i;r+=1)e[n=o[r]]=t[n];return e}function repeat(e,t){var r,i="";for(r=0;r<t;r+=1)i+=e;return i}function isNegativeZero(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e}var isNothing_1=isNothing,isObject_1=isObject,toArray_1=toArray,repeat_1=repeat,isNegativeZero_1=isNegativeZero,extend_1=extend,common={isNothing:isNothing_1,isObject:isObject_1,toArray:toArray_1,repeat:repeat_1,isNegativeZero:isNegativeZero_1,extend:extend_1};function formatError(e,t){var r="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(r+='in "'+e.mark.name+'" '),r+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(r+="\n\n"+e.mark.snippet),i+" "+r):i}function YAMLException$1(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=formatError(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}YAMLException$1.prototype=Object.create(Error.prototype),YAMLException$1.prototype.constructor=YAMLException$1,YAMLException$1.prototype.toString=function(e){return this.name+": "+formatError(this,e)};var exception=YAMLException$1;function getLine(e,t,r,i,n){var o="",a="",s=Math.floor(n/2)-1;return i-t>s&&(t=i-s+(o=" ... ").length),r-i>s&&(r=i+s-(a=" ...").length),{str:o+e.slice(t,r).replace(/\t/g,"\u2192")+a,pos:i-t+o.length}}function padStart(e,t){return common.repeat(" ",t-e.length)+e}function makeSnippet(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),"number"!=typeof t.indent&&(t.indent=1),"number"!=typeof t.linesBefore&&(t.linesBefore=3),"number"!=typeof t.linesAfter&&(t.linesAfter=2);for(var r,i=/\r?\n|\r|\0/g,n=[0],o=[],a=-1;r=i.exec(e.buffer);)o.push(r.index),n.push(r.index+r[0].length),e.position<=r.index&&a<0&&(a=n.length-2);a<0&&(a=n.length-1);var s,l,u="",c=Math.min(e.line+t.linesAfter,o.length).toString().length,h=t.maxLength-(t.indent+c+3);for(s=1;s<=t.linesBefore&&!(a-s<0);s++)l=getLine(e.buffer,n[a-s],o[a-s],e.position-(n[a]-n[a-s]),h),u=common.repeat(" ",t.indent)+padStart((e.line-s+1).toString(),c)+" | "+l.str+"\n"+u;for(l=getLine(e.buffer,n[a],o[a],e.position,h),u+=common.repeat(" ",t.indent)+padStart((e.line+1).toString(),c)+" | "+l.str+"\n",u+=common.repeat("-",t.indent+c+3+l.pos)+"^\n",s=1;s<=t.linesAfter&&!(a+s>=o.length);s++)l=getLine(e.buffer,n[a+s],o[a+s],e.position-(n[a]-n[a+s]),h),u+=common.repeat(" ",t.indent)+padStart((e.line+s+1).toString(),c)+" | "+l.str+"\n";return u.replace(/\n$/,"")}var snippet=makeSnippet,TYPE_CONSTRUCTOR_OPTIONS=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(e){var t={};return null!==e&&Object.keys(e).forEach((function(r){e[r].forEach((function(e){t[String(e)]=r}))})),t}function Type$1(e,t){if(t=t||{},Object.keys(t).forEach((function(t){if(-1===TYPE_CONSTRUCTOR_OPTIONS.indexOf(t))throw new exception('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=compileStyleAliases(t.styleAliases||null),-1===YAML_NODE_KINDS.indexOf(this.kind))throw new exception('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var type=Type$1;function compileList(e,t){var r=[];return e[t].forEach((function(e){var t=r.length;r.forEach((function(r,i){r.tag===e.tag&&r.kind===e.kind&&r.multi===e.multi&&(t=i)})),r[t]=e})),r}function compileMap(){var e,t,r={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function i(e){e.multi?(r.multi[e.kind].push(e),r.multi.fallback.push(e)):r[e.kind][e.tag]=r.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(i);return r}function Schema$1(e){return this.extend(e)}Schema$1.prototype.extend=function(e){var t=[],r=[];if(e instanceof type)r.push(e);else if(Array.isArray(e))r=r.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new exception("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit))}t.forEach((function(e){if(!(e instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new exception("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new exception("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),r.forEach((function(e){if(!(e instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var i=Object.create(Schema$1.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(r),i.compiledImplicit=compileList(i,"implicit"),i.compiledExplicit=compileList(i,"explicit"),i.compiledTypeMap=compileMap(i.compiledImplicit,i.compiledExplicit),i};var schema=Schema$1,str=new type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),seq=new type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),map=new type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}}),failsafe=new schema({explicit:[str,seq,map]});function resolveYamlNull(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)}function constructYamlNull(){return null}function isNull(e){return null===e}var _null=new type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function resolveYamlBoolean(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)}function constructYamlBoolean(e){return"true"===e||"True"===e||"TRUE"===e}function isBoolean(e){return"[object Boolean]"===Object.prototype.toString.call(e)}var bool=new type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function isHexCode(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function isOctCode(e){return 48<=e&&e<=55}function isDecCode(e){return 48<=e&&e<=57}function resolveYamlInteger(e){if(null===e)return!1;var t,r=e.length,i=0,n=!1;if(!r)return!1;if("-"!==(t=e[i])&&"+"!==t||(t=e[++i]),"0"===t){if(i+1===r)return!0;if("b"===(t=e[++i])){for(i++;i<r;i++)if("_"!==(t=e[i])){if("0"!==t&&"1"!==t)return!1;n=!0}return n&&"_"!==t}if("x"===t){for(i++;i<r;i++)if("_"!==(t=e[i])){if(!isHexCode(e.charCodeAt(i)))return!1;n=!0}return n&&"_"!==t}if("o"===t){for(i++;i<r;i++)if("_"!==(t=e[i])){if(!isOctCode(e.charCodeAt(i)))return!1;n=!0}return n&&"_"!==t}}if("_"===t)return!1;for(;i<r;i++)if("_"!==(t=e[i])){if(!isDecCode(e.charCodeAt(i)))return!1;n=!0}return!(!n||"_"===t)}function constructYamlInteger(e){var t,r=e,i=1;if(-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(t=r[0])&&"+"!==t||("-"===t&&(i=-1),t=(r=r.slice(1))[0]),"0"===r)return 0;if("0"===t){if("b"===r[1])return i*parseInt(r.slice(2),2);if("x"===r[1])return i*parseInt(r.slice(2),16);if("o"===r[1])return i*parseInt(r.slice(2),8)}return i*parseInt(r,10)}function isInteger(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!common.isNegativeZero(e)}var int=new type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(e){return null!==e&&!(!YAML_FLOAT_PATTERN.test(e)||"_"===e[e.length-1])}function constructYamlFloat(e){var t,r;return r="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:r*parseFloat(t,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(e,t){var r;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common.isNegativeZero(e))return"-0.0";return r=e.toString(10),SCIENTIFIC_WITHOUT_DOT.test(r)?r.replace("e",".e"):r}function isFloat(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||common.isNegativeZero(e))}var float=new type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"}),json=failsafe.extend({implicit:[_null,bool,int,float]}),core=json,YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function resolveYamlTimestamp(e){return null!==e&&(null!==YAML_DATE_REGEXP.exec(e)||null!==YAML_TIMESTAMP_REGEXP.exec(e))}function constructYamlTimestamp(e){var t,r,i,n,o,a,s,l,u=0,c=null;if(null===(t=YAML_DATE_REGEXP.exec(e))&&(t=YAML_TIMESTAMP_REGEXP.exec(e)),null===t)throw new Error("Date resolve error");if(r=+t[1],i=+t[2]-1,n=+t[3],!t[4])return new Date(Date.UTC(r,i,n));if(o=+t[4],a=+t[5],s=+t[6],t[7]){for(u=t[7].slice(0,3);u.length<3;)u+="0";u=+u}return t[9]&&(c=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(c=-c)),l=new Date(Date.UTC(r,i,n,o,a,s,u)),c&&l.setTime(l.getTime()-c),l}function representYamlTimestamp(e){return e.toISOString()}var timestamp=new type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp});function resolveYamlMerge(e){return"<<"===e||null===e}var merge=new type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge}),BASE64_MAP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function resolveYamlBinary(e){if(null===e)return!1;var t,r,i=0,n=e.length,o=BASE64_MAP;for(r=0;r<n;r++)if(!((t=o.indexOf(e.charAt(r)))>64)){if(t<0)return!1;i+=6}return i%8==0}function constructYamlBinary(e){var t,r,i=e.replace(/[\r\n=]/g,""),n=i.length,o=BASE64_MAP,a=0,s=[];for(t=0;t<n;t++)t%4==0&&t&&(s.push(a>>16&255),s.push(a>>8&255),s.push(255&a)),a=a<<6|o.indexOf(i.charAt(t));return 0===(r=n%4*6)?(s.push(a>>16&255),s.push(a>>8&255),s.push(255&a)):18===r?(s.push(a>>10&255),s.push(a>>2&255)):12===r&&s.push(a>>4&255),new Uint8Array(s)}function representYamlBinary(e){var t,r,i="",n=0,o=e.length,a=BASE64_MAP;for(t=0;t<o;t++)t%3==0&&t&&(i+=a[n>>18&63],i+=a[n>>12&63],i+=a[n>>6&63],i+=a[63&n]),n=(n<<8)+e[t];return 0===(r=o%3)?(i+=a[n>>18&63],i+=a[n>>12&63],i+=a[n>>6&63],i+=a[63&n]):2===r?(i+=a[n>>10&63],i+=a[n>>4&63],i+=a[n<<2&63],i+=a[64]):1===r&&(i+=a[n>>2&63],i+=a[n<<4&63],i+=a[64],i+=a[64]),i}function isBinary(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}var binary=new type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary}),_hasOwnProperty$3=Object.prototype.hasOwnProperty,_toString$2=Object.prototype.toString;function resolveYamlOmap(e){if(null===e)return!0;var t,r,i,n,o,a=[],s=e;for(t=0,r=s.length;t<r;t+=1){if(i=s[t],o=!1,"[object Object]"!==_toString$2.call(i))return!1;for(n in i)if(_hasOwnProperty$3.call(i,n)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==a.indexOf(n))return!1;a.push(n)}return!0}function constructYamlOmap(e){return null!==e?e:[]}var omap=new type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap}),_toString$1=Object.prototype.toString;function resolveYamlPairs(e){if(null===e)return!0;var t,r,i,n,o,a=e;for(o=new Array(a.length),t=0,r=a.length;t<r;t+=1){if(i=a[t],"[object Object]"!==_toString$1.call(i))return!1;if(1!==(n=Object.keys(i)).length)return!1;o[t]=[n[0],i[n[0]]]}return!0}function constructYamlPairs(e){if(null===e)return[];var t,r,i,n,o,a=e;for(o=new Array(a.length),t=0,r=a.length;t<r;t+=1)i=a[t],n=Object.keys(i),o[t]=[n[0],i[n[0]]];return o}var pairs=new type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs}),_hasOwnProperty$2=Object.prototype.hasOwnProperty;function resolveYamlSet(e){if(null===e)return!0;var t,r=e;for(t in r)if(_hasOwnProperty$2.call(r,t)&&null!==r[t])return!1;return!0}function constructYamlSet(e){return null!==e?e:{}}var set=new type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet}),_default=core.extend({implicit:[timestamp,merge],explicit:[binary,omap,pairs,set]}),_hasOwnProperty$1=Object.prototype.hasOwnProperty,CONTEXT_FLOW_IN=1,CONTEXT_FLOW_OUT=2,CONTEXT_BLOCK_IN=3,CONTEXT_BLOCK_OUT=4,CHOMPING_CLIP=1,CHOMPING_STRIP=2,CHOMPING_KEEP=3,PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/,PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/,PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i,PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function _class(e){return Object.prototype.toString.call(e)}function is_EOL(e){return 10===e||13===e}function is_WHITE_SPACE(e){return 9===e||32===e}function is_WS_OR_EOL(e){return 9===e||32===e||10===e||13===e}function is_FLOW_INDICATOR(e){return 44===e||91===e||93===e||123===e||125===e}function fromHexCode(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function escapedHexLen(e){return 120===e?2:117===e?4:85===e?8:0}function fromDecimalCode(e){return 48<=e&&e<=57?e-48:-1}function simpleEscapeSequence(e){return 48===e?"\0":97===e?"\x07":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"\x1b":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"\x85":95===e?"\xa0":76===e?"\u2028":80===e?"\u2029":""}function charFromCodepoint(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256),i=0;i<256;i++)simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0,simpleEscapeMap[i]=simpleEscapeSequence(i);function State$1(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||_default,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function generateError(e,t){var r={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return r.snippet=snippet(r),new exception(t,r)}function throwError(e,t){throw generateError(e,t)}function throwWarning(e,t){e.onWarning&&e.onWarning.call(null,generateError(e,t))}var directiveHandlers={YAML:function(e,t,r){var i,n,o;null!==e.version&&throwError(e,"duplication of %YAML directive"),1!==r.length&&throwError(e,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(r[0]))&&throwError(e,"ill-formed argument of the YAML directive"),n=parseInt(i[1],10),o=parseInt(i[2],10),1!==n&&throwError(e,"unacceptable YAML version of the document"),e.version=r[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&throwWarning(e,"unsupported YAML version of the document")},TAG:function(e,t,r){var i,n;2!==r.length&&throwError(e,"TAG directive accepts exactly two arguments"),i=r[0],n=r[1],PATTERN_TAG_HANDLE.test(i)||throwError(e,"ill-formed tag handle (first argument) of the TAG directive"),_hasOwnProperty$1.call(e.tagMap,i)&&throwError(e,'there is a previously declared suffix for "'+i+'" tag handle'),PATTERN_TAG_URI.test(n)||throwError(e,"ill-formed tag prefix (second argument) of the TAG directive");try{n=decodeURIComponent(n)}catch(t){throwError(e,"tag prefix is malformed: "+n)}e.tagMap[i]=n}};function captureSegment(e,t,r,i){var n,o,a,s;if(t<r){if(s=e.input.slice(t,r),i)for(n=0,o=s.length;n<o;n+=1)9===(a=s.charCodeAt(n))||32<=a&&a<=1114111||throwError(e,"expected valid JSON character");else PATTERN_NON_PRINTABLE.test(s)&&throwError(e,"the stream contains non-printable characters");e.result+=s}}function mergeMappings(e,t,r,i){var n,o,a,s;for(common.isObject(r)||throwError(e,"cannot merge mappings; the provided source object is unacceptable"),a=0,s=(n=Object.keys(r)).length;a<s;a+=1)o=n[a],_hasOwnProperty$1.call(t,o)||(t[o]=r[o],i[o]=!0)}function storeMappingPair(e,t,r,i,n,o,a,s,l){var u,c;if(Array.isArray(n))for(u=0,c=(n=Array.prototype.slice.call(n)).length;u<c;u+=1)Array.isArray(n[u])&&throwError(e,"nested arrays are not supported inside keys"),"object"==typeof n&&"[object Object]"===_class(n[u])&&(n[u]="[object Object]");if("object"==typeof n&&"[object Object]"===_class(n)&&(n="[object Object]"),n=String(n),null===t&&(t={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(o))for(u=0,c=o.length;u<c;u+=1)mergeMappings(e,t,o[u],r);else mergeMappings(e,t,o,r);else e.json||_hasOwnProperty$1.call(r,n)||!_hasOwnProperty$1.call(t,n)||(e.line=a||e.line,e.lineStart=s||e.lineStart,e.position=l||e.position,throwError(e,"duplicated mapping key")),"__proto__"===n?Object.defineProperty(t,n,{configurable:!0,enumerable:!0,writable:!0,value:o}):t[n]=o,delete r[n];return t}function readLineBreak(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):throwError(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function skipSeparationSpace(e,t,r){for(var i=0,n=e.input.charCodeAt(e.position);0!==n;){for(;is_WHITE_SPACE(n);)9===n&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),n=e.input.charCodeAt(++e.position);if(t&&35===n)do{n=e.input.charCodeAt(++e.position)}while(10!==n&&13!==n&&0!==n);if(!is_EOL(n))break;for(readLineBreak(e),n=e.input.charCodeAt(e.position),i++,e.lineIndent=0;32===n;)e.lineIndent++,n=e.input.charCodeAt(++e.position)}return-1!==r&&0!==i&&e.lineIndent<r&&throwWarning(e,"deficient indentation"),i}function testDocumentSeparator(e){var t,r=e.position;return!(45!==(t=e.input.charCodeAt(r))&&46!==t||t!==e.input.charCodeAt(r+1)||t!==e.input.charCodeAt(r+2)||(r+=3,0!==(t=e.input.charCodeAt(r))&&!is_WS_OR_EOL(t)))}function writeFoldedLines(e,t){1===t?e.result+=" ":t>1&&(e.result+=common.repeat("\n",t-1))}function readPlainScalar(e,t,r){var i,n,o,a,s,l,u,c,h=e.kind,f=e.result;if(is_WS_OR_EOL(c=e.input.charCodeAt(e.position))||is_FLOW_INDICATOR(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(is_WS_OR_EOL(i=e.input.charCodeAt(e.position+1))||r&&is_FLOW_INDICATOR(i)))return!1;for(e.kind="scalar",e.result="",n=o=e.position,a=!1;0!==c;){if(58===c){if(is_WS_OR_EOL(i=e.input.charCodeAt(e.position+1))||r&&is_FLOW_INDICATOR(i))break}else if(35===c){if(is_WS_OR_EOL(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&testDocumentSeparator(e)||r&&is_FLOW_INDICATOR(c))break;if(is_EOL(c)){if(s=e.line,l=e.lineStart,u=e.lineIndent,skipSeparationSpace(e,!1,-1),e.lineIndent>=t){a=!0,c=e.input.charCodeAt(e.position);continue}e.position=o,e.line=s,e.lineStart=l,e.lineIndent=u;break}}a&&(captureSegment(e,n,o,!1),writeFoldedLines(e,e.line-s),n=o=e.position,a=!1),is_WHITE_SPACE(c)||(o=e.position+1),c=e.input.charCodeAt(++e.position)}return captureSegment(e,n,o,!1),!!e.result||(e.kind=h,e.result=f,!1)}function readSingleQuotedScalar(e,t){var r,i,n;if(39!==(r=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,i=n=e.position;0!==(r=e.input.charCodeAt(e.position));)if(39===r){if(captureSegment(e,i,e.position,!0),39!==(r=e.input.charCodeAt(++e.position)))return!0;i=e.position,e.position++,n=e.position}else is_EOL(r)?(captureSegment(e,i,n,!0),writeFoldedLines(e,skipSeparationSpace(e,!1,t)),i=n=e.position):e.position===e.lineStart&&testDocumentSeparator(e)?throwError(e,"unexpected end of the document within a single quoted scalar"):(e.position++,n=e.position);throwError(e,"unexpected end of the stream within a single quoted scalar")}function readDoubleQuotedScalar(e,t){var r,i,n,o,a,s;if(34!==(s=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=i=e.position;0!==(s=e.input.charCodeAt(e.position));){if(34===s)return captureSegment(e,r,e.position,!0),e.position++,!0;if(92===s){if(captureSegment(e,r,e.position,!0),is_EOL(s=e.input.charCodeAt(++e.position)))skipSeparationSpace(e,!1,t);else if(s<256&&simpleEscapeCheck[s])e.result+=simpleEscapeMap[s],e.position++;else if((a=escapedHexLen(s))>0){for(n=a,o=0;n>0;n--)(a=fromHexCode(s=e.input.charCodeAt(++e.position)))>=0?o=(o<<4)+a:throwError(e,"expected hexadecimal character");e.result+=charFromCodepoint(o),e.position++}else throwError(e,"unknown escape sequence");r=i=e.position}else is_EOL(s)?(captureSegment(e,r,i,!0),writeFoldedLines(e,skipSeparationSpace(e,!1,t)),r=i=e.position):e.position===e.lineStart&&testDocumentSeparator(e)?throwError(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}throwError(e,"unexpected end of the stream within a double quoted scalar")}function readFlowCollection(e,t){var r,i,n,o,a,s,l,u,c,h,f,d,_=!0,p=e.tag,g=e.anchor,m=Object.create(null);if(91===(d=e.input.charCodeAt(e.position)))a=93,u=!1,o=[];else{if(123!==d)return!1;a=125,u=!0,o={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=o),d=e.input.charCodeAt(++e.position);0!==d;){if(skipSeparationSpace(e,!0,t),(d=e.input.charCodeAt(e.position))===a)return e.position++,e.tag=p,e.anchor=g,e.kind=u?"mapping":"sequence",e.result=o,!0;_?44===d&&throwError(e,"expected the node content, but found ','"):throwError(e,"missed comma between flow collection entries"),f=null,s=l=!1,63===d&&is_WS_OR_EOL(e.input.charCodeAt(e.position+1))&&(s=l=!0,e.position++,skipSeparationSpace(e,!0,t)),r=e.line,i=e.lineStart,n=e.position,composeNode(e,t,CONTEXT_FLOW_IN,!1,!0),h=e.tag,c=e.result,skipSeparationSpace(e,!0,t),d=e.input.charCodeAt(e.position),!l&&e.line!==r||58!==d||(s=!0,d=e.input.charCodeAt(++e.position),skipSeparationSpace(e,!0,t),composeNode(e,t,CONTEXT_FLOW_IN,!1,!0),f=e.result),u?storeMappingPair(e,o,m,h,c,f,r,i,n):s?o.push(storeMappingPair(e,null,m,h,c,f,r,i,n)):o.push(c),skipSeparationSpace(e,!0,t),44===(d=e.input.charCodeAt(e.position))?(_=!0,d=e.input.charCodeAt(++e.position)):_=!1}throwError(e,"unexpected end of the stream within a flow collection")}function readBlockScalar(e,t){var r,i,n,o,a=CHOMPING_CLIP,s=!1,l=!1,u=t,c=0,h=!1;if(124===(o=e.input.charCodeAt(e.position)))i=!1;else{if(62!==o)return!1;i=!0}for(e.kind="scalar",e.result="";0!==o;)if(43===(o=e.input.charCodeAt(++e.position))||45===o)CHOMPING_CLIP===a?a=43===o?CHOMPING_KEEP:CHOMPING_STRIP:throwError(e,"repeat of a chomping mode identifier");else{if(!((n=fromDecimalCode(o))>=0))break;0===n?throwError(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?throwError(e,"repeat of an indentation width identifier"):(u=t+n-1,l=!0)}if(is_WHITE_SPACE(o)){do{o=e.input.charCodeAt(++e.position)}while(is_WHITE_SPACE(o));if(35===o)do{o=e.input.charCodeAt(++e.position)}while(!is_EOL(o)&&0!==o)}for(;0!==o;){for(readLineBreak(e),e.lineIndent=0,o=e.input.charCodeAt(e.position);(!l||e.lineIndent<u)&&32===o;)e.lineIndent++,o=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>u&&(u=e.lineIndent),is_EOL(o))c++;else{if(e.lineIndent<u){a===CHOMPING_KEEP?e.result+=common.repeat("\n",s?1+c:c):a===CHOMPING_CLIP&&s&&(e.result+="\n");break}for(i?is_WHITE_SPACE(o)?(h=!0,e.result+=common.repeat("\n",s?1+c:c)):h?(h=!1,e.result+=common.repeat("\n",c+1)):0===c?s&&(e.result+=" "):e.result+=common.repeat("\n",c):e.result+=common.repeat("\n",s?1+c:c),s=!0,l=!0,c=0,r=e.position;!is_EOL(o)&&0!==o;)o=e.input.charCodeAt(++e.position);captureSegment(e,r,e.position,!1)}}return!0}function readBlockSequence(e,t){var r,i,n=e.tag,o=e.anchor,a=[],s=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=a),i=e.input.charCodeAt(e.position);0!==i&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,throwError(e,"tab characters must not be used in indentation")),45===i)&&is_WS_OR_EOL(e.input.charCodeAt(e.position+1));)if(s=!0,e.position++,skipSeparationSpace(e,!0,-1)&&e.lineIndent<=t)a.push(null),i=e.input.charCodeAt(e.position);else if(r=e.line,composeNode(e,t,CONTEXT_BLOCK_IN,!1,!0),a.push(e.result),skipSeparationSpace(e,!0,-1),i=e.input.charCodeAt(e.position),(e.line===r||e.lineIndent>t)&&0!==i)throwError(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!s&&(e.tag=n,e.anchor=o,e.kind="sequence",e.result=a,!0)}function readBlockMapping(e,t,r){var i,n,o,a,s,l,u,c=e.tag,h=e.anchor,f={},d=Object.create(null),_=null,p=null,g=null,m=!1,y=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=f),u=e.input.charCodeAt(e.position);0!==u;){if(m||-1===e.firstTabInLine||(e.position=e.firstTabInLine,throwError(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),o=e.line,63!==u&&58!==u||!is_WS_OR_EOL(i)){if(a=e.line,s=e.lineStart,l=e.position,!composeNode(e,r,CONTEXT_FLOW_OUT,!1,!0))break;if(e.line===o){for(u=e.input.charCodeAt(e.position);is_WHITE_SPACE(u);)u=e.input.charCodeAt(++e.position);if(58===u)is_WS_OR_EOL(u=e.input.charCodeAt(++e.position))||throwError(e,"a whitespace character is expected after the key-value separator within a block mapping"),m&&(storeMappingPair(e,f,d,_,p,null,a,s,l),_=p=g=null),y=!0,m=!1,n=!1,_=e.tag,p=e.result;else{if(!y)return e.tag=c,e.anchor=h,!0;throwError(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return e.tag=c,e.anchor=h,!0;throwError(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(m&&(storeMappingPair(e,f,d,_,p,null,a,s,l),_=p=g=null),y=!0,m=!0,n=!0):m?(m=!1,n=!0):throwError(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,u=i;if((e.line===o||e.lineIndent>t)&&(m&&(a=e.line,s=e.lineStart,l=e.position),composeNode(e,t,CONTEXT_BLOCK_OUT,!0,n)&&(m?p=e.result:g=e.result),m||(storeMappingPair(e,f,d,_,p,g,a,s,l),_=p=g=null),skipSeparationSpace(e,!0,-1),u=e.input.charCodeAt(e.position)),(e.line===o||e.lineIndent>t)&&0!==u)throwError(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return m&&storeMappingPair(e,f,d,_,p,null,a,s,l),y&&(e.tag=c,e.anchor=h,e.kind="mapping",e.result=f),y}function readTagProperty(e){var t,r,i,n,o=!1,a=!1;if(33!==(n=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&throwError(e,"duplication of a tag property"),60===(n=e.input.charCodeAt(++e.position))?(o=!0,n=e.input.charCodeAt(++e.position)):33===n?(a=!0,r="!!",n=e.input.charCodeAt(++e.position)):r="!",t=e.position,o){do{n=e.input.charCodeAt(++e.position)}while(0!==n&&62!==n);e.position<e.length?(i=e.input.slice(t,e.position),n=e.input.charCodeAt(++e.position)):throwError(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==n&&!is_WS_OR_EOL(n);)33===n&&(a?throwError(e,"tag suffix cannot contain exclamation marks"):(r=e.input.slice(t-1,e.position+1),PATTERN_TAG_HANDLE.test(r)||throwError(e,"named tag handle cannot contain such characters"),a=!0,t=e.position+1)),n=e.input.charCodeAt(++e.position);i=e.input.slice(t,e.position),PATTERN_FLOW_INDICATORS.test(i)&&throwError(e,"tag suffix cannot contain flow indicator characters")}i&&!PATTERN_TAG_URI.test(i)&&throwError(e,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch(t){throwError(e,"tag name is malformed: "+i)}return o?e.tag=i:_hasOwnProperty$1.call(e.tagMap,r)?e.tag=e.tagMap[r]+i:"!"===r?e.tag="!"+i:"!!"===r?e.tag="tag:yaml.org,2002:"+i:throwError(e,'undeclared tag handle "'+r+'"'),!0}function readAnchorProperty(e){var t,r;if(38!==(r=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&throwError(e,"duplication of an anchor property"),r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!is_WS_OR_EOL(r)&&!is_FLOW_INDICATOR(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&throwError(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function readAlias(e){var t,r,i;if(42!==(i=e.input.charCodeAt(e.position)))return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!is_WS_OR_EOL(i)&&!is_FLOW_INDICATOR(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&throwError(e,"name of an alias node must contain at least one character"),r=e.input.slice(t,e.position),_hasOwnProperty$1.call(e.anchorMap,r)||throwError(e,'unidentified alias "'+r+'"'),e.result=e.anchorMap[r],skipSeparationSpace(e,!0,-1),!0}function composeNode(e,t,r,i,n){var o,a,s,l,u,c,h,f,d,_=1,p=!1,g=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=a=s=CONTEXT_BLOCK_OUT===r||CONTEXT_BLOCK_IN===r,i&&skipSeparationSpace(e,!0,-1)&&(p=!0,e.lineIndent>t?_=1:e.lineIndent===t?_=0:e.lineIndent<t&&(_=-1)),1===_)for(;readTagProperty(e)||readAnchorProperty(e);)skipSeparationSpace(e,!0,-1)?(p=!0,s=o,e.lineIndent>t?_=1:e.lineIndent===t?_=0:e.lineIndent<t&&(_=-1)):s=!1;if(s&&(s=p||n),1!==_&&CONTEXT_BLOCK_OUT!==r||(f=CONTEXT_FLOW_IN===r||CONTEXT_FLOW_OUT===r?t:t+1,d=e.position-e.lineStart,1===_?s&&(readBlockSequence(e,d)||readBlockMapping(e,d,f))||readFlowCollection(e,f)?g=!0:(a&&readBlockScalar(e,f)||readSingleQuotedScalar(e,f)||readDoubleQuotedScalar(e,f)?g=!0:readAlias(e)?(g=!0,null===e.tag&&null===e.anchor||throwError(e,"alias node should not have any properties")):readPlainScalar(e,f,CONTEXT_FLOW_IN===r)&&(g=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===_&&(g=s&&readBlockSequence(e,d))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&throwError(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),l=0,u=e.implicitTypes.length;l<u;l+=1)if((h=e.implicitTypes[l]).resolve(e.result)){e.result=h.construct(e.result),e.tag=h.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(_hasOwnProperty$1.call(e.typeMap[e.kind||"fallback"],e.tag))h=e.typeMap[e.kind||"fallback"][e.tag];else for(h=null,l=0,u=(c=e.typeMap.multi[e.kind||"fallback"]).length;l<u;l+=1)if(e.tag.slice(0,c[l].tag.length)===c[l].tag){h=c[l];break}h||throwError(e,"unknown tag !<"+e.tag+">"),null!==e.result&&h.kind!==e.kind&&throwError(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+h.kind+'", not "'+e.kind+'"'),h.resolve(e.result,e.tag)?(e.result=h.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):throwError(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||g}function readDocument(e){var t,r,i,n,o=e.position,a=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(n=e.input.charCodeAt(e.position))&&(skipSeparationSpace(e,!0,-1),n=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==n));){for(a=!0,n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!is_WS_OR_EOL(n);)n=e.input.charCodeAt(++e.position);for(i=[],(r=e.input.slice(t,e.position)).length<1&&throwError(e,"directive name must not be less than one character in length");0!==n;){for(;is_WHITE_SPACE(n);)n=e.input.charCodeAt(++e.position);if(35===n){do{n=e.input.charCodeAt(++e.position)}while(0!==n&&!is_EOL(n));break}if(is_EOL(n))break;for(t=e.position;0!==n&&!is_WS_OR_EOL(n);)n=e.input.charCodeAt(++e.position);i.push(e.input.slice(t,e.position))}0!==n&&readLineBreak(e),_hasOwnProperty$1.call(directiveHandlers,r)?directiveHandlers[r](e,r,i):throwWarning(e,'unknown document directive "'+r+'"')}skipSeparationSpace(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,skipSeparationSpace(e,!0,-1)):a&&throwError(e,"directives end mark is expected"),composeNode(e,e.lineIndent-1,CONTEXT_BLOCK_OUT,!1,!0),skipSeparationSpace(e,!0,-1),e.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(e.input.slice(o,e.position))&&throwWarning(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&testDocumentSeparator(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,skipSeparationSpace(e,!0,-1)):e.position<e.length-1&&throwError(e,"end of the stream or a document separator is expected")}function loadDocuments(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var r=new State$1(e,t),i=e.indexOf("\0");for(-1!==i&&(r.position=i,throwError(r,"null byte is not allowed in input")),r.input+="\0";32===r.input.charCodeAt(r.position);)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)readDocument(r);return r.documents}function loadAll$1(e,t,r){null!==t&&"object"==typeof t&&void 0===r&&(r=t,t=null);var i=loadDocuments(e,r);if("function"!=typeof t)return i;for(var n=0,o=i.length;n<o;n+=1)t(i[n])}function load$1(e,t){var r=loadDocuments(e,t);if(0!==r.length){if(1===r.length)return r[0];throw new exception("expected a single document in the stream, but found more")}}var loadAll_1=loadAll$1,load_1=load$1,loader={loadAll:loadAll_1,load:load_1},_toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,CHAR_BOM=65279,CHAR_TAB=9,CHAR_LINE_FEED=10,CHAR_CARRIAGE_RETURN=13,CHAR_SPACE=32,CHAR_EXCLAMATION=33,CHAR_DOUBLE_QUOTE=34,CHAR_SHARP=35,CHAR_PERCENT=37,CHAR_AMPERSAND=38,CHAR_SINGLE_QUOTE=39,CHAR_ASTERISK=42,CHAR_COMMA=44,CHAR_MINUS=45,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_GREATER_THAN=62,CHAR_QUESTION=63,CHAR_COMMERCIAL_AT=64,CHAR_LEFT_SQUARE_BRACKET=91,CHAR_RIGHT_SQUARE_BRACKET=93,CHAR_GRAVE_ACCENT=96,CHAR_LEFT_CURLY_BRACKET=123,CHAR_VERTICAL_LINE=124,CHAR_RIGHT_CURLY_BRACKET=125,ESCAPE_SEQUENCES={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],DEPRECATED_BASE60_SYNTAX=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function compileStyleMap(e,t){var r,i,n,o,a,s,l;if(null===t)return{};for(r={},n=0,o=(i=Object.keys(t)).length;n<o;n+=1)a=i[n],s=String(t[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(l=e.compiledTypeMap.fallback[a])&&_hasOwnProperty.call(l.styleAliases,s)&&(s=l.styleAliases[s]),r[a]=s;return r}function encodeHex(e){var t,r,i;if(t=e.toString(16).toUpperCase(),e<=255)r="x",i=2;else if(e<=65535)r="u",i=4;else{if(!(e<=4294967295))throw new exception("code point within a string may not be greater than 0xFFFFFFFF");r="U",i=8}return"\\"+r+common.repeat("0",i-t.length)+t}var QUOTING_TYPE_SINGLE=1,QUOTING_TYPE_DOUBLE=2;function State(e){this.schema=e.schema||_default,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=common.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=compileStyleMap(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?QUOTING_TYPE_DOUBLE:QUOTING_TYPE_SINGLE,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function indentString(e,t){for(var r,i=common.repeat(" ",t),n=0,o=-1,a="",s=e.length;n<s;)-1===(o=e.indexOf("\n",n))?(r=e.slice(n),n=s):(r=e.slice(n,o+1),n=o+1),r.length&&"\n"!==r&&(a+=i),a+=r;return a}function generateNextLine(e,t){return"\n"+common.repeat(" ",e.indent*t)}function testImplicitResolving(e,t){var r,i;for(r=0,i=e.implicitTypes.length;r<i;r+=1)if(e.implicitTypes[r].resolve(t))return!0;return!1}function isWhitespace(e){return e===CHAR_SPACE||e===CHAR_TAB}function isPrintable(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==CHAR_BOM||65536<=e&&e<=1114111}function isNsCharOrWhitespace(e){return isPrintable(e)&&e!==CHAR_BOM&&e!==CHAR_CARRIAGE_RETURN&&e!==CHAR_LINE_FEED}function isPlainSafe(e,t,r){var i=isNsCharOrWhitespace(e),n=i&&!isWhitespace(e);return(r?i:i&&e!==CHAR_COMMA&&e!==CHAR_LEFT_SQUARE_BRACKET&&e!==CHAR_RIGHT_SQUARE_BRACKET&&e!==CHAR_LEFT_CURLY_BRACKET&&e!==CHAR_RIGHT_CURLY_BRACKET)&&e!==CHAR_SHARP&&!(t===CHAR_COLON&&!n)||isNsCharOrWhitespace(t)&&!isWhitespace(t)&&e===CHAR_SHARP||t===CHAR_COLON&&n}function isPlainSafeFirst(e){return isPrintable(e)&&e!==CHAR_BOM&&!isWhitespace(e)&&e!==CHAR_MINUS&&e!==CHAR_QUESTION&&e!==CHAR_COLON&&e!==CHAR_COMMA&&e!==CHAR_LEFT_SQUARE_BRACKET&&e!==CHAR_RIGHT_SQUARE_BRACKET&&e!==CHAR_LEFT_CURLY_BRACKET&&e!==CHAR_RIGHT_CURLY_BRACKET&&e!==CHAR_SHARP&&e!==CHAR_AMPERSAND&&e!==CHAR_ASTERISK&&e!==CHAR_EXCLAMATION&&e!==CHAR_VERTICAL_LINE&&e!==CHAR_EQUALS&&e!==CHAR_GREATER_THAN&&e!==CHAR_SINGLE_QUOTE&&e!==CHAR_DOUBLE_QUOTE&&e!==CHAR_PERCENT&&e!==CHAR_COMMERCIAL_AT&&e!==CHAR_GRAVE_ACCENT}function isPlainSafeLast(e){return!isWhitespace(e)&&e!==CHAR_COLON}function codePointAt(e,t){var r,i=e.charCodeAt(t);return i>=55296&&i<=56319&&t+1<e.length&&(r=e.charCodeAt(t+1))>=56320&&r<=57343?1024*(i-55296)+r-56320+65536:i}function needIndentIndicator(e){return/^\n* /.test(e)}var STYLE_PLAIN=1,STYLE_SINGLE=2,STYLE_LITERAL=3,STYLE_FOLDED=4,STYLE_DOUBLE=5;function chooseScalarStyle(e,t,r,i,n,o,a,s){var l,u=0,c=null,h=!1,f=!1,d=-1!==i,_=-1,p=isPlainSafeFirst(codePointAt(e,0))&&isPlainSafeLast(codePointAt(e,e.length-1));if(t||a)for(l=0;l<e.length;u>=65536?l+=2:l++){if(!isPrintable(u=codePointAt(e,l)))return STYLE_DOUBLE;p=p&&isPlainSafe(u,c,s),c=u}else{for(l=0;l<e.length;u>=65536?l+=2:l++){if((u=codePointAt(e,l))===CHAR_LINE_FEED)h=!0,d&&(f=f||l-_-1>i&&" "!==e[_+1],_=l);else if(!isPrintable(u))return STYLE_DOUBLE;p=p&&isPlainSafe(u,c,s),c=u}f=f||d&&l-_-1>i&&" "!==e[_+1]}return h||f?r>9&&needIndentIndicator(e)?STYLE_DOUBLE:a?o===QUOTING_TYPE_DOUBLE?STYLE_DOUBLE:STYLE_SINGLE:f?STYLE_FOLDED:STYLE_LITERAL:!p||a||n(e)?o===QUOTING_TYPE_DOUBLE?STYLE_DOUBLE:STYLE_SINGLE:STYLE_PLAIN}function writeScalar(e,t,r,i,n){e.dump=function(){if(0===t.length)return e.quotingType===QUOTING_TYPE_DOUBLE?'""':"''";if(!e.noCompatMode&&(-1!==DEPRECATED_BOOLEANS_SYNTAX.indexOf(t)||DEPRECATED_BASE60_SYNTAX.test(t)))return e.quotingType===QUOTING_TYPE_DOUBLE?'"'+t+'"':"'"+t+"'";var o=e.indent*Math.max(1,r),a=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-o),s=i||e.flowLevel>-1&&r>=e.flowLevel;switch(chooseScalarStyle(t,s,e.indent,a,(function(t){return testImplicitResolving(e,t)}),e.quotingType,e.forceQuotes&&!i,n)){case STYLE_PLAIN:return t;case STYLE_SINGLE:return"'"+t.replace(/'/g,"''")+"'";case STYLE_LITERAL:return"|"+blockHeader(t,e.indent)+dropEndingNewline(indentString(t,o));case STYLE_FOLDED:return">"+blockHeader(t,e.indent)+dropEndingNewline(indentString(foldString(t,a),o));case STYLE_DOUBLE:return'"'+escapeString(t)+'"';default:throw new exception("impossible error: invalid scalar style")}}()}function blockHeader(e,t){var r=needIndentIndicator(e)?String(t):"",i="\n"===e[e.length-1];return r+(i&&("\n"===e[e.length-2]||"\n"===e)?"+":i?"":"-")+"\n"}function dropEndingNewline(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function foldString(e,t){for(var r,i,n,o=/(\n+)([^\n]*)/g,a=(r=-1!==(r=e.indexOf("\n"))?r:e.length,o.lastIndex=r,foldLine(e.slice(0,r),t)),s="\n"===e[0]||" "===e[0];n=o.exec(e);){var l=n[1],u=n[2];i=" "===u[0],a+=l+(s||i||""===u?"":"\n")+foldLine(u,t),s=i}return a}function foldLine(e,t){if(""===e||" "===e[0])return e;for(var r,i,n=/ [^ ]/g,o=0,a=0,s=0,l="";r=n.exec(e);)(s=r.index)-o>t&&(i=a>o?a:s,l+="\n"+e.slice(o,i),o=i+1),a=s;return l+="\n",e.length-o>t&&a>o?l+=e.slice(o,a)+"\n"+e.slice(a+1):l+=e.slice(o),l.slice(1)}function escapeString(e){for(var t,r="",i=0,n=0;n<e.length;i>=65536?n+=2:n++)i=codePointAt(e,n),!(t=ESCAPE_SEQUENCES[i])&&isPrintable(i)?(r+=e[n],i>=65536&&(r+=e[n+1])):r+=t||encodeHex(i);return r}function writeFlowSequence(e,t,r){var i,n,o,a="",s=e.tag;for(i=0,n=r.length;i<n;i+=1)o=r[i],e.replacer&&(o=e.replacer.call(r,String(i),o)),(writeNode(e,t,o,!1,!1)||void 0===o&&writeNode(e,t,null,!1,!1))&&(""!==a&&(a+=","+(e.condenseFlow?"":" ")),a+=e.dump);e.tag=s,e.dump="["+a+"]"}function writeBlockSequence(e,t,r,i){var n,o,a,s="",l=e.tag;for(n=0,o=r.length;n<o;n+=1)a=r[n],e.replacer&&(a=e.replacer.call(r,String(n),a)),(writeNode(e,t+1,a,!0,!0,!1,!0)||void 0===a&&writeNode(e,t+1,null,!0,!0,!1,!0))&&(i&&""===s||(s+=generateNextLine(e,t)),e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=l,e.dump=s||"[]"}function writeFlowMapping(e,t,r){var i,n,o,a,s,l="",u=e.tag,c=Object.keys(r);for(i=0,n=c.length;i<n;i+=1)s="",""!==l&&(s+=", "),e.condenseFlow&&(s+='"'),a=r[o=c[i]],e.replacer&&(a=e.replacer.call(r,o,a)),writeNode(e,t,o,!1,!1)&&(e.dump.length>1024&&(s+="? "),s+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),writeNode(e,t,a,!1,!1)&&(l+=s+=e.dump));e.tag=u,e.dump="{"+l+"}"}function writeBlockMapping(e,t,r,i){var n,o,a,s,l,u,c="",h=e.tag,f=Object.keys(r);if(!0===e.sortKeys)f.sort();else if("function"==typeof e.sortKeys)f.sort(e.sortKeys);else if(e.sortKeys)throw new exception("sortKeys must be a boolean or a function");for(n=0,o=f.length;n<o;n+=1)u="",i&&""===c||(u+=generateNextLine(e,t)),s=r[a=f[n]],e.replacer&&(s=e.replacer.call(r,a,s)),writeNode(e,t+1,a,!0,!0,!0)&&((l=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,l&&(u+=generateNextLine(e,t)),writeNode(e,t+1,s,!0,l)&&(e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?u+=":":u+=": ",c+=u+=e.dump));e.tag=h,e.dump=c||"{}"}function detectType(e,t,r){var i,n,o,a,s,l;for(o=0,a=(n=r?e.explicitTypes:e.implicitTypes).length;o<a;o+=1)if(((s=n[o]).instanceOf||s.predicate)&&(!s.instanceOf||"object"==typeof t&&t instanceof s.instanceOf)&&(!s.predicate||s.predicate(t))){if(r?s.multi&&s.representName?e.tag=s.representName(t):e.tag=s.tag:e.tag="?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,"[object Function]"===_toString.call(s.represent))i=s.represent(t,l);else{if(!_hasOwnProperty.call(s.represent,l))throw new exception("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');i=s.represent[l](t,l)}e.dump=i}return!0}return!1}function writeNode(e,t,r,i,n,o,a){e.tag=null,e.dump=r,detectType(e,r,!1)||detectType(e,r,!0);var s,l=_toString.call(e.dump),u=i;i&&(i=e.flowLevel<0||e.flowLevel>t);var c,h,f="[object Object]"===l||"[object Array]"===l;if(f&&(h=-1!==(c=e.duplicates.indexOf(r))),(null!==e.tag&&"?"!==e.tag||h||2!==e.indent&&t>0)&&(n=!1),h&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(f&&h&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),"[object Object]"===l)i&&0!==Object.keys(e.dump).length?(writeBlockMapping(e,t,e.dump,n),h&&(e.dump="&ref_"+c+e.dump)):(writeFlowMapping(e,t,e.dump),h&&(e.dump="&ref_"+c+" "+e.dump));else if("[object Array]"===l)i&&0!==e.dump.length?(e.noArrayIndent&&!a&&t>0?writeBlockSequence(e,t-1,e.dump,n):writeBlockSequence(e,t,e.dump,n),h&&(e.dump="&ref_"+c+e.dump)):(writeFlowSequence(e,t,e.dump),h&&(e.dump="&ref_"+c+" "+e.dump));else{if("[object String]"!==l){if("[object Undefined]"===l)return!1;if(e.skipInvalid)return!1;throw new exception("unacceptable kind of an object to dump "+l)}"?"!==e.tag&&writeScalar(e,e.dump,t,o,u)}null!==e.tag&&"?"!==e.tag&&(s=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),s="!"===e.tag[0]?"!"+s:"tag:yaml.org,2002:"===s.slice(0,18)?"!!"+s.slice(18):"!<"+s+">",e.dump=s+" "+e.dump)}return!0}function getDuplicateReferences(e,t){var r,i,n=[],o=[];for(inspectNode(e,n,o),r=0,i=o.length;r<i;r+=1)t.duplicates.push(n[o[r]]);t.usedDuplicates=new Array(i)}function inspectNode(e,t,r){var i,n,o;if(null!==e&&"object"==typeof e)if(-1!==(n=t.indexOf(e)))-1===r.indexOf(n)&&r.push(n);else if(t.push(e),Array.isArray(e))for(n=0,o=e.length;n<o;n+=1)inspectNode(e[n],t,r);else for(n=0,o=(i=Object.keys(e)).length;n<o;n+=1)inspectNode(e[i[n]],t,r)}function dump$1(e,t){var r=new State(t=t||{});r.noRefs||getDuplicateReferences(e,r);var i=e;return r.replacer&&(i=r.replacer.call({"":i},"",i)),writeNode(r,0,i,!0,!0)?r.dump+"\n":""}var dump_1=dump$1,dumper={dump:dump_1};function renamed(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var Type=type,Schema=schema,FAILSAFE_SCHEMA=failsafe,JSON_SCHEMA=json,CORE_SCHEMA=core,DEFAULT_SCHEMA=_default,load=loader.load,loadAll=loader.loadAll,dump=dumper.dump,YAMLException=exception,types={binary:binary,float:float,map:map,null:_null,pairs:pairs,set:set,timestamp:timestamp,bool:bool,int:int,merge:merge,omap:omap,seq:seq,str:str},safeLoad=renamed("safeLoad","load"),safeLoadAll=renamed("safeLoadAll","loadAll"),safeDump=renamed("safeDump","dump"),jsYaml={Type:Type,Schema:Schema,FAILSAFE_SCHEMA:FAILSAFE_SCHEMA,JSON_SCHEMA:JSON_SCHEMA,CORE_SCHEMA:CORE_SCHEMA,DEFAULT_SCHEMA:DEFAULT_SCHEMA,load:load,loadAll:loadAll,dump:dump,YAMLException:YAMLException,types:types,safeLoad:safeLoad,safeLoadAll:safeLoadAll,safeDump:safeDump},SceneBundle=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,e),this.url=t,!r||isRelativeURL(r)&&!isRelativeURL(this.url)?this.path=pathForURL(this.url):this.path=r,this.path_for_parent=r||this.path,this.parent=i,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}return _createClass(e,[{key:"load",value:function(){return loadResource(this.url)}},{key:"resourceFor",value:function(e){return{url:this.urlFor(e),path:this.pathFor(e),type:this.typeFor(e)}}},{key:"urlFor",value:function(e){return isGlobal(e)?e:isRelativeURL(e)&&this.container?this.parent.urlFor(this.path_for_parent+e):addBaseURL(e,this.path)}},{key:"pathFor",value:function(e){return pathForURL(e)}},{key:"typeFor",value:function(e){return extensionForURL(e)}},{key:"isContainer",value:function(){return!1}}]),e}();function createSceneBundle(e,t,r){return new SceneBundle(e,t,r)}function isGlobal(e){return!(!e||"global."!==e.slice(0,7))}function parseResource(e){var t;try{t=jsYaml.load(e,{json:!0})}catch(e){throw e}return t}function loadResource(e){return new Promise((function(t,r){"string"==typeof e?Utils$1.io(e).then((function(e){try{var i=parseResource(e);t(i)}catch(e){r(e)}}),r):(e=Object.assign({},e),t(e))}))}function notNull(e){return null!=e}function wrap(e){return"("+e+")"}function maybeQuote(e){return"string"==typeof e?'"'+e+'"':e}function lookUp(e){return"$"===e[0]?"context['"+e.substring(1)+"']":"context.feature.properties['"+e+"']"}function nullValue(e,t){return" true "}function propertyEqual(e,t){return wrap(maybeQuote(t)+" === "+lookUp(e))}function propertyOr(e,t){return wrap(t.map((function(t){return propertyEqual(e,t)})).join(" || "))}function printNested(e,t){return wrap(e.filter(notNull).map((function(e){return wrap(e.join(" && "))})).join(" "+t+" "))}function any(e,t,r){return t&&t.length>0?printNested(t.map((function(e){return parseFilter(e,r)})),"||"):"true"}function all(e,t,r){return t&&t.length>0?printNested(t.map((function(e){return parseFilter(e,r)})),"&&"):"true"}function not(e,t,r){return"!"+wrap(parseFilter(t,r).join(" && "))}function none(e,t,r){return"!"+wrap(any(null,t,r))}function propertyMatchesBoolean(e,t){return wrap(lookUp(e)+(t?" != ":" == ")+"null")}function rangeMatch(e,t,r){var i=[],n=r&&"function"==typeof r.rangeTransform&&r.rangeTransform;if(t.max){var o=n?n(t.max):t.max;i.push(lookUp(e)+" < "+o)}if(t.min){var a=n?a=n(t.min):t.min;i.push(lookUp(e)+" >= "+a)}return wrap(i.join(" && "))}function parseFilter(e,t){var r=[];if("function"==typeof e)return[wrap(e.toString()+"(context)")];if(Array.isArray(e))return[any(null,e,t)];if(null==e)return["true"];for(var i=Object.keys(e),n=0;n<i.length;n++){var o=i[n],a=e[o],s=_typeof(a);if("string"===s||"number"===s)r.push(propertyEqual(o,a));else if("boolean"===s)r.push(propertyMatchesBoolean(o,a));else if("not"===o)r.push(not(o,a,t));else if("any"===o)r.push(any(o,a,t));else if("all"===o)r.push(all(o,a,t));else if("none"===o)r.push(none(o,a,t));else if(Array.isArray(a))r.push(propertyOr(o,a));else if("object"===s&&null!=a)(a.max||a.min)&&r.push(rangeMatch(o,a,t));else{if(null!=a)throw new Error("Unknown Query syntax: "+a);r.push(nullValue())}}return 0===i.length?["true"]:r}function filterToString(e){return wrap(e.join(" && "))}function buildFilter(e,t){return null==e?function(){return!0}:new Function("context","return "+filterToString(parseFilter(e,t))+";")}var reserved=["filter","draw","visible","enabled","data"],layer_cache={};function cacheKey(e){if(e.length>1){for(var t=e[0],r=1;r<e.length;r++)t+="/"+e[r];return t}return e[0]}function mergeTrees(e,t){for(var r,i=0,n=0;n<e.length;n++)e[n].length>i&&(i=e[n].length);if(0===i)return null;for(var o={visible:!0},a=function(i){if(r=[],e.forEach((function(e){e[i]&&e[i][t]&&-1===r.indexOf(e[i][t])&&r.push(e[i][t])})),0===r.length)return"continue";r.sort((function(e,t){return(e&&e.layer_name)>(t&&t.layer_name)?1:-1})),mergeObjects.apply(void 0,[o].concat(_toConsumableArray(r))),delete o.layer_name},s=0;s<i;s++)a(s);return!1===o.visible?null:o}var blacklist=["any","all","not","none"],Layer=function(){function e(t){var r=t.layer,i=t.name,n=t.parent,o=t.draw,a=t.visible,s=t.enabled,l=t.filter,u=t.styles;if(_classCallCheck(this,e),this.id=e.id++,this.config_data=r.data,this.parent=n,this.name=i,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=o,this.filter=l,this.styles=u,this.is_built=!1,s=void 0===s?a:s,this.parent&&!1===this.parent.visible?this.enabled=!1:this.enabled=!1!==s,this.draw)for(var c in this.draw)if(this.draw[c]=null==this.draw[c]?{}:this.draw[c],"object"!==_typeof(this.draw[c])){var h="Draw group '".concat(c,"' for layer ").concat(this.full_name," is invalid, must be an object, ");log("warn",h+="but was set to `".concat(c,": ").concat(this.draw[c],"` instead")),delete this.draw[c]}else this.draw[c].layer_name=this.full_name}return _createClass(e,[{key:"build",value:function(){log("trace","Building layer '".concat(this.full_name,"'")),this.buildFilter(),this.buildDraw(),this.is_built=!0}},{key:"buildDraw",value:function(){this.draw=Utils$1.stringsToFunctions(this.draw,StyleParser.wrapFunction),this.calculatedDraw=calculateDraw(this)}},{key:"buildFilter",value:function(){this.filter_original=this.filter,this.filter=Utils$1.stringsToFunctions(this.filter,StyleParser.wrapFunction);var e=_typeof(this.filter);if(null==this.filter||"object"===e||"function"===e)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||Object.keys(this.filter).length>0)?this.filter=buildFilter(this.filter,FilterOptions):this.filter=null}catch(e){var t="Filter for layer ".concat(this.full_name," is invalid, `filter: ").concat(JSON.stringify(this.filter),"` ");log("warn",t+="failed with error '".concat(e.message,"', stack trace: ").concat(e.stack))}else{var r="Filter for layer ".concat(this.full_name," is invalid, filter value must be an object or function, ");log("warn",r+="but was set to `filter: ".concat(this.filter,"` instead"))}}},{key:"buildZooms",value:function(){var e=this.filter&&this.filter.$zoom,t=_typeof(e);if(null!=e&&"function"!==t){if(this.zooms={},"number"===t)this.zooms[e]=!0;else if(Array.isArray(e))for(var r=0;r<e.length;r++)this.zooms[e[r]]=!0;else if("object"===t&&(null!=e.min||null!=e.max))for(var i=e.min||0,n=e.max||25,o=i;o<n;o++)this.zooms[o]=!0;delete this.filter.$zoom}}},{key:"buildPropMatches",value:function(){var e=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach((function(t){if(-1===blacklist.indexOf(t)){var r=e.filter[t],i=_typeof(r),n=Array.isArray(r);if(!n&&"string"!==i&&"number"!==i)return;"$"===t[0]?(e.context_prop_matches=e.context_prop_matches||[],e.context_prop_matches.push([t.substring(1),n?r:[r]])):(e.feature_prop_matches=e.feature_prop_matches||[],e.feature_prop_matches.push([t,n?r:[r]])),delete e.filter[t]}}))}},{key:"doPropMatches",value:function(e){if(this.feature_prop_matches)for(var t=0;t<this.feature_prop_matches.length;t++){var r=this.feature_prop_matches[t],i=e.feature.properties[r[0]];if(null==i||-1===r[1].indexOf(i))return!1}if(this.context_prop_matches)for(var n=0;n<this.context_prop_matches.length;n++){var o=this.context_prop_matches[n],a=e[o[0]];if(null==a||-1===o[1].indexOf(a))return!1}return!0}},{key:"doesMatch",value:function(e){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[e.zoom])return!1;if(!this.doPropMatches(e))return!1;var t;if(this.filter instanceof Function)try{t=this.filter(e)}catch(t){var r="Filter for this ".concat(this.full_name,": `filter: ").concat(this.filter_original,"` ");log("error",r+="failed with error '".concat(t.message,"', stack trace: ").concat(t.stack),e.feature)}else t=null==this.filter;return!!t&&(this.children_to_parse&&(parseLayerChildren(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)}}]),e}();Layer.id=0;var LayerLeaf=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var i;return _classCallCheck(this,r),(i=t.call(this,e)).is_leaf=!0,i}return r}(Layer),LayerTree=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var i;return _classCallCheck(this,r),(i=t.call(this,e)).is_tree=!0,i.layers=e.layers||[],i}return _createClass(r,[{key:"addLayer",value:function(e){this.layers.push(e)}},{key:"buildDrawGroups",value:function(e){var t=[],r=[];if(matchFeature(e,[this],t,r),t.length>0){var i=cacheKey(r);if(void 0===layer_cache[i]){for(var n=t.map((function(e){return e&&!1!==e.visible&&e.calculatedDraw})),o={},a=0;a<n.length;a++){var s=n[a];if(s)for(var l=0;l<s.length;l++){var u=s[l];for(var c in u)o[c]=!0}}for(var h in o)layer_cache[i]=layer_cache[i]||{},layer_cache[i][h]=mergeTrees(n,h),layer_cache[i][h]?(layer_cache[i][h].key=i+"/"+h,layer_cache[i][h].layers=t.map((function(e){return e&&e.full_name})),layer_cache[i][h].group=h):delete layer_cache[i][h];layer_cache[i]&&0===Object.keys(layer_cache[i]).length&&(layer_cache[i]=null)}return layer_cache[i]}}}]),r}(Layer),FilterOptions={rangeTransform:function(e){return"string"==typeof e&&"px2"===e.trim().slice(-3)?"".concat(parseFloat(e)," * context.meters_per_pixel_sq"):e}},SceneLoader;function isReserved(e){return reserved.indexOf(e)>-1}function isEmpty(e){return 0===Object.keys(e).length}function groupProps(e){var t={},r={};for(var i in e)isReserved(i)?t[i]=e[i]:r[i]=e[i];return[t,r]}function calculateDraw(e){var t=[];if(e.parent){var r=e.parent.calculatedDraw||[];t.push.apply(t,_toConsumableArray(r))}return t.push(e.draw),t}function parseLayerNode(e,t,r,i){var n={name:e,layer:t=null==t?{}:t,parent:r,styles:i},o=_slicedToArray(groupProps(t),2),a=o[0],s=o[1],l=isEmpty(s),u=new(l&&null!=r?LayerLeaf:LayerTree)(Object.assign(n,a));return u.enabled&&(r&&r.addLayer(u),u.children_to_parse=l?null:s),u}function parseLayerChildren(e,t,r){for(var i in t){var n=t[i];if("object"!==_typeof(n)||Array.isArray(n)){var o="Layer value must be an object: cannot create layer '".concat(i,": ").concat(JSON.stringify(n),"'");o+=", under parent layer '".concat(e.full_name,"'."),r[e.name]&&(o+=" The parent name '".concat(e.name,"' is also the name of a style, did you mean to create a 'draw' group"),e.parent&&(o+=" under '".concat(e.parent.name,"'")),o+=" instead?"),log("warn",o)}else parseLayerNode(i,n,e,r)}}function parseLayers(e,t){layer_cache={};var r={};for(var i in e){var n=e[i];n&&(r[i]=parseLayerNode(i,n,null,t))}return r}function matchFeature(e,t,r,i){var n=!1;if(0!==t.length){for(var o=0;o<t.length;o++){var a=t[o];a.is_leaf?a.doesMatch(e)&&(n=!0,r.push(a),i.push(a.id)):a.is_tree&&a.doesMatch(e)&&(n=!0,matchFeature(e,a.layers,r,i)||(r.push(a),i.push(a.id)))}return n}}var GLOBAL_PROP_RGX=/^global\.(.+)$/,SceneLoader$1=SceneLoader={loadScene:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.path,n=r.type,o=[];return this.loadSceneRecursive({url:e,path:i,type:n},null,o).then((function(e){return t.finalize(e)})).then((function(e){var r=e.config,i=e.bundle;return r?(o.length>0&&o.forEach((function(e){var r="Failed to import scene: ".concat(e.url);log("error",r,e),t.trigger("error",{type:"scene_import",message:r,error:e,url:e.url})})),{config:r,bundle:i}):Promise.reject(o[0])}))},loadSceneRecursive:function(e,t){var r=this,i=e.url,n=e.path;e.type;var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!i)return Promise.resolve({});var a=createSceneBundle(i,n,t);return a.load().then((function(e){if(null==e.import)return r.normalize(e,a),{config:e,bundle:a};Array.isArray(e.import)||(e.import=[e.import]);var t=[];return e.import.forEach((function(e){"object"===_typeof(e)&&(e=createObjectURL(new Blob([JSON.stringify(e)]))),t.push(a.resourceFor(e))})),delete e.import,Promise.all(t.map((function(e){return r.loadSceneRecursive(e,a,o)}))).then((function(t){t.forEach((function(e){return r.normalize(e.config,e.bundle)}));var i=t.map((function(e){return e.config}));return e=mergeObjects.apply(void 0,_toConsumableArray(i).concat([e])),r.normalize(e,a),{config:e,bundle:a}}))})).catch((function(e){return e.url=i,o.push(e),{}}))},normalize:function(e,t){return this.normalizeDataSources(e,t),this.normalizeFonts(e,t),this.normalizeTextures(e,t),this.hoistTextures(e,t),{config:e,bundle:t}},normalizeDataSources:function(e,t){for(var r in e.sources=e.sources||{},e.sources)this.normalizeDataSource(e.sources[r],t);return e},normalizeDataSource:function(e,t){if(e.url&&(e.url=t.urlFor(e.url)),e.scripts)for(var r in Array.isArray(e.scripts)&&(e.scripts=e.scripts.reduce((function(e,t){return e[t]=t,e}),{})),e.scripts)e.scripts[r]=t.urlFor(e.scripts[r]);return e},normalizeFonts:function(e,t){for(var r in e.fonts=e.fonts||{},e.fonts)if(Array.isArray(e.fonts[r]))e.fonts[r].forEach((function(e){e.url=e.url&&t.urlFor(e.url)}));else{var i=e.fonts[r];i.url=i.url&&t.urlFor(i.url)}return e},normalizeTextures:function(e,t){if(e.textures=e.textures||{},e.textures)for(var r in e.textures){var i=e.textures[r];i.url&&(i.url=t.urlFor(i.url))}},hoistTextures:function(e,t){var r=this;if(e.styles){var i=function(i){var n=e.styles[i],o=n.texture;"string"!=typeof o||e.textures[o]||(n.texture=r.hoistTexture(o,e,t)),n.material&&["emission","ambient","diffuse","specular","normal"].forEach((function(i){var o=null!=n.material[i]&&n.material[i].texture;"string"!=typeof o||e.textures[o]||(n.material[i].texture=r.hoistTexture(o,e,t))}))};for(var n in e.styles)i(n)}if(this.hoistStyleShaderUniformTextures(e,t,{include_globals:!1}),e.layers)for(var o=[e.layers];o.length>0;){var a=o.pop();if("object"===_typeof(a)&&!Array.isArray(a))for(var s in a)if("draw"===s){var l=a[s];for(var u in l){if(l[u].texture){var c=l[u].texture;"string"!=typeof c||e.textures[c]||(l[u].texture=this.hoistTexture(c,e,t))}if(l[u].outline&&l[u].outline.texture){var h=l[u].outline.texture;"string"!=typeof h||e.textures[h]||(l[u].outline.texture=this.hoistTexture(h,e,t))}}}else{if(isReserved(s))continue;o.push(a[s])}}},hoistStyleShaderUniformTextures:function(e,t,r){var i=this,n=r.include_globals;if(e.styles)for(var o in e.styles){var a=e.styles[o];a.shaders&&a.shaders.uniforms&&GLSL.parseUniforms(a.shaders.uniforms).forEach((function(r){var o=r.type,a=r.value,s=r.key,l=r.uniforms;"sampler2D"!==o||"string"!=typeof a||e.textures[a]||!n&&isGlobal(a)||(l[s]=i.hoistTexture(a,e,t))}))}},hoistTexture:function(e,t,r){var i=isGlobal(e),n=i?e:r.urlFor(e),o=i?"texture-".concat(n):n;return t.textures[o]={url:n},o},applyGlobalProperties:function(e){if(!e.global||0===Object.keys(e.global).length)return e;var t=flattenProperties(e.global);function r(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(i.indexOf(e)>-1)log({level:"warn",once:!0},"Global properties: cyclical reference detected",i);else{i.push(e);var n=GLOBAL_PROP_RGX.exec(e);if(n){var o=n[1];if(o){var a=t[o];if(void 0!==a)return"string"==typeof a&&GLOBAL_PROP_RGX.exec(a)?r(a,t,i):a;log({level:"warn",once:!0},"Global property not found: "+e)}else log({level:"warn",once:!0},"Invalid global property reference: "+e)}}}return function e(i,n,o){if("string"==typeof i){var a=r(i,t);void 0!==a&&(i=a)}else if(Array.isArray(i))for(var s=0;s<i.length;s++)i[s]=e(i[s]);else if("object"===_typeof(i))for(var l in i)i[l]=e(i[l]);return i}(e)},finalize:function(e){var t=e.config,r=e.bundle;return t?(t.global=t.global||{},t.scene=t.scene||{},t.cameras=t.cameras||{},t.lights=t.lights||{},t.styles=t.styles||{},t.layers=t.layers||{},t.camera&&(t.cameras.default=t.camera),0===Object.keys(t.cameras).length&&(t.cameras.default={}),(0===Object.keys(t.lights).length||Object.keys(t.lights).every((function(e){return!1===t.lights[e].visible})))&&(t.lights.default_light={type:"directional"}),{config:t,bundle:r}):{}}};function flattenProperties(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var n in r=r?r+t:"",e){var o=r+n,a=e[n];i[o]=a,"object"!==_typeof(a)||Array.isArray(a)||flattenProperties(a,t,o,i)}return i}subscribeMixin(SceneLoader);var TilePyramid=function(){function e(){_classCallCheck(this,e),this.coords={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=10}return _createClass(e,[{key:"sourceTiles",value:function(e,t){return this.coords[e.key]&&this.coords[e.key].sources&&this.coords[e.key].sources[t.name]}},{key:"addTile",value:function(e){var t=e.coords.key,r=this.coords[t];r||(r=this.coords[t]={descendants:0}),r.sources||(r.sources={}),r.sources[e.source.name]||(r.sources[e.source.name]={}),r.sources[e.source.name][e.style_zoom]=e;for(var i=e.coords.z-1;i>=0;i--){var n=Tile.coordinateAtZoom(e.coords,i);this.coords[n.key]||(this.coords[n.key]={descendants:0}),this.coords[n.key].descendants++}}},{key:"removeTile",value:function(e){var t=this.sourceTiles(e.coords,e.source),r=e.coords.key;t&&(delete t[e.style_zoom],0===Object.keys(t).length&&(delete this.coords[r].sources[e.source.name],0===Object.keys(this.coords[r].sources).length&&(delete this.coords[r].sources,0===this.coords[r].descendants&&delete this.coords[r])));for(var i=e.coords.z-1;i>=0;i--){var n=Tile.coordinateAtZoom(e.coords,i);this.coords[n.key]&&this.coords[n.key].descendants>0&&(this.coords[n.key].descendants--,0!==this.coords[n.key].descendants||this.coords[n.key].sources||delete this.coords[n.key])}}},{key:"getAncestor",value:function(e){var t=e.coords,r=e.style_zoom,i=e.source,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(n>this.max_proxy_ancestor_depth)){if(r>i.max_coord_zoom){var o=this.sourceTiles(t,i);if(o)for(var a=r-1;a>=i.max_coord_zoom;a--)if(o[a]&&o[a].loaded)return o[a];r=i.max_coord_zoom}r--;var s=Tile.coordinateAtZoom(t,t.z-1),l=this.sourceTiles(s,i);return l&&l[r]&&l[r].loaded?l[r]:s.z>0?this.getAncestor({coords:s,style_zoom:r,source:i},n+1):void 0}}},{key:"getDescendants",value:function(e){var t=e.coords,r=e.style_zoom,i=e.source,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=[];if(r>=i.max_coord_zoom){var a=this.sourceTiles(t,i);if(a)for(var s=Math.max(Geo$1.default_view_max_zoom,r+this.max_proxy_descendant_depth),l=r+1;l<=s;l++)if(a[l]&&a[l].loaded)return o.push(a[l]),o;return o}if(this.coords[t.key]&&this.coords[t.key].descendants>0){r++;for(var u=Tile.childrenForCoordinate(t),c=0;c<u.length;c++){var h=u[c],f=this.sourceTiles(h,i);f&&f[r]&&f[r].loaded?o.push(f[r]):n<=this.max_proxy_descendant_depth&&h.z<=i.max_coord_zoom&&o.push.apply(o,_toConsumableArray(this.getDescendants({coords:h,source:i,style_zoom:r},n+1)))}}return o}}]),e}(),LabelMainPass=function(){function e(t,r,i,n){_classCallCheck(this,e),Object.assign(this,t),this.placed=null,this._tile=n;var o=Geo$1.unitsPerMeter(n.coords.z)*Math.pow(2,i-n.style_zoom);this.layout=Object.assign({},t.layout),this.layout.repeat_scale=.75,this.layout.repeat_distance=this.layout.repeat_distance||0,this.layout.repeat_distance/=o,this.position=Geo$1.tileSpaceToMeters(this.position,n.coords.z,n.min),this._worldToScreen=r,this._screenSpaceBoundingBox=void 0,this._boundingCircles=void 0}return _createClass(e,[{key:"getTile",value:function(){return this._tile}},{key:"isFlat",value:function(){return this.is_flat}},{key:"getScreenSpaceBoundingBox",value:function(){if(!this._screenSpaceBoundingBox){var e=this._worldToScreen(this.position,!0);e[0]+=this.offset[0],e[1]+=this.offset[1];var t=this.size[0]/2+this.layout.buffer[0],r=this.size[1]/2+this.layout.buffer[1],i=e[0]-t,n=e[0]+t,o=e[1]-r,a=e[1]+r;this._screenSpaceBoundingBox={left:i,bottom:a,right:n,top:o}}return this._screenSpaceBoundingBox}},{key:"getBoundingCircles",value:function(){return this._boundingCircles||(this._boundingCircles="point"===this.type?this._convertSidesToScreenSpaceCircles():this._convertCirclesToScreenSpace()),this._boundingCircles}},{key:"_convertSidesToScreenSpaceCircles",value:function(){var e=this._tile.coords.z,t=this._tile.min,r=Geo$1.tileSpaceToMeters([this.sides[0],this.sides[1]],e,t),i=Geo$1.tileSpaceToMeters([this.sides[2],this.sides[3]],e,t),n=_slicedToArray(this._worldToScreen(r,!0),2),o=n[0],a=n[1],s=_slicedToArray(this._worldToScreen(i,!0),2);return encircleLine(o,a,s[0],s[1],this.size[1]/2+this.layout.buffer[1])}},{key:"_convertCirclesToScreenSpace",value:function(){for(var e=[],t=this.circles,r=this._tile.coords.z,i=this._tile.min,n=0;n<t.length-2;n+=3){var o=Geo$1.tileSpaceToMeters([t[n],-t[n+1]],r,i),a=t[n+2]/Geo$1.unitsPerMeter(r),s=[o[0]+a,o[1]],l=this._worldToScreen(o,!0),u=this._worldToScreen(s,!0),c=MathUtils$1.getLineLength(l[0],l[1],u[0],u[1]);e.push(l[0],l[1],c)}return e}}]),e}(),labelsMainPass={mainThreadLabelCollisionPass:mainThreadLabelCollisionPass},visible={},prev_visible={},IS_LITTLE_ENDIAN=120===new Uint8Array(new Uint32Array([305419896]).buffer)[0];function _createContainer(e,t,r,i,n){var o=e.container,a=o.label,s=o.linked,l=e.ranges;return{label:new LabelMainPass(a,r,i,n),linked:s,ranges:l,mesh:t}}function mainThreadLabelCollisionPass(e,t,r,i,n,o){prev_visible=visible,visible={};var a={},s={},l=[],u=r.worldToScreen.bind(r),c=new TextMeshHelper(o);for(var h in e.forEach((function(e){for(var r in e.meshes)e.meshes[r].forEach((function(r){if(r.labels){for(var i in c.trackMesh(r),r.labels["non-collision"]){var n=_createContainer(r.labels["non-collision"][i],r,u,t,e);n.label.text_data&&c.insertLabel(n,e)}for(var o in r.labels.collision)if(!a[o]){var l=_createContainer(r.labels.collision[o],r,u,t,e);a[o]=l.label,s[o]=l}}}))})),s){var f=s[h];f.linked&&(f.linked=s[f.linked]),l.push(f)}var d=r.getViewport(),_=d.width,p=d.height;return Collision.startTile("main",{apply_repeat_groups:!0,return_hidden:!0,grid_index:new GridIndex(_,p,30)}),Collision.addStyle("main","main"),Collision.collide(l,"main","main").then((function(e){return e.forEach((function(e){var t=e.mesh,r=e.label.getTile();if(t.valid){var n=0;!0!==e.show||i&&e.label.breach&&!prev_visible[e.label.id]||(n=1),n&&(visible[e.label.id]=!0),e.label.text_data&&c.insertLabel(e,r);var o=t.vertex_layout.offset.a_shape,a=t.vertex_layout.stride,s=t.vertex_layout.attribs.find((function(e){return"a_shape"===e.name})),l=s.byte_size/s.size;o+=3*l;var u=!0;e.ranges.forEach((function(e){if(u){for(var r=0;r<e[1];r++){if(t.vertex_data[e[0]+r*a+o]===n)return void(u=!1);t.vertex_data[e[0]+r*a+o]=n}c.trackMesh(t)}}))}})),c.createTextures(n).then((function(){return c.updateMeshes()}))})).then((function(t){t.forEach((function(e){return e.valid&&e.upload()})),e.forEach((function(e){e.labeled=!0})),l=[],s={},a={}}))}var TextMeshHelper=function(){function e(t){_classCallCheck(this,e),this.textureManager=getTextureManager(t),this.tiles={},this.meshes=[],this.containers=[]}return _createClass(e,[{key:"insertLabel",value:function(e,t){var r=e.label.text_data,i=r.text_settings_key,n=r.text,o=r.text_info;this.containers.push(e);var a=this._ensureTextSection(t,i);a[n]?e.label.text_data.text_info=a[n]:a[n]=o}},{key:"trackMesh",value:function(e){-1===this.meshes.indexOf(e)&&this.meshes.push(e)}},{key:"updateMeshes",value:function(){var e=this;return this.containers.forEach((function(t){if(t.label.text_data){var r=t.label.getTile(),i=t.mesh;if(i.valid){var n=t.label.type,o=t.label.text_data.text_info;if(e.tiles[r.id]&&e.tiles[r.id].textures){var a=e.tiles[r.id].textures[0];if(i.uniforms.u_texture=a,-1===i.textures.indexOf(a)&&i.textures.push(a),"point"===n||"straight"===n){var s="point"===n?o.align[t.label.align].texcoords:o.texcoords[n].texcoord;e.setTexCoords(i,t,s)}else if("curved"===n){var l=o.segments.length,u=o.texcoords_stroke,c=o.texcoords.curved;e.setTexCoords(i,t,(function(e){return e<l?u[e]:c[e-l].texcoord}))}}}else if(e.tiles[r.id]&&e.tiles[r.id].textures){var h=e.tiles[r.id].textures[0];e.textureManager.release(h)}}})),this.meshes}},{key:"setTexCoords",value:function(e,t,r){var i,n=r instanceof Function;if(!n){var o=_slicedToArray(r,4),a=o[0],s=o[1],l=o[2],u=o[3];i=[[a,s],[l,s],[l,u],[a,u]]}var c=e.vertex_layout.stride,h=new DataView(e.vertex_data.buffer),f=e.vertex_layout.offset.a_texcoord;t.ranges.forEach((function(e,t){var o=_slicedToArray(e,3),a=o[0],s=o[1],l=o[2];if(n){var u=_slicedToArray(r(t),4),d=u[0],_=u[1],p=u[2],g=u[3];i=[[d,_],[p,_],[p,g],[d,g]]}for(var m=l?s/2:0;m<s;m++){var y=i[m%4],v=a+m*c;h.setUint16(v+f,y[0]*texcoord_normalize,IS_LITTLE_ENDIAN),h.setUint16(v+f+2,y[1]*texcoord_normalize,IS_LITTLE_ENDIAN)}}))}},{key:"createTextures",value:function(e){var t=this;return Promise.all(Object.values(this.tiles).map((function(r){var i=r.id,n=r.key,o=r.texts;return t._createTexturesForTile(e,o,"labels-".concat(n,"-").concat(i),i,t.textureManager).then((function(e){e.length&&(e.forEach((function(e){t.textureManager.retain(e),t.textureManager.getRetainCount(e)>1&&t.textureManager.release(e)})),t.tiles[i].textures=e)}))})))}},{key:"_createTexturesForTile",value:function(e,t,r,i,n){var o=new CanvasText,a=o.setTextureTextPositions(t);return o.rasterize(t,a,i,r,e,n)}},{key:"_ensureTile",value:function(e){var t=e.id,r=e.key;return this.tiles[t]||(this.tiles[t]={id:t,key:r,texts:{}}),this.tiles[t]}},{key:"_ensureTextSection",value:function(e,t){var r=this._ensureTile(e).texts;return r[t]||(r[t]={}),r[t]}}]),e}(),TILE_VISIBILITY_COUNTER_THRESHOLD=30,TileManager=function(){function e(t){var r=this,i=t.scene,n=t.view;_classCallCheck(this,e),this._scene=i,this._view=n,this._visible_tiles={},this._pyramid=new TilePyramid,this._visible_coords={},this._building_tiles=null,this._renderable_tiles=[],this._active_styles=[],this._tile_visibility_counters={},this._update_labels_on_queue_check=!1,this._all_visible_tiles_are_cached=!1,this._debouncedUpdateLabels=debounce(this._updateLabels.bind(this),100,200),this._main_thread_target=["TileManager",this._scene.id].join("_"),WorkerBroker.addTarget(this._main_thread_target,this),this._keepCoordinate=this._keepCoordinate.bind(this),this._removeTilesFilter=this._removeTilesFilter.bind(this),this._removeCachedTilesFilter=this._removeCachedTilesFilter.bind(this),this._is_labeled=!1,this._tile_cache=new H.util.Cache(getMaxTileCacheSize(),(function(e,t,i){r._visible_tiles[e]&&r._visible_tiles[e]===t||t.destroy()}))}return _createClass(e,[{key:"destroy",value:function(){this._tile_cache.removeAll(),this.forEachVisibleTile((function(e){return e.destroy()})),this._visible_tiles={},this._pyramid=null,this._visible_coords={},this._scene=null,this._view=null}},{key:"keepTile",value:function(e){this._visible_tiles[e.key]=e,this._pyramid.addTile(e)}},{key:"hasTile",value:function(e){return void 0!==this._visible_tiles[e]}},{key:"_forgetTile",value:function(e){if(this.hasTile(e)){var t=this._visible_tiles[e];if(this._pyramid.removeTile(t),delete this._visible_tiles[e],t.loaded)this._tile_cache.add(t.key,t,getTileByteLength(t));else{var r=this._tile_cache.get(t.key);r?this._tile_cache.drop(r.key):t.destroy()}this._tileBuildStop(t)}}},{key:"removeTile",value:function(e){this._forgetTile(e),this._scene.requestRedraw()}},{key:"forEachVisibleTile",value:function(e){for(var t in this._visible_tiles)e(this._visible_tiles[t])}},{key:"removeTiles",value:function(e){for(var t in this._visible_tiles)e(this._visible_tiles[t])&&this.removeTile(t)}},{key:"removeCachedTiles",value:function(e){var t=this;this._tile_cache.forEach((function(r,i){e(i)&&t._tile_cache.drop(r)}))}},{key:"updateTilesForView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._visible_coords={};for(var t=this._view.findVisibleTileCoordinates(),r=0;r<t.length;r++){var i=t[r];this._visible_coords[i.key]=i}this.updateTileStates(e)}},{key:"updateTileStates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t in this._all_visible_tiles_are_cached=!0,this._visible_coords)this._keepCoordinate(t,e);this._all_visible_tiles_are_cached&&(this._is_labeled=!1,this._debouncedUpdateLabels()),this._tile_cache.removeAll(this._removeCachedTilesFilter),this._updateProxyTiles(),this.removeTiles(this._removeTilesFilter),this._updateRenderableTiles(),this._updateActiveStyles()}},{key:"_removeTilesFilter",value:function(e){if(e.style_zoom===this._view.lookAtManipulator.getLookAtData().tile_level){if(this._visible_coords[e.coords.key])return!1;for(var t in this._visible_coords)if(Tile.isDescendant(e.coords,this._visible_coords[t]))return!1}return!e.isProxy()}},{key:"_updateLabels",value:function(){var e=this;if(!this._building_tiles||0===Object.keys(this._building_tiles).length){CanvasText.pruneTextCache();var t=this._renderable_tiles.sort(compareTileCoords);labelsMainPass.mainThreadLabelCollisionPass(t,roundPrecision(this._view.lookAtManipulator.getLookAtData().zoom,2),this._view.lookAtManipulator,this.isLoadingVisibleTiles(),this._scene.gl,this._scene.id).then((function(){e._is_labeled=!Task.hasPendingTasks(),e._scene&&e._scene.immediateRedraw(),e._update_labels_on_queue_check=!1}))}}},{key:"_updateProxyTiles",value:function(){var e=this,t=this._view.lookAtManipulator.getZoomDirection();if(0!==t){var r=!1;this.forEachVisibleTile((function(i){if(i.setProxyFor(null),1===t){if(!i.built){var n=e._pyramid.getAncestor(i);n&&(n.setProxyFor(i),r=!0)}}else if(-1===t&&!i.built)for(var o=e._pyramid.getDescendants(i),a=0;a<o.length;a++)o[a].setProxyFor(i),r=!0})),r||this._view.lookAtManipulator.resetZoomDirection()}}},{key:"getRenderableTiles",value:function(){return this._renderable_tiles}},{key:"_updateRenderableTiles",value:function(){for(var e in this._renderable_tiles=[],this._visible_tiles){var t=this._visible_tiles[e],r=this._tile_cache.get(e);t.loaded?(this._renderable_tiles.push(t),r&&r!==t&&this._tile_cache.drop(e)):r&&(r.generation===this._scene.generation?this._renderable_tiles.push(r):this._tile_cache.drop(e))}return this._renderable_tiles}},{key:"getWorkerForTile",value:function(e,t){return t.has_volatile_data?this._scene.getWorkers(WorkerType.FAKE)[0]:t.tiled?this._scene.getWorkers(WorkerType.NATIVE)[Math.abs(e.x+e.y+e.z)%this._scene.num_workers]:this._scene.getWorkers(WorkerType.NATIVE)[t.id%this._scene.num_workers]}},{key:"getActiveStyles",value:function(){return this._active_styles}},{key:"_updateActiveStyles",value:function(){for(var e=this._renderable_tiles,t={},r=0;r<e.length;r++){var i=e[r];Object.keys(i.meshes).forEach((function(e){return t[e]=!0}))}return this._active_styles=Object.keys(t),this._active_styles}},{key:"isLoadingVisibleTiles",value:function(){var e=!1;for(var t in this._visible_tiles){if(!this._visible_tiles[t].built){e=!0;break}}return e}},{key:"updateTilesVisibilityCounters",value:function(){var e=this;Object.keys(this._visible_coords).forEach((function(t){t in e._tile_visibility_counters||(e._tile_visibility_counters[t]=0)}));var t=Object.keys(this._tile_visibility_counters),r=[];t.forEach((function(t){t in e._visible_coords?(e._tile_visibility_counters[t]++,e._tile_visibility_counters[t]>=TILE_VISIBILITY_COUNTER_THRESHOLD&&r.push(e._visible_coords[t])):(e._tile_visibility_counters[t]--,e._tile_visibility_counters[t]<=0&&delete e._tile_visibility_counters[t])})),r.length&&this.loadCoordinates(r)}},{key:"loadCoordinates",value:function(e){var t=this;e.sort((function(e,r){var i=t._view.lookAtManipulator.getLookAtData().position,n=Geo$1.metersPerTile(e.z)/2,o=Geo$1.metersForTile(e);o.x+=n,o.y-=n;var a=Geo$1.metersForTile(r);a.x+=n,a.y-=n;var s=Math.abs(i[0]-o.x)+Math.abs(i[1]-o.y),l=Math.abs(i[0]-a.x)+Math.abs(i[1]-a.y);return e.center_dist=s,r.center_dist=l,l>s?-1:l===s?0:1})),e.forEach((function(e){return t.loadCoordinate(e)}))}},{key:"_keepCoordinate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._visible_coords[e];if(r.z===this._view.center_tile.z)for(var i in this._scene.sources){var n=this._scene.sources[i];if(n.builds_geometry_tiles&&n.includesTile(r,this._view.lookAtManipulator.getLookAtData().tile_level)){var o=Tile.normalizedKey(r,n,this._view.lookAtManipulator.getLookAtData().tile_level);if(o&&!this.hasTile(o)){var a=t&&this._tile_cache.get(o);a||(this._all_visible_tiles_are_cached=!1);var s=a||new Tile({source:n,coords:r,worker:this.getWorkerForTile(r,n),style_zoom:Utils$1.zoomToTileLevel(r.z),view:this._view,sceneId:this._scene.id});"ObjectSource"===n.config.type&&(s.syncedAt=n.getSyncedAt()),this.keepTile(s)}}}}},{key:"loadCoordinate",value:function(e){if(e.z===this._view.center_tile.z)for(var t in this._scene.sources){var r=this._scene.sources[t];if(r.builds_geometry_tiles&&r.includesTile(e,this._view.lookAtManipulator.getLookAtData().tile_level)){var i=Tile.normalizedKey(e,r,this._view.lookAtManipulator.getLookAtData().tile_level);this.hasTile(i)&&this.buildTile(this._visible_tiles[i])}}}},{key:"buildTile",value:function(e,t){this._building_tiles&&this._building_tiles[e.key]||e.built&&e.generation===this._scene.generation||(this._tileBuildStart(e.key),e.build(this._scene.generation,t))}},{key:"buildTileStylesCompleted",value:function(e){var t=e.tile,r=e.progress;if(null==this._visible_tiles[t.key])Tile.abortBuild(t,this._scene.id);else if(t.generation!==this._scene.generation)Tile.abortBuild(t,this._scene.id);else{if(t.id<this._visible_tiles[t.key].id)return void Tile.abortBuild(t,this._scene.id);t=this._visible_tiles[t.key].merge(t),r.done&&(t.built=!0),t.buildMeshes(this._scene.styles,r),this.updateTileStates(),this._scene.requestRedraw()}r.done&&this._tileBuildStop(t)}},{key:"buildTileError",value:function(e){this._forgetTile(e.key),Tile.abortBuild(e,this._scene.id)}},{key:"_tileBuildStart",value:function(e){this._is_labeled=!1,this._building_tiles=this._building_tiles||{},this._building_tiles[e]=!0}},{key:"_tileBuildStop",value:function(e){this._building_tiles&&(e.source&&e.source.hasLabeledData()&&(this._update_labels_on_queue_check=!0),delete this._building_tiles[e.key],Task.removeForTile(e.id),this.checkBuildQueue())}},{key:"isReady",value:function(){return this._is_labeled&&!this.isLoadingVisibleTiles()}},{key:"checkBuildQueue",value:function(){this._building_tiles&&0!==Object.keys(this._building_tiles).length||(this._building_tiles=null,this._update_labels_on_queue_check?this._updateLabels():(this._is_labeled=!Task.hasPendingTasks(),this._scene.immediateRedraw()))}},{key:"_removeCachedTilesFilter",value:function(e,t,r){var i=t.source;return!this._visible_tiles[e]&&(t.generation!==this._scene.generation||"ObjectSource"===i.config.type&&i.getSyncedAt()>t.syncedAt)}}]),e}();function compareTileCoords(e,t){var r=e.coords,i=t.coords;return r.z-i.z||r.x-i.x||r.y-i.y}function roundPrecision(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=Math.pow(10,r);return Math.round(Math.floor(e*t)/t*i)/i}function getTileByteLength(e){var t=0;for(var r in e.meshes)for(var i=e.meshes[r],n=0;n<i.length;n++){var o=i[n];t+=o.buffer_size;for(var a=0;a<o.textures.length;a++)t+=e.textureManager.getByteLength(o.textures[a])}return t}function getMaxTileCacheSize(){var e=.1;return navigator&&navigator.deviceMemory?e=5*navigator.deviceMemory/100:window&&window.screen&&(e=window.screen.width/512*window.screen.height/512*.03*3,e=Math.min(e,1)),1024*e*1024*1024}var RenderState=function(){function e(t,r){_classCallCheck(this,e),r(t),this.value=t,this.setup=r}return _createClass(e,[{key:"get",value:function(){return this.value}},{key:"set",value:function(e){JSON.stringify(this.value)!==JSON.stringify(e)&&(this.setup(e),this.value=e)}}]),e}(),RenderStateManager=function e(t){_classCallCheck(this,e),this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=t.BACK,this.defaults.blending=!1,this.defaults.blending_src=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=t.ONE,this.defaults.blending_dst_alpha=t.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,t.depthFunc(t.LESS),this.culling=new RenderState({cull:this.defaults.culling,face:this.defaults.culling_face},(function(e){e.cull?(t.enable(t.CULL_FACE),t.cullFace(e.face)):t.disable(t.CULL_FACE)})),this.blending=new RenderState({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},(function(e){e.blend?(t.enable(t.BLEND),e.src_alpha&&e.dst_alpha?t.blendFuncSeparate(e.src,e.dst,e.src_alpha,e.dst_alpha):t.blendFunc(e.src,e.dst)):t.disable(t.BLEND)})),this.depth_write=new RenderState({depth_write:this.defaults.depth_write},(function(e){t.depthMask(e.depth_write)})),this.depth_test=new RenderState({depth_test:this.defaults.depth_test},(function(e){e.depth_test?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)}))},MediaCapture=function(){function e(){_classCallCheck(this,e),this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}return _createClass(e,[{key:"setCanvas",value:function(e,t){this.canvas=e,this.gl=t}},{key:"screenshot",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:t},this.queue_screenshot.promise=new Promise((function(t,r){e.queue_screenshot.resolve=t,e.queue_screenshot.reject=r}))),this.queue_screenshot.promise}},{key:"completeScreenshot",value:function(){if(null!=this.queue_screenshot){var e=this.canvas.width,t=this.canvas.height,r=new Uint8Array(e*t*4);this.gl.readPixels(0,0,e,t,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r);var i=this.queue_screenshot.background;i=i&&"transparent"!==i?StyleParser.parseColor(i).slice(0,3).map((function(e){return 255*e})):null;for(var n=new Uint8ClampedArray(e*t*4),o=0;o<t;o++)for(var a=0;a<e;a++){var s=4*((t-o-1)*e+a),l=4*(o*e+a),u=r[s+3];n[l+0]=255*r[s+0]/u,n[l+1]=255*r[s+1]/u,n[l+2]=255*r[s+2]/u,n[l+3]=u,i&&(u/=255,n[l+0]=n[l+0]*u+i[0]*(1-u),n[l+1]=n[l+1]*u+i[1]*(1-u),n[l+2]=n[l+2]*u+i[2]*(1-u),n[l+3]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var c=this.screenshot_canvas;c.width=e,c.height=t,this.screenshot_context=this.screenshot_context||c.getContext("2d");var h=this.screenshot_context,f=new ImageData(n,e,t);h.putImageData(f,0,0);for(var d=c.toDataURL("image/png"),_=atob(d.slice(22)),p=new Uint8Array(_.length),g=0;g<_.length;++g)p[g]=_.charCodeAt(g);var m=new Blob([p],{type:"image/png"});this.queue_screenshot.resolve({url:d,blob:m,type:"png"}),this.queue_screenshot=null}}},{key:"startVideoCapture",value:function(){var e=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return log("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return log("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var t=this.video_capture={};t.chunks=[],t.stream=this.canvas.captureStream(),t.options={mimeType:"video/webm"},t.media_recorder=new MediaRecorder(t.stream,t.options),t.media_recorder.ondataavailable=function(r){if(r.data.size>0&&t.chunks.push(r.data),t.resolve){var i=new Blob(t.chunks,{type:t.options.mimeType}),n=createObjectURL(i);if(t.stream)(t.stream.getTracks()||[]).forEach((function(e){e.stop(),t.stream.removeTrack(e)}));t.stream=null,t.media_recorder=null,e.video_capture=null,t.resolve({url:n,blob:i,type:"webm"})}},t.media_recorder.start()}catch(e){return this.video_capture=null,log("error","Scene video capture failed",e),!1}return!0}},{key:"stopVideoCapture",value:function(){var e=this;return this.video_capture?(this.video_capture.promise=new Promise((function(t,r){e.video_capture.resolve=t,e.video_capture.reject=r})),this.video_capture.media_recorder.stop(),this.video_capture.promise):(log("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}}]),e}(),SceneWorker=function(){function e(){_classCallCheck(this,e),this.sources={},this.styles={},this.layers={},this.tiles={},this._isConfigured=!1}return _createClass(e,[{key:"init",value:function(e,t,r,i,n,o,a){return this.setMeshVariantMaxLife(a),this.scene_id=e,this.textureManager=getTextureManager(e),this._worker_id=t,log.setLevel(r),Utils$1.device_pixel_ratio=i,VertexElements.setElementIndexUint(n),FeatureSelection.setPrefix(this._worker_id),this._style_manager=new StyleManager,this._importExternalScripts(o),Label.id_prefix=t,this._isConfigured=!1,t}},{key:"dispose",value:function(){this._last_config_sources=null,this._config_sources=null,this.sources=null,this._style_manager=null,this.styles=null,this.layers=null,this.tiles=null}},{key:"_importExternalScripts",value:function(e){if(0!==e.length){log("debug","loading custom data source scripts in worker:",e);var t=Object.getOwnPropertyNames(window);importScripts.apply(void 0,_toConsumableArray(e)),Object.getOwnPropertyNames(window).forEach((function(e){-1===t.indexOf(e)&&(self[e]=window[e])}))}}},{key:"updateConfig",value:function(e,t){var r=e.config,i=e.generation,n=e.introspection;for(var o in r=JSON.parse(r),mergeDebugSettings(t),this._generation=i,this._isConfigured=!1,r.layers)r.layers[o]&&(r.layers[o].data=Utils$1.stringsToFunctions(r.layers[o].data));this.global=Utils$1.stringsToFunctions(r.global),this._createDataSources(r),r.styles=Utils$1.stringsToFunctions(r.styles,StyleParser.wrapFunction),this.styles=this._style_manager.build(r.styles),self.is_fake_worker=Thread.is_main,this._style_manager.initStyles({generation:this._generation,styles:this.styles,sources:this.sources,introspection:n,id:this.scene_id}),delete self.is_fake_worker,this.layers=parseLayers(r.layers,this._style_manager.styles),this._configuring=this._syncTextures(r.textures)}},{key:"setMeshVariantMaxLife",value:function(e){this.meshVariantMaxLife=e}},{key:"_createDataSources",value:function(e){var t=this;this._last_config_sources=this._config_sources||{},this._config_sources=e.sources;var r=this.sources,i=[];for(var n in e.sources=Utils$1.stringsToFunctions(e.sources),this.sources={},self.is_fake_worker=Thread.is_main,e.sources)if(JSON.stringify(this._last_config_sources[n])!==JSON.stringify(e.sources[n])){var o=void 0;try{o=DataSource.create(Object.assign({},e.sources[n],{name:n}),this.sources)}catch(t){log("error","Error creating source.",t.message,e.sources[n]);continue}o&&(this.sources[n]=o,i.push(n))}else this.sources[n]=r[n];delete self.is_fake_worker,i.forEach((function(e){for(var r in t.tiles)t.tiles[r].source===e&&delete t.tiles[r]}))}},{key:"awaitConfiguration",value:function(){return this._configuring}},{key:"_onConfig",value:function(e){var t=this;if(this._isConfigured=!0,!0!==e.loaded)e.loading=!0,e.loaded=!1,e.error=null,this._loadTileSourceData(e).then((function(){if(t.getTile(e.id)){e.loading=!1,e.loaded=!0;try{Tile.buildGeometry(e,t)}catch(r){e.error=r.toString(),WorkerBroker.postMessage("TileManager_".concat(t.scene_id,".buildTileError"),Tile.slice(e))}}else log("trace","stop tile build after data source load because tile was removed. Key: ".concat(e.key,", id: ").concat(e.id))}),(function(r){e.loading=!1,e.loaded=!1,e.error=r.stack,log("error","tile load error for tile with key ".concat(e.key," and id ").concat(e.id,": ").concat(e.error)),WorkerBroker.postMessage("TileManager_".concat(t.scene_id,".buildTileError"),Tile.slice(e))}));else{log("trace","used worker cache for tile with key ".concat(e.key," and id ").concat(e.id));try{Tile.buildGeometry(e,this)}catch(t){e.error=t.toString(),WorkerBroker.postMessage("TileManager_".concat(this.scene_id,".buildTileError"),Tile.slice(e))}}}},{key:"buildTile",value:function(e){var t=e.tile,r=this.getTile(t.id);if(!r||!r.loading)if(t=this.tiles[t.id]=Object.assign(r||{},t),this._isConfigured)this._onConfig(t);else{var i=this;this.awaitConfiguration().then((function(){return i._onConfig(t)}))}}},{key:"_loadTileSourceData",value:function(e){return this.sources[e.source]?this.sources[e.source].load(e):(e.source_data={},Promise.resolve(e))}},{key:"getTile",value:function(e){return this.tiles[e]}},{key:"removeTile",value:function(e){var t=this.tiles[e];null!=t&&(!0===t.loading&&(log("trace","cancel tile load for tile id ".concat(e)),t.loading=!1,Tile.cancel(t)),delete this.tiles[e],log("trace","remove tile from cache, tile id: ".concat(e)))}},{key:"queryFeatures",value:function(e){var t=this,r=e.filter,i=e.visible,n=e.geometry,o=e.tile_ids,a=[],s=o.map((function(e){return t.tiles[e]})).filter((function(e){return e}));return null!=r&&(r=["{","["].indexOf(r[0])>-1?JSON.parse(r):r,r=Utils$1.stringsToFunctions(r,StyleParser.wrapFunction)),r=buildFilter(r,FilterOptions),s.forEach((function(e){var o=function(o){e.source_data.layers[o].features.forEach((function(s){if(!(!0===i&&s.generation!==t._generation||!1===i&&s.generation===t._generation)){var l=StyleParser.getFeatureParseContext(s,e,t.global);if(l.source=e.source,l.layer=o,r(l)){var u={type:s.type,properties:s.properties};!0===n&&(u.geometry=Geo$1.copyGeometry(s.geometry),Geo$1.tileSpaceToLatlng(u.geometry,e.coords.z,e.min)),a.push(u)}}}))};for(var s in e.source_data.layers)o(s)})),a}},{key:"resetFeatureSelection",value:function(){FeatureSelection.reset()}},{key:"_syncTextures",value:function(e){var t=[];return e&&t.push.apply(t,_toConsumableArray(Object.keys(e))),log("trace","sync textures to worker:",t),t.length>0?this.textureManager.syncTexturesToWorker(t):Promise.resolve()}},{key:"profile",value:function(e){console.profile("worker ".concat(this._worker_id,": ").concat(e))}},{key:"profileEnd",value:function(e){console.profileEnd("worker ".concat(this._worker_id,": ").concat(e))}},{key:"terminate",value:function(){this.dispose()}}]),e}();(Thread.is_worker||self.H&&self.H.DEBUG)&&WorkerBroker.addTarget("self",new SceneWorker);var Scene=function(){function e(t,r){_classCallCheck(this,e),r=r||{},subscribeMixin(this),this.id=e.id++,this.textureManager=getTextureManager(this.id),this.initialized=!1,this.initializing=null,this.sources={},this.view=new View(this,r),this.tile_manager=new TileManager({scene:this,view:this.view}),this.num_workers=r.numWorkers||2,!0===r.disableVertexArrayObjects&&(VertexArrayObject.disabled=!0),Utils$1.device_pixel_ratio=r.devicePixelRatio,this.config=null,this.config_source=t,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new StyleManager,this.building=null,this.dirty=!0,r.preUpdate&&this.subscribe({pre_update:r.preUpdate}),r.postUpdate&&this.subscribe({post_update:r.postUpdate}),this.render_loop=!r.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new MediaCapture,this.selection=null,this.introspection=!0===r.introspection,this.viewport=r.viewport,this.adjustMeshVariantMaxLife(),this.container=r.container,this.canvas=null,this.contextOptions=r.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=e.generation,this.last_complete_generation=e.generation,this.log_level=r.logLevel||"warn",log.setLevel(this.log_level),log.reset()}return _createClass(e,[{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initializing||(log.reset(),this.updating++,this.initialized=!1,this.initial_build_time=null,(r="string"==typeof r?{base_path:r}:r).blocking=void 0===r.blocking||r.blocking,!1!==this.render_loop?this.setupRenderLoop():document.hidden&&document.addEventListener("visibilitychange",(function(){document.hidden||(e.setupRenderLoop(),setTimeout((function(){e.render_loop_stop=!0}),1e3))})),this.createCanvas(),this.textureManager.destroy(this.gl),this.initializing=this.loadScene(t,r).then((function(){return e.createWorkers()})).then((function(){e.resetFeatureSelection();var t="object"===_typeof(e.config_source)||e.hasSubscribersFor("load"),i=e.updateConfig({serialize_funcs:t,normalize:!1,load_event:!0,fade_in:!0});if(!0===r.blocking)return i})).then((function(){e.updating--,e.initializing=null,e.initialized=!0,e.last_valid_config_source=e.config_source,e.last_valid_options={base_path:r.base_path,file_type:r.file_type},e.requestRedraw()})).catch((function(t){var r,i;if(e.initializing=null,e.updating=0,"YAMLException"===t.name?(r="yaml",i="Error parsing scene YAML"):i="Error initializing scene",e.trigger("error",{type:r,message:i,error:t,url:e.config_source}),i="Scene.load() failed to load ".concat(e.config_source,": ").concat(t.message),e.last_valid_config_source)return log("warn",i,t),log("info","Scene.load() reverting to last valid configuration"),e.load(e.last_valid_config_source,e.last_valid_base_path);throw log("error",i,t),t}))),this.initializing}},{key:"destroy",value:function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.selection&&this.selection.destroy(),this.gl){this.textureManager.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},ShaderProgram.reset();var e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.gl=null}this.sources={},this.tile_manager.destroy(),this.tile_manager=null,this.destroyWorkers(),log.reset()}},{key:"createCanvas",value:function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=Context$1.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!1,stencil:!0,device_pixel_ratio:Utils$1.device_pixel_ratio},this.contextOptions))}catch(e){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.handleViewportUpdate(),VertexArrayObject.init(this.gl),this.render_states=new RenderStateManager(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}}},{key:"getWorkerUrl",value:function(){var e;if(void 0!==__worker_src__){var t="("+__worker_src__+")()";if(__worker_src_origin__&&""!==__worker_src_map__)t+="\n//# sourceMappingURL="+__worker_src_origin__.slice(0,__worker_src_origin__.lastIndexOf("/")+1)+__worker_src_map__;e=createObjectURL(new Blob([t],{type:"application/javascript"}))}if(!e)throw new Error("Couldn't find internal Tangram source variable (may indicate the library did not build correctly)");return e}},{key:"updateExternalScripts",value:function(){var e=_toConsumableArray(this.external_scripts||[]),t=[];if(this.config.scene.scripts)for(var r in this.config.scene.scripts)-1===t.indexOf(this.config.scene.scripts[r])&&t.push(this.config.scene.scripts[r]);for(var i in this.config.sources){var n=this.config.sources[i];if(n.scripts)for(var o in n.scripts)-1===t.indexOf(n.scripts[o])&&t.push(n.scripts[o])}return this.external_scripts=t,!(this.external_scripts.length===e.length&&this.external_scripts.every((function(t,r){return t===e[r]})))}},{key:"createWorkers",value:function(){return this.updateExternalScripts()&&this.destroyWorkers(),this._workers?Promise.resolve():this.makeWorkers(this.getWorkerUrl())}},{key:"makeWorkers",value:function(e){var t=this,r=!!this.gl.getExtension("OES_element_index_uint"),i=[];this._workers=[];for(var n=0,o=function(){var o=new Worker(e);t._workers[n]=o,WorkerBroker.addWorker(o),log("debug","Scene.makeWorkers: initializing worker ".concat(n));var a=n;i.push(WorkerBroker.postMessage(o,"self.init",t.id,n,t.log_level,Utils$1.device_pixel_ratio,r,t.external_scripts,t.meshVariantMaxLife).then((function(e){return log("debug","Scene.makeWorkers: initialized worker ".concat(e)),e}),(function(e){return log("error","Scene.makeWorkers: failed to initialize worker ".concat(a,":"),e),Promise.reject(e)})))};n<this.num_workers;n++)o();var a=new SceneWorker;return this._workers.push(a),i.push(a.init(this.id,n,this.log_level,Utils$1.device_pixel_ratio,r,[],this.meshVariantMaxLife)),this.next_worker=0,Promise.all(i).then((function(){log.setWorkers(t._workers.slice(0,t.num_workers)),revokeObjectURL(e)}))}},{key:"getWorkers",value:function(e){return this._workers.filter((function(t){switch(e){case WorkerType.NATIVE:return t instanceof Worker;case WorkerType.FAKE:return t instanceof SceneWorker;default:return!0}}))}},{key:"destroyWorkers",value:function(){this.selection=null,Array.isArray(this._workers)&&(log.setWorkers(null),this._workers.forEach((function(e){e.terminate()})),this._workers=null)}},{key:"ready",value:function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)}},{key:"handleViewportUpdate",value:function(){var e=this.viewport,t=e.width,r=e.height;t>0&&r>0&&(this.dirty=!0,this.view.handleViewportUpdate(),this.gl&&Context$1.resize(this.gl,t,r,Utils$1.device_pixel_ratio)),this.adjustMeshVariantMaxLife()&&this.syncMeshVariantMaxLife()}},{key:"adjustMeshVariantMaxLife",value:function(){var e=this.viewport,t=e.width,r=e.height,i=Utils$1.device_pixel_ratio,n=t/i/256*(r/i/256),o=Math.max(Math.ceil(2*n),8);if(this.meshVariantMaxLife!==o)return this.meshVariantMaxLife=o,!0}},{key:"syncMeshVariantMaxLife",value:function(){this._workers&&WorkerBroker.postMessage(this._workers,"self.setMeshVariantMaxLife",this.meshVariantMaxLife)}},{key:"requestRedraw",value:function(){this.dirty=!0}},{key:"immediateRedraw",value:function(){this.dirty=!0,this.update()}},{key:"renderLoop",value:function(){this.render_loop_active=!0,this.initialized&&this.update(),Task.setState({user_moving_view:this.view.user_input_active}),Task.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))}},{key:"setupRenderLoop",value:function(){var e=this;this.render_loop_active||setTimeout((function(){e.renderLoop()}),0)}},{key:"update",value:function(){var e=this.dirty,t=!!this.selection&&this.selection.hasPendingRequests(),r=!(!1===e&&!1===t||!1===this.initialized||this.updating>0||!1===this.ready());return this.trigger("pre_update",r),this.view.update(),!!r&&(this.dirty=!1,this.render({main:e,selection:t}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",r),(!0===this.animated||this.view.isAnimating())&&(this.dirty=!0),this.frame++,log("trace","Scene.render()"),!0)}},{key:"render",value:function(e){var t=this,r=e.main,i=e.selection,n=this.gl;if(Object.keys(this.lights).forEach((function(e){return t.lights[e].update()})),r&&(this.render_count=this.renderPass(),this.last_main_render=this.frame),i){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();(this.last_selection_render<this.last_main_render||this.selection.has_dirty_buffer)&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.canvas.width,this.canvas.height),n.clearColor.apply(n,_toConsumableArray(this.background.color)),this.last_selection_render=this.frame,this.selection.has_dirty_buffer=!1),this.selection.read(this.tile_manager.getRenderableTiles()),this.selection.has_dirty_buffer&&this.render({main:!1,selection:i})}return this.render_count_changed=!1,this.render_count!==this.last_render_count&&(this.render_count_changed=!0),this.last_render_count=this.render_count,!0}},{key:"renderPass",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program",r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).allow_blend,i=this.gl;r=null==r||r,this.clearFrame();for(var n,o,a=Style.sortByBlendOrderWithinLayers(this.tile_manager.getActiveStyles().map((function(t){return e.styles[t]})).filter((function(e){return e}))),s=0,l=0,u=0;u<a.length;u++){var c=a[u],h=l-(o=parseInt(c.name));if((c.clean_depth||h)&&(this.render_states.depth_write.value.depth_write?i.clear(i.DEPTH_BUFFER_BIT):(i.depthMask(!0),i.clear(i.DEPTH_BUFFER_BIT),i.depthMask(!1)),h&&(l=o)),c.blend!==n){var f=Object.assign({},Style.render_states[c.blend],{blend:r&&c.blend});this.setRenderState(f)}var d="translucent"===c.blend&&"program"===t;d&&(this.gl.colorMask(!1,!1,!1,!1),this.renderStyle(c.name,t),this.gl.colorMask(!0,!0,!0,!0),this.gl.depthFunc(this.gl.EQUAL),this.gl.enable(this.gl.STENCIL_TEST),this.gl.clear(this.gl.STENCIL_BUFFER_BIT),this.gl.stencilFunc(this.gl.EQUAL,this.gl.ZERO,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.INCR)),s+=this.renderStyle(c.name,t),d&&(this.gl.disable(this.gl.STENCIL_TEST),this.gl.depthFunc(this.gl.LESS)),n=c.blend}return s}},{key:"renderStyle",value:function(e,t){for(var r,i=this,n=this.styles[e],o=!0,a=0,s=this.tile_manager.getRenderableTiles(),l=Math.max.apply(Math,_toConsumableArray(s.map((function(t){return t.meshes[e]?Math.max.apply(Math,_toConsumableArray(t.meshes[e].map((function(e){return e.variant.order})))):-1})))),u=function(l){for(var u=0;u<s.length;u++){var c=s[u];if(null!=c.meshes[e]&&c.shouldProxyForStyle(e))for(var h=c.meshes[e].filter((function(e){return e.variant.order===l})),f=0,d=h.length;f<d;f+=1){var _=h[f];if(!0===o&&(o=!1,!(r=i.setupStyle(n,t))))return{v:0};i.view.setupTile(c,r),i.selection.setupDiscards(r),n.render(_)&&i.requestRedraw(),a+=_.geometry_count}}},c=0;c<l+1;c++){var h=u(c);if("object"===_typeof(h))return h.v}return a}},{key:"setupStyle",value:function(e,t){var r;try{if(!(r=e.getProgram(t)))return}catch(t){return void this.trigger("warning",{type:"styles",message:"Error compiling style ".concat(e.name),style:e,shader_errors:e.program&&e.program.shader_errors})}for(var i in r.use(),e.setup(),this.view.setupProgram(r),this.lights)this.lights[i].setupProgram(r);return r}},{key:"clearFrame",value:function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))}},{key:"setRenderState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.depth_test,r=e.depth_write,i=e.cull_face,n=e.blend;if(this.initialized){var o=this.render_states;t=!1!==t&&o.defaults.depth_test,r=!1!==r&&o.defaults.depth_write,i=!1!==i&&o.defaults.culling,n=null!=n?n:o.defaults.blending;var a=this.gl;o.depth_test.set({depth_test:t}),o.depth_write.set({depth_write:r}),o.culling.set({cull:i,face:o.defaults.culling_face}),n?"opaque"===n?o.blending.set({blend:!1}):"overlay"===n||"inlay"===n||"translucent"===n?o.blending.set({blend:!0,src:a.SRC_ALPHA,dst:a.ONE_MINUS_SRC_ALPHA,src_alpha:a.ONE,dst_alpha:a.ONE_MINUS_SRC_ALPHA}):"add"===n?o.blending.set({blend:!0,src:a.ONE,dst:a.ONE}):"multiply"===n&&o.blending.set({blend:!0,src:a.ZERO,dst:a.SRC_COLOR}):o.blending.set({blend:!1})}}},{key:"getFeatureAt",value:function(e,t,r){var i=t.radius,n=t.top_most_only;if(this.initialized){var o={x:e.x/this.view.size.css.width,y:e.y/this.view.size.css.height};i=i>0?{x:i/this.view.size.css.width,y:i/this.view.size.css.height}:null,this.selection.getFeatureAt(o,{radius:i,top_most_only:n},r)}else log("debug","Scene.getFeatureAt() called before scene was initialized")}},{key:"queryFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filter,r=e.unique,i=void 0===r||r,n=e.group_by,o=void 0===n?null:n,a=e.visible,s=void 0===a?null:a,l=e.geometry,u=void 0!==l&&l;t=Utils$1.serializeWithFunctions(t);var c=this.tile_manager.getRenderableTiles().map((function(e){return e.id}));return WorkerBroker.postMessage(this._workers,"self.queryFeatures",{filter:t,visible:s,geometry:u,tile_ids:c}).then((function(e){var t=[],r={},n={},a=(i="string"==typeof i?[i]:i)&&function(e){return JSON.stringify(Array.isArray(i)?sliceObject(e,i):e)},s=(o=("string"==typeof o||Array.isArray(o))&&o)&&function(e){return Array.isArray(o)?JSON.stringify(sliceObject(e,o)):e[o]};return e.forEach((function(e){return e.forEach((function(e){if(a){var i=a(e);if(r[i])return;r[i]=!0}if(s){var o=s(e.properties);n[o]=n[o]||[],n[o].push(e)}else t.push(e)}))})),s?n:t}))}},{key:"loadScene",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.base_path,n=r.file_type;return this.config_source=t||this.config_source,"string"==typeof this.config_source?this.base_path=pathForURL(i||this.config_source):this.base_path=pathForURL(i),this.config_path=this.base_path,SceneLoader$1.loadScene(this.config_source,{path:this.base_path,type:n}).then((function(t){var r=t.config,i=t.bundle;return e.config=r,e.config_bundle=i,e.config}))}},{key:"createDataSources",value:function(){var e=this,t=[],r=Object.keys(this.sources),i=0;for(var n in this.config.sources){var o=this.config.sources[n],a=this.sources[n];try{var s=Object.assign({},o,{name:n,id:i++});if(this.sources[n]=DataSource.create(s,this.sources),!this.sources[n])throw{}}catch(e){delete this.sources[n];var l="Could not create data source: ".concat(e.message);log("warn","Scene: ".concat(l),o),this.trigger("warning",{type:"sources",source:o,message:l})}DataSource.sameConfig(this.sources[n],a)||t.push(n)}for(var u in r.forEach((function(r){e.config.sources[r]||(delete e.sources[r],t.push(r))})),t.length>0&&this.tile_manager.removeTiles((function(e){return t.indexOf(e.source.name)>-1})),this.config.layers){var c=this.config.layers[u];!1!==c.enabled&&c.data&&this.sources[c.data.source]&&(this.sources[c.data.source].builds_geometry_tiles=!0)}}},{key:"loadTextures",value:function(){var e=this;return this.textureManager.createFromObject(this.gl,this.config.textures).then((function(){return e.textureManager.createDefault(e.gl)}))}},{key:"updateStyles",value:function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var e in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[e].setGL(this.gl);this.dirty=!0}},{key:"createLights",value:function(){for(var e in this.lights={},this.config.lights)if(this.config.lights[e]&&"object"===_typeof(this.config.lights[e])){var t=this.config.lights[e];t.name=e.replace("-","_"),t.visible=!1!==t.visible,t.visible&&(this.lights[t.name]=Light.create(this.view,t))}Light.inject(this.lights)}},{key:"setBackground",value:function(){var e,t=this.config.scene.background;this.background={},t&&t.color&&(this.background.color=StyleParser.parseColor(t.color)),this.background.color||(this.background.color=[0,0,0,0]),1===this.background.color[3]?this.canvas.style.backgroundColor="rgba(".concat(this.background.color.map((function(e){return Math.floor(255*e)})).join(", "),")"):this.canvas.style.backgroundColor="transparent",(e=this.gl).clearColor.apply(e,_toConsumableArray(this.background.color))}},{key:"setIntrospection",value:function(e){var t=this;return e!==this.introspection?(this.introspection=e||!1,this.updating++,this.updateConfig({normalize:!1}).then((function(){return t.updating--}))):Promise.resolve()}},{key:"updateConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.load_event,i=void 0!==r&&r,n=t.serialize_funcs,o=t.normalize,a=void 0===o||o;t.fade_in,this.generation=++e.generation,this.updating++,this.config=SceneLoader$1.applyGlobalProperties(this.config),a?SceneLoader$1.normalize(this.config,this.config_bundle):(SceneLoader$1.hoistStyleShaderUniformTextures(this.config,this.config_bundle,{include_globals:!0}),SceneLoader$1.normalizeTextures(this.config,this.config_bundle)),this.trigger(i?"load":"update",{config:this.config}),this.style_manager.init(),this.createLights(),this.createDataSources(),this.loadTextures(),this.setBackground(),FontManager.loadFonts(this.config.fonts),this.updateStyles();var s=this.syncConfigToWorker({serialize_funcs:n});return this.updating--,this.view.updateBounds(),this.requestRedraw(),s}},{key:"syncConfigToWorker",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).serialize_funcs,t=void 0===e||e?Utils$1.serializeWithFunctions(this.config):JSON.stringify(this.config);return WorkerBroker.postMessage(this._workers,"self.updateConfig",{config:t,generation:this.generation,introspection:this.introspection},debugSettings$1)}},{key:"createListeners",value:function(){var e=this;this.listeners={},this.listeners.view={move:function(){return e.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return e.dirty=!0},warning:function(t){return e.trigger("warning",Object.assign({type:"textures"},t))}},this.textureManager.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(t){return e.trigger("error",Object.assign({type:"scene"},t))}},SceneLoader$1.subscribe(this.listeners.scene_loader)}},{key:"destroyListeners",value:function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),this.textureManager.unsubscribe(this.listeners.texture),SceneLoader$1.unsubscribe(this.listeners.scene_loader),this.listeners=null}},{key:"resetFeatureSelection",value:function(){this.selection?this._workers&&WorkerBroker.postMessage(this._workers,"self.resetFeatureSelection"):this.selection=new FeatureSelection(this.gl,this.id)}},{key:"updateViewComplete",value:function(){(this.render_count_changed||this.generation!==this.last_complete_generation)&&this.tile_manager.isReady()&&(this.last_complete_generation=this.generation,this.trigger("view_complete"))}},{key:"resetViewComplete",value:function(){this.last_complete_generation=null}},{key:"screenshot",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).background,t=void 0===e?"white":e;return this.requestRedraw(),this.media_capture.screenshot({background:t})}},{key:"pixelRatio",value:function(){return Utils$1.device_pixel_ratio}},{key:"startVideoCapture",value:function(){return this.requestRedraw(),this.media_capture.startVideoCapture()}},{key:"stopVideoCapture",value:function(){return this.media_capture.stopVideoCapture()}},{key:"_profile",value:function(e){console.profile("main thread: ".concat(e)),WorkerBroker.postMessage(this._workers,"self.profile",e)}},{key:"_profileEnd",value:function(e){console.profileEnd("main thread: ".concat(e)),WorkerBroker.postMessage(this._workers,"self.profileEnd",e)}},{key:"getCameraMatrix",value:function(){return this.view.lookAtManipulator.getCameraMatrix()}},{key:"animated",get:function(){var e=this;return void 0!==this.config.scene.animated?this.config.scene.animated:this.tile_manager.getActiveStyles().some((function(t){return e.styles[t]&&e.styles[t].animated}))}}],[{key:"create",value:function(t){return new e(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}]),e}();Scene.id=0,Scene.generation=0;var RemoteTexture=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,r);var a,s=Math.pow(2,o.coords.z),l=Math.abs(Math.floor(o.coords.x/s));a=Math.abs(s*l-Math.abs(o.coords.x));var u=o.coords;return o.coords={x:a,y:u.y,z:u.z},t.call(this,e,i,n,o)}return _createClass(r,[{key:"load",value:function(e){var t=this;if(!e||!e.uid)return _get(_getPrototypeOf(r.prototype),"load",this).call(this,e);var i=e.coords,n=new Uint8Array([0,0,0,0]);return this.loading=new Promise((function(r,o){var a=H.map.DataModel.invoke(e.uid,"requestTileAsPromise",[i.x,i.y,i.z])||null;a?a.then((function(r){var i=r.data;t.loaded=!0,!i||i instanceof ArrayBuffer?t.setData(1,1,n,{filtering:"nearest"}):"IMG"===i.tagName.toUpperCase()||"CANVAS"===i.tagName.toUpperCase()?t.setElement(i,e):t.setData(1,1,n,{filtering:"nearest"})}),(function(){t.loaded=!1})).then(r,(function(e){return o(e)})):o(new Error("Unable to invoke on target "+e.uid))})),this.loading}}]),r}(Texture);TextureManager.register(RemoteTexture,(function(e){return e&&e.uid})),self.H=self.H||{},self.H.gl={DataSource:DataSource,Geo:Geo$1,MathUtils:MathUtils$1,Scene:Scene,Task:Task,Tile:Tile,WorkerBroker:WorkerBroker,log:log,SceneLoader:SceneLoader$1,yaml:jsYaml}})()};f()})();

/**!
 * The code below uses open source software. Please visit the URL below for an overview of the licenses: 
 * https://sdk.venues.here.com/v3/3.1/HERE_NOTICE 
 */
this.H=this.H||{},this.H.venues=function(e){"use strict";function t(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}function n(e,t,n){if(r())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var o=new(e.bind.apply(e,i));return n&&g(o,n.prototype),o}function r(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(r=function(){return!!e})()}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(){a=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),s=new w(r||[]);return i(a,"_invoke",{value:T(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",f="suspendedYield",v="executing",g="completed",y={};function m(){}function E(){}function I(){}var _={};c(_,s,(function(){return this}));var S=Object.getPrototypeOf,b=S&&S(S(x([])));b&&b!==n&&r.call(b,s)&&(_=b);var M=I.prototype=m.prototype=Object.create(_);function L(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(i,o,a,s){var u=d(e[i],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function T(t,n,r){var i=p;return function(o,a){if(i===v)throw Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=O(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=v;var l=d(t,n,r);if("normal"===l.type){if(i=r.done?g:f,l.arg===y)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=g,r.method="throw",r.arg=l.arg)}}}function O(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=d(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function x(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return E.prototype=I,i(M,"constructor",{value:I,configurable:!0}),i(I,"constructor",{value:E,configurable:!0}),E.displayName=c(I,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,I):(e.__proto__=I,c(e,l,"GeneratorFunction")),e.prototype=Object.create(M),e},t.awrap=function(e){return{__await:e}},L(A.prototype),c(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new A(h(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},L(M),c(M,l,"Generator"),c(M,s,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=x,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:x(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function s(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function d(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function y(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){var t=r();return function(){var n,r=v(e);if(t){var i=v(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,n)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},I.apply(this,arguments)}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}t(".H_l_right .venues-ui__drawings .trigger.button--active .arrow {\n  transform: rotate(90deg);\n}\n.H_l_right .venues-ui__drawings .drawings {\n  right: 45px;\n  left: initial;\n}");var L=function(e){f(n,H.map.Feature);var t=E(n);function n(e){var r;return c(this,n),(r=t.call(this)).id=e.id,r.model=e,r}return d(n,[{key:"getData",value:function(){return this.model}},{key:"getAddress",value:function(){return this.model.getInternalAddress()}},{key:"getCenter",value:function(){var e=_(this.model.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"toGeoJSON",value:function(){return this.model.toJSON()}},{key:"getLevel",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getLevel().getDrawing().getParentEventTarget()}}]),n}(),A=function(e){f(r,H.map.Feature);var t=E(r);function r(e){var n;return c(this,r),(n=t.call(this)).id=e.id,n.model=e,n}return d(r,[{key:"getData",value:function(){return this.model}},{key:"getBoundingBox",value:function(){return n(H.geo.Rect,S(this.model.getBoundingBox()))}},{key:"getCenter",value:function(){var e=_(this.model.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getLevel",value:function(e){return this.getLevels().find((function(t){return t.getIdentifier()===e}))}},{key:"getLevels",value:function(){var e=this.getData().getLevels().map((function(e){return e.getIdentifier()}));return this.getVenue().getLevels().filter((function(t){return-1!==e.indexOf(t.id)}))}},{key:"getMainLevel",value:function(){return this.getLevel(this.model.getMainLevel().getIdentifier())}},{key:"getVenue",value:function(){return this.getParentEventTarget()}}]),r}(),T=function(e){f(n,H.map.Feature);var t=E(n);function n(e){var r;return c(this,n),(r=t.call(this)).id=e.id,r.model=e,r}return d(n,[{key:"getGeometry",value:function(e){return this.getGeometries().find((function(t){return t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){var e=this.getData().getGeometries().map((function(e){return e.getIdentifier()}));return this.getDrawing().getVenue().getGeometries().filter((function(t){return-1!==e.indexOf(t.id)}))}},{key:"getData",value:function(){return this.model}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getShortName",value:function(){return this.model.getShortName()}},{key:"getZIndex",value:function(){return this.model.getZIndex()}},{key:"isMain",value:function(){return this.model.isMain()}},{key:"getDrawing",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getDrawing().getParentEventTarget()}}]),n}();function O(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],h=e[n+1],d=t+3;d<n;d+=3){var p=N(e[d],e[d+1],u,l,c,h);if(p>o)i=d,o=p;else if(p===o){var f=Math.abs(d-a);f<s&&(i=d,s=f)}}o>r&&(i-t>3&&O(e,t,i,r),e[i+2]=o,n-i>3&&O(e,i,n,r))}function N(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function k(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)w(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)w(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)w(e,t[r][i])}(i),i}function w(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function x(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)P(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)P(i[l],s);else if("LineString"===o)C(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],C(i[l],s,a,!1),e.push(k(u,"LineString",s,t.properties));return}D(i,s,a,!1)}else if("Polygon"===o)D(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)x(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];D(i[l],c,a,!0),s.push(c)}}e.push(k(u,o,s,t.properties))}}function P(e,t){t.push(j(e[0])),t.push(G(e[1])),t.push(0)}function C(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=j(e[s][0]),l=G(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,O(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function D(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];C(e[i],o,n,r),t.push(o)}}function j(e){return e/360+.5}function G(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function R(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,d=c.type,p=0===i?c.minX:c.minY,f=0===i?c.maxX:c.maxY;if(p>=n&&f<r)u.push(c);else if(!(f<n||p>=r)){var v=[];if("Point"===d||"MultiPoint"===d)V(h,v,n,r,i);else if("LineString"===d)z(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===d)U(h,v,n,r,i,!1);else if("Polygon"===d)U(h,v,n,r,i,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];U(h[g],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===d){for(g=0;g<v.length;g++)u.push(k(c.id,d,v[g],c.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===v.length?(d="LineString",v=v[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===v.length?"Point":"MultiPoint"),u.push(k(c.id,d,v,c.tags))}}}return u.length?u:null}function V(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function z(e,t,n,r,i,o,a){for(var s,u,l=B(e),c=0===i?Y:Z,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],v=e[d+2],g=e[d+3],y=e[d+4],m=0===i?p:f,E=0===i?g:y,I=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),m<n?E>n&&(u=c(l,p,f,g,y,n),a&&(l.start=h+s*u)):m>r?E<r&&(u=c(l,p,f,g,y,r),a&&(l.start=h+s*u)):F(l,p,f,v),E<n&&m>=n&&(u=c(l,p,f,g,y,n),I=!0),E>r&&m<=r&&(u=c(l,p,f,g,y,r),I=!0),!o&&I&&(a&&(l.end=h+s*u),t.push(l),l=B(e)),a&&(h+=s)}var _=e.length-3;p=e[_],f=e[_+1],v=e[_+2],(m=0===i?p:f)>=n&&m<=r&&F(l,p,f,v),_=l.length-3,o&&_>=3&&(l[_]!==l[0]||l[_+1]!==l[1])&&F(l,l[0],l[1],l[2]),l.length&&t.push(l)}function B(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function U(e,t,n,r,i,o){for(var a=0;a<e.length;a++)z(e[a],t,n,r,i,o,!1)}function F(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Y(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function Z(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function W(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=K(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(K(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(K(o.geometry[s][l],t));i.push(u)}n.push(k(o.id,a,i,o.tags))}return n}function K(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function J(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(X(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(X(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(h)}}return e.transformed=!0,e}function X(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function Q(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,q(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function q(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)$(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)$(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)$(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var d={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(d.id=t.id),e.features.push(d)}}function $(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ee(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)x(n,e.features[r],t,r);else"Feature"===e.type?x(n,e,t):x(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=R(e,1,-1-n,n,0,-1,2,t),o=R(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=R(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=W(i,1).concat(r)),o&&(r=r.concat(W(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function te(e,t,n){return 32*((1<<e)*n+t)+e}ee.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ee.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=te(t,n,r),d=this.tiles[h];if(!d&&(l>1&&console.time("creation"),d=this.tiles[h]=Q(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,i){if(t===u.maxZoom||t===i)continue;var f=1<<i-t;if(n!==Math.floor(o/f)||r!==Math.floor(a/f))continue}else if(t===u.indexMaxZoom||d.numPoints<=u.indexMaxPoints)continue;if(d.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,y,m,E,I,_=.5*u.buffer/u.extent,S=.5-_,b=.5+_,M=1+_;v=g=y=m=null,E=R(e,c,n-_,n+b,0,d.minX,d.maxX,u),I=R(e,c,n+S,n+M,0,d.minX,d.maxX,u),e=null,E&&(v=R(E,c,r-_,r+b,1,d.minY,d.maxY,u),g=R(E,c,r+S,r+M,1,d.minY,d.maxY,u),E=null),I&&(y=R(I,c,r-_,r+b,1,d.minY,d.maxY,u),m=R(I,c,r+S,r+M,1,d.minY,d.maxY,u),I=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(y||[],t+1,2*n+1,2*r),s.push(m||[],t+1,2*n+1,2*r+1)}}},ee.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=te(e,t=(t%a+a)%a,n);if(this.tiles[s])return J(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[te(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?J(this.tiles[s],i):null):null};var ne="Point",re="Polygon",ie="MultiPoint",oe="MultiLineString",ae="MultiPolygon",se={fillColor:"#e0e0e0",outlineColor:"#829DB4",outlineWidth:1},ue={fill:"#333333",size:13},le={fillColor:"#F2F285",outlineColor:"#0088BF",outlineWidth:1.2},ce=16,he=18,de=24,pe={FOOTPRINT:"FOOTPRINT",ICON:"ICON",TEXT:"TEXT",VECTOR:"VECTOR"},fe=Object.freeze({v1:1,v2:2}),ve=1,ge=2,ye=3,me="CW",Ee="CCW",Ie=function(e){var t=function(e){for(var t=0,n=e.length,r=0;r<n-1;r+=1){var i=e[r],o=e[r+1];t+=i[0]*o[1]-o[0]*i[1]}return t+(e[n-1][0]*e[0][1]-e[0][0]*e[n-1][1])}(e);return t>0?me:t<0?Ee:void 0},_e=function(e){for(var t,n=[],r=[],i=0,o=e.coordinates.length;i<o;i+=1){var a=e.coordinates[i],s=Ie(a);null!==s&&(s===(t=t||s)&&r.length&&(n.push(r),r=[]),r.push(a))}return r.length>0&&n.push(r),1===n.length?(e.type=re,e.coordinates=n[0]):n.length>1?(e.type=ae,e.coordinates=n):e=null,e},Se=function(e,t,n,r,i){var o,a,s,u,l,c,h=function(e,t,n,r,i){var o=1<<t,a=[];return a[0]=(e[0]/i+n)/o,a[1]=(e[1]/i+r)/o,{x:a[0],y:a[1]}}(e,t,n,r,i);return a=(o=h).x,s=o.y,u=360*(a-.5),l=Math.exp(Math.PI*(.5-s)/.25)-1,c=Math.exp(Math.PI*(.5-s)/.25)+1,[u,180*Math.asin(l/c)/Math.PI]};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var be,Me,Le,Ae=(be=function(e,t){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==u(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==u(Symbol.iterator)?function(e){return u(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":u(e)})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),c=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,a=void 0===o?100:o,u=n.threshold,l=void 0===u?.6:u,c=n.maxPatternLength,h=void 0===c?32:c,d=n.caseSensitive,p=void 0!==d&&d,f=n.tokenSeparator,v=void 0===f?/ +/g:f,g=n.findAllMatches,y=void 0!==g&&g,m=n.minMatchCharLength,E=void 0===m?1:m,I=n.id,_=void 0===I?null:I,S=n.keys,b=void 0===S?[]:S,M=n.shouldSort,L=void 0===M||M,A=n.getFn,T=void 0===A?s:A,O=n.sortFn,N=void 0===O?function(e,t){return e.score-t.score}:O,k=n.tokenize,w=void 0!==k&&k,x=n.matchAllTokens,P=void 0!==x&&x,C=n.includeMatches,D=void 0!==C&&C,j=n.includeScore,G=void 0!==j&&j,R=n.verbose,V=void 0!==R&&R;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:l,maxPatternLength:h,isCaseSensitive:p,tokenSeparator:v,findAllMatches:y,minMatchCharLength:E,id:_,keys:b,includeMatches:D,includeScore:G,shouldSort:L,getFn:T,sortFn:N,verbose:V,tokenize:w,matchAllTokens:P},this.setCollection(t),this._processKeys(b)}var t;return(t=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var i=null,o=null,a=0,s=0,u=e.length;s<u;s+=1){var l=e[s];if(!l.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=l.name;if(this._keyNames.push(c),!l.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var h=l.weight;if(h<0||h>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?h:Math.max(o,h),i=null==i?h:Math.min(i,h),this._keyWeights[c]=h,a+=h}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),r=n.tokenSearchers,i=n.fullSearcher,o=this._search(r,i);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,i=n.length;r<i;r+=1)t.push(new o(n[r],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,r={},i=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t});return i}for(var s=0,u=n.length;s<u;s+=1)for(var l=n[s],c=0,h=this._keyNames.length;c<h;c+=1){var d=this._keyNames[c];this._analyze({key:d,value:this.options.getFn(l,d),record:l,index:s},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t})}return i}},{key:"_analyze",value:function(e,t){var n=this,r=e.key,i=e.arrayIndex,o=void 0===i?-1:i,a=e.value,s=e.record,u=e.index,c=t.tokenSearchers,h=void 0===c?[]:c,d=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,v=t.results,g=void 0===v?[]:v;!function e(t,i,o,a){if(null!=i)if("string"==typeof i){var s=!1,u=-1,c=0;n._log("\nKey: ".concat(""===r?"--":r));var p=d.search(i);if(n._log('Full text: "'.concat(i,'", score: ').concat(p.score)),n.options.tokenize){for(var v=i.split(n.options.tokenSeparator),y=v.length,m=[],E=0,I=h.length;E<I;E+=1){var _=h[E];n._log('\nPattern: "'.concat(_.pattern,'"'));for(var S=!1,b=0;b<y;b+=1){var M=v[b],L=_.search(M),A={};L.isMatch?(A[M]=L.score,s=!0,S=!0,m.push(L.score)):(A[M]=1,n.options.matchAllTokens||m.push(1)),n._log('Token: "'.concat(M,'", score: ').concat(A[M]))}S&&(c+=1)}u=m[0];for(var T=m.length,O=1;O<T;O+=1)u+=m[O];u/=T,n._log("Token score average:",u)}var N=p.score;u>-1&&(N=(N+u)/2),n._log("Score average:",N);var k=!n.options.tokenize||!n.options.matchAllTokens||c>=h.length;if(n._log("\nCheck Matches: ".concat(k)),(s||p.isMatch)&&k){var w={key:r,arrayIndex:t,value:i,score:N};n.options.includeMatches&&(w.matchedIndices=p.matchedIndices);var x=f[a];x?x.output.push(w):(f[a]={item:o,output:[w]},g.push(f[a]))}}else if(l(i))for(var P=0,C=i.length;P<C;P+=1)e(P,i[P],o,a)}(o,a,s,u)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,i=e.length;r<i;r+=1){for(var o=e[r],a=o.output,s=a.length,u=1,l=0;l<s;l+=1){var c=a[l],h=c.key,d=n?t[h]:1,p=0===c.score&&t&&t[h]>0?Number.EPSILON:c.score;u*=Math.pow(p,d)}o.score=u,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var i=[];this.options.includeMatches&&i.push((function(e,t){var n=e.output;t.matches=[];for(var r=0,i=n.length;r<i;r+=1){var o=n[r];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&i.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var u={item:s.item},l=0,c=i.length;l<c;l+=1)i[l](s,u);t.push(u)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&i(e.prototype,t),e}();e.exports=c},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,s=void 0===o?100:o,u=n.threshold,l=void 0===u?.6:u,c=n.maxPatternLength,h=void 0===c?32:c,d=n.isCaseSensitive,p=void 0!==d&&d,f=n.tokenSeparator,v=void 0===f?/ +/g:f,g=n.findAllMatches,y=void 0!==g&&g,m=n.minMatchCharLength,E=void 0===m?1:m,I=n.includeMatches,_=void 0!==I&&I;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:l,maxPatternLength:h,isCaseSensitive:p,tokenSeparator:v,findAllMatches:y,includeMatches:_,minMatchCharLength:E},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=h&&(this.patternAlphabet=a(this.pattern))}var t;return(t=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return r&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,u=s.maxPatternLength,l=s.tokenSeparator;if(this.pattern.length>u)return i(e,this.pattern,l);var c=this.options,h=c.location,d=c.distance,p=c.threshold,f=c.findAllMatches,v=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:h,distance:d,threshold:p,findAllMatches:f,minMatchCharLength:v,includeMatches:r})}}])&&r(e.prototype,t),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(r,"|")),o=e.match(i),a=!!o,s=[];if(a)for(var u=0,l=o.length;u<l;u+=1){var c=o[u];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var r=n(4),i=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,u=o.distance,l=void 0===u?100:u,c=o.threshold,h=void 0===c?.6:c,d=o.findAllMatches,p=void 0!==d&&d,f=o.minMatchCharLength,v=void 0===f?1:f,g=o.includeMatches,y=void 0!==g&&g,m=s,E=e.length,I=h,_=e.indexOf(t,m),S=t.length,b=[],M=0;M<E;M+=1)b[M]=0;if(-1!==_){var L=r(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});if(I=Math.min(L,I),-1!==(_=e.lastIndexOf(t,m+S))){var A=r(t,{errors:0,currentLocation:_,expectedLocation:m,distance:l});I=Math.min(A,I)}}_=-1;for(var T=[],O=1,N=S+E,k=1<<(S<=31?S-1:30),w=0;w<S;w+=1){for(var x=0,P=N;x<P;)r(t,{errors:w,currentLocation:m+P,expectedLocation:m,distance:l})<=I?x=P:N=P,P=Math.floor((N-x)/2+x);N=P;var C=Math.max(1,m-P+1),D=p?E:Math.min(m+P,E)+S,j=Array(D+2);j[D+1]=(1<<w)-1;for(var G=D;G>=C;G-=1){var R=G-1,V=n[e.charAt(R)];if(V&&(b[R]=1),j[G]=(j[G+1]<<1|1)&V,0!==w&&(j[G]|=(T[G+1]|T[G])<<1|1|T[G+1]),j[G]&k&&(O=r(t,{errors:w,currentLocation:R,expectedLocation:m,distance:l}))<=I){if(I=O,(_=R)<=m)break;C=Math.max(1,2*m-_)}}if(r(t,{errors:w+1,currentLocation:m,expectedLocation:m,distance:l})>I)break;T=j}var z={isMatch:_>=0,score:0===O?.001:O};return y&&(z.matchedIndices=i(b,v)),z}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,i=t.currentLocation,o=void 0===i?0:i,a=t.expectedLocation,s=void 0===a?0:a,u=t.distance,l=void 0===u?100:u,c=r/e.length,h=Math.abs(s-o);return l?c+h/l:h?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,i=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===r?r=o:s||-1===r||((i=o-1)-r+1>=t&&n.push([r,i]),r=-1)}return e[o-1]&&o-r>=t&&n.push([r,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},i=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var u=s.indexOf("."),l=s,c=null;-1!==u&&(l=s.slice(0,u),c=s.slice(u+1));var h=t[l];if(null!=h)if(c||!i(h)&&!o(h))if(n(h))for(var d=0,p=h.length;d<p;d+=1)e(h[d],c);else c&&e(h,c);else a.push(r(h))}else a.push(t)}(e,t),a},isArray:n,isString:i,isNum:o,toString:r}}])},be(Me={exports:{}},Me.exports),Me.exports),Te=(Le=Ae)&&Le.__esModule&&Object.prototype.hasOwnProperty.call(Le,"default")?Le.default:Le;Ae.Fuse;var Oe,Ne,ke,we,xe,Pe=d((function e(t){var n=t.addressList,r=void 0===n?[]:n,i=t.geometries,o=void 0===i?[]:i,a=t.entity,s=void 0===a?null:a,u=t.name,l=void 0===u?"":u,h=t.icon,d=void 0===h?"":h;c(this,e),this.addressList=r,this.geometries=o,this.icon=d,this.entity=s,this.name=l})),Ce={keys:[{name:"name",weight:.6},{name:"addressList",weight:.4}],threshold:.2},De=function(){function e(t){c(this,e),this.fuseSearch=null,this.levels_=null,this.searchListEntities_=[],this.searchListIcons_=[],this.searchList_=[],this.venueModel=t,this.init()}return d(e,[{key:"init",value:function(){var e=this.venueModel.getGeometries().reduce((function(e,t){var n=e;return n[t.getId()]=t,n}),{});this.initEntityList(this.venueModel.getOccupant()),this.initIconList(e),this.levels_=this.venueModel.getLevels().map((function(e){return{levelId:e.getId(),levelName:e.getName(),drawingId:e.getDrawing().getId(),drawingName:e.getDrawing().getName()}}));var t=[].concat(S(this.searchListEntities_),S(this.searchListIcons_));this.searchList_=t.sort((function(e,t){return e.name.localeCompare(t.name)})),this.fuseSearch_=new Te(this.searchList_,Ce)}},{key:"initEntityList",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return e.spaceIds?new Pe({geometries:e.space,addressList:e.spaceIds||[],name:e.properties.name||"",entity:e}):null})).filter((function(e){return null!==e}));this.searchListEntities_=e}},{key:"initIconList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.searchListIcons_=Object.values(e).filter((function(e){return e.isIcon()})).map((function(e){var t=e.getIcon();return new Pe({geometries:[e],icon:t,name:e.properties.name||""})}))}},{key:"all",value:function(){return this.searchList_}},{key:"allIconTypes",value:function(){var e=this.searchListIcons_.reduce((function(e,t){var n=e;return n[t.name]=t.name,n}),{});return Object.keys(e)}},{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""===e?this.searchList_:this.fuseSearch_.search(e)}}]),e}(),je=Object.freeze({SITE:"SITE",IMAGES:"IMAGES",THEME:"THEME"}),Ge={SITE:"indoor.Site",STRUCTURE:"indoor.Structure",OCCUPANT:"indoor.Occupant",SPACE:"indoor.Space",SPACEGROUPS:"indoor.SpaceGroups",TOPOLOGY:"Topology",ADDRESS:"Address",LEVEL:"indoor.Level",LEVELCONNECTOR:"indoor.LevelConnector",ENTRANCE:"indoor.Entrance"},Re="OCCUPANT_NAMES",Ve="SPACE_NAME",He="INTERNAL_ADDRESS_SHORT",ze="INTERNAL_ADDRESS",Be="INTERNAL_ADDRESS_LONG",Ue="SPACE_TYPE_NAME",Fe="SPACE_CATEGORY_NAME",Ye="Point",Ze="LineString",We="Polygon",Ke="MultiPoint",Je="MultiLineString",Xe="MultiPolygon",Qe=Object.freeze({STANDARD:"STANDARD",FLATTEN:"FLATTEN",OUTDOOR_MAIN:"OUTDOOR_MAIN",INDOOR_MAIN:"INDOOR_MAIN",NO_OUTDOORS:"NO_OUTDOORS",FLATTEN_INDOOR_MAIN:"FLATTEN_INDOOR_MAIN",FLATTEN_OUTDOOR_COPY:"FLATTEN_OUTDOOR_COPY"}),qe="9999999999999",$e="icons",et="config",tt="https://interactive.data.api.platform.here.com/interactive/v1/catalogs",nt=Object.freeze({THEME:"THEME",THEME_MAP:"THEME_MAP",PRESETS:"PRESETS",SDK_STRINGS:"SDK_STRINGS",ICON_FILE:"ICON_FILE",INPUT_COLORS:"INPUT_COLORS",BASE_MAP_INFO:"BASE_MAP_INFO",CONFIG_PROFILE:"CONFIG_PROFILE",NAV_THEME:"NAV_THEME",NAV_NAME_THEME:"NAV_NAME_THEME",NAV_PROP_MAP:"NAV_PROP_MAP",NAV_STRINGS:"NAV_STRINGS",NAV_THEME_MAP:"NAV_THEME_MAP",NAV_NAME_THEME_MAP:"NAV_NAME_THEME_MAP",V4_THEME_FAMILY:"V4_THEME_FAMILY",V4_MAPTYPE_THEME:"V4_MAPTYPE_THEME",ICON:"ICON",MARKER:"MARKER",PERMISSIONS:"PERMISSIONS",NAICS_ARRAY:"NAICS_ARRAY",NAICS_MAP:"NAICS_MAP"});Object.freeze((p(Oe={},nt.THEME,"themeUrls"),p(Oe,nt.THEME_MAP,"themeMapUrl"),p(Oe,nt.PRESETS,"presetsUrl"),p(Oe,nt.SDK_STRINGS,"stringsUrl"),Oe)),Object.freeze((p(Ne={},nt.THEME,"themeOverrides"),p(Ne,nt.THEME_MAP,"themeMapOverrides"),p(Ne,nt.PRESETS,"presetOverrides"),p(Ne,nt.SDK_STRINGS,"stringsOverrides"),p(Ne,nt.INPUT_COLORS,"inputColorOverrides"),Ne)),Object.freeze((p(ke={},nt.THEME,["Modern","Standard","Factory","Navteq","TheBase","Westfield_noLabels","Westfield","TDM_noLabel"]),p(ke,nt.SDK_STRINGS,["Standard","SDK","sdk/standard"]),p(ke,nt.V4_THEME_FAMILY,["modern","standard"]),p(ke,nt.V4_MAPTYPE_THEME,["Airport Terminal","Airport","Casino","College Building","College Campus","Convention","General","Hospital","Outdoor","Retail","School Building","School Campus","Shopping Mall","Traffic","Train Station"]),p(ke,nt.NAV_THEME,["Factory","MapEditor"]),p(ke,nt.ICON,["Multicolor","Standard","TheBase","Factory"]),ke)),Object.freeze((p(we={},nt.THEME,"Modern"),p(we,nt.THEME_MAP,"Standard"),p(we,nt.PRESETS,"Standard"),p(we,nt.SDK_STRINGS,"Standard"),p(we,nt.ICON_FILE,"Standard"),p(we,nt.INPUT_COLORS,"Standard"),p(we,nt.BASE_MAP_INFO,"Standard"),p(we,nt.CONFIG_PROFILE,"factory"),p(we,nt.NAV_THEME,"Factory"),p(we,nt.NAV_NAME_THEME,"FactoryName"),p(we,nt.NAV_PROP_MAP,"Standard"),p(we,nt.NAV_STRINGS,"Standard"),p(we,nt.NAV_THEME_MAP,"Standard"),p(we,nt.NAV_NAME_THEME_MAP,"StandardName"),p(we,nt.V4_THEME_FAMILY,"Standard"),p(we,nt.V4_MAPTYPE_THEME,"Standard"),p(we,nt.ICON,"Multicolor"),p(we,nt.MARKER,"Standard"),we));var rt=Object.freeze({GEO_JSON:"GEO_JSON",V5_MAP:"V5_MAP",V5_NAV:"V5_NAV",V5_INFO:"V5_INFO",KML:"KML",SVG:"SVG",PNG:"PNG"});Object.freeze(p({},rt.GEO_JSON,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_ENTITY:"COMMUNITY_ENTITY",PATH_LEVEL_GEOMETRY:"PATH_LEVEL_GEOMETRY",GEOJSON_LEVEL_GEOMETRY:"GEOJSON_LEVEL_GEOMETRY"}));var it=Object.freeze({ACCOUNT_API:"ACCOUNT_API",DEFAULT_COLLECTION:"DEFAULT_COLLECTION",CATALOG_LAYER:"CATALOG_LAYER"}),ot=Object.freeze((p(xe={},it.ACCOUNT_API,{BASE_URL:"https://account.api.here.com/authorization/v1.1/projects/me"}),p(xe,it.DEFAULT_COLLECTION,{BASE_URL:"https://config.data.api.platform.here.com/config/v1/catalogs",PARAMS:{CREATED_BY:"created",COLLECTION:"-collection"}}),p(xe,it.CATALOG_LAYER,{BASE_URL:"https://interactive.data.api.platform.here.com/interactive/v1/catalogs",MOMDATA_LAYER:"9999999999999",ICON_LAYER:"icons",THEMERULE_LAYER:"config",COLLECTION_LAYER:"layers/9999999999999/search",PARAMS:{FEATURE_TYPE:{KEY:"p.featureType",VALUE:"indoor.Site"}}}),xe)),at=Object.freeze({isIconsEnabled:!0,isMetaEnabled:!0,metaOptions:{},iconOptions:{}}),st=Object.freeze({GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"});function ut(){}function lt(){lt.init.call(this)}function ct(e){return void 0===e._maxListeners?lt.defaultMaxListeners:e._maxListeners}function ht(e,t,n,r){var i,o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=new ut,e._eventsCount=0),a){if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(i=ct(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[t]=n,++e._eventsCount;return e}function dt(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function pt(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function ft(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}ut.prototype=Object.create(null),lt.EventEmitter=lt,lt.usingDomains=!1,lt.prototype.domain=void 0,lt.prototype._events=void 0,lt.prototype._maxListeners=void 0,lt.defaultMaxListeners=10,lt.init=function(){this.domain=null,lt.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ut,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},lt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},lt.prototype.getMaxListeners=function(){return ct(this)},lt.prototype.emit=function(e){var t,n,r,i,o,a,s,u="error"===e;if(a=this._events)u=u&&null==a.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=a[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=ft(e,r),o=0;o<r;++o)i[o].call(n)}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=ft(e,i),a=0;a<i;++a)o[a].call(n,r)}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=ft(e,o),s=0;s<o;++s)a[s].call(n,r,i)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=ft(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=ft(e,i),a=0;a<i;++a)o[a].apply(n,r)}(n,c,this,i)}return!0},lt.prototype.addListener=function(e,t){return ht(this,e,t,!1)},lt.prototype.on=lt.prototype.addListener,lt.prototype.prependListener=function(e,t){return ht(this,e,t,!0)},lt.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,dt(this,e,t)),this},lt.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,dt(this,e,t)),this},lt.prototype.removeListener=function(e,t){var n,r,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new ut:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new ut,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,a||t)}return this},lt.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new ut,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new ut:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new ut,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},lt.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},lt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):pt.call(e,t)},lt.prototype.listenerCount=pt,lt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var vt,gt="venues-ui-button--active",yt="venues-ui-button",mt="venues-ui__drawings",Et="data-drawing",It=function(){function e(t,n,r){var i=this;c(this,e),this.clickHandler=r,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("class",mt);var o=document.createElement("div");o.setAttribute("class","trigger ".concat(yt));var a=document.createElement("div");a.setAttribute("class","arrow arrow--down"),o.appendChild(a),o.addEventListener("click",(function(){o.classList.toggle(gt),i.containerButtons.classList.toggle("drawings--open")})),this.containerDiv.appendChild(o),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","drawings"),this.containerDiv.appendChild(this.containerButtons),n&&this.update(n),t.appendChild(this.containerDiv)}return d(e,[{key:"drawButton",value:function(e,t,n){var r=this,i=document.createElement("div"),o=Number(n)===Number(e);i.setAttribute("class",o?"".concat(yt," ").concat(gt):yt),i.innerHTML=t,i.setAttribute(Et,e),i.addEventListener("click",(function(){r.switch(e),r.clickHandler(e)})),this.containerButtons.appendChild(i)}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(mt," .").concat(gt)).forEach((function(e){return e.setAttribute("class",yt)}));var t=this.containerButtons.querySelector("[".concat(Et,"='").concat(e,"']"));t&&t.setAttribute("class","".concat(yt," ").concat(gt))}},{key:"update",value:function(e){var t=this;this.containerButtons.innerHTML="";var n=function(e){var t=e.getDrawings();return new Map(t.map((function(e){var t=e.getDisplayName()||e.getName();return[e.getId(),t]})))}(e);n.size>0&&n.forEach((function(n,r){return t.drawButton(r,n,e.getRootDrawing().getId())}))}}]),e}(),_t="venues-ui-button--active",St="venues-ui-button",bt="data-level",Mt="venues-ui__levels",Lt=function(){function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;c(this,e),this.clickHandler=i,this.levelButtonCount=o,this.currentScrollIndex=0,this.containerUI=document.createElement("div"),this.containerUI.setAttribute("class","".concat(Mt)),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","levels"),this.containerUI.appendChild(this.containerButtons),n&&this.update(n,r),t.appendChild(this.containerUI)}return d(e,[{key:"clear",value:function(){this.containerButtons.innerHTML="",this.buttonScrollUp&&(this.containerUI.removeChild(this.buttonScrollUp),this.buttonScrollUp=null),this.buttonScrollDown&&(this.containerUI.removeChild(this.buttonScrollDown),this.buttonScrollDown=null)}},{key:"drawLevelButton",value:function(e,t){var n=this,r=document.createElement("div");r.innerHTML=t,r.style.fontSize="".concat(Math.max(Math.min(28.8/t.length,11.52),10),"px"),r.style.display="block",r.setAttribute("class",St),r.setAttribute(bt,e),r.addEventListener("click",(function(){n.switch(e),n.clickHandler(e)})),this.containerButtons.appendChild(r)}},{key:"drawScrollButtons",value:function(){var e=this;this.buttonScrollUp=document.createElement("div"),this.buttonScrollUp.setAttribute("class","".concat(St," ").concat(St,"--up"));var t=document.createElement("div");t.setAttribute("class","arrow arrow--up"),this.buttonScrollUp.appendChild(t),this.buttonScrollUp.addEventListener("click",(function(){return e.scroll(1)})),this.containerUI.insertBefore(this.buttonScrollUp,this.containerButtons),this.buttonScrollDown=document.createElement("div"),this.buttonScrollDown.setAttribute("class","".concat(St," ").concat(St,"--down"));var n=document.createElement("div");n.setAttribute("class","arrow arrow--down"),this.buttonScrollDown.appendChild(n),this.buttonScrollDown.addEventListener("click",(function(){return e.scroll(-1)})),this.containerUI.appendChild(this.buttonScrollDown)}},{key:"scroll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Array.from(this.containerButtons.querySelectorAll(".".concat(St))).reverse(),n=[];if(e>=0){this.currentScrollIndex=Math.min(this.currentScrollIndex+e,t.length-this.levelButtonCount);var r=Math.min(this.currentScrollIndex,t.length-this.levelButtonCount),i=Math.min(this.currentScrollIndex+this.levelButtonCount,t.length);n=t.slice(r,i)}else if(e<0){this.currentScrollIndex=Math.max(this.currentScrollIndex+e,0);var o=Math.max(0,this.currentScrollIndex),a=Math.min(t.length,this.currentScrollIndex+this.levelButtonCount);n=t.slice(o,a)}t.forEach((function(e){-1!==n.indexOf(e)?e.style.display="block":e.style.display="none"})),this.buttonScrollDown&&(0===this.currentScrollIndex?this.buttonScrollDown.setAttribute("disabled","disabled"):this.buttonScrollDown.removeAttribute("disabled")),this.buttonScrollUp&&(this.currentScrollIndex===t.length-this.levelButtonCount?this.buttonScrollUp.setAttribute("disabled","disabled"):this.buttonScrollUp.removeAttribute("disabled"))}},{key:"switch",value:function(e){this.containerButtons.querySelectorAll(".".concat(_t)).forEach((function(e){return e.setAttribute("class",St)}));var t=this.containerButtons.querySelector(".".concat(Mt," [").concat(bt,"='").concat(e,"']"));if(t){var n=Array.from(this.containerButtons.querySelectorAll(".".concat(St))).reverse();t.setAttribute("class","".concat(St," ").concat(_t));var r=n.indexOf(t);(r<this.currentScrollIndex||r>=this.currentScrollIndex+4)&&this.scroll(r-this.currentScrollIndex)}}},{key:"update",value:function(e,t){var n=this,r=function(){return new Map((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(e){return[e.getZIndex(),e.getShortName()||e.getDisplayName()||e.getName()]})))}(function(e,t){if(t===Qe.FLATTEN){var n=e.getVenueModel().getLevelMapFlattenedByZIndex_();return Object.values(n).map((function(e){return e[0]}))}return e.getLevels()}(e,t).sort((function(e,t){return t.getZIndex()-e.getZIndex()}))),i=e.getMainLevel().getZIndex();this.clear(),r.forEach((function(e,t){return n.drawLevelButton(t,e)})),r.size>this.levelButtonCount&&(r.size>this.levelButtonCount+1?this.currentScrollIndex=Math.min(Array.from(r).reverse().findIndex((function(e){return e[0]===i})),r.size-this.levelButtonCount):this.currentScrollIndex=0,this.drawScrollButtons(),this.scroll(0)),this.switch(i)}}]),e}(),At=function(){function e(t,n){c(this,e),this.baseTheme=t,this.metaInformation=n,this.labelStyleMap={},this.styleMap={},this.setStyleMap()}return d(e,[{key:"setStyleMap",value:function(){this.styleMap.ENTRANCE=this.baseTheme.entranceRules.default.styleProperties,this.labelStyleMap.ENTRANCE=this.baseTheme.entranceRules.default.textLabelStyleProperties;for(var e=0,t=Object.entries(this.baseTheme.spaceRules);e<t.length;e++){var n=_(t[e],2),r=n[0],i=n[1],o=i.properties.behavioralAppearance.default.styleProperties,a=i.properties.behavioralAppearance.default.textLabelStyleProperties;if(this.styleMap[r]=o,this.labelStyleMap[r]=a,i.spaceTypes)for(var s=0,u=Object.entries(i.spaceTypes);s<u.length;s++){var l=_(u[s],2),c=l[0],h=l[1],d=h.behavioralAppearance.default.styleProperties,p=h.behavioralAppearance.default.textLabelStyleProperties;this.styleMap["".concat(r,"_").concat(c)]=d&&0!==Object.keys(d)?d:o,this.labelStyleMap["".concat(r,"_").concat(c)]=p&&0!==Object.keys(p)?p:a}}}},{key:"getBaseTheme",value:function(){return this.baseTheme}},{key:"getStyleMap",value:function(){return this.styleMap}},{key:"getGeometryStyle",value:function(e){return this.styleMap&&Object.getOwnPropertyNames(this.styleMap)?this.styleMap[e]:null}},{key:"getLabelStyle",value:function(e){return this.labelStyleMap&&Object.getOwnPropertyNames(this.labelStyleMap)?this.labelStyleMap[e]:null}}],[{key:"getGeometryDefaultStyle",value:function(){return{fill:"#e5e5e5",fillOpacity:1,stroke:"#6c7a89",strokeOpacity:1,strokeWidth:2}}},{key:"getLabelDefaultStyle",value:function(){return{stroke:"#6c7a89",zmin:15}}}]),e}(),Tt=function(){function e(){c(this,e),this.config=Object.seal({emitEventOnOverrideUpdate:!0}),this.imageCache={},this.releaseSettings_={displayOptions:{},mom:[]},this.theme={}}return d(e,[{key:"getMomData",value:function(){return this.releaseSettings_.mom}},{key:"getTheme",value:function(){return this.theme||{}}},{key:"getStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getTheme(),i=At.getGeometryDefaultStyle(),o=e.properties.spaceType,a=e.properties.spaceCategory,s=a;return o&&(s="".concat(a,"_").concat(o)),(t=r.getGeometryStyle(s))&&!n||(t=i),{m:t.fill&&t.fill.toLowerCase()||"#fff",w:t.strokeWidth/10||.1,o:t.stroke&&t.stroke.toLowerCase()||"#fff",l:"Dark"}||void 0}},{key:"getLabelStyle",value:function(e){this.getTheme();var t=At.getLabelDefaultStyle();return{fill:t.stroke,zmin:t.zmin}}}]),e}(),Ot=Math.PI/180,Nt=180/Math.PI,kt=function(){function e(){c(this,e)}return d(e,null,[{key:"toRadians",value:function(e){return e*Ot}},{key:"toDegrees",value:function(e){return e*Nt}},{key:"getBoundingBox",value:function(t,n){var r=[];switch(t){case Ye:r=[n,n];break;case Ke:case Ze:r=n;break;case Je:case We:r=n.reduce((function(e,t){return e.concat(t)}),[]);break;case Xe:r=n.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.concat(t)}),[])}return e.getBoundingBoxVertices(r)}},{key:"getInverseTransform",value:function(e){var t=e[0]*e[3]-e[1]*e[2],n=[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,0,0];return n[4]=-(n[0]*e[4]+n[2]*e[5]),n[5]=-(n[1]*e[4]+n[3]*e[5]),n}},{key:"applyTransformToPoint",value:function(e,t){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"transformProduct",value:function(e,t){var n=[0,0,0,0,0,0];return n[0]=t[0]*e[0]+t[2]*e[1],n[1]=t[1]*e[0]+t[3]*e[1],n[2]=t[0]*e[2]+t[2]*e[3],n[3]=t[1]*e[2]+t[3]*e[3],n[4]=t[0]*e[4]+t[2]*e[5]+t[4],n[5]=t[1]*e[4]+t[3]*e[5]+t[5],n}},{key:"convertLonLatToMerc",value:function(e){var t=e[0]*Ot,n=e[1]*Ot,r=Math.sin(n);return[.5+t/(2*Math.PI),.5-Math.log((1+r)/(1-r))/(4*Math.PI)]}},{key:"convertMercToLatLon",value:function(e){var t=2*Math.PI*(e[0]-.5),n=Math.atan(Math.sinh(2*Math.PI*(.5-e[1])));return[t/Ot,n/Ot]}},{key:"getTransformScale",value:function(e){return Math.sqrt(e[0]*e[3]-e[1]*e[2])}},{key:"getLonLatToMercTransform",value:function(t){var n=[1/360,0,0,-1/(360*Math.cos(t[1]*Ot)),0,0],r=e.applyTransformToPoint(n,t),i=e.convertLonLatToMerc(t);return n[4]=i[0]-r[0],n[5]=i[1]-r[1],n}},{key:"getNatToMercTransform",value:function(t){var n=[t[4],t[5]],r=e.getLonLatToMercTransform(n);return e.transformProduct(t,r)}},{key:"convertMxMy2LonLat",value:function(t,n){return t.length&&n.length?e.applyTransformToPoint(t,n):[]}},{key:"convertLonLat2MxMy",value:function(t,n){if(!t.length||!n.length)return[];var r=e.getInverseTransform(t);return e.applyTransformToPoint(r,n)}},{key:"getFlattenedQuadraticBezierCurve",value:function(e,t,n){var r=[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;i<1&&(i=6);for(var o=0;o<=i;o+=1){var a=o/i,s=(1-a)*(1-a),u=2*a*(1-a),l=a*a,c=s*e[0]+u*t[0]+l*n[0],h=s*e[1]+u*t[1]+l*n[1];r.push([c,h])}return r}},{key:"getFlattenedCubicBezierCurve",value:function(e,t,n,r){var i=[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;o<1&&(o=6);for(var a=0;a<=o;a+=1){var s=a/o,u=(1-s)*(1-s)*(1-s),l=3*s*(1-s)*(1-s),c=3*s*s*(1-s),h=s*s*s,d=u*e[0]+l*t[0]+c*n[0]+h*r[0],p=u*e[1]+l*t[1]+c*n[1]+h*r[1];i.push([d,p])}return i}},{key:"getRectangularCoordinatesOfLabelArea",value:function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=_(t,6),o=i[0],a=i[1],s=i[2],u=i[3],l=i[5],c=e.getDeltaLonLatForMeterAtGivenLonLat(o,a),h=t[4];return r?(l&&(h*=-1),null!=n&&(h=(h+=n<0?2*Math.PI+n:n)<0?2*Math.PI+h:h)):h=0,e.getRectVerticesFromSignatureRectRepresentation([o,a],{xLength:s,yLength:u},h,c)}},{key:"getRotatedPoint",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],i=Math.cos(t),o=Math.sin(t),a=e[0]-r[0],s=e[1]-r[1],u=[];return[(u=n?[a*i+s*o,s*i-a*o]:[a*i-s*o,s*i+a*o])[0]+r[0],u[1]+r[1]]}},{key:"getRectVerticesFromSignatureRectRepresentation",value:function(t,n,r,i){var o=n.xLength,a=n.yLength,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=_(t,2),l=u[0],c=u[1],h=o/2,H=a/2,d=_(i,2),p=d[0],f=d[1];return[[1,1],[-1,1],[-1,-1],[1,-1]].map((function(e){return[e[0]*h,e[1]*H]})).map((function(t){return e.getRotatedPoint(t,r,s)})).map((function(e){return[e[0]*p,e[1]*f]})).map((function(e){return[e[0]+l,e[1]+c]}))}},{key:"getScaleFactorForRectInSpace",value:function(e,t,n,r){var i=e/n,o=t/r;return i>o?o:i}},{key:"getDeltaLonLatForMeterAtGivenLonLat",value:function(e,t){var n=6371e3;return[1/n*(180/Math.PI)/Math.cos(t*Math.PI/180),1/n*(180/Math.PI)]}},{key:"getBoundingBoxVertices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]];return e.reduce((function(e,t){return[[Math.min(t[0],e[0][0]),Math.min(t[1],e[0][1])],[Math.max(t[0],e[1][0]),Math.max(t[1],e[1][1])]]}),t)}},{key:"isPointInBoundingBox",value:function(e,t){if(e&&t){var n=_(e,2),r=n[0],i=n[1],o=_(t,2),a=_(o[0],2),s=a[0],u=a[1],l=_(o[1],2),c=l[0],h=l[1];return r<=c&&r>=s&&i<=h&&i>=u}}},{key:"isPointOnLineSegment",value:function(e,t,n){var r=_(e,2),i=r[0],o=r[1],a=_(t,2),s=a[0],u=a[1],l=_(n,2),c=l[0],h=l[1],d=(u-o)*(h-o)<=0;return s===c?s===i&&d:!(o-h!=(h-u)/(c-s)*(i-c)||!d)}},{key:"rayIntersectLineSegment",value:function(e,t,n){var r=_(e,2),i=r[0],o=r[1],a=_(t,2),s=a[0],u=a[1],l=_(n,2),c=l[0],h=l[1];if(s===c)return!1;var d=(i-s)/(c-s);return d>=0&&d<1&&(h-u)*d+u>o}},{key:"isPointInPolygon",value:function(t,n){var r=_(t,2),i=r[0],o=r[1],a=n.length;if(a<3)return!1;var s=0,u=n[a-1];return n.forEach((function(t){e.rayIntersectLineSegment([i,o],u,t)&&(s+=1),u=t})),s%2!=0}},{key:"isPointOnLineString",value:function(t,n){var r=_(t,2),i=r[0],o=r[1],a=n.length;if(a<2)return!1;for(var s=n[a-1],u=0;u<a;u+=1){var l=n[u];if(e.isPointOnLineSegment([i,o],s,l))return!0;s=n[u]}return!1}},{key:"getAreaOfPolygon",value:function(e){var t=e.length;if(t<3)return null;var n=0,r=e[t-1];return e.forEach((function(e){var t,i,o,a,s,u;n+=.5*(t=e,i=_(r,2),o=i[0],a=i[1],s=_(t,2),u=s[0],o*s[1]-a*u),r=e})),n}},{key:"getDistanceBetweenPoints",value:function(e,t){var n=_(e,2),r=n[0],i=n[1],o=_(t,2),a=r-o[0],s=i-o[1];return Math.sqrt(a*a+s*s)}}]),e}(),wt=function(){function e(){c(this,e),this.spaceRules={}}return d(e,null,[{key:"getDataEntriesOne",value:function(e,t){var n=[e,""];if(null!==t&&Array.isArray(t))n[1]=t.toString();else if(null!==t&&"object"===u(t)){var r=Object.entries(t);if(r.length>0){var i=this.getDataEntriesOne(r[0][0],r[0][1]);n[0]="".concat(n[0],".").concat(i[0]),n[1]=i[1]}}else n[1]=t;return n}},{key:"getDataEntriesAll",value:function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=_(r[n],2),o=i[0],a=i[1],s=this.getDataEntriesOne(o,a);t.push(s)}return t}},{key:"doFindComboMatch",value:function(e,t){var n=this,r="";return e&&e.configuration&&e.configuration.combinations&&function(){for(var i=n.getDataEntriesAll(t),o=Object.entries(e.configuration.combinations),a=0,s=function(){var e=l[u],t=Object.keys(e[1]).filter((function(t){return i.some((function(n){return t===n[0]&&e[1][t]===n[1]}))}));t.length===Object.keys(e[1]).length&&t.length>a&&(r=e[0],a=t.length)},u=0,l=o;u<l.length;u++)s()}(),r}},{key:"getIconFromCombinations",value:function(e,t){if(e&&e.configuration.combinations&&t&&Object.keys(t).length>0&&e.behavioralAppearance.combinations&&Object.keys(e.behavioralAppearance.combinations).length>0){var n=this.doFindComboMatch(e,t);if(""===n||!e.behavioralAppearance.combinations[n].labelIcon)return"";if(e.behavioralAppearance.combinations&&e.behavioralAppearance.combinations[n]&&e.behavioralAppearance.combinations[n].labelIcon)return e.behavioralAppearance.combinations[n].labelIcon.referenceUri}return""}},{key:"findSpace",value:function(e,t){if(t.spaceTypes&&t.spaceTypes[e])return t.spaceTypes[e]}},{key:"findCategory",value:function(e){if(this.spaceRules[e])return this.spaceRules[e]}},{key:"setSpaceRules",value:function(e){this.spaceRules=e}},{key:"getSpaceIcon",value:function(e,t,n){var r="",i=this.findCategory(t);if(i){var o=this.findSpace(e,i);if(o){var a="";n&&(a=this.getIconFromCombinations(o,n)),a&&""!==a?r=a:o.behavioralAppearance.default.labelIcon?r=o.behavioralAppearance.default.labelIcon.referenceUri:i.properties.behavioralAppearance.default.labelIcon&&(r=i.properties.behavioralAppearance.default.labelIcon.referenceUri)}}return r}}]),e}(),xt=function(){function e(){c(this,e),this.themeRule={},this.svgList={},this.defaultLang="ENG"}return d(e,null,[{key:"getNumberFromAlphaNumeric",value:function(e){try{var t=e.split("").reverse().join("").replace(/[^0-9]/g,"").substr(0,6);return parseInt(t,10)}catch(e){return null}}},{key:"extractNumFromSting",value:function(e){try{var t=e.replace(/[^0-9]/g,"");return parseInt(t,10)}catch(t){return console.warn("Exception in converting string to Id"),this.getNumberFromAlphaNumeric(e)}}},{key:"getVenueId",value:function(e){if("number"!=typeof e){var t=e.substr(e.length-6);return parseInt(t,10)}return e}},{key:"getStringFormatIdentifier",value:function(e){return"number"==typeof e||e.length<13?"indoormap-00000000-0000-4000-a000-".concat(e.toString().padStart(12,"0")):e}},{key:"setSite",value:function(e,t){var n=this.getName(e),r={id:this.getStringFormatIdentifier(t),location:e.referencePoint,properties:e.properties,geometry:e.geometry,map_version:e.properties.indoorSiteMetadata.legacyVersion.mapVersion,identifier:this.getVenueId(t),obj_type:"CommunityMap"};return r.properties.name=n,r.properties.display_name=n,r}},{key:"setEntrance",value:function(e){var t=this.themeRule.entranceRules.default.labelIcon.referenceUri,n=this.extractNumFromSting(e.id),r=this.getName(e),i=e.properties;return i.icon=!0,i.svg=this.svgList[t.toLowerCase()],i.name=r||"entrance",i.display_name=r||"entrance",i.level={id:e.properties.level.id},{id:e.id,levelId:e.properties.level.id,momType:Ge.ENTRANCE,geometry:e.geometry,location:e.geometry,properties:i,identifier:n,label_area:[e.referencePoint.coordinates[0],e.referencePoint.coordinates[1],50,50,180]}}},{key:"setStructure",value:function(e){var t=this.extractNumFromSting(e.id),n=this.getName(e),r=e.properties;return r.is_root=0===e.properties.drawOrder,r.display_name=n,r.map_type=e.properties.structureType,r.name=n,{id:e.id,obj_type:"Drawing",identifier:t,properties:r}}},{key:"getNameByPriority",value:function(e,t){for(var n=this,r="",i=function(e){return"OFFICIAL"===e.nameType&&e.languageCode&&e.languageCode===n.defaultLang||"OFFICIAL"===e.nameType},o=0;o<e.length;o++){var a=e[o];if(i(a)&&(t&&t===a.nameType||!t)){r=a.name;break}if("ABBREVIATION"===a.nameType&&(t&&t===a.nameType||!t)){r=a.name;break}if("UNCLASSIFIED"===a.nameType&&(t&&t===a.nameType||!t)){r=a.name;break}if(!a.nameType&&a.name){r=a.name;break}}return r}},{key:"getName",value:function(e,t){return e.properties&&e.properties.names?this.getNameByPriority(e.properties.names,t):e.properties.placeProperties&&e.properties.placeProperties&&e.properties.placeProperties.names?this.getNameByPriority(e.properties.placeProperties.names,t):e.properties.locationDetails&&e.properties.locationDetails[0]&&e.properties.locationDetails[0].names?this.getNameByPriority(e.properties.locationDetails[0].names,t):""}},{key:"setLevel",value:function(e){var t=this.extractNumFromSting(e.id),n=e.properties.names,r=e.properties,i=e.geometry;return r["short name"]=this.getNameByPriority(n,n&&1!==n.length?"ABBREVIATION":""),r.name=this.getNameByPriority(n,n&&1!==n.length?"ABBREVIATION":""),{id:e.id,obj_type:"Level",identifier:t,properties:r,geometry:i}}},{key:"setLevelConnector",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"LevelConnector",properties:e.properties,geometry:e.geometry,identifier:t,location:e.geometry}}},{key:"setOccupant",value:function(e){var t=this.getName(e),n=this.extractNumFromSting(e.id),r=e.properties;return r.occupantName=t,r.email=e.properties.placeProperties&&e.properties.placeProperties.contacts&&e.properties.placeProperties.contacts.find((function(e){return"EMAIL"===e.contactType}))&&e.properties.placeProperties.contacts.find((function(e){return"EMAIL"===e.contactType})).value,r.name=t,r.tags=e.properties.attributes&&e.properties.attributes.tags,{geometry:e.geometry,id:e.id,obj_type:"Geometry",properties:r,identifier:n,spaceIds:e.properties.spaces?e.properties.spaces:[],type:"Feature",momType:Ge.OCCUPANT}}},{key:"getIcon",value:function(e){var t=!1,n="";return this.svgList[e]&&(t=!0,n=this.svgList[e]),{icon:t,svg:n}}},{key:"setSpace",value:function(e){var t=wt.getSpaceIcon(e.properties.spaceType,e.properties.spaceCategory,e.properties.spaceTypeProperties),n=this.getName(e),r=this.getIcon(t),i=r.icon,o=r.svg,a=this.extractNumFromSting(e.id),s=(e.properties.level.id.includes("out"),e.properties.level.id),u=e.properties;u.spaceName=n,u[e.properties.spaceCategory]=e.properties.spaceType,u.spaceType=e.properties.spaceType,u.spaceCategory=e.properties.spaceCategory,u.icon=i,u.svg=o;var l={geometry:e.geometry,id:e.id,levelId:s,label_area:[e.referencePoint.coordinates[0],e.referencePoint.coordinates[1],50,50,180],location:e.referencePoint,obj_type:"Geometry",identifier:a,properties:u,momType:Ge.SPACE,type:"Feature"};return e.properties.spaceAddress&&e.properties.spaceAddress.id&&(l.addressId=e.properties.spaceAddress.id),l}},{key:"setSpaceGroups",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"SpaceGroups",properties:e.properties,geometry:e.geometry,location:e.referencePoint,identifier:t}}},{key:"setTopology",value:function(e){var t=this.extractNumFromSting(e.id);return{id:e.id,obj_type:"Topology",properties:e.properties,geometry:e.geometry,identifier:t}}},{key:"setAddress",value:function(e){var t=this.extractNumFromSting(e.id),n=this.getName(e),r=e.properties;return r.addressName=n,r.name=n,{id:e.id,properties:r,obj_type:"Address",identifier:t}}},{key:"manageSvgDimensions",value:function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var i=_(r[n],2),o=i[0],a=i[1];if("string"==typeof a){var s=-1!==a.indexOf("<g")&&a.indexOf("<g")||a.indexOf("<p"),u=a.indexOf("</s");if(s&&u){var l=a.substring(s-1,u-1);t[o]="<svg width='64' height='64' viewBox='0 0 24 32' fill='none' xmlns='http://www.w3.org/2000/svg'>".concat(l,"</svg>")}}}return t}},{key:"getSiteBoundingBox",value:function(e){if(e){var t=_(kt.getBoundingBox(e.geometry.type,e.geometry.coordinates),2),n=t[0],r=t[1];if(n)return"".concat(n[0],",").concat(n[1],",").concat(r[0],",").concat(r[1])}return"null, null, null, null"}}]),e}(),Pt=function(){function e(){c(this,e)}return d(e,null,[{key:"get",value:function(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"GET"}).then((function(t){return t.ok?t.json():Promise.reject(new Error("Call failed for ".concat(e," : ").concat(t.status," ").concat(t.statusText)))}))}},{key:"getFormattedIndoorMapId",value:function(e){return"number"==typeof e?"indoormap-00000000-0000-4000-a000-".concat(e.toString().padStart(12,"0")):e.includes("indoormap")?e:"indoormap-00000000-0000-4000-a000-".concat(e.padStart(12,"0"))}},{key:"getConfigUrl",value:function(e,t,n){var r=n.apiKey,i=n.url,o=n.token,a=n.hrn,s={method:"GET",mode:"cors",cache:"default"},u="".concat(i||tt,"/").concat(a),l="";return t===je.SITE&&(l="".concat(u,"/layers/").concat(qe,"/search?p.featureType=indoor.Site&p.indoorMapId='").concat(this.getFormattedIndoorMapId(e),"'")),t===je.IMAGES&&(l="".concat(u,"/layers/").concat($e,"/features/svg")),t===je.Theme&&(l="".concat(u,"/layers/").concat(et,"/features/indoorMapRules")),o?s.headers={Authorization:"Bearer ".concat(o)}:l=l.concat("".concat(t===je.SITE?"&":"?","apiKey=").concat(r)),this.get(l,s)}},{key:"getMomData",value:function(e,t){var n=t.apiKey,r=t.url,i=t.token,o=t.hrn,a={method:"GET",mode:"cors",cache:"default"},s="".concat(r||tt,"/").concat(o),u=e&&e.features&&e.features.find((function(e){return e.momType===Ge.SITE})),l=xt.getSiteBoundingBox(u),c=[Ge.TOPOLOGY,Ge.LEVELCONNECTOR],h=Object.values(Ge).filter((function(e){return!c.includes(e)})).join(),d="".concat(s,"/layers/").concat(qe,"/bbox?bbox=").concat(l,"&limit=100000&f.momType=").concat(h);return i?a.headers={Authorization:"Bearer ".concat(i)}:d=d.concat("&apiKey=".concat(n)),{mom:this.get(d,a),site:u}}},{key:"getDefaultCollection",value:function(e){var t=e.token,n=ot[it.DEFAULT_COLLECTION],r=n.PARAMS,i=n.BASE_URL,o=encodeURI("".concat(i,"?sortBy=").concat(r.CREATED_BY,"&q=").concat(r.COLLECTION));if(t){var a={method:"GET",headers:{Authorization:"Bearer ".concat(t)}};return this.get(o,a)}return Promise.reject(new Error("Please provide valid token"))}},{key:"getProjectAccountDetails",value:function(e){var t=e.token,n=ot[it.ACCOUNT_API].BASE_URL;if(t){var r={method:"GET",mode:"cors",headers:{Authorization:"Bearer ".concat(t)}};return this.get(n,r)}return Promise.reject(new Error("Please provide valid token"))}},{key:"fetchIndoorMapList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.hrn,n=e.url,r=ot[it.CATALOG_LAYER],i=r.PARAMS,o=r.COLLECTION_LAYER;if(t){var a=encodeURI("".concat(n||tt,"/").concat(t,"/").concat(o,"?").concat(i.FEATURE_TYPE.KEY,"=").concat(i.FEATURE_TYPE.VALUE)),s=this.createBaseUrl(a,st.GET,{},e),u=s.URL,l=s.options;return this.get(u,l)}return Promise.reject(new Error("Please provide valid hrn"))}},{key:"createBaseUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:st.GET,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.token,a=r.apiKey,s=e,u={method:t,mode:"cors"};return i?u.headers=o({Authorization:"Bearer ".concat(i)},n):s=e.concat("&apiKey=".concat(a)),{URL:s,options:u}}}]),e}(),Ct=function(){function e(){c(this,e)}return d(e,null,[{key:"isPointOnGeoJSONLineString",value:function(e,t){var n=!1;if(t&&t.length>1)for(var r=0,i=0,o=1;o<t.length;o+=1)if(r=t[o-1],i=t[o],kt.isPointOnLineSegment(e,r,i)){n=!0;break}return n}},{key:"isPointOnGeoJSONMultiLineString",value:function(t,n){for(var r=!1,i=0;i<n.length;i+=1)if(e.isPointOnGeoJSONLineString(t,n[i])){r=!0;break}return r}},{key:"isPointInsideGeoJSONPolygon",value:function(e,t){var n=!1;if(kt.isPointInPolygon(e,t[0])&&(n=!0),n)for(var r=1;r<t.length;r+=1)if(kt.isPointInPolygon(e,t[r])){n=!1;break}return n}},{key:"isPointInsideGeoJSONMultiPolygon",value:function(t,n){for(var r=n.length,i=0;i<r;i+=1)if(e.isPointInsideGeoJSONPolygon(t,n[i]))return!0;return!1}},{key:"getGeometriesByLonLat",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=t.filter((function(t){return kt.isPointInBoundingBox(e,t.getBoundingBox())})),o=0;o<i.length;o+=1){var a=i[o];if(a.isPointInsideGeometry(e,true)&&(r.push(a),!n))break}return r.sort((function(e,t){return t.getZIndex()-e.getZIndex()}))}}]),e}(),Dt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;c(this,e),this.id=t.id,this.properties=t.properties||{},this.labelArea=t.label_area||[],this.geometry=t.geometry||{},this.location=t.location||{},this.address=t.address||{},this.level=n,this.zIndex=r,this.spaceId=t.spaceId,this.state_={isHighlighted:!1,highlightedStyle:{}},this.geometryData=t}return d(e,[{key:"getId",value:function(){return this.geometryData&&this.geometryData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getInternalAddress",value:function(){return this.address?this.address.properties&&this.address.properties.name:null}},{key:"getCenter",value:function(){return this.location.coordinates||[]}},{key:"getCoordinates",value:function(){return this.geometry.coordinates||[]}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getStyle",value:function(){return this.getMetaInformation_().getStyle(this)}},{key:"getIcon",value:function(){return this.properties.svg}},{key:"getLabelArea",value:function(){return this.labelArea||[]}},{key:"getLabelStyle",value:function(){return this.getMetaInformation_().getLabelStyle(this)||null}},{key:"getLevel",value:function(){return this.level}},{key:"getType",value:function(){return this.geometry.type}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"getBoundingBox",value:function(){var e=this.getType(),t=this.getCoordinates(),n=[];switch(e){case Ye:n=[t,t];break;case Ke:case Ze:n=t;break;case Je:case We:n=t.reduce((function(e,t){return e.concat(t)}),[]);break;case Xe:n=t.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.concat(t)}),[])}return kt.getBoundingBoxVertices(n)}},{key:"isIcon",value:function(){return!!this.properties.icon}},{key:"isPointInsideGeometry",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1;switch(this.getType()){case Ye:t=this.getLabelArea()&&kt.getRectangularCoordinatesOfLabelArea(this.getLabelArea()),r=kt.isPointInPolygon(e,t);break;case Ke:break;case Ze:r=n&&Ct.isPointOnGeoJSONLineString(e,this.getCoordinates());break;case Je:r=n&&Ct.isPointOnGeoJSONMultiLineString(e,this.getCoordinates());break;case We:r=Ct.isPointInsideGeoJSONPolygon(e,this.getCoordinates());break;case Xe:r=Ct.isPointInsideGeoJSONMultiPolygon(e,this.getCoordinates())}return r}},{key:"highlight",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.state_.isHighlighted=e,this.state_.highlightedStyle=e?t:{}}},{key:"isHighlighted",value:function(){return Boolean(this.state_.isHighlighted)}},{key:"getHighlightedStyle",value:function(){return this.state_.highlightedStyle||{}}},{key:"toJSON",value:function(){return o({},this.geometry)}},{key:"getMetaInformation_",value:function(){return this.getLevel()?this.getLevel().getDrawing().getVenueModel().metaInformation_:null}}]),e}(),jt=function(){function e(t,n){var r=this;c(this,e),this.id=t&&t.id,this.properties=t&&t.properties,this.zIndexCount=0,this.geometries=t&&t.features&&Object.values(t.features).reduce((function(e,t){return e[[t.id]]=new Dt(t,r,t.properties.drawOrder),e}),{}),this.drawing=n,this.levelData=t}return d(e,[{key:"getId",value:function(){return this.levelData&&this.levelData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getName",value:function(){return this.properties&&this.properties.name||""}},{key:"getDisplayName",value:function(){return this.properties&&this.properties.display_name||""}},{key:"getDrawing",value:function(){return this.drawing}},{key:"getShortName",value:function(){return this.properties&&this.properties["short name"]||""}},{key:"getZIndex",value:function(){return this.properties&&this.properties.zLevel}},{key:"getFeatureCollectionArray",value:function(){return this.getGeometries().map((function(e){return e.toJSON()}))}},{key:"getGeometryById",value:function(e){return this.geometries[e]}},{key:"getGeometries",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.geometries&&Object.values(this.geometries).sort((function(e,t){return t.getZIndex()-e.getZIndex()})):this.geometries&&Object.values(this.geometries).sort((function(e,t){return e.getZIndex()-t.getZIndex()}))}},{key:"getGeometriesByAddress",value:function(e){return Object.values(this.geometries).filter((function(t){return t.address&&t.address.properties&&t.address.properties.name&&t.address.properties.name===e}))}},{key:"isMain",value:function(){return Boolean(this.properties.isMain)}}]),e}(),Gt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;c(this,e),this.venueModel=o,this.levels=i.map((function(e){return new jt(e,n)})),this.structure=t,this.id=t&&t.id,this.properties=r}return d(e,[{key:"getId",value:function(){return this.structure&&this.structure&&this.structure.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"isRoot",value:function(){return Boolean(this.properties.is_root)}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getBoundingBox",value:function(){if(this.structure&&this.structure.geometry){var e=_(kt.getBoundingBox(this.structure.geometry.type,this.structure.geometry.coordinates),2),t=e[0],n=e[1];if(t)return[n[1],t[0],t[1],n[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.structure&&this.structure.location&&this.structure.location.coordinates}},{key:"getGeometryById",value:function(e){return this.getGeometries().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.levels.flatMap((function(e){return e.getGeometries()}))}},{key:"getLevelById",value:function(e){return this.levels.find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getLevelByZIndex",value:function(e){return this.levels.find((function(t){return t.getZIndex()===e}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getMainLevel",value:function(){return this.levels.find((function(e){return e.isMain()}))}},{key:"getVenueModel",value:function(){return this.venueModel}}]),e}(),Rt=Qe.STANDARD,Vt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt;c(this,e),this.metaInformation_=r,this.momStructure=t,this.id=t&&t.site&&t.site.id,this.location=t&&t.site&&t.site.location||{},this.properties=t&&t.site&&o({},t.site.properties),this.drawings=t&&t.structure&&Object.values(t.structure).map((function(e){var r=t.getStructureWiseGeometry(e.id);return new Gt(e,e.properties,Object.values(r),n)}))}return d(e,[{key:"getDisplaySettings",value:function(){return(this.metaInformation_.releaseSettings_?this.metaInformation_.releaseSettings_.displayOptions:"").display||Rt}},{key:"getId",value:function(){return this.momStructure&&this.momStructure.site&&this.momStructure.site.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getName",value:function(){return this.properties.name}},{key:"getBoundingBox",value:function(){if(this.momStructure){var e=_(kt.getBoundingBox(this.momStructure.site.geometry.type,this.momStructure.site.geometry.coordinates),2),t=e[0],n=e[1];if(t)return[n[1],t[0],t[1],n[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.location.coordinates}},{key:"getGeometryById",value:function(e){return this.getGeometries().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.getLevels().sort((function(e,t){return e.getZIndex()-t.getZIndex()})).flatMap((function(e){return e.getGeometries()}))}},{key:"getGeometriesByLonLat",value:function(e){var t=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((function(e){return t.getLevelById(e)}));0===r.length&&(r=this.drawings.filter((function(t){var n=t.getBoundingBox();return kt.isPointInBoundingBox(e,n)})).flatMap((function(e){return e.getLevels()})));return Ct.getGeometriesByLonLat(e,r.flatMap((function(e){return e.getGeometries(!0)})),n)}},{key:"getDrawingById",value:function(e){return this.drawings.find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getRootDrawing",value:function(){return this.drawings.find((function(e){return e.isRoot()}))}},{key:"getLevelById",value:function(e){return this.getLevels().find((function(t){return t.getId()===e||t.getIdentifier()===e}))}},{key:"getLevelsByZIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getLevels().filter((function(t){return Number(t.getZIndex())===Number(e)}))}},{key:"getLevels",value:function(){return this.drawings.flatMap((function(e){return e.getLevels()}))}},{key:"getMomStructure",value:function(){return this.momStructure}},{key:"getLevelMapFlattenedByZIndex_",value:function(){var e=this.getLevels().reduce((function(e,t){var n=t.getZIndex(),r=e;return r[n]||(r[n]=[]),r[n].push(t),r}),{});return e}},{key:"getOccupant",value:function(){var e=this.momStructure.occupant;return Object.values(e)}}]),e}(),Ht=function(){function e(t){c(this,e),this.theme=t&&t.theme,this.level=t&&t.level,this.site=t&&t.site,this.spaces=t&&t.spaces,this.address=t&&t.address,this.levelConnector=t&&t.levelConnector,this.topology=t&&t.topology,this.entrance=t&&t.entrance,this.occupant=t&&t.occupant,this.structure=t&&t.structure,this.spaceGroups=t&&t.spaceGroups,this.levelWiseGeometry={},this.levelStructureMapping=t&&t.levelStructureMapping,this.outdoorLevelMapping=t&&t.outdoorLevelMapping||{},this.labelTextPreference=t&&t.labelTextPreference||null}return d(e,[{key:"setSpaceWithLevel",value:function(){var e=this;this.spaces&&Object.values(this.spaces).forEach((function(t){var n="";t.addressId&&(n=e.address&&e.address[t.addressId]&&e.address[t.addressId].properties.addressName);var r=t.properties;r.addressName=n;var i=e.getLabelAsPerPreference(o(o({},t),{},{properties:r})),a=t.properties;a.name=i,a.display_name=i,t.properties.icon&&(a.name=t.id,a.display_name=t.id);var s=t;s.properties=a,s.address=e.address[t.addressId],e.spaces[t.id]=t;var u=t.levelId;e.outdoorLevelMapping[u]&&(u=e.outdoorLevelMapping[u]),e.levelWiseGeometry[u]||(e.levelWiseGeometry[u]={}),e.levelWiseGeometry[u][s.id]=s}))}},{key:"setOccupantWithLevel",value:function(){var e=this;this.occupant&&Object.values(this.occupant).forEach((function(t){if(t.spaceIds&&t.properties.occupantName){var n=[],r=[];t.spaceIds.forEach((function(i){var o=i.id,a=e.spaces[o],s=null;e.spaceGroups&&Object.values(e.spaceGroups).forEach((function(e){e.properties.spaceGroups&&e.properties.spaceGroups&&e.properties.spaceGroups.forEach((function(e){e.mainSpace&&e.mainSpace.id===i.id&&(s=e.spaces.map((function(e){return e.id})))}))}));var u=function(i){var o=!1;e.labelTextPreference&&e.labelTextPreference.length&&(o=-1!==e.labelTextPreference.indexOf("OCCUPANT_NAMES"));var a=null===e.labelTextPreference||o,s=i,u=i.properties;u.name=i.properties.icon||!a?i.properties.name:t.properties.occupantName,u.display_name=i.properties.icon||!a?i.properties.display_name:t.properties.occupantName,u.address=i.address,u.occupantName=t.properties.occupantName;var l=i.levelId;e.outdoorLevelMapping[l]&&(l=e.outdoorLevelMapping[l]),e.levelWiseGeometry[l]||(e.levelWiseGeometry[l]={}),e.levelWiseGeometry[l][i.id]=s,n.push(s),r.push(i.id)};s&&s.length>0&&s.forEach((function(t){u(e.spaces[t])})),a&&u(a)})),e.occupant[t.id]=t,e.occupant[t.id].space=n,e.occupant[t.id].spaceIds=r}}))}},{key:"setEntrance",value:function(){var e=this;this.entrance&&Object.values(this.entrance).forEach((function(t){var n=t.properties.level.id;e.levelWiseGeometry[n]||(e.levelWiseGeometry[t.properties.level.id]={}),e.outdoorLevelMapping[n]&&(n=e.outdoorLevelMapping[n]),e.levelWiseGeometry[n][t.id]=t}))}},{key:"setLevelWiseGeometry",value:function(){var e=this;this.level&&Object.keys(this.level).forEach((function(t){e.levelWiseGeometry[t]={}})),this.setSpaceWithLevel(),this.setOccupantWithLevel(),this.setEntrance()}},{key:"getStructureWiseGeometry",value:function(e){for(var t={},n=0,r=Object.entries(this.levelWiseGeometry);n<r.length;n++){var i=_(r[n],2),o=i[0],a=i[1];e===this.levelStructureMapping[o]&&(t[o]=this.level[o],t[o].features=a)}return t}},{key:"getLabelAsPerPreference",value:function(e){var t,n=e.properties,r=n.spaceType,i=n.occupantName,o=n.spaceName,a=n.addressName,s=n.spaceCategory,u=(p(t={},Re,i),p(t,Ve,o),p(t,Ue,r?r.charAt(0).toUpperCase()+r.slice(1).toLowerCase():""),p(t,Fe,s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():""),p(t,He,a),p(t,ze,a),p(t,Be,a),t),l=this.theme.spaceRules,c="",h=s&&r&&l[s]&&l[s].spaceTypes&&l[s].spaceTypes[r].behavioralAppearance.default.labelType;if("NONE"===h){if(!this.labelTextPreference)return"";u[Ue]=""}var d=s&&r&&l[s]&&l[s].properties&&l[s].properties.behavioralAppearance&&l[s].properties.behavioralAppearance.default&&l[s].properties.behavioralAppearance.default.labelType;if(("NONE"===d||void 0===d)&&void 0===h){if(!this.labelTextPreference)return"";u[Ue]="",u[Fe]=""}var f=s&&r&&l[s]&&l[s].properties&&l[s].properties.behavioralAppearance&&l[s].properties.behavioralAppearance.default&&l[s].properties.behavioralAppearance.default.labelTextPreference,v=f&&this.labelTextPreference?this.labelTextPreference:f;if(v)for(var g=0;g<v.length;g++)if(u[v[g]]){c=u[v[g]];break}return c}}]),e}(),zt=function(){function e(t){var n=t.apiKey,r=t.baseUrl,i=t.token,o=t.hrn;c(this,e);var a={apiKey:n,url:r,token:i,hrn:o};this.hostOptions_=a,this.momData=[],this.theme={},this.loadOptions={}}var t;return d(e,[{key:"setHostOptions",value:function(e){0===Object.keys(e).length||(this.hostOptions_=o(o({},this.hostOptions_),e))}},{key:"getToken",value:function(){return this.hostOptions_.token}},{key:"getHrn",value:function(){return this.hostOptions_.hrn}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadOptions=o(o(o({},at),n),{},{venueId:e}),this.hostOptions_.mapData=n.mapData,this.hostOptions_.themeRule=n.themeRule,this.hostOptions_.svgList=n.svgList,this.hostOptions_.labelTextPreference=n.labelTextPreferenceOverride,this.getHrn()?this.getVenueModalInstance():this.getToken()?this.getDefaultCollectionWithToken().then((function(){return t.getVenueModalInstance()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load indoor map, Please provide either hrn or token"))}},{key:"getVenueModalInstance",value:function(){var e=this;return Promise.resolve().then((function(){return e.loadOptions.isMetaEnabled?e.getMeta_(e.loadOptions.isIconsEnabled).catch((function(e){return console.warn(e),Promise.resolve()})):Promise.reject()})).then((function(t){return e.getVenue_(t)})).then((function(e){return e})).catch((function(e){console.debug("Captured event VENUE_ERROR_STATE",e)}))}},{key:"createMomStructure",value:function(){var e=this,t={site:{},structure:{},level:{},levelConnector:{},occupant:{},spaces:{},spaceGroups:{},topology:{},address:{},outdoorLevelMapping:{},entrance:{},levelStructureMapping:{}};return this.momData.forEach((function(n){var r="indoormap-00000000-0000-4000-a000-".concat(e.loadOptions.venueId.toString().padStart(12,"0")),i=n.id;(n.momType===Ge.ADDRESS||e.hostOptions_.mapData||n.properties.indoorMapId==e.loadOptions.venueId||n.properties.indoorMapId===r)&&(n.momType===Ge.SITE?t.site=xt.setSite(n,e.loadOptions.venueId):n.momType===Ge.STRUCTURE?t.structure[i]=xt.setStructure(n):n.momType!==Ge.LEVEL||n.properties.isOutdoor&&(!n.properties.isOutdoor||n.properties.parentIndoorLevel)?n.momType===Ge.LEVEL&&n.properties.isOutdoor&&n.properties.parentIndoorLevel?t.outdoorLevelMapping[n.id]=n.properties.parentIndoorLevel.id:n.momType===Ge.ENTRANCE?t.entrance[i]=xt.setEntrance(n):n.momType===Ge.OCCUPANT?t.occupant[i]=xt.setOccupant(n):n.momType===Ge.SPACE?t.spaces[i]=xt.setSpace(n):n.momType===Ge.SPACEGROUPS?t.spaceGroups[i]=xt.setSpaceGroups(n):n.momType===Ge.ADDRESS&&(t.address[i]=xt.setAddress(n)):(t.level[i]=xt.setLevel(n),t.levelStructureMapping[i]=n.properties.structure.id))})),t.theme=this.theme,t.labelTextPreference=this.hostOptions_.labelTextPreference,new Ht(t)}},{key:"getVenue_",value:function(e){this.momData=e.getMomData();var t=this.createMomStructure();return t.setLevelWiseGeometry(),new Vt(t,e)}},{key:"setConfigData",value:function(e){var t=e.themeRule,n=e.svgList,r=e.defaultLang;wt.setSpaceRules(t.spaceRules),xt.svgList=n,xt.themeRule=t,xt.defaultLang=r,this.theme=t}},{key:"getMeta_",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=new Tt,r=this.hostOptions_.mapData?{}:this.getMetaConfig_(this.loadOptions.venueId,je.SITE),i=this.hostOptions_.themeRule||this.getMetaConfig_(this.loadOptions.venueId,je.Theme),o=[];return t&&(o=this.hostOptions_.svgList||this.getMetaConfig_(this.loadOptions.venueId,je.IMAGES)),new Promise((function(a){Promise.all([r,i,o]).then((function(r){var i=_(r,3),o=i[0],s=i[1],u=i[2],l=e.hostOptions_.mapData?{mom:new Promise((function(t){return t(e.hostOptions_.mapData)})),site:e.hostOptions_.mapData.features.find((function(e){return e.momType===Ge.SITE}))}:Pt.getMomData(o,e.hostOptions_);l.mom.then((function(r){var i=s.properties;n.imageCache=t?xt.manageSvgDimensions(u.properties):[],e.setConfigData({themeRule:i,svgList:n.imageCache,defaultLang:l&&l.site&&l.site.properties.defaultLanguageCode}),n.releaseSettings_={displayOptions:{display:i.entranceRules.default.displayName||Qe.STANDARD},mom:r.features},n.theme=new At(i,n),a(n)}))}))}))}},{key:"getMetaConfig_",value:function(e,t){return Pt.getConfigUrl(e,t,this.hostOptions_)}},{key:"fetchCollections",value:function(){return Pt.getDefaultCollection(this.hostOptions_)}},{key:"fetchUserProjects",value:function(){return Pt.getProjectAccountDetails(this.hostOptions_)}},{key:"getDefaultCollectionWithToken",value:(t=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){l(o,r,i,a,s,"next",e)}function s(e){l(o,r,i,a,s,"throw",e)}a(void 0)}))}}(a().mark((function e(){var t=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.fetchCollections(),this.fetchUserProjects()]).then((function(e){var n=_(e,2),r=n[0],i=n[1],o=t.getHrnFromDefaultCollection(r,i);if(o.hrn){var a={hrn:o.hrn};return t.setHostOptions(a),Promise.resolve()}return Promise.reject()})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getHrnFromDefaultCollection",value:function(e,t){var n=e.results.items;if(Array.isArray(n)&&n.length){var r=this.getProjectRealm(t);return n.find((function(e){return e.hrn.includes(r)}))}return Promise.reject(new Error("Error while accessing default collection"))}},{key:"getProjectRealm",value:function(e){if(Array.isArray(e.items)&&e.items.length&&e.items[0].id.includes("indoor-")){var t=e.items[0].hrn;return this.getRealmNameFromHrn(t)}return""}},{key:"getRealmNameFromHrn",value:function(e){if(e){var t=e.split(":");return t.length&&t[4]}return""}},{key:"getSupportedMapList",value:function(){var e=this,t=this.hostOptions_,n=t.hrn,r=t.token;return n?this.fetchMapInfoList():r?this.getDefaultCollectionWithToken().then((function(){return e.fetchMapInfoList()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load map list, Please provide either hrn or token"))}},{key:"fetchMapInfoList",value:function(){var e=this;return Pt.fetchIndoorMapList(this.hostOptions_).then((function(t){var n=t.features;return n.length>0?n.map((function(t){var n=t.properties,r=n.placeProperties,i=n.indoorMapId,o=i.split("-").pop(),a=o.substring(o.length-5);return{mapIdentifier:i,mapName:e.getMapName(r.names).name,mapId:a}})):[]})).catch((function(e){Promise.reject(new Error("".concat(e,": Error while fetching map list")))}))}},{key:"getMapName",value:function(e){return Array.isArray(e)&&e.length>0?e.find((function(e){return"OFFICIAL"===e.nameType})):{}}}]),e}(),Bt=["origin","destination"],Ut=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(c(this,e),!t.apiKey&&!t.token)throw new Error("API key or Token is missing");this.config_=o({baseUrl:"https://meta-indoor-routing.api-gateway.ls.hereapi.com"},t)}return d(e,[{key:"calculateRoute",value:function(e){var t=e.origin,n=void 0===t?{}:t,r=e.destination,i=void 0===r?{}:r,o=y(e,Bt);if(!n.coordinates||!i.coordinates)throw new Error("Waypoint coordinates are missing");var a=function(e){var t=e.coordinates,n=e.venueId,r=e.levelId,i=t.join(",");return n&&r?i.concat(";indoorMapId=",n,";levelId=",r):i},s=new URL("".concat(this.config_.baseUrl,"/v1/routes")),l=new URLSearchParams({origin:a(n),destination:a(i),apiKey:this.config_.apiKey});return Object.entries(o).forEach((function(e){var t=_(e,2),n=t[0],r=t[1];l.append(n,"object"===u(r)?JSON.stringify(r):r)})),s.search=l,fetch(s,{headers:{"X-Api-Key":this.config_.apiKey}}).then((function(e){return e.json()}))}}]),e}(),Ft={VENUE_DATA_LOADED:"VENUE_DATA_LOADED",VENUE_THEME_LOADED:"VENUE_THEME_LOADED",VENUE_ICONS_LOADED:"VENUE_ICONS_LOADED",VENUE_MOM_DATA_LOADED:"VENUE_MOM_DATA_LOADED",VENUE_ERROR_STATE:"VENUE_ERROR_STATE",VENUE_MAP_DATA_LOADED:"VENUE_MAP_DATA_LOADED",VENUE_ENTITY_DATA_LOADED:"VENUE_ENTITY_DATA_LOADED",VENUE_DATA_MODEL_LOADED:"VENUE_DATA_MODEL_LOADED",VENUE_NAV_DATA_LOADED:"VENUE_NAV_DATA_LOADED",META_DATA_LOADED:"META_DATA_LOADED",META_DATA_MODEL_LOADED:"META_DATA_MODEL_LOADED",META_DATA_MODEL_UPDATED:"META_DATA_MODEL_UPDATED"};Object.freeze((p(vt={},Ft.VENUE_DATA_LOADED,{description:"event fired when all requested files along with metadata & overrides are loaded",emitTemplate:{}}),p(vt,Ft.VENUE_MAP_DATA_LOADED,{description:"event fired when requested levels, drawings & community files are loaded",emitTemplate:{}}),p(vt,Ft.VENUE_ENTITY_DATA_LOADED,{description:"event fired when requested entity data is loaded",emitTemplate:{}}),p(vt,Ft.VENUE_DATA_MODEL_LOADED,{description:"event fired when a map file is loaded",emitTemplate:{}}),p(vt,Ft.VENUE_NAV_DATA_LOADED,{description:"event fired when requested navigation product is loaded",emitTemplate:{}}),p(vt,Ft.META_DATA_LOADED,{description:"event fired when all requested meta files are loaded except icon & marker",emitTemplate:{}}),p(vt,Ft.META_DATA_MODEL_LOADED,{description:"event fired when a specific model is loaded except icon & marker",emitTemplate:{}}),p(vt,Ft.META_DATA_MODEL_UPDATED,{description:"event fired when a specific meta override is added or removed",emitTemplate:{}}),p(vt,Ft.VENUE_ICONS_LOADED,{description:"event fired when all icons of venue are loaded",emitTemplate:{}}),vt));var Yt=new lt;Yt.EVENT_NAME=Ft,Yt.on("newListener",(function(e){Ft[e]||console.warn("subscribing for un-registered/documented event")}));var Zt=function(e){f(r,H.map.Feature);var t=E(r);function r(e){var n;if(c(this,r),n=t.call(this),!(e instanceof Vt))throw new Error("It is mandatory to provide valid instance of venueModel");return n.venueModel=e,n.search_=new De(e),n.status_={activeDrawingId:e.getRootDrawing().getIdentifier(),activeLevelIndex:e.getRootDrawing().getMainLevel().getZIndex()},n.mapObjectStore_=n.getDefaultMapObjectsStore_(),n.drawings=e.getDrawings().map((function(e){var t=new A(e);return t.setParentEventTarget(m(n)),t})),n.levels=e.getLevels().map((function(e){var t=new T(e);return t.setParentEventTarget(n.drawings.find((function(e){return e.getIdentifier()===t.getData().getDrawing().getIdentifier()}))),t})),n.geometries=e.getGeometries().map((function(e){var t=new L(e);return t.setParentEventTarget(n.levels.find((function(e){return e.getIdentifier()===t.getData().getLevel().getIdentifier()}))),t})),n.mutualExclusiveHighlight_=!1,n}return d(r,[{key:"getData",value:function(){return this.venueModel}},{key:"getBoundingBox",value:function(){return n(H.geo.Rect,S(this.venueModel.getBoundingBox()))}},{key:"getCenter",value:function(){var e=_(this.venueModel.getCenter(),2),t=e[0],n=e[1];return new H.geo.Point(n,t)}},{key:"getId",value:function(){return this.venueModel.getId()}},{key:"getIdentifier",value:function(){return this.venueModel.getIdentifier()}},{key:"getName",value:function(){return this.venueModel.getName()}},{key:"getDrawing",value:function(e){return this.drawings.find((function(t){return t.getIdentifier()===e}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getLevel",value:function(e){return this.levels.find((function(t){return t.getIdentifier()===e}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getGeometry",value:function(e){return this.getGeometries().find((function(t){return t.getIdentifier()===e}))}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getActiveLevels",value:function(){var e=this;return this.getData().getDisplaySettings()===Qe.FLATTEN?this.venueModel.getLevelsByZIndex(this.status_.activeLevelIndex).map((function(t){return e.getLevel(t.getIdentifier())})):[this.venueModel.getDrawingById(this.status_.activeDrawingId).getLevelByZIndex(this.status_.activeLevelIndex)].map((function(t){return e.getLevel(t.getIdentifier())}))}},{key:"getActiveDrawing",value:function(){return this.getDrawing(this.status_.activeDrawingId)}},{key:"setActiveDrawing",value:function(e){if(this.status_.activeDrawingId!==e){var t=this.venueModel.getDrawingById(e);if(!t)throw new Error("Drawing ".concat(e," was not found"));var n=this.status_.activeDrawingId;this.status_.activeDrawingId=t.id,this.setActiveLevelIndex(t.getMainLevel().getZIndex()),this.dispatchEvent(new H.util.ChangeEvent(r.EVENTS.DRAWING_CHANGE,e,n))}}},{key:"getActiveLevelIndex",value:function(){return this.status_.activeLevelIndex}},{key:"setActiveLevelIndex",value:function(e){if(this.venueModel.getLevelsByZIndex(e)){var t=this.status_.activeLevelIndex;this.status_.activeLevelIndex=e,this.dispatchEvent(new H.util.ChangeEvent(r.EVENTS.LEVEL_CHANGE,e,t))}}},{key:"isActive",value:function(){var e=this.getParentEventTarget();return!!e&&this===e.activeVenue}},{key:"getHighlightedGeometries",value:function(){var e=this;return this.venueModel.getGeometries().filter((function(e){return e.isHighlighted()})).map((function(t){return e.getGeometry(t.getIdentifier())}))}},{key:"setHighlightedGeometries",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=o(o({},le),n),s=a.fillColor,u=a.outlineColor,l=a.outlineWidth;(this.mutualExclusiveHighlight_=!!i,this.mutualExclusiveHighlight_)&&this.getHighlightedGeometries().forEach((function(e){e.getData().highlight(!1)}));t.forEach((function(t){t.getData().highlight(e,{m:s,o:u,w:l})})),this.dispatchEvent(r.EVENTS.GEOMETRY_HIGHLIGHT)}},{key:"getMapObjects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getActiveLevelIndex(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveDrawing();return this.mapObjectStore_[e][t.getIdentifier()]}},{key:"setMapObjects",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveLevelIndex(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getActiveDrawing();this.mapObjectStore_[t]&&this.mapObjectStore_[t][n.getIdentifier()]&&(this.mapObjectStore_[t][n.getIdentifier()]=S(e)),this.updateMapObjectsVisibility_()}},{key:"search",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.search_.find(t).flatMap((function(t){return t.geometries.map((function(t){return e.getGeometry(t.id)}))}))}},{key:"updateMapObjectsVisibility_",value:function(){Object.values(this.mapObjectStore_).forEach((function(e){Object.values(e).forEach((function(e){return e.forEach((function(e){return e.setVisibility(!1)}))}))})),this.isActive()&&this.mapObjectStore_[this.getActiveLevelIndex()][this.getActiveDrawing().getIdentifier()].forEach((function(e){return e.setVisibility(!0)}))}},{key:"getDefaultMapObjectsStore_",value:function(){var e=this,t=this.getData().getDisplaySettings()===Qe.FLATTEN;return this.venueModel.getLevels().reduce((function(n,r){var i=r.getZIndex(),a=o({},n);return a[i]||(a[i]={}),a[i][r.getDrawing().getIdentifier()]=[],t&&(a[i][e.venueModel.getRootDrawing().getIdentifier()]=[]),a}),{})}}]),r}();Zt.EVENTS={ACTIVE_VENUE_CHANGE:"activevenuechange",DRAWING_CHANGE:"drawingchange",LEVEL_CHANGE:"levelchange",GEOMETRY_HIGHLIGHT:"geometryhighlight"};var Wt=function(){function e(){c(this,e)}return d(e,null,[{key:"getIconLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.isIcon()&&e.getIcon()})).map((function(e){var t=_(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLevel(),o=e.getIcon(),a=e.properties.spaceType||e.properties.spaceCategory||e.getDisplayName();return{type:"Feature",properties:{id:e.getIdentifier(),geometryId:e.getIdentifier(),levelId:i.getIdentifier(),name:a,venueId:i.getDrawing().getVenueModel().getIdentifier(),url:o?"data:image/svg+xml;utf8,".concat(encodeURIComponent(o)):""},geometry:{type:ne,coordinates:[n,r]}}}))}}},{key:"getLabelLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.getDisplayName()&&!e.isIcon()})).map((function(e){var t=_(e.getLabelArea(),2),n=t[0],r=t[1],i=e.getLabelStyle(),o=i.fill,a=i.zmin,s=e.getLevel();return{type:"Feature",properties:{id:e.getIdentifier(),geometryId:e.getIdentifier(),levelId:s.getIdentifier(),venueId:s.getDrawing().getVenueModel().getIdentifier(),name:e.getDisplayName(),minZoom:a||15,textFillColor:o.toLowerCase()},geometry:{type:ne,coordinates:[n,r]}}}))}}},{key:"getGeometryLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(e){return e.getData().getGeometries()})).filter((function(e){return e.getType()!==ne})).map((function(e){var t=e.getHighlightedStyle()||{},n=t.m,r=t.o,i=t.w,a=o({},e.getStyle()),s=a.m,u=a.o,l=a.w,c=se,h=c.fillColor,d=c.outlineColor,p=c.outlineWidth,f=e.getLevel();return{type:"Feature",properties:{id:e.getIdentifier(),fillColor:(n||s||h).toLowerCase(),geometryId:e.getIdentifier(),levelId:f.getIdentifier(),venueId:f.getDrawing().getVenueModel().getIdentifier(),outlineColor:(r||u||d).toLowerCase(),outlineWidth:Number(((i||l||p)/3).toFixed(2)),zIndex:e.getZIndex()},geometry:{type:e.getType(),coordinates:e.getCoordinates()}}}))}}},{key:"getFootprintLayer",value:function(e){return{type:"FeatureCollection",features:e.flatMap((function(e){return e.getData().getLevels().map((function(t){var n=t.getIdentifier(),r=e.getLevel(n).getData().levelData.geometry;return{type:"Feature",properties:{isFootprint:!0,levelId:n,venueId:e.getIdentifier(),zIndex:1},geometry:{type:"MultiPolygon",coordinates:r.coordinates}}}))}))}}}]),e}(),Kt=function(){function e(){c(this,e)}return d(e,null,[{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={styles:[{layer:pe.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#4E5663",lineWidth:["interpolate",["linear"],["zoom"],0,"1px",6,"1px",7,"2px",18,"2px",19,"4px",24,"4px"],renderOrder:1},{layer:pe.FOOTPRINT,when:["==",["geometry-type"],"Point"],technique:"text",color:"black",size:16,text:["get","venueName"],priority:61},{layer:pe.VECTOR,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:["get","fillColor"],renderOrder:["get","zIndex"]},{layer:pe.VECTOR,technique:"solid-line",color:["get","outlineColor"],lineWidth:["get","outlineWidth"],renderOrder:["get","zIndex"]},{layer:pe.TEXT,minZoomLevel:["get","minZoom"],technique:"text",color:["get","textFillColor"],size:ue.size,text:["get","name"],priority:60},{layer:pe.ICON,minZoomLevel:ce,when:["==",["geometry-type"],"Point"],technique:"labeled-icon",textIsOptional:!0,size:0,imageTexture:["concat","texture",["get","name"]],screenWidth:["interpolate",["linear"],["zoom"],15,3,21,70],screenHeight:["interpolate",["linear"],["zoom"],15,3,21,70],priority:61}],images:{},imageTextures:[]};return e.forEach((function(e){var t="texture"+e.properties.name;n.images[t]||(n.images[t]={url:e.properties.url,preload:!0},n.imageTextures.push({name:t,image:t}))})),t.forEach((function(e){var t,r=e.getData().getHighlightedStyle(),i=r.m,o=r.o,a=r.w;(t=n.styles).push.apply(t,[{layer:pe.VECTOR,when:["==",["get","id"],e.id],technique:"fill",color:i,renderOrder:["get","zIndex"]},{layer:pe.VECTOR,when:["==",["get","id"],e.id],technique:"solid-line",color:o,lineWidth:a,renderOrder:["get","zIndex"]}])})),new H.map.render.harp.Style(n)}}]),e}(),Jt=function(){function e(){c(this,e)}return d(e,null,[{key:"getIconsTextures",value:function(){var e={},t={},n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,t){var n=t.properties.name;return e[n]||(e[n]=[]),e[n].push(t),e}),{});return Object.keys(n).forEach((function(r){var i="texture".concat(r),o="sprite".concat(r),a=n[r][0].properties.url;e[i]={url:a,sprites:p({},o,[0,0,50,50])},n[r].forEach((function(e){var n=e.properties;t["icon".concat(n.name)]={filter:{name:n.name,$zoom:{min:ce}},draw:{points:{interactive:!0,priority:1,size:[[15,"50%"],[16,"55%"],[17,"60%"],[18,"65%"],[19,"75%"],[20,"80%"],[21,"100%"]],texture:i,sprite:o}}}}))})),{textures:e,iconLayers:t}}},{key:"getFootprintLayer",value:function(){return{data:{source:"venues",layer:pe.FOOTPRINT},draw:{lines:{color:"#4E5663",width:[[0,"1px"],[6,"1px"],[7,"2px"],[18,"2px"],[19,"4px"],[24,"4px"]],order:1},points:{color:"[0, 0, 0, 0]",size:"0px",order:3,priority:1,text:{anchor:"center",collide:!1,font:{fill:"black",size:"16px"},text_source:"function() { return feature.venueName }"}}}}}},{key:"getGeometryLayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={};if(e.length){var n=e[0].getData().getHighlightedStyle(),r=n.m,i=n.o,o=n.w;t={filter:{id:e.map((function(e){return e.id}))},draw:{polygons:{interactive:!0,color:r},lines:{color:i,width:o}}}}return{data:{source:"venues",layer:pe.VECTOR},draw:{polygons:{interactive:!0,color:"function() { return feature.fillColor }",order:"function() { return feature.zIndex }"},lines:{color:"function() { return feature.outlineColor }",order:"function() { return feature.zIndex }",width:"function() { return feature.outlineWidth }"}},highlighted:t}}},{key:"getTextLayer",value:function(){return{filter:{$zoom:{min:he}},data:{source:"venues",layer:pe.TEXT},draw:{points:{filter:"function() { return $zoom > feature.minZoom }",color:"[0, 0, 0, 0]",size:"0px",offset:["0px","-10px"],priority:2,text:{font:{fill:"function() { return feature.textFillColor }",size:ue.size},text_source:"function() { return feature.name }"}}}}}},{key:"getIconLayer",value:function(e){return o({data:{source:"venues",layer:pe.ICON}},e)}},{key:"getStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.getIconsTextures(t),i=r.textures,o=r.iconLayers,a={venue_footprints:e.getFootprintLayer(),venue_geometries:e.getGeometryLayer(n),venue_labels:e.getTextLayer(),venue_icons:e.getIconLayer(o)},s=H.gl.yaml.dump({sources:{venues:{max_zoom:de,type:"GeoJSONTileSource"}},layers:a,textures:i});return new H.map.render.webgl.Style(s)}}]),e}(),Xt={type:"FeatureCollection",features:[]},Qt={extent:4096,indexMaxZoom:0,maxZoom:24,tolerance:3},qt=function(e){f(n,H.map.provider.RemoteTileProvider);var t=E(n);function n(e){var r;return c(this,n),(r=t.call(this,e)).venues=[],r.activeVenue=null,r.dataLayers_={},r.tileIndexes_={},r.addEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,r.activeVenueChangeHandler_,void 0,m(r)),r}return d(n,[{key:"setStyle",value:function(e){return this.setStyleInternal(e)}},{key:"getStyle",value:function(){return this.getStyleInternal()}},{key:"isFeatureVisible_",value:function(e){var t=e.properties;return!!this.activeVenue.getActiveLevels().some((function(e){return e.id===t.levelId}))}},{key:"requestInternal",value:function(e,t,n,r){var i=this,o=function(r){for(var i=0;i<r.length;i+=1)r[i]=r[i].map((function(r){return Se(r,n,e,t,Qt.extent)}))},a={};return Object.keys(this.tileIndexes_).forEach((function(r){var s=i.tileIndexes_[r].getTile(n,e,t);a[r]=s?function(e){var t=[],n=e&&e.features;if(n)for(var r=0,i=n.length;r<i;r+=1){var o=n[r],a=o.type,s=void 0,u=!1;switch(a){case ve:s={type:ie,coordinates:o.geometry.map((function(e){return e.slice()}))};break;case ge:case ye:s={type:oe,coordinates:o.geometry.map((function(e){return e.map((function(e){return e.slice()}))}))},a===ye&&null==(s=_e(s))&&(u=!0);break;default:u=!0}u||t.push({geometry:s,id:o.id,properties:o.tags,type:"Feature"})}return{type:"FeatureCollection",features:t}}(s):Xt,a[r].features=a[r].features.filter((function(e){return i.isFeatureVisible_(e)}));for(var u=0;u<a[r].features.length;u+=1){var l=a[r].features[u],c=l.geometry.type;if(c===re||c===oe)o(l.geometry.coordinates);else if(c===ae)l.geometry.coordinates.map(o);else for(var h=l.geometry.coordinates,d=0;d<h.length;d+=1)h[d]=Se(h[d],n,e,t,Qt.extent)}})),r(a),{cancel:function(){}}}},{key:"getActiveVenue",value:function(){return this.activeVenue}},{key:"getVenue",value:function(e){return e?this.venues.find((function(t){return t.getIdentifier()===e})):this.activeVenue}},{key:"setActiveVenue",value:function(e){var t=this.activeVenue;this.activeVenue=e,this.dispatchEvent(new H.util.ChangeEvent(Zt.EVENTS.ACTIVE_VENUE_CHANGE,e,t)),this.reload()}},{key:"addVenue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(e instanceof Zt))throw new Error("Invalid argument");var n=e.getIdentifier();if(this.getVenue(n))throw new Error("Please invoke provider.removeVenue to remove old instance of venue ".concat(n," before adding new"));e.setParentEventTarget(this),this.venues.push(e),t||(this.reloadData_(),this.reloadStyle_())}},{key:"addVenues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length>0&&(t.forEach((function(t){t instanceof Zt&&e.addVenue(t,!0)})),this.reloadData_(),this.reloadStyle_())}},{key:"removeVenue",value:function(e){if(e instanceof Zt&&this.venues.indexOf(e)>-1){var t=e.getIdentifier();this.activeVenue&&this.activeVenue.getIdentifier()===t&&this.setActiveVenue(null),this.venues.splice(this.venues.indexOf(e),1),this.reloadData_(),this.reloadStyle_(),this.reload()}}},{key:"getFeatureProxy",value:function(e,t,n){var r=e.geometryId,i=e.venueId,o=this.getVenue(i);return r?n(o.getGeometries().find((function(e){return e.id===r}))):o&&n(o),!0}},{key:"addVenueEventListeners_",value:function(e){e&&(e.addEventListener(Zt.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.addEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.addEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"removeVenueEventListeners_",value:function(e){e&&(e.removeEventListener(Zt.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),e.removeEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),e.removeEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"activeVenueChangeHandler_",value:function(e){var t=e.oldValue,n=e.newValue;t&&(this.removeVenueEventListeners_(t),t.updateMapObjectsVisibility_()),n&&(this.addVenueEventListeners_(n),n.updateMapObjectsVisibility_())}},{key:"drawingChangeHandler_",value:function(){this.reload()}},{key:"levelChangeHandler_",value:function(){this.activeVenue&&(this.activeVenue.updateMapObjectsVisibility_(),this.reload())}},{key:"geometryHighlightHandler_",value:function(){this.reloadStyle_(this.activeVenue.getHighlightedGeometries())}},{key:"createDataLayers_",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(pe),n=pe.FOOTPRINT,r=pe.ICON,i=pe.TEXT,o=pe.VECTOR;t.forEach((function(t){switch(t){case o:e.dataLayers_[o]=Wt.getGeometryLayer(e.venues);break;case n:e.dataLayers_[n]=Wt.getFootprintLayer(e.venues);break;case r:e.dataLayers_[r]=Wt.getIconLayer(e.venues);break;case i:e.dataLayers_[i]=Wt.getLabelLayer(e.venues);break;default:throw new Error("Unsupported Layer ".concat(t))}}))}},{key:"createTileIndexes_",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(pe)).forEach((function(t){e.tileIndexes_[t]=new ee(e.dataLayers_[t],Qt)}))}},{key:"reloadData_",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(pe);this.createDataLayers_(e),this.createTileIndexes_(e)}},{key:"reloadStyle_",value:function(e){var t=this.dataLayers_[pe.ICON]?this.dataLayers_[pe.ICON].features:[];this.getEngineType()===H.Map.EngineType.WEBGL?this.setStyle(Jt.getStyle(t,e)):this.getEngineType()===H.Map.EngineType.HARP&&this.setStyle(Kt.getStyle(t,e))}},{key:"providesGeoJSON",value:function(){return!0}}]),n}(),$t=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),en=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),tn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImIiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PG1hc2sgaWQ9ImMiIHdpZHRoPSIzOCIgaGVpZ2h0PSI0NiIgeD0iMCIgeT0iMCIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iMjAiIGN5PSI0NS4xNiIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjOTc5Nzk3IiBzdHJva2Utd2lkdGg9Ii4yNSIgcng9IjMuNSIgcnk9IjMuNSIvPjx1c2UgZmlsbD0iIzAxQjZCMiIgeGxpbms6aHJlZj0iI2IiLz48cGF0aCBmaWxsPSIjMzIzMjMyIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNMTEuODEgMzcuNjZoMTYuMzhsLTguMiA4eiIvPjx1c2Ugc3Ryb2tlPSIjNDE2QTg2IiBzdHJva2Utd2lkdGg9Ii41IiBtYXNrPSJ1cmwoI2MpIiB4bGluazpocmVmPSIjYSIvPjxlbGxpcHNlIGN4PSIxOS44MSIgY3k9IjE5LjE5IiBmaWxsPSIjRkZGIiByeD0iNC44MSIgcnk9IjQuODEiLz48L2c+PC9zdmc+"),nn=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzMi44MyAzMy4xMDRjLjQwNy0uMzc0IDEuNDE5LTEuNDUyIDEuNDE5LTEuNDUyeiIvPjxtYXNrIGlkPSJjIiB3aWR0aD0iMzgiIGhlaWdodD0iNDYiIHg9IjAiIHk9IjAiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGVsbGlwc2UgaWQ9ImIiIGN4PSIxOS44MDciIGN5PSIxOS4xNjgiIHJ4PSIxMi4zNjMiIHJ5PSIxMi4xOTciLz48bWFzayBpZD0iZCIgd2lkdGg9IjI1LjcyNSIgaGVpZ2h0PSIyNS4zOTQiIHg9Ii0uNSIgeT0iLS41Ij48cGF0aCBmaWxsPSIjZmZmIiBkPSJNNi45NDQgNi40NzFoMjUuNzI1djI1LjM5NEg2Ljk0NHoiLz48dXNlIHhsaW5rOmhyZWY9IiNiIi8+PC9tYXNrPjwvZGVmcz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjQ1LjE2IiBmaWxsPSIjRkZGIiBzdHJva2U9IiM5Nzk3OTciIHN0cm9rZS13aWR0aD0iLjI1IiByeD0iMy41IiByeT0iMy41Ii8+PHVzZSBmaWxsPSIjMzIzMjMyIiB4bGluazpocmVmPSIjYSIvPjxwYXRoIGZpbGw9IiM3RDdEN0QiIGQ9Ik0xMi4wMTEgMzcuODA1aDE1Ljk3OGwtNy45MTYgOHoiLz48dXNlIHN0cm9rZT0iIzdDN0M3QyIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNlKSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNjKSIgeGxpbms6aHJlZj0iI2EiLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iMTkuODA3IiBjeT0iMTkuMTY4IiByeD0iMTIuMzYzIiByeT0iMTIuMTk3Ii8+PHBhdGggZmlsbD0iIzMyMzIzMiIgZD0iTTYuODEyIDYuOTQ4aDYuNDV2Ni4zNjRoLTYuNDV6bTAgMTIuNzI3aDYuNDV2Ni4zNjRoLTYuNDV6bTYuNDUtNi4zNjNoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS0xOS4wOTFoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS02LjM2M2g2LjQ1djYuMzY0aC02LjQ1em0wIDEyLjcyN2g2LjQ1djYuMzY0aC02LjQ1eiIvPjx1c2Ugc3Ryb2tlPSIjRkZGIiBtYXNrPSJ1cmwoI2QpIiB4bGluazpocmVmPSIjYiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIvPjwvZz48L3N2Zz4="),rn=function(e,t,n){return n===on.ObjectType.SEGMENT_START_MARKER?0===e?tn:null:n===on.ObjectType.SEGMENT_FINISH_MARKER?1===t.length||e===t.length-1?nn:null:"indoor"===t[e].departure.place.type?$t:en},on=function(){function e(t,n){c(this,e),this.indoorMapObjects_=null,this.outdoorMapObjects_=null,this.createRouteObjects_(t,n)}return d(e,[{key:"createRouteObjects_",value:function(t){var n=this,r=t.sections,i=void 0===r?[]:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;this.indoorMapObjects_={},this.outdoorMapObjects_=new H.map.Group;for(var s=function(t){var r=i[t],s=r.departure.place,u=s.id,l=s.type,c=H.util.flexiblePolyline.decode(r.polyline).polyline,h=void 0,d=void 0,p=a(t,i,e.ObjectType.SEGMENT_START_MARKER);p&&(h=new H.map.Marker(r.departure.place.location,{icon:p}));var f=a(t,i,e.ObjectType.SEGMENT_FINISH_MARKER);f&&(d=new H.map.Marker(r.arrival.place.location,{icon:f}));var v=a(t,i,e.ObjectType.SEGMENT_POLYLINE);if("indoor"===l){var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new Map,n=new H.geo.LineString,r=_(e[0],3)[2];return t.set(r,[n]),e.forEach((function(e){var i;e[2]!==r&&(r=e[2],n=new H.geo.LineString,t.has(r)?t.get(r).push(n):t.set(r,[n])),(i=n).pushLatLngAlt.apply(i,S(e))})),t}(c),y=Array.from(g.keys()).reduce((function(e,t){return e[t]||(e[t]=new H.map.Group),e}),{});v&&g.forEach((function(e,t){e.forEach((function(e){if(e.getPointCount()>1){var n=new H.map.Polyline(e,{style:v});y[t].addObject(n)}}))})),h&&y[r.departure.place.location.lvl].addObject(h),d&&y[r.arrival.place.location.lvl].addObject(d),n.indoorMapObjects_[u]=o(o({},n.indoorMapObjects_[u]||{}),y)}else{if(v){var m=new H.geo.LineString(c.flatMap((function(e){return[e[0],e[1],0]}))),E=new H.map.Polyline(m,{style:v});n.outdoorMapObjects_.addObject(E)}h&&n.outdoorMapObjects_.addObject(h),d&&n.outdoorMapObjects_.addObject(d)}},u=0;u<i.length;u++)s(u)}},{key:"getIndoorObjects",value:function(){return this.indoorMapObjects_}},{key:"getOutdoorObjects",value:function(){return this.outdoorMapObjects_}}]),e}();on.ObjectType={SEGMENT_START_MARKER:1,SEGMENT_FINISH_MARKER:2,SEGMENT_POLYLINE:3};var an=function(e){f(n,H.service.Service);var t=E(n);function n(e){var r;c(this,n),r=t.call(this,n,o(o({},e),{},{baseUrl:void 0}));var i={apiKey:e.apikey,baseUrl:e.baseUrl,token:e.token},a={apiKey:i.apiKey,token:i.token};i.apiKey||(i.apiKey=r.getUrl().getQuery().apikey);var s=e.useLegacy||!1;return r.venueService_=new zt(i,s),a.apiKey||(a.apiKey=r.getUrl().getQuery().apikey),e.routingBaseUrl&&(a.baseUrl=e.routingBaseUrl),r.routingService_=new Ut(a),r}return d(n,[{key:"loadVenue",value:function(e){return console.warn("Venue service version 1 is no longer supported hence "+e+" could not be loaded"),Promise.resolve()}},{key:"calculateRoute",value:function(e){return console.warn("HERE Indoor Routing is deprecated and will be removed soon."),this.routingService_.calculateRoute(e)}}]),n}();an.CONFIG_KEY="venues";var sn=function(e){f(n,H.service.Service);var t=E(n);function n(e){var r;c(this,n),r=t.call(this,n,o(o({},e),{},{baseUrl:void 0}));var i={apiKey:e.apikey,baseUrl:e.baseUrl,token:e.token,hrn:e.hrn};i.apiKey||(i.apiKey=r.getUrl().getQuery().apikey);var a=e.useLegacy||!1;return r.venueService_=new zt(i,a),r}return d(n,[{key:"loadVenue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.venueService_.load(e,t).then((function(e){return new Zt(e)}))}},{key:"getMapInfoList",value:function(){return this.venueService_.getSupportedMapList()}}]),n}();sn.CONFIG_KEY="indoorMaps",H.service.Platform.prototype.getVenuesService=function(e,t){var n=sn;return 1!==t&&t?t!==fe.v2||e.token||(e.hrn?e.apikey||console.error("Venue Service version 2 requires either apikey or token"):console.error("Token is mandatory when Hrn is not provided in Venue Service version 2")):(console.warn("Venue service version 1 is no longer supported"),n=an),this.createService(n,e)},sn.LABEL_TEXT_PREFERENCE_OVERRIDE={OCCUPANT_NAMES:"OCCUPANT_NAMES",SPACE_NAME:"SPACE_NAME",SPACE_TYPE_NAME:"SPACE_TYPE_NAME",SPACE_CATEGORY_NAME:"SPACE_CATEGORY_NAME",INTERNAL_ADDRESS:"INTERNAL_ADDRESS"};var un=function(e){f(n,H.ui.Control);var t=E(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,n),(r=t.call(this)).provider_=null,r.levelSelectorUI_=null,r.setAlignment(i&&i.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),r.addClass("venues-ui"),e instanceof Zt&&r.setVenue(e),r}return d(n,[{key:"renderInternal",value:function(e,t){I(v(n.prototype),"renderInternal",this).call(this,e,t),this.createLevelSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof Zt&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.update_(),this.addEventListeners_())}},{key:"createLevelSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.levelSelectorUI_=null;this.levelSelectorUI_=new Lt(e,null,null,(function(e){return t.venue.setActiveLevelIndex(e)}))}},{key:"update_",value:function(){if(this.levelSelectorUI_){var e=this.venue.getActiveDrawing().getData(),t=this.venue.getData().getDisplaySettings();this.levelSelectorUI_.update(e,t),this.levelChangeHandler_()}}},{key:"addEventListeners_",value:function(){this.venue&&(this.venue.addEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.addEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.addEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&(this.venue.removeEventListener(Zt.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.removeEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.removeEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"levelChangeHandler_",value:function(){this.levelSelectorUI_.switch(this.venue.getActiveLevelIndex())}},{key:"drawingChangeHandler_",value:function(){this.update_()}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}]),n}(),ln=function(e){f(n,H.ui.Control);var t=E(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,n),(r=t.call(this)).provider_=null,r.drawingSelectorUI_=null,r.addClass("venues-ui"),r.setAlignment(i&&i.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),e instanceof Zt&&r.setVenue(e),r}return d(n,[{key:"renderInternal",value:function(e,t){I(v(n.prototype),"renderInternal",this).call(this,e,t),this.createDrawingSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(e){e instanceof Zt&&(this.removeEventListeners_(),this.venue=e,this.provider_=e.getParentEventTarget(),this.drawingSelectorUI_&&this.drawingSelectorUI_.update(e.getData()),this.addEventListeners_())}},{key:"createDrawingSelectorUI_",value:function(e){var t=this;e.innerHTML="",this.drawingSelectorUI_=null,this.drawingSelectorUI_=new It(e,null,(function(e){return t.venue.setActiveDrawing(e)}))}},{key:"addEventListeners_",value:function(){this.venue&&this.venue.addEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.addEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&this.venue.removeEventListener(Zt.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.removeEventListener(Zt.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"drawingChangeHandler_",value:function(){this.drawingSelectorUI_.switch(this.venue.getActiveDrawing().id)}},{key:"activeVenueChangeHandler_",value:function(e){this.setVenue(e.newValue)}}]),n}(),cn=Object.freeze({__proto__:null,DrawingControl:ln,LevelControl:un});return t(".venues-ui * {\n  font-family: \"Fira Sans\", \"Helvetica Neue\", Helvetica, sans-serif;\n  color: #0F1621;\n}\n.venues-ui .arrow {\n  display: block;\n  width: 100%;\n  height: 100%;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n.venues-ui .arrow--up {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-426.000000, -584.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls-Copy' transform='translate(417.753906, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(15.000000, 16.499023) rotate(-180.000000) translate(-15.000000, -16.499023) translate(9.000000, 12.749023)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .arrow--down {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-347.000000, -704.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls' transform='translate(338.251953, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(9.000000, 132.746094)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .venues-ui-button {\n  display: block;\n  width: 40px;\n  height: 40px;\n  line-height: 40px;\n  font-size: 16px;\n  font-weight: 600;\n  background-color: #fff;\n  border: none;\n  border-bottom: 1px solid #9FA2A6;\n  cursor: pointer;\n  overflow: hidden;\n  color: #6e737a;\n  text-align: center;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.venues-ui .venues-ui-button:hover, .venues-ui .venues-ui-button--active {\n  background-color: #f0f0f0;\n  color: #0F1621;\n}\n@keyframes fade {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n.venues-ui__drawings .drawings {\n  position: absolute;\n  top: 0;\n  right: 45px;\n  display: none;\n  opacity: 0;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .drawings--open {\n  display: block;\n  opacity: 1;\n  animation: fade 1s;\n}\n.venues-ui__drawings .drawings .venues-ui-button {\n  width: auto;\n  padding: 0 10px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__drawings .trigger {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__drawings .trigger.venues-ui-button--active .arrow {\n  transform: rotate(90deg);\n  transition: 0.4s;\n}\n.venues-ui__levels {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__levels .levels {\n  overflow: hidden;\n}\n.venues-ui__levels .venues-ui-button--up + .levels .venues-ui-button {\n  border-radius: 0;\n}\n.venues-ui__levels .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button[disabled=disabled] .arrow {\n  opacity: 0.5;\n}\n.venues-ui__directory {\n  position: absolute;\n  top: 10px;\n  right: 60px;\n  bottom: calc(100% - 45px);\n  width: 350px;\n  overflow: hidden;\n  background: white;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__directory.active {\n  bottom: 10px;\n}\n.venues-ui__directory .directory__list {\n  top: 80px;\n  bottom: 20px;\n  position: absolute;\n  overflow-y: scroll;\n  right: 10px;\n  left: 10px;\n  font-size: 12px;\n}\n.venues-ui__directory .directory__list svg {\n  width: 25px;\n  height: 25px;\n}\n.venues-ui__directory .directory__heading {\n  margin: 8px;\n  font-size: 15px;\n  font-weight: normal;\n  cursor: pointer;\n}\n.venues-ui__directory .directory__input {\n  margin: 10px;\n}\n.venues-ui__directory .directory__input input {\n  width: 100%;\n  padding: 5px 0;\n}\n.venues-ui__directory .directory__trigger {\n  position: absolute;\n  right: 10px;\n  top: 15px;\n  width: 10px;\n  height: 10px;\n}\n.venues-ui__directory .directory__trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__directory .directory__trigger--active .arrow {\n  transform: rotate(-180deg);\n  transition: 0.4s;\n}"),e.Drawing=A,e.Geometry=L,e.Level=T,e.Provider=qt,e.Route=on,e.Service=an,e.Service2=sn,e.Venue=Zt,e.ui=cn,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
}).call(self);
export default H;